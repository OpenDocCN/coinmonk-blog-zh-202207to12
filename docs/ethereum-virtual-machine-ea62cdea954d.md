# ä»¥å¤ªåŠè™šæ‹Ÿæœº

> åŸæ–‡ï¼š<https://medium.com/coinmonks/ethereum-virtual-machine-ea62cdea954d?source=collection_archive---------2----------------------->

## solidity å¼€å‘è€…å®ç”¨æŒ‡å—

# ä»€ä¹ˆæ˜¯ EVMï¼Ÿ

ä½ å¯èƒ½å¬è¯´è¿‡ **Java è™šæ‹Ÿæœº**ï¼Œå¼€å‘è€…ç”¨ Java(æˆ–å…¶ä»–è¯­è¨€)ç¼–å†™çš„ä»£ç ç¼–è¯‘æˆ Java å­—èŠ‚ç ï¼ŒJVM æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å¼•æ“**æ‰§è¡Œ Java å­—èŠ‚ç **ã€‚ä»¥å¤ªåŠè™šæ‹Ÿæœºåœ¨é«˜å±‚æ¬¡ä¸Šæ˜¯ç±»ä¼¼çš„ï¼Œå¼€å‘è€…ç”¨ Solidity(æˆ–å…¶ä»–è¯­è¨€ï¼Œå¦‚ Vyper)ç¼–ç ï¼Œå¹¶å‘ä¸‹ç¼–è¯‘æˆ EVM å­—èŠ‚ç ï¼ŒEVM æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å¼•æ“ï¼Œæ‰§è¡Œ EVM å­—èŠ‚ç ã€‚

![](img/d4038eedaff58040e9149e0d85150661.png)

credit to ethereum.org on a high level of EVM

**å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ**

EVM æ˜¯ä¸€ä¸ªåŸºäºäº‹åŠ¡çš„çŠ¶æ€æœºâ€”â€”å¦‚æœäº‹åŠ¡å¤±è´¥ï¼ŒçŠ¶æ€ä¸ä¼šæ›´æ–°ï¼Œé™¤äº†å‘é€è€…æ”¯ä»˜æ±½æ²¹çš„ nonce å’Œ eth ä½™é¢ã€‚

1.  **EVM ä»£ç â€”** å¼€å‘äººå‘˜ç¼–å†™æ™ºèƒ½åˆåŒï¼Œå°†å…¶ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œç„¶åç­¾ç½²å¹¶åœ¨é“¾ä¸Šæ¨é€äº¤æ˜“ï¼Œä»¥åœ¨ EVM åˆ›å»ºæ™ºèƒ½åˆåŒã€‚
2.  å½“ç”¨æˆ·æˆ–å¦ä¸€ä¸ªæ™ºèƒ½åˆçº¦ä¸æ™ºèƒ½åˆçº¦äº¤äº’æ—¶ï¼ŒEVM ä¼šå°†åˆçº¦å­—èŠ‚ç (æ“ä½œç åºåˆ—)åŠ è½½åˆ°**å†…å­˜**ä¸­ã€‚
3.  ç„¶åï¼ŒEVM å°†æ‰§è¡Œæ“ä½œç åºåˆ—ã€‚å½“æ‰§è¡Œæ­£åœ¨è¿›è¡Œæ—¶ï¼Œ**ç¨‹åºè®¡æ•°å™¨**(ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€)å°†å¢åŠ ã€‚**å¯ç”¨æ°”ä½“**å°†æ ¹æ®æ“ä½œç å‡å°‘ï¼Œå¦‚æœå¯ç”¨æ°”ä½“ä¸è¶³åˆ™ç»ˆæ­¢ã€‚ä»»ä½•åœ¨å­˜å‚¨å™¨ä¸­å­˜å‚¨æ•°æ®çš„æ“ä½œå°†åœ¨**è´¦æˆ·å­˜å‚¨å™¨**ä¸­æŒç»­å­˜åœ¨(ä»…é€‚ç”¨äºæ™ºèƒ½åˆçº¦)ã€‚

# **ä»€ä¹ˆæ˜¯æ“ä½œç ï¼Ÿ**

æ€»å…±æœ‰ 141 ä¸ª EVM æ“ä½œç å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‡ ç±»ä»»åŠ¡(ä¸å®Œå…¨)ã€‚å®Œæ•´çš„æ¸…å•åŠå…¶ç›¸å…³çš„å¤©ç„¶æ°”æˆæœ¬å¯åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°: [https://www.evm.codes/](https://www.evm.codes/)

1.  åŠ è½½å¹¶ä¿å­˜åˆ°å†…å­˜/å­˜å‚¨å™¨(`mload` | `mstore` | `sload` | ã€T3)
2.  å·¥è‰ºæµç¨‹(`jump`
3.  ç®—æœ¯(`add` | `mul` | `sub` | `div`ç­‰)
4.  æ¯”è¾ƒ(`eq` | `isZero`)
5.  EVM ç¯å¢ƒç›¸å…³(`gas` | `caller`)

# ä¾‹å¦‚:å¯é æ€§->å­—èŠ‚ç ->æ“ä½œç 

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ Solidity ä»£ç ç¤ºä¾‹å’Œæ¼”ç»ƒ

1.  ä¸€ä¸ªå¥‘çº¦åœ¨å­—èŠ‚ç å’Œæ“ä½œç ä¸­æ˜¯ä»€ä¹ˆæ ·å­çš„
2.  EVM å¦‚ä½•çŸ¥é“å‡½æ•°è°ƒç”¨è¦æ‰§è¡Œå“ªä¸ªæ“ä½œç 

## **åœ¨å­—èŠ‚ç å’Œæ“ä½œç ä¸­ï¼Œå¥‘çº¦çœ‹èµ·æ¥åƒä»€ä¹ˆ**

æˆ‘ä»¬å°†ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ç®€å•å¥‘çº¦:

é€šè¿‡ [solcjs](https://github.com/ethereum/solc-js)
`> solcjs -o BytecodeDir --bin src/Demo.sol`ç¼–è¯‘æˆå­—èŠ‚ç å

```
608060405234801561001057600080fd5b50610133806100206000396000f3fe6080604052348015600f57600080fd5b506004361060325760003560e01c80633c6bb4361460375780633d4197f0146051575b600080fd5b603d6069565b604051604891906090565b60405180910390f35b606760048036038101906063919060d5565b606f565b005b60005481565b8060008190555050565b6000819050919050565b608a816079565b82525050565b600060208201905060a360008301846083565b92915050565b600080fd5b60b5816079565b811460bf57600080fd5b50565b60008135905060cf8160ae565b92915050565b60006020828403121560e85760e760a9565b5b600060f48482850160c2565b9150509291505056fea26469706673582212202008ce9f466108e302b16a0a7d864882e3925c470c9a7371c7c03dfa5083b56f64736f6c63430008110033
```

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ [Etherscan çš„](https://etherscan.io/opcode-tool)å·¥å…·è½¬æ¢æˆæ“ä½œç (ä¹Ÿå¯ä»¥ä½¿ç”¨`solc`å‘½ä»¤)

```
[0] DUP1
[2] PUSH1 0x40
[3] MSTORE
[4] CALLVALUE
...
```

å½“ä½ è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¾‹å¦‚`setVal(uint256)`â€”â€”ä½ çš„è¾“å…¥æ•°æ®å°†åŒ…å«ä½ çš„æ–¹æ³•ç­¾åå’Œè¾“å…¥å€¼ã€‚ä¾‹å¦‚ï¼Œå½“æ‚¨è°ƒç”¨`setVal(10)`æ—¶ï¼Œå‰ 4 ä¸ªå­—èŠ‚æ˜¯`3d4197f0`ï¼Œæ¥ä¸‹æ¥çš„ 32 ä¸ªå­—èŠ‚åŒ…å«æ‚¨çš„è¾“å…¥å€¼`10`

```
> abi.encodeWithSignature("setVal(uint256)", 10)0x3d4197f0000000000000000000000000000000000000000000000000000000000000000a
```

æ‚¨å¯ä»¥å°è¯•æœç´¢`3d4197f0`â€”â€”å®ƒå­˜åœ¨äºå­—èŠ‚ç ä¸­ï¼è¿™æ˜¯ç¬¬ä¸€ä¸ªå…³äº EVM å¦‚ä½•çŸ¥é“ä¸ºä¸€ä¸ªæ–¹æ³•è°ƒç”¨æ‰§è¡Œå“ªä¸ªæ“ä½œç çš„æç¤ºğŸ˜€

## **EVM å¦‚ä½•çŸ¥é“å‡½æ•°è°ƒç”¨è¦æ‰§è¡Œå“ªä¸ªæ“ä½œç **

**ç¬¬ä¸€æ­¥:**
å°†ä¸Šé¢çš„`Demo.sol`å¤åˆ¶åˆ° [Remix](https://remix.ethereum.org/) ä¸­ï¼Œç¼–è¯‘éƒ¨ç½²ã€‚ç„¶åè°ƒç”¨`setVal(10)`å¹¶æŒ‰ä¸‹â€œè°ƒè¯•â€å›¾æ ‡ï¼Œå®ƒä¼šæŠŠä½ å¸¦åˆ°è°ƒè¯•å™¨

ä½ åº”è¯¥çœ‹åˆ°å®ƒç›´æ¥æŠŠä½ å¸¦åˆ°äº†è¿™ä¸ªæ“ä½œç ï¼Œå®ƒåœ¨å‡½æ•°ä½“ä¸­ï¼Œå°½ç®¡æˆ‘ä»¬çƒ­è¡·äº EVM å¦‚ä½•æŠŠæˆ‘ä»¬å¸¦åˆ°è¿™ä¸ªæ“ä½œç ï¼Œè€Œä¸æ˜¯å‡½æ•°æ‰§è¡Œçš„æ“ä½œç ã€‚

```
112 DUP1 
113 PUSH1 00
115 DUP2 
```

**ç¬¬äºŒæ­¥:** æŒ‰ä¸‹åé€€ï¼Œç›´åˆ°çœ‹åˆ°è¿™æ¡æŒ‡ä»¤é«˜äº®æ˜¾ç¤ºã€‚

![](img/175fca49e09654ee19578f12544fed33.png)

æ­¤æ—¶ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æ–¹æ³•ç­¾ååœ¨å †æ ˆä¸­ã€‚ä»å †æ ˆä¸­å–å‡ºä¸¤ä»¶ç‰©å“ã€‚å¦‚æœç›¸ç­‰ï¼Œåˆ™æŒ‰ 1ï¼Œå¦åˆ™æŒ‰ 0)æ˜¯ä¸‹ä¸€ä¸ªè¦è°ƒç”¨çš„æ“ä½œç ã€‚ç«‹å³å †å :

```
Since both value are equal
0: 0x..01
1: 0x..3d4197f0
```

éšåæ˜¯å°†`0x51`æ¨å…¥å †æ ˆçš„`PUSH 51`ã€‚ç«‹å³å †å :

```
0: 0x..51
1: 0x..01
2: 0x..3d4197f0
```

ä¹‹åæ˜¯å…³é”®éƒ¨åˆ†`JUMPI`(ä»å †æ ˆä¸­å¼¹å‡º 2 å€¼ï¼Œå¦‚æœ index 1 å¤§äº 0 åˆ™è¿›è¡Œ index 0 ç¨‹åºè®¡æ•°å™¨ï¼Œå¦åˆ™ç»§ç»­)ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œç”±äºå †æ ˆçš„ç´¢å¼• 1 æ˜¯éé›¶çš„ï¼Œç¨‹åºè®¡æ•°å™¨å°†å‰è¿›åˆ°æˆ‘ä»¬çš„æ–¹æ³•ä½“`0x51`ã€‚è¿™å°±æ˜¯ EVM å¦‚ä½•çœ‹å¾…å‡½æ•°ç­¾åï¼Œå¹¶ç»§ç»­æ‰§è¡Œæ­£ç¡®çš„æ“ä½œç ã€‚

**å¦‚æœåœ¨ JUMPIO** ä¸­ä¸ç›¸ç­‰æ€ä¹ˆåŠï¼Ÿç¨‹åºå°†ä¸ä¼šè·³è½¬ï¼Œå¹¶æœ€ç»ˆåœ¨æ“ä½œç `054`å¤„åˆ°è¾¾`REVERT`è°ƒç”¨

# **ç»“å°¾æ³¨é‡Š**

ç†è§£ EVM æ˜¯å¦‚ä½•å·¥ä½œçš„æœ‰åŠ©äºæˆä¸ºæ›´å¥½çš„å¯é æ€§å¼€å‘äººå‘˜ï¼Œå°±åƒ Java å¼€å‘äººå‘˜åº”è¯¥ç†è§£ JVM ä¸€æ ·ã€‚ä¾‹å¦‚ï¼ŒæŸ¥çœ‹[æ“ä½œç ](https://www.evm.codes/) `mstore`å’Œ`sstore`çš„ gasâ€”æ‚¨ä¼šçœ‹åˆ°å­˜å‚¨åœ¨å†…å­˜å’Œå­˜å‚¨ä¸­çš„ gas å·®å¼‚ã€‚

æˆ‘çœŸçš„å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½æœ‰æ‰€å¸®åŠ©ï¼åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºæ™ºèƒ½åˆçº¦çš„ gas ä¼˜åŒ–ï¼Œè¿™äº›æ“ä½œç çŸ¥è¯†åº”è¯¥ä¼šæ´¾ä¸Šç”¨åœºï¼

# å‚è€ƒ

è¿™äº›æ–‡ç« æå¤§åœ°å¸®åŠ©äº†æˆ‘äº†è§£ EVMï¼Œè¿™è¦å½’åŠŸäºä»–ä»¬ï¼

1.  [https://www.evm.codes/](https://www.evm.codes/)
2.  [https://leftasexercise . com/2021/08/08/q-smart-contracts-and-the-ether eum-virtual-machine/](https://leftasexercise.com/2021/08/08/q-smart-contracts-and-the-ethereum-virtual-machine/)
3.  [https://noxx . substack . com/p/EVM-deep-dives-the-path-to-shadow](https://noxx.substack.com/p/evm-deep-dives-the-path-to-shadowy)

> äº¤æ˜“æ–°æ‰‹ï¼Ÿå°è¯•[åŠ å¯†äº¤æ˜“æœºå™¨äºº](/coinmonks/crypto-trading-bot-c2ffce8acb2a)æˆ–[å¤åˆ¶äº¤æ˜“](/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c)