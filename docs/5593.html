<html>
<head>
<title>CSC Tracker Bot Using PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PHP的CSC跟踪机器人</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/csc-tracker-bot-using-php-d3b8c08710c9?source=collection_archive---------29-----------------------#2022-10-27">https://medium.com/coinmonks/csc-tracker-bot-using-php-d3b8c08710c9?source=collection_archive---------29-----------------------#2022-10-27</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="81b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当你使用社交媒体时，你有没有尝试过跟踪CSC网络。在本教程中，我们将使用php和coinex.net API服务编写一个CSC跟踪机器人</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/f1ca77a95c3273468213277dcf45bf7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mswiiZpxECTBRxhygPr6vA.jpeg"/></div></div></figure><h2 id="cdfe" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated"><strong class="ak">电报</strong></h2><p id="c1ea" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">Telegram是一种流行的即时通讯服务，以其安全性而自豪。它拥有现代聊天平台的所有功能，包括<strong class="is hu">聊天机器人</strong>:基于软件的代理，你可以通过编程读取和回复其他用户的消息。</p><h2 id="8806" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">设置你的电报机器人</h2><p id="18e2" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">创建电报机器人的第一步是建立机器人最终支持的配置文件。这也是获得电报API令牌的方法。</p><p id="180f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要设置新的机器人档案，请登录您的Telegram帐户，并与允许您创建和管理机器人的官方帐户<strong class="is hu">机器人父亲</strong>(@机器人父亲)开始对话。在该对话中，输入<code class="eh la lb lc ld b">/newbot</code>命令。</p><p id="6472" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">机器人父亲会要求你为你的机器人选择一个显示名<em class="le">和</em>用户名。用户名必须以“bot”结尾，并且必须是唯一的。在我们的例子中，我们已经确定了显示名称<em class="le"> CSCTrcker_bot </em>和用户名<em class="le"> CSCTrackerBot </em></p><p id="8f10" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一旦你登陆了一个有效的用户名，机器人父亲会自动注册你的机器人，并回复一个电报API的令牌，这个令牌是机器人独有的。确保不要与任何人共享您的令牌。</p><h1 id="ffd2" class="lf kb ht bd kc lg lh li kg lj lk ll kk lm ln lo kn lp lq lr kq ls lt lu kt lv dt translated">为你的机器人设置一个网络钩子</h1><p id="dc26" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">创建电报机器人的下一步是设置将与机器人通信的webhook。Webhooks是API告诉你发生了什么事情的方式，这样你就不必每隔几分钟(或几秒钟)就去查询API，看看是否有新消息被发送。</p><p id="219c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Telegram只使用一种webhook，每当发生<em class="le">任何</em>事件时，它都会向你发送一个<code class="eh la lb lc ld b">update</code>对象。</p><p id="7592" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">设置webhook非常简单。您只需要知道两件事:您的API令牌(您应该从第一步就有了)和您将托管bot的URL。该网址将类似于<code class="eh la lb lc ld b">https://Example.com/Bot.php</code>。确保在URL的开头包含<code class="eh la lb lc ld b">https</code>;否则，电报不会发送webhook。</p><p id="e0c8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，在常规的网络浏览器中，导航到<code class="eh la lb lc ld b">https://api.telegram.org/bot&lt;yourtoken&gt;/setwebhook?url=https://Example.com/Bot.php</code>。瞧，你的webhook现在已经启动并运行了！</p><h1 id="2153" class="lf kb ht bd kc lg lh li kg lj lk ll kk lm ln lo kn lp lq lr kq ls lt lu kt lv dt translated">让我们编码</h1><p id="3a04" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">是时候为我们的电报机器人写逻辑了。我会这样继续下去…</p><p id="8b70" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先要做的是初始化一个变量，这将使我们能够轻松地调用电报API。就这么简单<code class="eh la lb lc ld b">$path = "https://api.telegram.org/bot&lt;yourtoken&gt;</code>。</p><p id="79d3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将你的token api(从bot father)粘贴到<yourtoken>。</yourtoken></p><p id="d7cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因为我们将通过webhook接收更新，所以让我们创建一个数组并填充更新数据:<code class="eh la lb lc ld b">$update = json_decode(file_get_contents("php://input"), TRUE)</code></p><p id="0f40" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，为了以后方便起见，让我们从更新中提取两个关键的数据—聊天ID和消息(如果更新不是由新消息引起的，这个字段可能是空的，我们将在后面编写代码):</p><pre class="jp jq jr js fq lw ld lx ly aw lz dt"><span id="7244" class="ka kb ht ld b fv ma mb l mc md">$chatId = $update["message"]["chat"]["id"];<br/>$message = $update["message"]["text"];</span></pre><p id="aaea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你还没有猜到这个机器人应该做什么，我想让它告诉我我选择的位置的当前天气。为此，我将创建一个<code class="eh la lb lc ld b">/asset [Address]</code>命令。</p><p id="f482" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为此，让我们创建一个<code class="eh la lb lc ld b">if</code>语句，看看消息是否以<code class="eh la lb lc ld b">/asset</code>开头。我们可以用<code class="eh la lb lc ld b">strpos()</code>函数来完成，它告诉我们子串在字符串中的位置:</p><pre class="jp jq jr js fq lw ld lx ly aw lz dt"><span id="3019" class="ka kb ht ld b fv ma mb l mc md">if (strpos($message, "/asset") === 0) {<br/>}</span></pre><p id="0f03" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">嵌套在该<code class="eh la lb lc ld b">if</code>语句中，让我们编写一些代码，通过截掉消息的前九个字符来提取位置(这是由<code class="eh la lb lc ld b">/asset </code>命令使用的字符数，以及它后面的空格):</p><pre class="jp jq jr js fq lw ld lx ly aw lz dt"><span id="3b94" class="ka kb ht ld b fv ma mb l mc md">if (strpos($message, "/asset") === 0) {<br/>$asset = substr($message, 9);<br/>}</span></pre><p id="fc2b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果这个机器人被用于生产，我们必须添加一些输入清理，以确保位置采取正确的格式。但事实并非如此，所以我们不会为此担心。</p><p id="d6ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们将从coinex.net获得数据:</p><pre class="jp jq jr js fq lw ld lx ly aw lz dt"><span id="6d16" class="ka kb ht ld b fv ma mb l mc md">$curl = curl_init();<br/>curl_setopt_array($curl, [<br/>	CURLOPT_URL =&gt; "https://www.coinex.net/api/v1/transactions/".$message,<br/>	CURLOPT_RETURNTRANSFER =&gt; true,<br/>	CURLOPT_FOLLOWLOCATION =&gt; true,<br/>	CURLOPT_ENCODING =&gt; "",<br/>	CURLOPT_MAXREDIRS =&gt; 10,<br/>	CURLOPT_TIMEOUT =&gt; 30,<br/>	CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,<br/>	CURLOPT_CUSTOMREQUEST =&gt; "GET",<br/>	CURLOPT_HTTPHEADER =&gt; [<br/>		"apikey: YOUR API KEY",<br/>	],<br/>]);<br/><br/>$response = curl_exec($curl);<br/>$err = curl_error($curl);<br/>curl_close($curl);<br/>$data = json_decode($response, true);</span></pre><p id="106d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里我们应该实现某种错误处理，但是我不想麻烦。相反，让我们抱最好的希望，使用Telegram API发送我们的机器人的响应:</p><pre class="jp jq jr js fq lw ld lx ly aw lz dt"><span id="d0af" class="ka kb ht ld b fv ma mb l mc md">file_get_contents($path."/sendmessage?chat_id=".$chatId."&amp;text="The list of assets:". $.data);</span></pre><p id="e2e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">总而言之，下面是代码的样子:</p><pre class="jp jq jr js fq lw ld lx ly aw lz dt"><span id="54cc" class="ka kb ht ld b fv ma mb l mc md">&lt;?php<br/>$path = "https://api.telegram.org/bot&lt;PasteYourTokenHere&gt;";</span><span id="8c41" class="ka kb ht ld b fv me mb l mc md">$update = json_decode(file_get_contents("php://input"), TRUE);</span><span id="d7d2" class="ka kb ht ld b fv me mb l mc md">$chatId = $update["message"]["chat"]["id"];<br/>$message = $update["message"]["text"];</span><span id="2f8b" class="ka kb ht ld b fv me mb l mc md">$curl = curl_init();<br/>curl_setopt_array($curl, [<br/>	CURLOPT_URL =&gt; "https://www.coinex.net/api/v1/transactions/".$message,<br/>	CURLOPT_RETURNTRANSFER =&gt; true,<br/>	CURLOPT_FOLLOWLOCATION =&gt; true,<br/>	CURLOPT_ENCODING =&gt; "",<br/>	CURLOPT_MAXREDIRS =&gt; 10,<br/>	CURLOPT_TIMEOUT =&gt; 30,<br/>	CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,<br/>	CURLOPT_CUSTOMREQUEST =&gt; "GET",<br/>	CURLOPT_HTTPHEADER =&gt; [<br/>		"apikey: YOUR API KEY",<br/>	],<br/>]);<br/><br/>$response = curl_exec($curl);<br/>$err = curl_error($curl);<br/>curl_close($curl);<br/>$data = json_decode($response, true);</span><span id="0174" class="ka kb ht ld b fv me mb l mc md">if (strpos($message, "/asset") === 0) {<br/>    $location = substr($message,6,42);<br/>    $asset=$data;<br/>    file_get_contents($path."/sendmessage?chat_id=".$chatId."&amp;text="The list of assets:". $.data);<br/>}</span><span id="b158" class="ka kb ht ld b fv me mb l mc md">?&gt;</span></pre><h2 id="4ce4" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">部署机器人</h2><p id="f215" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">逻辑完成后，将代码保存为PHP文件。然后，上传文件到你可以上传你的机器人到一个共享主机，并设置网页挂钩。</p><blockquote class="mf"><p id="10f0" class="mg mh ht bd mi mj mk ml mm mn mo jn ek translated">交易新手？尝试<a class="ae mp" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae mp" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>