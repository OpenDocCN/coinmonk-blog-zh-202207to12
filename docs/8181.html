<html>
<head>
<title>#5- Ethernaut Challenge 5— Token</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">#5-以太网挑战5-令牌</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/5-ethernaut-challenge-5-token-e4dfaf1f249c?source=collection_archive---------46-----------------------#2022-12-28">https://medium.com/coinmonks/5-ethernaut-challenge-5-token-e4dfaf1f249c?source=collection_archive---------46-----------------------#2022-12-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/f208e9a03165eb55563bd5b667ed794a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uk0Ah90eDbkNBFlvbp3w6Q.png"/></div></div></figure><h1 id="10ea" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">理解代码:</h1><pre class="jz ka kb kc fq kd ke kf bn kg kh bi"><span id="7ce3" class="ki jc ht ke b be kj kk l kl km">// SPDX-License-Identifier: MIT<br/>pragma solidity ^0.6.0;<br/><br/>contract Token {<br/><br/>  mapping(address =&gt; uint) balances;<br/>  uint public totalSupply;<br/><br/>  constructor(uint _initialSupply) public {<br/>    balances[msg.sender] = totalSupply = _initialSupply;<br/>  }<br/><br/>  function transfer(address _to, uint _value) public returns (bool) {<br/>    require(balances[msg.sender] - _value &gt;= 0);<br/>    balances[msg.sender] -= _value;<br/>    balances[_to] += _value;<br/>    return true;<br/>  }<br/><br/>  function balanceOf(address _owner) public view returns (uint balance) {<br/>    return balances[_owner];<br/>  }<br/>}</span></pre><p id="a0e2" class="pw-post-body-paragraph kn ko ht kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">有一个balances的映射，它将用户的地址信息与他们的地址uint值存储在一起。totalSupply变量跟踪所有创建的令牌供应。</p><p id="6bf4" class="pw-post-body-paragraph kn ko ht kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">一旦部署了契约，就执行构造函数，它在balances映射中将部署者地址下的总供应量和初始供应量设置为相等。</p><blockquote class="ll"><p id="4786" class="lm ln ht bd lo lp lq lr ls lt lu lk ek translated">交易新手？在<a class="ae lv" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳密码交易所</a>上尝试<a class="ae lv" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a>或<a class="ae lv" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote><p id="3552" class="pw-post-body-paragraph kn ko ht kp b kq lw ks kt ku lx kw kx ky ly la lb lc lz le lf lg ma li lj lk hm dt translated">传递函数需要传递两个参数，目的地址和以太值。该函数检查发送方的余额(当扣除要转账的乙醚值时)是否大于0，以确保金额可以转账。一旦支票兑现，从发送方地址的余额映射中减少金额，并增加接收方地址的余额。</p><p id="4da0" class="pw-post-body-paragraph kn ko ht kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">在balances[msg.sender] -= _value行中，此函数看起来很弱。我们可以在这一行触发算术下溢。</p><p id="713f" class="pw-post-body-paragraph kn ko ht kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">balanceOf函数只是返回所有者的余额。</p><p id="a1a1" class="pw-post-body-paragraph kn ko ht kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">现在，我们需要理解solidity中的下溢和上溢的概念。你可以在这里查看我简短的2分钟阅读博客<a class="ae lv" rel="noopener" href="/@rahulpujari2919/2-smart-contract-security-attacks-overflow-underflow-784339208666"/>。一旦你理解了下溢和上溢，我们就可以破解合同了。</p><h1 id="096b" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">怎么黑这个合同？</h1><ol class=""><li id="99ba" class="mb mc ht kp b kq md ku me ky mf lc mg lg mh lk mi mj mk ml dt translated">去控制台输入<strong class="kp hu">await contract . balance of(player)。这表明您的账户在地址映射上的余额为20英镑。</strong></li></ol><figure class="jz ka kb kc fq iu fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/c0eef4aa543dfbcf3dd6c4d41188493e.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*vRHaNS8YqJBnnkoPux2G_g.png"/></div></figure><p id="94e6" class="pw-post-body-paragraph kn ko ht kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">2.在控制台上，使用参数(一个随机以太坊地址，值20+1)触发函数transfer，这样您的命令将类似于<strong class="kp hu">contract . transfer(' 0x04b 24656 E4 b 114 E4 ef 83 f 40 a 1161d 1804 e 684d 89 '，20+1)。</strong></p><blockquote class="mn mo mp"><p id="9882" class="kn ko mq kp b kq kr ks kt ku kv kw kx mr kz la lb ms ld le lf mt lh li lj lk hm dt translated">现在将会发生的是，当您转移代币时，首先，支票通过，因为它将是<strong class="kp hu"> 20 -20 +1 ≥ 0 </strong>这是真的，我们转到下一行balances[msg . sender]-= _ value；这里发生的情况是，你名下的余额<strong class="kp hu">减去20，再减去21 </strong>，得到20–21<strong class="kp hu">=-1。</strong>因此，会出现算术下溢，合同被黑。</p></blockquote><figure class="jz ka kb kc fq iu fe ff paragraph-image"><div class="fe ff mu"><img src="../Images/156f7bbb95719543b2d95b387b2a6f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*r4XaERD5zsC2npWY5i-T8Q.png"/></div></figure><p id="8b97" class="pw-post-body-paragraph kn ko ht kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">3.恭喜黑了合同！</p><h1 id="95ee" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">预防措施:</h1><ol class=""><li id="2fa6" class="mb mc ht kp b kq md ku me ky mf lc mg lg mh lk mi mj mk ml dt translated">每当您部署协定时，请在代码中使用SafeMath库。</li></ol><p id="6e46" class="pw-post-body-paragraph kn ko ht kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">感谢您读到这里！</p><p id="34bf" class="pw-post-body-paragraph kn ko ht kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">如果您觉得这很有帮助，请一定要鼓掌并关注更多内容:)</p><blockquote class="ll"><p id="8139" class="lm ln ht bd lo lp lq lr ls lt lu lk ek translated">加入Coinmonks <a class="ae lv" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae lv" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="944c" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm mv jo jp jq mw js jt ju mx jw jx jy dt translated">另外，阅读</h1><ul class=""><li id="2a22" class="mb mc ht kp b kq md ku me ky mf lc mg lg mh lk my mj mk ml dt translated"><a class="ae lv" href="https://coincodecap.com/huobi-crypto-trading-signals" rel="noopener ugc nofollow" target="_blank">用于Huobi的加密交易信号</a> | <a class="ae lv" rel="noopener" href="/coinmonks/hitbtc-review-c5143c5d53c2"> HitBTC审核</a></li><li id="d079" class="mb mc ht kp b kq mz ku na ky nb lc nc lg nd lk my mj mk ml dt translated"><a class="ae lv" href="https://coincodecap.com/traderwagon-review" rel="noopener ugc nofollow" target="_blank"> TraderWagon回顾</a> | <a class="ae lv" href="https://coincodecap.com/kraken-vs-gemini-vs-bityard" rel="noopener ugc nofollow" target="_blank">北海巨妖vs双子星vs BitYard </a></li><li id="18b6" class="mb mc ht kp b kq mz ku na ky nb lc nc lg nd lk my mj mk ml dt translated"><a class="ae lv" href="https://coincodecap.com/ftx-futures-trading" rel="noopener ugc nofollow" target="_blank">如何在FTX交易所交易期货</a></li><li id="dfd5" class="mb mc ht kp b kq mz ku na ky nb lc nc lg nd lk my mj mk ml dt translated"><a class="ae lv" href="https://coincodecap.com/okex-kucoin" rel="noopener ugc nofollow" target="_blank"> OKEx vs KuCoin </a> | <a class="ae lv" href="https://coincodecap.com/celsius-alternatives" rel="noopener ugc nofollow" target="_blank">摄氏替代品</a> | <a class="ae lv" href="https://coincodecap.com/buy-vechain" rel="noopener ugc nofollow" target="_blank">如何购买VeChain </a></li><li id="3d22" class="mb mc ht kp b kq mz ku na ky nb lc nc lg nd lk my mj mk ml dt translated"><a class="ae lv" href="https://coincodecap.com/profitfarmers-review" rel="noopener ugc nofollow" target="_blank"> ProfitFarmers点评</a> | <a class="ae lv" href="https://coincodecap.com/cornix-trading-bot" rel="noopener ugc nofollow" target="_blank">如何使用Cornix交易机器人</a></li></ul></div></div>    
</body>
</html>