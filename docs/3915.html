<html>
<head>
<title>Offensive Smart Contract Hacking — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">进攻性智能合同黑客—第2部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/offensive-smart-contract-hacking-part-2-dd6fcafc8a13?source=collection_archive---------7-----------------------#2022-09-20">https://medium.com/coinmonks/offensive-smart-contract-hacking-part-2-dd6fcafc8a13?source=collection_archive---------7-----------------------#2022-09-20</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="d3f8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">repo—<a class="ae jo" href="https://github.com/JEflyer/Offensive-Smart-Contract-Hacking-Course" rel="noopener ugc nofollow" target="_blank">https://github . com/JEflyer/Offensive-Smart-Contract-Hacking-Course</a></p><p id="4d31" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最终，2/3和4中的漏洞几乎是相同的，因此我们将直接跳到挑战4，这是最复杂的，需要学习的内容也最多。</p><p id="5961" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">玩得开心xD</p><p id="ca46" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">挑战4</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/07c1dce781016ca4a711233c498def38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kd50zIw8gR5HnZgm8KE5Bg.png"/></div></div></figure><p id="97b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">目标—从令牌A-ETH LP池中窃取所有ETH。</p><p id="360c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你对xD足够有信心，就自己去试试吧</p><p id="45f5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt">.</p><p id="a7ae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt">.</p><p id="0596" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt">.</p><p id="c1dc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt">.</p><p id="b544" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt">.</p><p id="8024" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt">.</p><p id="abfe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt">.</p><p id="8c57" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt">.</p><p id="0208" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所以我们在这里要走的总路线是:<br/> 1。从Flashloan提供者处借用令牌A<br/>2。将令牌A换成令牌B <br/> 3。用令牌B晃刀<br/> 4。偷刀令牌B <br/> 5。将令牌B转换为令牌A <br/> 6。偿还闪贷<br/> 7。将剩余的令牌A转换成ETH &amp;发送给攻击者</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kb"><img src="../Images/6c42a0b14b4a69e2a7e0903f2990a83a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EdiayWShJpz1iokIOJB1UA.png"/></div></div></figure><p id="d1d2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们在攻击契约中有攻击功能。#</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kc"><img src="../Images/d2c13cdfe8b6b19c086f98265ccb902a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sxjp7asW9ATT_UJWXLLQWg.png"/></div></div></figure><p id="29bc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">很简单，我们的攻击者将调用来初始化攻击，我们将借用所有的flashloan池令牌，这些令牌将启动它自己的功能&amp;一旦flashloan(&amp;我们的漏洞)完成，我们就将合同中剩余的ETH转移给攻击者。</p><p id="41b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们快速看一下flashloan提供商。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kd"><img src="../Images/50c0ce84bf003ca4a8b42a8db443844e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5JbA7mZi9nQQ7_uckg6ICw.png"/></div></div></figure><p id="d3d6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，我们向mint请求一笔金额，契约检查它是否拥有足够的令牌来实际借出，检查调用者是否是契约，将令牌传输给调用者，初始化攻击契约上的flashloan逻辑。一旦闪贷完成，预计本合同的余额将大于或等于之前的余额。</p><p id="43d3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好吧，回到攻击合同。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ke"><img src="../Images/d31ce7a4d2625c6aa8d93412559b1b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n7ft779TlT3Jvr0KHlGSIQ.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kf"><img src="../Images/a1d91dcca0803e82aceb830f2027d5c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ie9TbvaUYFg4sjCRLGz_Vw.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kg"><img src="../Images/553cb371be90e460c6f41e4574feeb14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m8Qg5p5pQoxCyV0-JAjU7w.png"/></div></div></figure><p id="c100" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您没有任何与Uniswap v2交互的经验，那么这可能看起来很难消化，但不要担心，我会分解它。</p><p id="9094" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们检查这个函数的调用者是池契约，然后我们构建一个从令牌A到令牌B的路径，检索令牌A的契约余额。</p><p id="bcb3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在Uniswap上交换令牌时，您必须首先批准路由器先使用您的令牌。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kh"><img src="../Images/ec0d559a294600048195e6c325896105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HXOQ4t_doVvF6mkXcoYf0g.png"/></div></div></figure><p id="c2ff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这里，我们将令牌A交换为令牌B，声明我们希望出售起始数量的令牌A，并检索任何可能检索到的内容(因此是0)，即我们希望此事务立即完成的令牌B &amp;的接收方(因此是block.timestamp)。</p><p id="a22f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好了，现在我们有了很多令牌B，让我们来看看这把刀。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ki"><img src="../Images/e94ce40dc9995f95c7fce6c13111f0fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eMk2lP1guSSKLMa7tP01Nw.png"/></div></div></figure><p id="de3f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们在这里没有使用ETH，所以我们不能使用重入，让我们看一下提议系统。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff kj"><img src="../Images/048a81a37b67ec6d6a6999f4c7e3e81b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*UPdYK49D6Y5xg36JQgloZw.png"/></div></figure><p id="14de" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好的，如果我们有超过51%的令牌，我们就可以强制DAO使用我们想要的任何参数调用任何契约上的任何函数。</p><p id="c53f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们检查一下攻击契约，看看我们如何攻击这个。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kk"><img src="../Images/e3c8068b1718e7520530ad4a248894ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DB5ABPR5ilaWij3sYyzBuQ.png"/></div></div></figure><p id="95dc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们批准DAO使用我们的令牌B，检索DAO持有的金额。要求我们的存款金额足以以51%的多数票发起攻击。</p><p id="8f4b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">存放代币。构建DAO将随其函数调用一起发送的数据。我们将强制DAO调用的函数是Token B上的approve函数，因为它的整个余额都是我们的契约。</p><p id="cd6b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们向DAO提出这个数据和地址，然后检查DAO是否已经批准了这个合同，以使用它的全部余额。</p><p id="d080" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好的&amp;闪贷漏洞的最后一部分？</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kl"><img src="../Images/755c3b1d7921b4c94332b08e010fc6ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qh9IkJnAR3j_-CgOV55h8w.png"/></div></div></figure><p id="f593" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">从DAO中窃取所有令牌B然后批准Uniswap路由器花费您的令牌B .耗尽令牌A —令牌B令牌A的LP池.偿还flashloan。批准路由器使用我们的令牌A。清空令牌A-ETH LP池。</p><p id="a3e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，正如攻击函数中计划的那样，剩余的ETH被转移给攻击者。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff km"><img src="../Images/1b90c9481c38f885568897e225ac0c4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o5X26WWzkMFrEI_2O-187g.png"/></div></div></figure><p id="664b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你觉得这很有趣，看看这个！<br/><a class="ae jo" rel="noopener" href="/p/28a8bb064e86">https://medium.com/p/28a8bb064e86</a></p><p id="72d9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">坚实发展研究小组—<a class="ae jo" href="https://discord.gg/KzbcGmrnfN" rel="noopener ugc nofollow" target="_blank">https://discord.gg/KzbcGmrnfN</a></p><p id="a02c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">-多边形联盟—<a class="ae jo" href="https://www.polygonalliance.com/" rel="noopener ugc nofollow" target="_blank">https://www.polygonalliance.com/</a></p><p id="def5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">——多边形联盟不和—<a class="ae jo" href="https://discord.gg/kJKPCGQu66" rel="noopener ugc nofollow" target="_blank">https://discord.gg/kJKPCGQu66</a></p><p id="352f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你喜欢这篇文章吗？想请我喝杯咖啡吗？<br/>Polygon/Eth/Bsc—0x4a 581 E0 EAF 6b 71d 05905 e8e 6014 DC 0277 a1 b 10 ad</p><blockquote class="kn ko kp"><p id="96be" class="iq ir kq is b it iu iv iw ix iy iz ja kr jc jd je ks jg jh ji kt jk jl jm jn hm dt translated"><em class="ht">交易新手？试试</em> <a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a"> <em class="ht">加密交易机器人</em> </a> <em class="ht">或</em> <a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c"> <em class="ht">复制交易</em> </a> <em class="ht">上</em> <a class="ae jo" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769"> <em class="ht">最好的加密交易</em> </a></p></blockquote><blockquote class="ku"><p id="e056" class="kv kw ht bd kx ky kz la lb lc ld jn ek translated">加入Coinmonks <a class="ae jo" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jo" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae jo" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h1 id="2e6f" class="le lf ht bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb dt translated">另外，阅读</h1><ul class=""><li id="e75c" class="mc md ht is b it me ix mf jb mg jf mh jj mi jn mj mk ml mm dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="42a1" class="mc md ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/leveraged-token-3f5257808b22">杠杆代币</a>终极指南</li><li id="55b1" class="mc md ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/top-17-folding-electric-bikes-5e296f0918cb"> 16款最佳折叠电动自行车</a></li><li id="d79e" class="mc md ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/the-28-best-electric-bikes-review-and-buying-guide-in-2023-7bb3146cb403"> 28款最佳电动自行车点评</a></li><li id="8894" class="mc md ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated">前三名<a class="ae jo" rel="noopener" href="/coinmonks/top-3-binance-futures-trading-bots-e6031f84b3f9">币安期货交易机器人</a></li></ul></div></div>    
</body>
</html>