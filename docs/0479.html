<html>
<head>
<title>Add CSC Network in Metamask Using Web3.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Web3.js在Metamask中添加CSC网络</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/add-csc-network-in-metamask-using-web3-js-b8d6a00cffdb?source=collection_archive---------9-----------------------#2022-07-10">https://medium.com/coinmonks/add-csc-network-in-metamask-using-web3-js-b8d6a00cffdb?source=collection_archive---------9-----------------------#2022-07-10</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="477b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">嘿嘿嘿</p><p id="aa14" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">0Xlive在这里😃</p><p id="357c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">也许你的用户不知道如何在元掩码中手动添加CSC网络，这将减少你的用户。在本教程中，我们将编写一个简单的函数，使用纯js自动将CSC网络添加到元掩码中，类似于链表</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/3f2a3024f2d1912a65438c972212db78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e5PI3gJCPusLqYFyvRNz8A.jpeg"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">chainlist.org</figcaption></figure><p id="ab57" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们需要在终端类型中开始我们的项目:</p><pre class="jp jq jr js fq ke kf kg kh aw ki dt"><span id="cfa5" class="kj kk ht kf b fv kl km l kn ko">touch network.js</span></pre><p id="f8ea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上面的命令将创建一个名为network.js的文件。我们应该从wallet获得许可来将我们的wallet连接到dapp。我们使用Metamask文档。</p><div class="kp kq fm fo kr ks"><a href="https://docs.metamask.io/guide/rpc-api.html#other-rpc-methods" rel="noopener  ugc nofollow" target="_blank"><div class="kt ab ej"><div class="ku ab kv cl cj kw"><h2 class="bd hu fv z el kx eo ep ky er et hs dt translated">RPC API |元掩码文档</h2><div class="kz l"><h3 class="bd b fv z el kx eo ep ky er et ek translated">MetaMask使用ethereum.request(args)方法包装RPC API。该API基于一个由所有…</h3></div><div class="la l"><p class="bd b gc z el kx eo ep ky er et ek translated">docs.metamask.io</p></div></div></div></a></div><h2 id="87fa" class="kj kk ht bd lb lc ld le lf lg lh li lj jb lk ll lm jf ln lo lp jj lq lr ls lt dt translated">Web3浏览器检测</h2><p id="186e" class="pw-post-body-paragraph iq ir ht is b it lu iv iw ix lv iz ja jb lw jd je jf lx jh ji jj ly jl jm jn hm dt translated">要知道metamask已安装，请将此代码粘贴到network.js或浏览器控制台中:</p><pre class="jp jq jr js fq ke kf kg kh aw ki dt"><span id="d267" class="kj kk ht kf b fv kl km l kn ko">if (typeof window.ethereum !== 'undefined') {<br/>  console.log('MetaMask is installed!');<br/>}</span></pre><p id="8309" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上面的代码检查元掩码，如果安装了将打印元掩码安装！。</p><blockquote class="lz ma mb"><p id="6401" class="iq ir mc is b it iu iv iw ix iy iz ja md jc jd je me jg jh ji mf jk jl jm jn hm dt translated">交易新手？试试<a class="ae mg" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae mg" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote><h2 id="0109" class="kj kk ht bd lb lc ld le lf lg lh li lj jb lk ll lm jf ln lo lp jj lq lr ls lt dt translated">连接到元掩码</h2><p id="e8ae" class="pw-post-body-paragraph iq ir ht is b it lu iv iw ix lv iz ja jb lw jd je jf lx jh ji jj ly jl jm jn hm dt translated">要将wallet连接到dapp，我们应该请求访问wallet:</p><pre class="jp jq jr js fq ke kf kg kh aw ki dt"><span id="7941" class="kj kk ht kf b fv kl km l kn ko">ethereum.request({ method: 'eth_requestAccounts' });</span></pre><p id="4c72" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在html中创建按钮:</p><pre class="jp jq jr js fq ke kf kg kh aw ki dt"><span id="8ef2" class="kj kk ht kf b fv kl km l kn ko">&lt;button class="enableEthereumButton"&gt;Enable Ethereum&lt;/button&gt;</span></pre><p id="ce0b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">完整的代码应该是这样的:</p><pre class="jp jq jr js fq ke kf kg kh aw ki dt"><span id="609c" class="kj kk ht kf b fv kl km l kn ko">const ethereumButton = document.querySelector('.enableEthereumButton');<br/>const showAccount = document.querySelector('.showAccount');<br/><br/>ethereumButton.addEventListener('click', () =&gt; {<br/>  getAccount();<br/>});<br/><br/>async function getAccount() {<br/>  const accounts = await ethereum.request({ method: 'eth_requestAccounts' });<br/>  showAccount.innerHTML = account;<br/>}</span></pre><p id="b8b0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们去实现添加网络功能吧。</p><p id="af14" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要添加链，我们应该创建接口:</p><pre class="jp jq jr js fq ke kf kg kh aw ki dt"><span id="1f0c" class="kj kk ht kf b fv kl km l kn ko">interface AddEthereumChainParameter {<br/>  chainId: string; // A 0x-prefixed hexadecimal string<br/>  chainName: string;<br/>  nativeCurrency: {<br/>    name: string;<br/>    symbol: string; // 2-6 characters long<br/>    decimals: 18;<br/>  };<br/>  rpcUrls: string[];<br/>  blockExplorerUrls?: string[];<br/>  iconUrls?: string[]; // Currently ignored.<br/>}</span></pre><p id="2d47" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要将coinex智能链添加到元掩码，我们应该更改参数:</p><p id="4998" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ChainId: 52</p><p id="0d48" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ChainName:Coinex智能链Mainnet</p><p id="14ba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">NativeCurrency[name]:CET</p><p id="dbac" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">符号:CET</p><p id="618b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">rpcUrls:https://rpc.coinex.net</p><p id="0906" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">区块探索规则:<a class="ae mg" href="https://coinex.net" rel="noopener ugc nofollow" target="_blank">https://coinex.net</a></p><p id="8a38" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">iconUrls:可以使用anylink(可选)</p><p id="afbd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">MetaMask严格验证该方法的参数，如果任何参数的格式不正确，它将拒绝请求。此外，在下列情况下，MetaMask将自动拒绝请求:</p><ul class=""><li id="92d4" class="mh mi ht is b it iu ix iy jb mj jf mk jj ml jn mm mn mo mp dt translated">如果RPC端点不响应RPC调用。</li><li id="93cb" class="mh mi ht is b it mq ix mr jb ms jf mt jj mu jn mm mn mo mp dt translated">如果调用<code class="eh mv mw mx kf b">eth_chainId</code>时RPC端点返回不同的链ID。</li><li id="0dc0" class="mh mi ht is b it mq ix mr jb ms jf mt jj mu jn mm mn mo mp dt translated">如果链ID对应于任何默认元掩码链。</li></ul><p id="07a4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">MetaMask尚不支持本地货币不超过18位小数的链，但将来可能会支持</p><p id="6540" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们还可以实现切换链功能，从其他链切换到csc:</p><pre class="jp jq jr js fq ke kf kg kh aw ki dt"><span id="7ec8" class="kj kk ht kf b fv kl km l kn ko">try {<br/>  await ethereum.request({<br/>    method: 'wallet_switchEthereumChain',<br/>    params: [{ chainId: '0x34' }],<br/>  });<br/>} catch (switchError) {<br/>  // This error code indicates that the chain has not been added to MetaMask.<br/>  if (switchError.code === 4902) {<br/>    try {<br/>      await ethereum.request({<br/>        method: 'wallet_addEthereumChain',<br/>        params: [<br/>          {<br/>            chainId: '0x34', //52 in hex<br/>            chainName: 'Coinex Smart Chain',<br/>            rpcUrls: ['<a class="ae mg" href="https://rpc.coinex.net" rel="noopener ugc nofollow" target="_blank">https:</a>//rpc.coinex.net'] /* ... */,<br/>          },<br/>        ],<br/>      });<br/>    } catch (addError) {<br/>      // handle "add" error<br/>    }<br/>  }<br/>  // handle other "switch" errors<br/>}</span></pre><p id="f276" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">祝贺🥳</p><p id="884a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，我们可以轻松地将CSC网络添加到元掩码中。</p><p id="03f0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在下一个教程中，我们将使用web3.js和metamask。</p></div></div>    
</body>
</html>