<html>
<head>
<title>An image classification app in Android using Keras and Tensorflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android中使用Keras和Tensorflow的图像分类应用程序</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/an-image-classification-app-in-android-using-keras-and-tensorflow-17177a546dd7?source=collection_archive---------9-----------------------#2022-09-18">https://medium.com/coinmonks/an-image-classification-app-in-android-using-keras-and-tensorflow-17177a546dd7?source=collection_archive---------9-----------------------#2022-09-18</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/11bd686f3c760d26bf641ba434225a5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m94I9mvEUfVsHE_J7EuXrw.png"/></div></div></figure><p id="c352" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">图像分类是根据特定的规则对图像进行分类和标记的过程。它可以有益于卫星图像中的物体识别、刹车灯检测、交通控制系统等。</p><p id="4055" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要使用Tensorflow lite插件为Android创建图像分类应用程序，请点击以下链接。</p><div class="jz ka fm fo kb kc"><a href="https://codemaker2016.medium.com/image-classification-app-in-android-using-custom-tflite-model-7cf9ee9c0a53" rel="noopener follow" target="_blank"><div class="kd ab ej"><div class="ke ab kf cl cj kg"><h2 class="bd hu fv z el kh eo ep ki er et hs dt translated">Android中使用自定义TFLite模型的图像分类应用程序</h2><div class="kj l"><h3 class="bd b fv z el kh eo ep ki er et ek translated">科技在我们的日常生活中起着至关重要的作用。人工智能和机器学习是两个关键因素…</h3></div><div class="kk l"><p class="bd b gc z el kh eo ep ki er et ek translated">codemaker2016.medium.com</p></div></div><div class="kl l"><div class="km l kn ko kp kl kq iz kc"/></div></div></a></div><p id="7d52" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这些应用程序对于使用轻量级tflite模型执行影像分类非常有用。当模型尺寸增加时，边缘设备需要更多的处理。TFLite安卓包只支持tflite机型。边缘设备可能不是创建/训练/运行大型模型的好选择。为了克服这个限制，使用基于Flask服务器的模型部署。</p><p id="6b02" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在本次会议中，我们将创建一个Keras模型，并将其部署在Flask服务器上。我们可以使用flask APIs来访问android应用程序中的模型。此外，我们将在Heroku云上托管flask服务器。</p><h1 id="7a99" class="kr ks ht bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">入门指南</h1><p id="f445" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">在本次会议中，我们将创建一个android应用程序，从输入图像中对手写数字进行分类。为了减少数据收集和清理的工作量，我们将在应用程序中使用MNIST数据集。</p><p id="98ed" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们将本教程分为三个部分，</p><ol class=""><li id="40c1" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy lz ma mb mc dt translated"><a class="ae md" href="#2b10" rel="noopener ugc nofollow">Keras图像分类模型的创建和部署</a></li><li id="547a" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy lz ma mb mc dt translated"><a class="ae md" href="#9bd7" rel="noopener ugc nofollow">创建一个用于图像分类的android应用</a></li><li id="1779" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy lz ma mb mc dt translated"><a class="ae md" href="#8a68" rel="noopener ugc nofollow">Heroku上的Flask服务器部署</a></li></ol><h1 id="2b10" class="kr ks ht bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">第1部分:Keras图像分类模型的创建和部署</h1><p id="a138" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">在本节中，我们将使用Keras创建一个多层感知器(MLP)模型，该模型在<a class="ae md" href="https://www.tensorflow.org/api_docs/python/tf/keras/datasets/mnist" rel="noopener ugc nofollow" target="_blank"> MNIST数据集</a>上进行训练。</p><h2 id="1599" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">目录</h2><ul class=""><li id="4390" class="lu lv ht jd b je lp ji lq jm mx jq my ju mz jy na ma mb mc dt translated"><a class="ae md" href="#a02a" rel="noopener ugc nofollow">安装依赖项</a></li><li id="1e93" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated"><a class="ae md" href="#b04b" rel="noopener ugc nofollow">准备MNIST数据集</a></li><li id="9a6d" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated"><a class="ae md" href="#0049" rel="noopener ugc nofollow">建立MLP模型</a></li><li id="e243" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated"><a class="ae md" href="#b2c3" rel="noopener ugc nofollow">列车MLP型号</a></li><li id="11a9" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated"><a class="ae md" href="#0b04" rel="noopener ugc nofollow">保存MLP模型</a></li><li id="f239" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated"><a class="ae md" href="#5157" rel="noopener ugc nofollow">使用保存的模型进行预测</a></li><li id="6933" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated"><a class="ae md" href="#3495" rel="noopener ugc nofollow">创建一个用于图像分类的Flask API</a></li></ul><h2 id="a02a" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">安装依赖项</h2><p id="50a2" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">建议将依赖项安装在<a class="ae md" href="https://docs.python.org/3/tutorial/venv.html" rel="noopener ugc nofollow" target="_blank">虚拟环境</a>上，而不是全局安装。</p><ul class=""><li id="462e" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">使用以下命令创建一个虚拟环境</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="3ab8" class="mj ks ht ng b fv nk nl l nm nn">python -m venv venv</span></pre><ul class=""><li id="0682" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">切换到Windows中的虚拟环境</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="4c36" class="mj ks ht ng b fv nk nl l nm nn">venv\Scripts\activate</span></pre><ul class=""><li id="510c" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">使用以下命令安装依赖项，</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="66ff" class="mj ks ht ng b fv nk nl l nm nn">pip install tensorflow flask imageio</span></pre><h2 id="b04b" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">准备MNIST数据集</h2><p id="9258" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">MNIST数据集是用于数字0到9的手写数字识别数据集。它有70，000张图像，60，000张用于训练，10，000张用于测试。每一张图像都是28×28的灰度图像。数据集的样本如下所示。</p><figure class="nb nc nd ne fq iu fe ff paragraph-image"><div class="fe ff no"><img src="../Images/f71b92424a74f547fc3bf77d296f5b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:352/format:webp/0*jDtN7EqBDIGAR2QY.jpeg"/></div></figure><p id="4372" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用以下代码将mnist数据集导入到项目中，</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="898a" class="mj ks ht ng b fv nk nl l nm nn">from tensorflow import keras<br/>from tensorflow.keras import datasets<br/>from tensorflow.keras import models, layers, optimizers<br/>import numpy<br/>batch_size = 128<br/>num_classes = 10<br/>epochs = 20<br/># the data, split between train and test sets<br/>(x_train, y_train), (x_test, y_test) = datasets.mnist.load_data()<br/>print(x_train.shape) # (60000, 28, 28)<br/>print(y_train.shape) # (60000,)<br/>print(x_test.shape)  # (10000, 28, 28)<br/>print(y_test.shape)  # (10000,)</span></pre><p id="65b5" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">Keras模块允许我们自动下载某些数据集。我们可以使用<code class="eh np nq nr ng b">keras.datasets</code>从<a class="ae md" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras </a>模块下载数据集。将<code class="eh np nq nr ng b">keras.datasets.mnist</code>导入到对mnist数据集执行各种操作的代码中。使用<code class="eh np nq nr ng b">load_data()</code>函数加载项目中的数据集。该函数返回一个包含2个元素的元组，如下所示:</p><ul class=""><li id="3543" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated"><code class="eh np nq nr ng b">(x_train, y_train)</code> —训练输入&amp;标签。</li><li id="3565" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated"><code class="eh np nq nr ng b">(x_test, y_test)</code> —测试输入&amp;标签。</li></ul><p id="cb3d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们可以使用数组的<code class="eh np nq nr ng b">shape</code>元素来确定数据集的大小。训练输入数组(<code class="eh np nq nr ng b">x_train</code>)的形状是(60000，28，28)，这意味着有60000个样本，每个样本图像的大小是28×28。</p><p id="cf59" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们将建立一个MLP模型，它接受一个向量而不是一个数组作为输入。我们需要将每个数组转换成一个向量。可以使用<code class="eh np nq nr ng b">reshape()</code>功能完成。使用下面的代码改变输入数组的形状。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="fb33" class="mj ks ht ng b fv nk nl l nm nn">x_train = x_train.reshape(60000, 784) # (60000, 28 * 28)<br/>x_test = x_test.reshape(10000, 784)   # (10000, 28 * 28)</span></pre><p id="56cf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">图像的数据类型是uint8，其中每个像素的范围从0到255。重新缩放有助于降低反向传播阶段的梯度。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="de93" class="mj ks ht ng b fv nk nl l nm nn">x_train = x_train.astype(<strong class="ng hu">'float32'</strong>) / 255<br/>x_test = x_test.astype(<strong class="ng hu">'float32'</strong>) / 255</span></pre><p id="59a8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">根据训练和测试标签的形状，为每个样本分配一个值。在MNIST数据集中有10个类，其中每个样本必须被分配一个长度为10的二进制向量。元素的索引对应于类标签。</p><p id="ffc1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">例如，如果样本具有分类标签2，则创建10个元素的向量，其中除了索引2处的元素是1之外，所有元素都是0，</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="89f9" class="mj ks ht ng b fv nk nl l nm nn">[0, 0, 1, 0, 0, 0, 0, 0, 0, 0]</span></pre><p id="2a27" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要进行转换，使用<code class="eh np nq nr ng b">keras.utils.to_categorical()</code>功能。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="0b97" class="mj ks ht ng b fv nk nl l nm nn">y_train = keras.utils.to_categorical(y_train, num_classes) # (60000, 10)<br/>y_test = keras.utils.to_categorical(y_test, num_classes) # (10000, 10)</span></pre><p id="3b8d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">下面给出了数据准备的完整代码，</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="a0a4" class="mj ks ht ng b fv nk nl l nm nn">from tensorflow import keras<br/>from tensorflow.keras import datasets<br/>import numpy<br/>batch_size = 128<br/>num_classes = 10<br/>epochs = 20# the data, split between train and test sets<br/>(x_train, y_train), (x_test, y_test) = datasets.mnist.load_data()<br/>print(x_train.shape) # (60000, 28, 28)<br/>print(y_train.shape) # (60000,)<br/>print(x_test.shape) # (10000, 28, 28)<br/>print(y_test.shape) # (10000,)<br/>x_train = x_train.reshape(60000, 784)<br/>x_test = x_test.reshape(10000, 784)<br/>x_train = x_train.astype('float32') / 255<br/>x_test = x_test.astype('float32') / 255<br/>y_train = keras.utils.to_categorical(y_train, num_classes) # (60000, 10)<br/>y_test = keras.utils.to_categorical(y_test, num_classes) # (10000, 10)</span></pre><h2 id="0049" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">建立MLP模式</h2><p id="63d0" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">使用<code class="eh np nq nr ng b">keras.models.Sequential()</code>函数将MLP模型声明为序列模型。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="deea" class="mj ks ht ng b fv nk nl l nm nn">from tensorflow.keras import models, layers, optimizers<br/>import numpy<br/>...<br/>model = models.Sequential()<br/>model.add(layers.Dense(512, activation='relu', input_shape=(784,)))<br/>model.add(layers.Dropout(0.2))<br/>model.add(layers.Dense(512, activation='relu'))<br/>model.add(layers.Dropout(0.2))<br/>model.add(layers.Dense(num_classes, activation='softmax'))</span></pre><p id="0f64" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">顺序模型包含3个密集层和2个下降层。第一密集层接受包含512个神经元的形状784的矢量图像。最后一个密集层使用10个神经元的softmax函数，返回每一类的概率。</p><p id="ba91" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">建立模型后，使用<code class="eh np nq nr ng b">model.summary()</code>功能打印模型摘要。它列出了层，输出形状和参数。</p><figure class="nb nc nd ne fq iu fe ff paragraph-image"><div class="fe ff ns"><img src="../Images/6a3147d4aacecef35cd841879b56f90b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/0*7wQTTISYG9wJG2sI.png"/></div></figure><p id="9756" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh np nq nr ng b">Param</code>列给出了该层的参数总数，作为输入数(784)和该层中神经元数(512)的乘积，得到784 * 512 = 401，408。一些神经元往往会有偏差，因此将额外的512个参数添加到总数中，得到401，920个参数。</p><p id="ca3a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用<code class="eh np nq nr ng b">compile()</code>函数定义用于训练模型的损失函数、优化器和指标。设置损失函数为<code class="eh np nq nr ng b">categorical_crossentropy</code>，优化器为<a class="ae md" href="https://towardsdatascience.com/understanding-rmsprop-faster-neural-network-learning-62e116fcf29a" rel="noopener" target="_blank">均方根传播</a> ( <code class="eh np nq nr ng b">RMSprop</code>)，度量为分类<code class="eh np nq nr ng b">accuracy</code>。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="00e5" class="mj ks ht ng b fv nk nl l nm nn">from tensorflow.keras import optimizers<br/>model.compile(loss='categorical_crossentropy',<br/>              optimizer=keras.optimizers.RMSprop(),<br/>              metrics=['accuracy'])</span></pre><h2 id="b2c3" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">训练MLP模型</h2><p id="67bc" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">使用下面给出的<code class="eh np nq nr ng b">fit()</code>功能训练模型。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="ed19" class="mj ks ht ng b fv nk nl l nm nn">batch_size = 128<br/>epochs = 20<br/>history = model.fit(x_train, y_train,<br/>                    batch_size=batch_size,<br/>                    epochs=epochs,<br/>                    verbose=1,<br/>                    validation_data=(x_test, y_test))</span></pre><p id="47dd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">它接受训练输入(<code class="eh np nq nr ng b">x_train</code>)、训练标签(<code class="eh np nq nr ng b">y_train</code>)、批量(128)和时期数(20)。将<code class="eh np nq nr ng b">verbose=1</code>添加到输入中，以便在模型训练时打印消息和验证数据。</p><p id="e70c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh np nq nr ng b">evaluate()</code>函数用于根据验证数据评估模型，如下所示。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="1584" class="mj ks ht ng b fv nk nl l nm nn">score = model.evaluate(x_test, y_test, verbose=0)<br/>print(<strong class="ng hu">'Test accuracy:'</strong>, score[1]) # prints 98.41%</span></pre><h2 id="0b04" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">保存模型</h2><p id="6a04" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">使用<code class="eh np nq nr ng b">model.save()</code>功能保存模型以备将来参考。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="800b" class="mj ks ht ng b fv nk nl l nm nn">model.save(<strong class="ng hu">"</strong>model.h5<strong class="ng hu">"</strong>)</span></pre><p id="5a24" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">下面给出了准备数据、构建、训练和保存模型的完整代码。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="6c68" class="mj ks ht ng b fv nk nl l nm nn">from tensorflow import keras<br/>from tensorflow.keras import datasets<br/>from tensorflow.keras import models, layers, optimizers<br/>import numpy<br/>batch_size = 128<br/>num_classes = 10<br/>epochs = 20 <br/># the data, split between train and test sets<br/>(x_train, y_train), (x_test, y_test) = datasets.mnist.load_data()<br/>print(x_train.shape) # (60000, 28, 28)<br/>print(y_train.shape) # (60000,)<br/>print(x_test.shape) # (10000, 28, 28)<br/>print(y_test.shape) # (10000,)<br/>x_train = x_train.reshape(60000, 784)<br/>x_test = x_test.reshape(10000, 784)<br/>x_train = x_train.astype('float32') / 255<br/>x_test = x_test.astype('float32') / 255<br/>y_train = keras.utils.to_categorical(y_train, num_classes) # (60000, 10)<br/>y_test = keras.utils.to_categorical(y_test, num_classes) # (10000, 10)model = models.Sequential()<br/>model.add(layers.Dense(512, activation='relu', input_shape=(784,)))<br/>model.add(layers.Dropout(0.2))<br/>model.add(layers.Dense(512, activation='relu'))<br/>model.add(layers.Dropout(0.2))<br/>model.add(layers.Dense(num_classes, activation='softmax'))<br/>model.summary()<br/>model.compile(loss='categorical_crossentropy',<br/>              optimizer=optimizers.RMSprop(),<br/>              metrics=['accuracy'])history = model.fit(x_train, y_train,<br/>                    batch_size=batch_size,<br/>                    epochs=epochs,<br/>                    verbose=1,<br/>                    validation_data=(x_test, y_test))<br/>score = model.evaluate(x_test, y_test, verbose=0)<br/>print('Test loss:', score[0])<br/>print('Test accuracy:', score[1])<br/>model.save("model.h5")<br/>loaded_model = keras.models.load_model('model.h5')<br/>predicted_label = loaded_model.predict_classes(numpy.array([x_test[0, :]]))[0]<br/>print(predicted_label)</span></pre><blockquote class="nt nu nv"><p id="cf33" class="jb jc nw jd b je jf jg jh ji jj jk jl nx jn jo jp ny jr js jt nz jv jw jx jy hm dt translated"><strong class="jd hu">注意:如果你正在运行本教程提供的git repo中的代码，那么尝试使用</strong> <code class="eh np nq nr ng b"><strong class="jd hu">pip install -r requirements.txt</strong></code> <strong class="jd hu">命令从</strong> <code class="eh np nq nr ng b"><strong class="jd hu">requirements.txt</strong></code> <strong class="jd hu">文件中安装依赖项。</strong></p></blockquote><div class="nb nc nd ne fq ab cb"><figure class="oa iu ob oc od oe of paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><img src="../Images/6b15c05ac462f958c7a5d7a118cbac31.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/0*sLGa34SKST1GAVUq.png"/></div></figure><figure class="oa iu og oc od oe of paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><img src="../Images/b6b5e8ddaed7dfb532e1429c75ebaef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/0*M3GpJ1mwtji86WSp.png"/></div></figure><figure class="oa iu ob oc od oe of paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><img src="../Images/a9a8b9c42d05694aaf7ac552b5c6e486.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/0*-MGCouMeplGWB9J_.png"/></div></figure></div><h2 id="5157" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">使用保存的模型进行预测</h2><p id="2a9c" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">使用<code class="eh np nq nr ng b">keras.models.load_model()</code>函数加载模型，并使用<code class="eh np nq nr ng b">predict_classes()</code>函数预测类。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="2adc" class="mj ks ht ng b fv nk nl l nm nn">loaded_model = keras.models.load_model(<strong class="ng hu">'model.h5'</strong>)<br/>predicted_label = loaded_model.predict_classes(numpy.array([x_test[0, :]]))[0]<br/>print(predicted_label)</span></pre><h2 id="3495" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">为图像分类创建Flask API</h2><p id="b6ca" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated"><a class="ae md" href="https://flask.palletsprojects.com/en/2.2.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>是一个用Python编写的轻量级web框架。</p><p id="6cae" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">创建一个名为<code class="eh np nq nr ng b">server.py</code>的文件，并向其中添加以下代码，以便在访问服务器时返回<code class="eh np nq nr ng b">“Hello World”</code>文本。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="8011" class="mj ks ht ng b fv nk nl l nm nn">app = flask.Flask(__name__)<br/><a class="ae md" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/', methods = ['GET', 'POST'])<br/>def welcome():<br/>    return "Hello World"<br/>app.run(host="0.0.0.0", port=5000, debug=True)</span></pre><p id="8b24" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh np nq nr ng b">app.route()</code> decorator函数将一个URL与一个回调函数相关联。在这个例子中，这个函数被命名为<code class="eh np nq nr ng b">welcome()</code>，当用户点击默认路径(“/”)时，它返回<code class="eh np nq nr ng b">“Hello World”</code>文本。我们将主机设置为<code class="eh np nq nr ng b">“0.0.0.0”</code>，端口设置为<code class="eh np nq nr ng b">5000</code>。</p><p id="24f1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们试着创建一条路线<code class="eh np nq nr ng b">“/predict”</code>来根据输入图像预测班级。为此，创建一个名为<code class="eh np nq nr ng b">server.py</code>的文件，并向其中添加以下代码。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="90c8" class="mj ks ht ng b fv nk nl l nm nn">import flask<br/>import werkzeug<br/>from tensorflow.keras import models<br/>import numpy<br/>import imageio<br/>import os<br/>app = flask.Flask(__name__)<br/><a class="ae md" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/', methods = ['GET', 'POST'])<br/>def welcome():<br/>    return "Hello World"<br/><a class="ae md" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/predict/', methods = ['GET', 'POST'])<br/>def handle_request():<br/>    imagefile = flask.request.files['image0']<br/>    filename = werkzeug.utils.secure_filename(imagefile.filename)<br/>    print("\nReceived image File name : " + imagefile.filename)<br/>    imagefile.save(filename)<br/>    <br/>    img = imageio.imread(filename, pilmode="L")<br/>    if img.shape != (28, 28):<br/>        return "Image size mismatch " + str(img.shape) + ". \nOnly (28, 28) is acceptable."<br/>    img = img.reshape(784)<br/>    loaded_model = models.load_model('model.h5')<br/>    predicted_label = numpy.argmax(loaded_model.predict(numpy.array([img]))[0], axis=-1)<br/>    print(predicted_label)<br/>    return str(predicted_label)<br/>app.run(host="0.0.0.0", port=os.environ.get('PORT', 5000), debug=True)</span></pre><p id="d768" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">让我们来理解代码，</strong></p><ul class=""><li id="e3dd" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated"><code class="eh np nq nr ng b">imageio.imread</code>将图像读取为灰度并将其重塑为(28，28)。</li><li id="eae4" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated">使用<code class="eh np nq nr ng b">models.load_model(‘model.h5’)</code>加载预训练模型</li><li id="25cf" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated">使用<code class="eh np nq nr ng b">loaded_model.predict()</code>函数通过Keras预训练模型预测分类标签，并以字符串形式返回分类标签。</li></ul><p id="2861" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">通过从<code class="eh np nq nr ng b">FlaskServer/app</code>文件夹运行以下命令来启动服务器。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="7eec" class="mj ks ht ng b fv nk nl l nm nn">python server.py</span></pre><blockquote class="nt nu nv"><p id="d959" class="jb jc nw jd b je jf jg jh ji jj jk jl nx jn jo jp ny jr js jt nz jv jw jx jy hm dt translated"><strong class="jd hu">注意:如果你正在运行本教程提供的git repo中的代码，那么尝试使用</strong> <code class="eh np nq nr ng b"><strong class="jd hu">pip install -r requirements.txt</strong></code> <strong class="jd hu">命令从</strong> <code class="eh np nq nr ng b"><strong class="jd hu">requirements.txt</strong></code> <strong class="jd hu">文件中安装依赖项。</strong></p></blockquote><figure class="nb nc nd ne fq iu fe ff paragraph-image"><div class="fe ff oh"><img src="../Images/e46e2d69d7cef59877c9c6342ea6534b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_F_VDe1ytOo8_lWt.png"/></div></figure></div><div class="ab cl oi oj hb ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="hm hn ho hp hq"><h1 id="9bd7" class="kr ks ht bd kt ku op kw kx ky oq la lb lc or le lf lg os li lj lk ot lm ln lo dt translated">第2部分:为图像分类创建一个android应用程序</h1><p id="9f37" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">现在，我们可以创建一个客户端android应用程序，将图像上传到我们在上一步中创建的flask服务器。该应用程序有一个选项，从画廊选择图像。所选图像被转换成字节数组，并发送给Flask服务器。我们可以使用<a class="ae md" href="https://square.github.io/okhttp/" rel="noopener ugc nofollow" target="_blank"> OkHttp </a>来处理HTTP请求和响应。</p><h2 id="11c7" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">目录</h2><ul class=""><li id="5d0b" class="lu lv ht jd b je lp ji lq jm mx jq my ju mz jy na ma mb mc dt translated"><a class="ae md" href="#ce94" rel="noopener ugc nofollow">创建应用</a></li><li id="b17a" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated"><a class="ae md" href="#08a5" rel="noopener ugc nofollow">设计布局</a></li><li id="7ce1" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated"><a class="ae md" href="#8e02" rel="noopener ugc nofollow">与flask服务器通信</a></li></ul><h2 id="ce94" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">创建应用程序</h2><p id="88ef" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">打开android studio，点击<code class="eh np nq nr ng b">New project</code>按钮，提供必要的信息。</p><figure class="nb nc nd ne fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ou"><img src="../Images/70f867889436f5cd8dd217a326bbc254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*09RRRqBb9eNh5vEaMlk2WA.png"/></div></div></figure><h2 id="08a5" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">设计布局</h2><p id="331c" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">使用编辑文本、按钮、图像视图和文本视图定义基本布局。它包含3个按钮-捕捉图像，选择图像和预测类和编辑文本-用于输入服务器的网址(IP地址和端口)。</p><p id="f8d7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">将以下代码添加到<code class="eh np nq nr ng b">activity_main.xml</code>以定义布局。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="72a2" class="mj ks ht ng b fv nk nl l nm nn">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;LinearLayout xmlns:android="<a class="ae md" href="http://schemas.android.com/apk/res/android" rel="noopener ugc nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"<br/>    xmlns:app="<a class="ae md" href="http://schemas.android.com/apk/res-auto" rel="noopener ugc nofollow" target="_blank">http://schemas.android.com/apk/res-auto</a>"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    android:orientation="vertical"<br/>    android:padding="20dp"&gt;    <br/>    &lt;Button<br/>        android:id="@+id/btnCapture"<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:onClick="captureImage"<br/>        android:text="Capture Image"<br/>        android:textStyle="bold" /&gt;<br/>    &lt;Button<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:text="Select Image"<br/>        android:onClick="selectImage"<br/>        android:textStyle="bold"/&gt;    <br/>    &lt;ImageView<br/>        android:id="@+id/imageView"<br/>        android:layout_width="200dp"<br/>        android:layout_height="200dp"<br/>        android:layout_gravity="center"<br/>        android:layout_margin="10dp"<br/>        app:srcCompat="<a class="ae md" href="http://twitter.com/android" rel="noopener ugc nofollow" target="_blank">@android</a>:drawable/ic_menu_report_image"&gt;    <br/>    &lt;/ImageView&gt;<br/>    &lt;TextView<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:text="No Image Selected."<br/>        android:id="@+id/imgName"<br/>        android:textAlignment="center"<br/>        android:textStyle="bold"<br/>        android:textColor="#807E76"/&gt;    <br/>    &lt;LinearLayout<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:orientation="horizontal"<br/>        android:layout_gravity="center"<br/>        android:padding="10dp"&gt;<br/>        &lt;TextView<br/>            android:layout_weight="1"<br/>            android:layout_width="wrap_content"<br/>            android:layout_height="match_parent"<br/>            android:text="Server URL"<br/>            android:textStyle="bold"<br/>            android:textColor="#807E76"<br/>            android:gravity="center_vertical"/&gt;<br/>        &lt;EditText<br/>            android:layout_weight="4"<br/>            android:layout_width="wrap_content"<br/>            android:layout_height="match_parent"<br/>            android:id="@+id/edtServerURL"<br/>            android:text="<a class="ae md" href="http://192.168.1.9:5000/" rel="noopener ugc nofollow" target="_blank">http://192.168.1.9:5000</a>"<br/>            android:singleLine="true"<br/>            android:textStyle="bold"/&gt;<br/>    &lt;/LinearLayout&gt;    <br/>    &lt;Button<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:onClick="connectServer"<br/>        android:text="Predict Class"<br/>        android:textStyle="bold" /&gt;    <br/>    &lt;TextView<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:text=""<br/>        android:id="@+id/responseText"<br/>        android:textAlignment="center"<br/>        android:textStyle="bold"<br/>        android:layout_marginTop="10dp"/&gt;<br/>&lt;/LinearLayout&gt;</span></pre><p id="2489" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">最终的布局如下所示，</p><figure class="nb nc nd ne fq iu fe ff paragraph-image"><div class="fe ff ov"><img src="../Images/a335eff85c711c9d6f26ae44933d6fd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/0*tjTgyN3I9zrErcW-.jpeg"/></div></figure><h2 id="8e02" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">与flask服务器通信</h2><ul class=""><li id="f99c" class="lu lv ht jd b je lp ji lq jm mx jq my ju mz jy na ma mb mc dt translated">将下面一行添加到应用程序<code class="eh np nq nr ng b">build.gradle</code>的依赖项部分，并同步您的项目。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="29eb" class="mj ks ht ng b fv nk nl l nm nn">implementation 'com.squareup.okhttp3:okhttp:3.4.1'</span></pre><ul class=""><li id="00f9" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">将以下代码添加到<code class="eh np nq nr ng b">AndroidManifest.xml</code>文件中，以请求应用程序中的摄像头、互联网和存储权限。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="64f3" class="mj ks ht ng b fv nk nl l nm nn">&lt;uses-permission android:name="android.permission.CAMERA" /&gt;<br/>&lt;uses-permission android:name="android.permission.INTERNET"/&gt;<br/>&lt;uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" /&gt;<br/>&lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;<br/>&lt;application <br/>    ...<br/>    android:usesCleartextTraffic="true"<br/>    android:requestLegacyExternalStorage="true"&gt;</span></pre><ul class=""><li id="37a7" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">请求活动初始化的权限。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="ed84" class="mj ks ht ng b fv nk nl l nm nn">ActivityCompat.requestPermissions(MainActivity.this, new String[]{Manifest.permission.CAMERA}, 2);<br/>ActivityCompat.requestPermissions(MainActivity.this, new String[]{Manifest.permission.READ_EXTERNAL_STORAGE}, 1);</span></pre><ul class=""><li id="38ba" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">在<code class="eh np nq nr ng b">MainActivity.java</code>中创建一个<code class="eh np nq nr ng b">captureImage</code>方法，从摄像机中捕捉一个图像。为捕获的图像创建一个URI，并将其分配给imageView。创建图像的byteArray，并将其添加到<code class="eh np nq nr ng b">OkHttp</code>请求体中。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="25ac" class="mj ks ht ng b fv nk nl l nm nn">public void captureImage(View v) {<br/>    if (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED) {<br/>        requestPermissions(new String[]{Manifest.permission.CAMERA}, MY_CAMERA_PERMISSION_CODE);<br/>    }<br/>    else {<br/>        Intent cameraIntent = new Intent(android.provider.MediaStore.ACTION_IMAGE_CAPTURE);<br/>        startActivityForResult(cameraIntent, CAMERA_REQUEST);<br/>    }<br/>}</span></pre><ul class=""><li id="2b27" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">创建一个方法，<code class="eh np nq nr ng b">selectImage</code>来浏览图库中的图片。创建所选图像的URI，并将其分配给<code class="eh np nq nr ng b">imageView</code>。创建图像的<code class="eh np nq nr ng b">byteArray</code>,并将其添加到<code class="eh np nq nr ng b">OkHttp</code>请求体中。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="26cd" class="mj ks ht ng b fv nk nl l nm nn">public void selectImage(View v) {<br/>    Intent intent = new Intent();<br/>    intent.setType("image/*");<br/>    intent.setAction(Intent.ACTION_GET_CONTENT);<br/>    startActivityForResult(Intent.createChooser(intent, "Select Picture"), SELECT_IMAGES);<br/>}</span></pre><ul class=""><li id="2ce1" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">创建一个方法，<code class="eh np nq nr ng b">getImageUri</code>从位图图像数据中获取图像路径。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="76eb" class="mj ks ht ng b fv nk nl l nm nn">public Uri getImageUri(Context inContext, Bitmap inImage) {<br/>    ByteArrayOutputStream bytes = new ByteArrayOutputStream();<br/>    inImage.compress(Bitmap.CompressFormat.JPEG, 100, bytes);<br/>    String path = MediaStore.Images.Media.insertImage(inContext.getContentResolver(), inImage, "Title", null);<br/>    return Uri.parse(path);<br/>}</span></pre><ul class=""><li id="5528" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">创建一个方法，<code class="eh np nq nr ng b">getFileName</code>从Uri中获取文件名。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="822f" class="mj ks ht ng b fv nk nl l nm nn">public String getFileName(Uri uri) {<br/>    String result = null;<br/>    if (uri.getScheme().equals("content")) {<br/>        Cursor cursor = getContentResolver().query(uri, null, null, null, null);<br/>        try {<br/>            if (cursor != null &amp;&amp; cursor.moveToFirst()) {<br/>                result = cursor.getString(cursor.getColumnIndex(OpenableColumns.DISPLAY_NAME));<br/>            }<br/>        } finally {<br/>            cursor.close();<br/>        }<br/>    }<br/>    if (result == null) {<br/>        result = uri.getPath();<br/>        int cut = result.lastIndexOf('/');<br/>        if (cut != -1) {<br/>            result = result.substring(cut + 1);<br/>        }<br/>    }<br/>    return result;<br/>}</span></pre><ul class=""><li id="717b" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">创建一个接受<code class="eh np nq nr ng b">postUrl</code>和<code class="eh np nq nr ng b">postBody</code>的方法<code class="eh np nq nr ng b">postRequest</code>。该方法将图像发送到服务器，并在应用程序中接收响应。在<code class="eh np nq nr ng b">responseText</code>上设置结果。</li><li id="afa9" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated">请求是使用<code class="eh np nq nr ng b">Request.Builder</code>类创建的。该类负责将目标URL映射到请求正文。<code class="eh np nq nr ng b">url()</code>方法接受URL,<code class="eh np nq nr ng b">post()</code>方法接受请求体。最后，使用<code class="eh np nq nr ng b">build()</code>方法构建请求。</li><li id="d0b6" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated">使用名为<code class="eh np nq nr ng b">newCall()</code>的方法通过<code class="eh np nq nr ng b">OkHttpClient</code>的实例发送请求。根据呼叫的状态，有两种回调方法:</li><li id="f632" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated"><code class="eh np nq nr ng b">onFailure()</code>:当请求由于取消、连接问题或超时而无法执行时调用。</li><li id="5a86" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy na ma mb mc dt translated"><code class="eh np nq nr ng b">onResponse()</code>:远程服务器成功返回HTTP响应时调用。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="0593" class="mj ks ht ng b fv nk nl l nm nn">void postRequest(String postUrl, RequestBody postBody) {<br/>        OkHttpClient client = new OkHttpClient();<br/>        Request request = new Request.Builder()<br/>                .url(postUrl)<br/>                .post(postBody)<br/>                .build();</span><span id="5ce7" class="mj ks ht ng b fv ow nl l nm nn">client.newCall(request).enqueue(new Callback() {<br/>            <a class="ae md" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>            public void onFailure(Call call, IOException e) {<br/>                call.cancel();<br/>                Log.d("FAIL", e.getMessage());</span><span id="a0d4" class="mj ks ht ng b fv ow nl l nm nn">runOnUiThread(new Runnable() {<br/>                    <a class="ae md" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>                    public void run() {<br/>                        TextView responseText = findViewById(R.id.responseText);<br/>                        responseText.setText("Failed to Connect to Server. Please Try Again.");<br/>                    }<br/>                });<br/>            }</span><span id="3a26" class="mj ks ht ng b fv ow nl l nm nn"><a class="ae md" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>            public void onResponse(Call call, final Response response) throws IOException {<br/>                runOnUiThread(new Runnable() {<br/>                    <a class="ae md" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>                    public void run() {<br/>                        TextView responseText = findViewById(R.id.responseText);<br/>                        try {<br/>                            String[] res = response.toString().split(",");<br/>                            if(res[1].trim().equals("code=200"))<br/>                                responseText.setText("Server's Response\n" + response.body().string());<br/>                            else<br/>                                responseText.setText("Oops! Something went wrong. \nPlease try again.");<br/>                        } catch (IOException e) {<br/>                            e.printStackTrace();<br/>                        }<br/>                    }<br/>                });<br/>            }<br/>        });<br/>}</span></pre><ul class=""><li id="6c42" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">创建一个方法，<code class="eh np nq nr ng b">connectServer</code>从文件系统获取图像信息，并向服务器发送请求。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="f6e7" class="mj ks ht ng b fv nk nl l nm nn">public void connectServer(View v) {<br/>        TextView responseText = findViewById(R.id.responseText);<br/>        if (imagesSelected == false) { // This means no image is selected and thus nothing to upload.<br/>            responseText.setText("No Image Selected to Upload. \nSelect Image and Try Again.");<br/>            return;<br/>        }<br/>        responseText.setText("Sending the Files. Please Wait ...");</span><span id="fcf1" class="mj ks ht ng b fv ow nl l nm nn">        EditText edtServerURL = findViewById(R.id.edtServerURL);<br/>        String postUrl = edtServerURL.getText().toString() + "/predict/";</span><span id="2a56" class="mj ks ht ng b fv ow nl l nm nn">        MultipartBody.Builder multipartBodyBuilder = new         MultipartBody.Builder().setType(MultipartBody.FORM);</span><span id="a68d" class="mj ks ht ng b fv ow nl l nm nn">        for (int i = 0; i &lt; selectedImagesPaths.size(); i++) {<br/>            byte[] byteArray = null;<br/>            try {<br/>                InputStream inputStream = getContentResolver().openInputStream(selectedImagesPaths.get(i));<br/>                ByteArrayOutputStream byteBuffer = new ByteArrayOutputStream();<br/>                int bufferSize = 1024;<br/>                byte[] buffer = new byte[bufferSize];</span><span id="2896" class="mj ks ht ng b fv ow nl l nm nn">                int len = 0;<br/>                while ((len = inputStream.read(buffer)) != -1) {<br/>                    byteBuffer.write(buffer, 0, len);<br/>                }<br/>                byteArray = byteBuffer.toByteArray();</span><span id="a05e" class="mj ks ht ng b fv ow nl l nm nn">            }catch(Exception e) {<br/>                responseText.setText("Please Make Sure the Selected File is an Image.");<br/>                return;<br/>            }<br/>            multipartBodyBuilder.addFormDataPart("image" + i, "input_img.jpg", RequestBody.create(MediaType.parse("image/*jpg"), byteArray));<br/>        }</span><span id="e5a4" class="mj ks ht ng b fv ow nl l nm nn">          RequestBody postBodyImage = multipartBodyBuilder.build();</span><span id="025b" class="mj ks ht ng b fv ow nl l nm nn">//        RequestBody postBodyImage = new MultipartBody.Builder()<br/>//                .setType(MultipartBody.FORM)<br/>//                .addFormDataPart("image", "androidFlask.jpg",      RequestBody.create(MediaType.parse("image/*jpg"), byteArray))<br/>//                .build();</span><span id="176e" class="mj ks ht ng b fv ow nl l nm nn">          postRequest(postUrl, postBodyImage);<br/>    }</span></pre><ul class=""><li id="7e77" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">MainActivity的完整代码如下所示，</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="c68d" class="mj ks ht ng b fv nk nl l nm nn">package com.vsoft.androidflaskdemo.app;<br/>public class MainActivity extends AppCompatActivity {<br/>    final int SELECT_IMAGES = 1;<br/>    final int CAMERA_REQUEST = 2;<br/>    final int MY_CAMERA_PERMISSION_CODE = 100;<br/>    ArrayList&lt;Uri&gt; selectedImagesPaths; // Paths of the image(s) selected by the user.<br/>    boolean imagesSelected = false; // Whether the user selected at least an image or not.<br/>    <a class="ae md" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>    protected void onCreate(Bundle savedInstanceState) {<br/>        super.onCreate(savedInstanceState);<br/>        ActivityCompat.requestPermissions(MainActivity.this, new String[]{Manifest.permission.INTERNET}, 2);<br/>        ActivityCompat.requestPermissions(MainActivity.this, new String[]{Manifest.permission.READ_EXTERNAL_STORAGE}, 1);<br/>        setContentView(R.layout.activity_main);<br/>    }<br/>    <a class="ae md" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>    public void onRequestPermissionsResult(int requestCode, String permissions[], int[] grantResults) {<br/>        super.onRequestPermissionsResult(requestCode, permissions, grantResults);<br/>        switch (requestCode) {<br/>            case 1: {<br/>                if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {<br/>//                    Toast.makeText(getApplicationContext(), "Access to Storage Permission Granted.", Toast.LENGTH_SHORT).show();<br/>                } else {<br/>//                    Toast.makeText(getApplicationContext(), "Access to Storage Permission Denied.", Toast.LENGTH_SHORT).show();<br/>                }<br/>                return;<br/>            }<br/>            case 2: {<br/>                if (grantResults[0] == PackageManager.PERMISSION_GRANTED) {<br/>//                    Toast.makeText(this, "Camera Permission Granted.", Toast.LENGTH_LONG).show();<br/>                }<br/>                else {<br/>                    Toast.makeText(this, "camera permission denied", Toast.LENGTH_LONG).show();<br/>                }<br/>                return;<br/>            }<br/>        }<br/>    }<br/>    public void connectServer(View v) {<br/>        TextView responseText = findViewById(R.id.responseText);<br/>        if (imagesSelected == false) { // This means no image is selected and thus nothing to upload.<br/>            responseText.setText("No Image Selected to Upload. \nSelect Image and Try Again.");<br/>            return;<br/>        }<br/>        responseText.setText("Sending the Files. Please Wait ...");<br/>        EditText edtServerURL = findViewById(R.id.edtServerURL);<br/>        String postUrl = edtServerURL.getText().toString() + "/predict/";<br/>        MultipartBody.Builder multipartBodyBuilder = new MultipartBody.Builder().setType(MultipartBody.FORM);<br/>        for (int i = 0; i &lt; selectedImagesPaths.size(); i++) {<br/>            byte[] byteArray = null;<br/>            try {<br/>                InputStream inputStream = getContentResolver().openInputStream(selectedImagesPaths.get(i));<br/>                ByteArrayOutputStream byteBuffer = new ByteArrayOutputStream();<br/>                int bufferSize = 1024;<br/>                byte[] buffer = new byte[bufferSize];int len = 0;<br/>                while ((len = inputStream.read(buffer)) != -1) {<br/>                    byteBuffer.write(buffer, 0, len);<br/>                }<br/>                byteArray = byteBuffer.toByteArray();}catch(Exception e) {<br/>                responseText.setText("Please Make Sure the Selected File is an Image.");<br/>                return;<br/>            }<br/>            multipartBodyBuilder.addFormDataPart("image" + i, "input_img.jpg", RequestBody.create(MediaType.parse("image/*jpg"), byteArray));<br/>        }<br/>        RequestBody postBodyImage = multipartBodyBuilder.build();<br/>//      RequestBody postBodyImage = new MultipartBody.Builder()<br/>//                .setType(MultipartBody.FORM)<br/>//                .addFormDataPart("image", "androidFlask.jpg",   RequestBody.create(MediaType.parse("image/*jpg"), byteArray))<br/>//                .build();postRequest(postUrl, postBodyImage);<br/>    }<br/>    void postRequest(String postUrl, RequestBody postBody) {OkHttpClient client = new OkHttpClient();Request request = new Request.Builder()<br/>                .url(postUrl)<br/>                .post(postBody)<br/>                .build();client.newCall(request).enqueue(new Callback() {<br/>            <a class="ae md" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>            public void onFailure(Call call, IOException e) {<br/>                call.cancel();<br/>                Log.d("FAIL", e.getMessage());runOnUiThread(new Runnable() {<br/>                    <a class="ae md" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>                    public void run() {<br/>                        TextView responseText = findViewById(R.id.responseText);<br/>                        responseText.setText("Failed to Connect to Server. Please Try Again.");<br/>                    }<br/>                });<br/>            }<br/>            <a class="ae md" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>            public void onResponse(Call call, final Response response) throws IOException {<br/>                runOnUiThread(new Runnable() {<br/>                    <a class="ae md" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>                    public void run() {<br/>                        TextView responseText = findViewById(R.id.responseText);<br/>                        try {<br/>                            String[] res = response.toString().split(",");<br/>                            if(res[1].trim().equals("code=200"))<br/>                                responseText.setText("Server's Response\n" + response.body().string());<br/>                            else<br/>                                responseText.setText("Oops! Something went wrong. \nPlease try again.");<br/>                        } catch (IOException e) {<br/>                            e.printStackTrace();<br/>                        }<br/>                    }<br/>                });<br/>            }<br/>        });<br/>    }<br/>    public void captureImage(View v) {<br/>        if (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED) {<br/>            requestPermissions(new String[]{Manifest.permission.CAMERA}, MY_CAMERA_PERMISSION_CODE);<br/>        }<br/>        else {<br/>            Intent cameraIntent = new Intent(android.provider.MediaStore.ACTION_IMAGE_CAPTURE);<br/>            startActivityForResult(cameraIntent, CAMERA_REQUEST);<br/>        }<br/>    }<br/>    public void selectImage(View v) {<br/>        Intent intent = new Intent();<br/>        intent.setType("image/*");<br/>        intent.setAction(Intent.ACTION_GET_CONTENT);<br/>        startActivityForResult(Intent.createChooser(intent, "Select Picture"), SELECT_IMAGES);<br/>    }<br/>    <a class="ae md" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>    protected void onActivityResult(int requestCode, int resultCode, Intent data) {<br/>        super.onActivityResult(requestCode, resultCode, data);<br/>        try {<br/>            if (requestCode == SELECT_IMAGES &amp;&amp; resultCode == RESULT_OK &amp;&amp; data != null) {<br/>                selectedImagesPaths = new ArrayList&lt;&gt;();<br/>                TextView imgName = findViewById(R.id.imgName);<br/>                ImageView imgView = findViewById(R.id.imageView);<br/>                if (data.getData() != null) {<br/>                    Uri uri = data.getData();<br/>                    Log.d("ImageDetails", "URI : " + uri);<br/>                    selectedImagesPaths.add(uri);<br/>                    imagesSelected = true;<br/>                    imgName.setText(getFileName(selectedImagesPaths.get(0)));<br/>                    imgView.setImageURI(selectedImagesPaths.get(0));<br/>                }<br/>            } else if (requestCode == CAMERA_REQUEST &amp;&amp; resultCode == RESULT_OK &amp;&amp; data != null) {<br/>                selectedImagesPaths = new ArrayList&lt;&gt;();<br/>                TextView imgName = findViewById(R.id.imgName);<br/>                ImageView imgView = findViewById(R.id.imageView);<br/>                if (data.getExtras().get("data") != null) {<br/>                    Bitmap photo = (Bitmap) data.getExtras().get("data");<br/>                    Uri uri = getImageUri(getApplicationContext(), photo);<br/>                    Log.d("ImageDetails", "URI : " + uri);<br/>                    selectedImagesPaths.add(uri);<br/>                    imagesSelected = true;<br/>                    imgName.setText(getFileName(selectedImagesPaths.get(0)));<br/>                    imgView.setImageURI(selectedImagesPaths.get(0));<br/>                }<br/>            } else {<br/>                Toast.makeText(this, "You haven't Picked any Image.", Toast.LENGTH_LONG).show();<br/>            }<br/>        } catch (Exception e) {<br/>            Toast.makeText(this, "Something Went Wrong.", Toast.LENGTH_LONG).show();<br/>            e.printStackTrace();<br/>        }<br/>    }<br/>    public Uri getImageUri(Context inContext, Bitmap inImage) {<br/>        ByteArrayOutputStream bytes = new ByteArrayOutputStream();<br/>        inImage.compress(Bitmap.CompressFormat.JPEG, 100, bytes);<br/>        String path = MediaStore.Images.Media.insertImage(inContext.getContentResolver(), inImage, "Title", null);<br/>        return Uri.parse(path);<br/>    }<br/>    public String getFileName(Uri uri) {<br/>        String result = null;<br/>        if (uri.getScheme().equals("content")) {<br/>            Cursor cursor = getContentResolver().query(uri, null, null, null, null);<br/>            try {<br/>                if (cursor != null &amp;&amp; cursor.moveToFirst()) {<br/>                    result = cursor.getString(cursor.getColumnIndex(OpenableColumns.DISPLAY_NAME));<br/>                }<br/>            } finally {<br/>                cursor.close();<br/>            }<br/>        }<br/>        if (result == null) {<br/>            result = uri.getPath();<br/>            int cut = result.lastIndexOf('/');<br/>            if (cut != -1) {<br/>                result = result.substring(cut + 1);<br/>            }<br/>        }<br/>        return result;<br/>    }<br/>}</span></pre><h2 id="a46f" class="mj ks ht bd kt mk ml mm kx mn mo mp lb jm mq mr lf jq ms mt lj ju mu mv ln mw dt translated">测试应用程序</h2><p id="5691" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">将您的设备连接到机器。点击播放按钮运行应用程序。</p><figure class="nb nc nd ne fq iu fe ff paragraph-image"><div class="fe ff ox"><img src="../Images/179688109600c819407407bf002ff732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*ipITnvmuYtQTFzp75ensog.png"/></div></figure><p id="ecf4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可以使用本地机器flask服务器地址(如果手机和机器都连接到同一个网络)或远程地址(<a class="ae md" href="https://androidflaskdemo.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://androidflaskdemo.herokuapp.com/</a>)作为服务器URL。</p><figure class="nb nc nd ne fq iu fe ff paragraph-image"><div class="fe ff oy"><img src="../Images/5c35cae32a963d0cb532d3f2252387fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/1*1AD9W5USO2dNuDplVGHBxQ.gif"/></div></figure><h1 id="8a68" class="kr ks ht bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">第3部分:Heroku上的Flask服务器部署</h1><p id="415e" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">Heroku是一个基于容器的云平台即服务(PaaS ),用于在web上部署应用程序。由于其简单的设置和预算友好的定价，近年来受到了关注。</p><p id="4424" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您还没有Heroku帐户，请创建一个。登录您的帐户，点击<code class="eh np nq nr ng b">Create new app</code>按钮创建一个项目。可以选择任意app名称(如:<code class="eh np nq nr ng b">androidflaskdemo</code>)。</p><div class="nb nc nd ne fq ab cb"><figure class="oa iu oz oc od oe of paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><img src="../Images/486efba1c4b51f3ea44e0979b1015764.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*C-yJrAivS0zM5uH-.png"/></div></figure><figure class="oa iu pa oc od oe of paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><img src="../Images/bac90212ee0a5c7eb05fa6841d2c8bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/0*gVVRivyrzkBh9BBI.png"/></div></figure></div><figure class="nb nc nd ne fq iu fe ff paragraph-image"><div class="fe ff oh"><img src="../Images/c52cd718c7a05c37ed402b782090942a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*v_r0pj8avMm1_qhz.png"/></div></figure><p id="9840" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">尽管Heroku提供了在Heroku中部署应用程序的说明，但</strong>您必须在项目中包含一些必要的配置文件，以识别平台、构建工具等。</p><p id="a69d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">flask应用程序部署需要项目根文件夹中的三个文件。</strong></p><ol class=""><li id="c01f" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy lz ma mb mc dt translated"><strong class="jd hu">过程文件</strong></li><li id="46bd" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy lz ma mb mc dt translated"><strong class="jd hu"> requirements.txt </strong></li><li id="52fe" class="lu lv ht jd b je me ji mf jm mg jq mh ju mi jy lz ma mb mc dt translated"><strong class="jd hu"> runtime.txt </strong></li></ol><ul class=""><li id="ab0f" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">在项目根文件夹中打开终端，运行以下命令创建<code class="eh np nq nr ng b">Procfile</code>和<code class="eh np nq nr ng b">runtime.txt</code>文件。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="13e6" class="mj ks ht ng b fv nk nl l nm nn">$ echo web: python server.py runserver 0.0.0.0:$PORT &gt; Procfile<br/>$ echo python-3.7.10 &gt; runtime.txt</span></pre><ul class=""><li id="1fe6" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">从虚拟环境中使用<code class="eh np nq nr ng b">pip freeze</code>创建<code class="eh np nq nr ng b">requirements.txt</code>文件。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="5e6b" class="mj ks ht ng b fv nk nl l nm nn">$ pip freeze &gt; requirements.txt</span></pre><p id="877d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，我们可以进入部署流程了。</p><ul class=""><li id="80dd" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">下载Heroku CLI并安装到您的机器上。</li></ul><div class="jz ka fm fo kb kc"><a href="https://devcenter.heroku.com/articles/heroku-cli" rel="noopener  ugc nofollow" target="_blank"><div class="kd ab ej"><div class="ke ab kf cl cj kg"><h2 class="bd hu fv z el kh eo ep ki er et hs dt translated">Heroku CLI</h2><div class="kj l"><h3 class="bd b fv z el kh eo ep ki er et ek translated">Heroku命令行界面(CLI)允许您直接从终端创建和管理Heroku应用程序。这是一个…</h3></div><div class="kk l"><p class="bd b gc z el kh eo ep ki er et ek translated">devcenter.heroku.com</p></div></div><div class="kl l"><div class="pb l kn ko kp kl kq iz kc"/></div></div></a></div><ul class=""><li id="ed59" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">通过执行以下命令，在终端中登录Heroku帐户:</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="4537" class="mj ks ht ng b fv nk nl l nm nn">$ heroku login</span></pre><figure class="nb nc nd ne fq iu fe ff paragraph-image"><div class="fe ff oh"><img src="../Images/0800c60754bb6bf788e90f8c9f03c223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*juJwyCvECj6zG943.png"/></div></figure><ul class=""><li id="8937" class="lu lv ht jd b je jf ji jj jm lw jq lx ju ly jy na ma mb mc dt translated">执行Heroku网站的deploy选项卡中提供的命令。</li></ul><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="6810" class="mj ks ht ng b fv nk nl l nm nn">$ git init<br/>$ heroku git:remote -a androidflaskdemo<br/>$ git add .<br/>$ git commit -am "make it better"<br/>$ git push heroku master</span></pre><div class="nb nc nd ne fq ab cb"><figure class="oa iu pc oc od oe of paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><img src="../Images/dac411d897bd1093734d990f1b2893a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/0*AyNXEm2pCrXHjCMU.png"/></div></figure><figure class="oa iu pd oc od oe of paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><img src="../Images/e15c4163e7354039848e07a2b917544b.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/0*2utAb2KMbtt8GthI.png"/></div></figure><figure class="oa iu pe oc od oe of paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><img src="../Images/51c9d3975d7d3ddc5ec9856bd277a696.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/0*mNWxMK9cR0JCOkwX.png"/></div></figure></div><p id="5ba5" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们已经成功地在Heroku上部署了我们的Flask服务器。你可以使用本地的flask服务器或<a class="ae md" href="https://androidflaskdemo.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://androidflaskdemo.herokuapp.com/</a>链接在移动应用程序中运行分类。</p><p id="7483" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">感谢阅读这篇文章。</p><p id="d464" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">感谢Gowri M Bhatt 审阅内容。</p><p id="5b52" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果你喜欢这篇文章，请点击拍手按钮👏并且分享出来帮别人找！</p><p id="01b0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这篇文章也可以在Dev上找到。</p><p id="3267" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">本教程的完整源代码可以在这里找到，</p><div class="jz ka fm fo kb kc"><a href="https://github.com/codemaker2015/android-flask-demo" rel="noopener  ugc nofollow" target="_blank"><div class="kd ab ej"><div class="ke ab kf cl cj kg"><h2 class="bd hu fv z el kh eo ep ki er et hs dt translated">GitHub-codemaker 2015/Android-Flask-Demo:Android Flask Demo</h2><div class="kj l"><h3 class="bd b fv z el kh eo ep ki er et ek translated">安卓烧瓶演示。通过在GitHub上创建帐户，为codemaker 2015/Android-flask-demo开发做出贡献。</h3></div><div class="kk l"><p class="bd b gc z el kh eo ep ki er et ek translated">github.com</p></div></div><div class="kl l"><div class="pf l kn ko kp kl kq iz kc"/></div></div></a></div><blockquote class="pg"><p id="9289" class="ph pi ht bd pj pk pl pm pn po pp jy ek translated">交易新手？试试<a class="ae md" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae md" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>