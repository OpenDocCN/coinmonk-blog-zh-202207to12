<html>
<head>
<title>Ethernaut Level 5 Token [Foundry-Hardhat]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太5级令牌[铸造厂-安全帽]</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethernaut-level-5-token-foundry-hardhat-d9d52e5ce39a?source=collection_archive---------9-----------------------#2022-12-16">https://medium.com/coinmonks/ethernaut-level-5-token-foundry-hardhat-d9d52e5ce39a?source=collection_archive---------9-----------------------#2022-12-16</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/0c88bc03eb6d12515e6de05616f95175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LmiAPMal99JVHCtd54Nlng.png"/></div></div></figure><blockquote class="jb"><p id="1e24" class="jc jd ht bd je jf jg jh ji jj jk jl ek translated"><em class="jm"/><a class="ae jn" href="https://github.com/Chirag21/Ethernaut-solutions" rel="noopener ugc nofollow" target="_blank"><em class="jm">以太解决方案</em> </a> <em class="jm">库包含使用Foundry和Hardhat的解决方案。</em></p></blockquote><h1 id="c9b4" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">目标</h1><ul class=""><li id="2e77" class="km kn ht ko b kp kq kr ks kt ku kv kw kx ky jl kz la lb lc dt translated">你最初获得20枚代币作为启动资金。您需要将合同的20个令牌增加到更多令牌</li></ul></div><div class="ab cl ld le hb lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hm hn ho hp hq"><p id="5065" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated"><code class="eh mb mc md me b">Integer Overflow and Underflows</code></p><p id="3eb6" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">当算术运算超过类型的最大或最小大小时，就会发生上溢或下溢。例如，如果一个数字被保存为一个<code class="eh mb mc md me b">uint8</code>类型，它被存储为一个无符号的8位数字，范围从0到255(2⁸-1).255加1就是0，减1就是255。</p><blockquote class="jb"><p id="b533" class="jc jd ht bd je jf mf mg mh mi mj jl ek translated">交易新手？在<a class="ae jn" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易</a>上尝试<a class="ae jn" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae jn" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote><p id="db1c" class="pw-post-body-paragraph lk ll ht ko b kp mk ln lo kr ml lq lr kt mm lt lu kv mn lw lx kx mo lz ma jl hm dt translated">在计算机编程中，当一个算术运算试图产生一个大于最大值或小于最小值的数值时，就会发生整数溢出。如果您将令牌余额存储在一个变量中，并在不检查的情况下增减它，这可能会变得很麻烦。</p><p id="a6f8" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">在比特级别发生的情况如下，</p><figure class="mq mr ms mt fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mp"><img src="../Images/45d15aba43c68c1f043026f5aa61c344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kyA75hC3uKaY-Nzn_UYs0w.png"/></div></div></figure></div><div class="ab cl ld le hb lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hm hn ho hp hq"><h1 id="effc" class="jo jp ht bd jq jr mu jt ju jv mv jx jy jz mw kb kc kd mx kf kg kh my kj kk kl dt translated">分析</h1><p id="032e" class="pw-post-body-paragraph lk ll ht ko b kp kq ln lo kr ks lq lr kt mz lt lu kv na lw lx kx nb lz ma jl hm dt translated">为了完成这一关，我们必须下溢代币余额。</p><p id="cff4" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">在旧版本的Solidity中，没有对溢出和下溢的保护。开发人员必须实现他们的检查或者使用像<a class="ae jn" href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/math/SafeMath.sol" rel="noopener ugc nofollow" target="_blank"> SafeMath </a>这样的库。后来Solidity版原生实现了溢出或下溢。如果检测到上溢或下溢，则事务被还原。</p><p id="2007" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">看一看<code class="eh mb mc md me b">transfer</code>功能，</p><pre class="mq mr ms mt fq nc me nd bn ne nf bi"><span id="6654" class="ng jp ht me b be nh ni l nj nk">function transfer(address _to, uint _value) public returns (bool) {<br/>    require(balances[msg.sender] - _value &gt;= 0);<br/>    balances[msg.sender] -= _value;<br/>    balances[_to] += _value;<br/>    return true;<br/>}</span></pre><p id="e9f3" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">合同使用^0.6.0.的可靠版本因此，它容易发生上溢和下溢。该功能从<code class="eh mb mc md me b">msg.sender</code>的账户向<code class="eh mb mc md me b">_to</code>地址发送<code class="eh mb mc md me b">_value</code>个令牌。语句<code class="eh mb mc md me b">require(balances[msg.sender] - _value &gt;= 0)</code>确保余额不会变成负数。接下来的两行代码传输令牌。我们必须利用下面几行代码，</p><pre class="mq mr ms mt fq nc me nd bn ne nf bi"><span id="0a5f" class="ng jp ht me b be nh ni l nj nk">require(balances[msg.sender] - _value &gt;= 0);<br/>balances[msg.sender] -= _value;</span></pre><p id="b081" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">必须传递函数_ <code class="eh mb mc md me b">value</code> <em class="nl">，以便</em> <code class="eh mb mc md me b">balances[msg.sender] - value</code>下溢并返回一个大数。如果我们传递21，那么得到的值将是uint256所能容纳的最大数，等于1157920892373161954235709850086879078532698466564056403945758400791312963935。可以使用<code class="eh mb mc md me b">type(uint256).max</code>检查该值。</p><ol class=""><li id="13fc" class="km kn ht ko b kp lm kr lp kt nm kv nn kx no jl np la lb lc dt translated"><code class="eh mb mc md me b">balances[msg.sender] - _value &gt;= 0</code>还会真</li><li id="1bd0" class="km kn ht ko b kp nq kr nr kt ns kv nt kx nu jl np la lb lc dt translated"><code class="eh mb mc md me b">balances[msg.sender] -= _value</code>，将天平设置为<code class="eh mb mc md me b">type(uint256).max</code>值。</li><li id="5e23" class="km kn ht ko b kp nq kr nr kt ns kv nt kx nu jl np la lb lc dt translated">即使我们有20个令牌，也有21个令牌将被传输到<code class="eh mb mc md me b">_to</code>地址。</li></ol></div><div class="ab cl ld le hb lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hm hn ho hp hq"><h1 id="9baa" class="jo jp ht bd jq jr mu jt ju jv mv jx jy jz mw kb kc kd mx kf kg kh my kj kk kl dt translated">剥削</h1><p id="3d21" class="pw-post-body-paragraph lk ll ht ko b kp kq ln lo kr ks lq lr kt mz lt lu kv na lw lx kx nb lz ma jl hm dt translated">在Chrome中打开开发控制台。</p><ul class=""><li id="8966" class="km kn ht ko b kp lm kr lp kt nm kv nn kx no jl kz la lb lc dt translated">首先，检查你的余额</li></ul><pre class="mq mr ms mt fq nc me nd bn ne nf bi"><span id="3c4b" class="ng jp ht me b be nh ni l nj nk">await contract.balanceOf(player)</span></pre><ul class=""><li id="3b62" class="km kn ht ko b kp lm kr lp kt nm kv nn kx no jl kz la lb lc dt translated">用<code class="eh mb mc md me b">_value</code> = 21调用<code class="eh mb mc md me b">transfer</code></li></ul><pre class="mq mr ms mt fq nc me nd bn ne nf bi"><span id="3be5" class="ng jp ht me b be nh ni l nj nk">await transfer(0x4dD7ca0a5c590bc7E882AbfD873568e3128953f7, 21)</span></pre><p id="6455" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">这将使余额下溢。</p><ul class=""><li id="7e91" class="km kn ht ko b kp lm kr lp kt nm kv nn kx no jl kz la lb lc dt translated">检查新余额</li></ul><pre class="mq mr ms mt fq nc me nd bn ne nf bi"><span id="aee5" class="ng jp ht me b be nh ni l nj nk">await contract.balanceOf(player)</span></pre><p id="7cf2" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">这是一个非常大的数字，因此在控制台上无法正常显示。您可以使用<a class="ae jn" href="https://remix.ethereum.org/?#gist=730f1e4a5d854a3fbe175292dc1d9a08&amp;version=soljson-v0.6.12+commit.27d51765.js&amp;optimize=false&amp;runs=200&amp;evmVersion=null" rel="noopener ugc nofollow" target="_blank"> Remix IDE </a>来检查余额，</p><p id="b872" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">如果您已经安装了Foundry，请运行以下命令</p><pre class="mq mr ms mt fq nc me nd bn ne nf bi"><span id="7695" class="ng jp ht me b be nh ni l nj nk">cast --to-base $(cast storage --rpc-url [RPC_URL] [INSTANCE_ADDRESS] $(cast index address [PLAYER_ADDRESS] 0)) 10</span></pre><p id="91e6" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">开始时给了我们20个代币。但我们成功转移了20多枚代币。在这个过程中，我们的余额也增加了。</p><p id="ac5a" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">提交实例。</p><p id="7a84" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">关卡通过！！！😄</p></div><div class="ab cl ld le hb lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hm hn ho hp hq"><h1 id="3361" class="jo jp ht bd jq jr mu jt ju jv mv jx jy jz mw kb kc kd mx kf kg kh my kj kk kl dt translated">关键要点</h1><ul class=""><li id="eae0" class="km kn ht ko b kp kq kr ks kt ku kv kw kx ky jl kz la lb lc dt translated">始终使用最新的Solidity编译器</li><li id="6940" class="km kn ht ko b kp nq kr nr kt ns kv nt kx nu jl kz la lb lc dt translated">如果你用的是老编译器(0.8以下)，用<a class="ae jn" href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/math/SafeMath.sol" rel="noopener ugc nofollow" target="_blank"> Openzeppelin的SafeMath库</a>。</li><li id="2476" class="km kn ht ko b kp nq kr nr kt ns kv nt kx nu jl kz la lb lc dt translated">即使在检查模式下，也不要认为您可以避免溢出错误。在这种模式下，溢出总是会恢复。如果无法避免溢出，这可能会导致智能合约卡在某个状态。</li><li id="570e" class="km kn ht ko b kp nq kr nr kt ns kv nt kx nu jl kz la lb lc dt translated">如果你确定表达式不会溢出或下溢，使用<a class="ae jn" href="https://docs.soliditylang.org/en/v0.8.17/control-structures.html#checked-or-unchecked-arithmetic" rel="noopener ugc nofollow" target="_blank">未检查块</a>。这将为您的最终用户节省一些汽油。</li></ul><blockquote class="jb"><p id="3e24" class="jc jd ht bd je jf jg jh ji jj jk jl ek translated"><em class="jm"/><a class="ae jn" href="https://github.com/Chirag21/Ethernaut-solutions" rel="noopener ugc nofollow" target="_blank"><em class="jm">以太解决方案</em> </a> <em class="jm">库包含使用Foundry和Hardhat的解决方案。</em></p><p id="30ca" class="jc jd ht bd je jf mf mg mh mi mj jl ek translated"><em class="jm">解决方案使用铸造:- </em></p><p id="aaf0" class="jc jd ht bd je jf mf mg mh mi mj jl ek translated"><a class="ae jn" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/test/foundry/5_Token.t.sol" rel="noopener ugc nofollow" target="_blank"> <em class="jm">测试</em> </a> <em class="jm">，</em> <a class="ae jn" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/script/5_TokenScript.sol" rel="noopener ugc nofollow" target="_blank"> <em class="jm">漏洞利用脚本</em> </a></p><p id="5c08" class="jc jd ht bd je jf mf mg mh mi mj jl ek translated"><em class="jm">使用安全帽的解决方案:- </em></p><p id="f44e" class="jc jd ht bd je jf mf mg mh mi mj jl ek translated"><a class="ae jn" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/test/hardhat/5_Token.test.ts" rel="noopener ugc nofollow" target="_blank"> <em class="jm">测试</em> </a> <em class="jm">，</em> <a class="ae jn" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/scripts/5_token_exploit.ts" rel="noopener ugc nofollow" target="_blank"> <em class="jm">漏洞利用脚本</em> </a></p></blockquote><figure class="nw nx ny nz oa iu fe ff paragraph-image"><a href="https://www.buymeacoffee.com/0xcsp"><div class="fe ff nv"><img src="../Images/679392ad412abc67dd16f3b9fefa799d.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*769MixcK_s6-z4fwRrIpMQ.png"/></div></a></figure><h1 id="1e15" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ob kb kc kd oc kf kg kh od kj kk kl dt translated">更多级别</h1><div class="oe of fm fo og oh"><a rel="noopener follow" target="_blank" href="/coinmonks/ethernaut-level-6-delegation-foundry-hardhat-917faaff3570"><div class="oi ab ej"><div class="oj ab ok cl cj ol"><h2 class="bd hu fv z el om eo ep on er et hs dt translated">以太6级-委托[铸造-安全帽]</h2><div class="oo l"><h3 class="bd b fv z el om eo ep on er et ek translated">Ethernaut-Solutions存储库包含使用Foundry和Hardhat的解决方案。</h3></div><div class="op l"><p class="bd b gc z el om eo ep on er et ek translated">medium.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov iz oh"/></div></div></a></div><div class="oe of fm fo og oh"><a rel="noopener follow" target="_blank" href="/coinmonks/ethernaut-level-4-telephone-foundry-hardhat-599aff68a9b4"><div class="oi ab ej"><div class="oj ab ok cl cj ol"><h2 class="bd hu fv z el om eo ep on er et hs dt translated">以太四级电话[铸造厂-安全帽]</h2><div class="oo l"><h3 class="bd b fv z el om eo ep on er et ek translated">Ethernaut-Solutions存储库包含使用Foundry和Hardhat的解决方案。</h3></div><div class="op l"><p class="bd b gc z el om eo ep on er et ek translated">medium.com</p></div></div><div class="oq l"><div class="ow l os ot ou oq ov iz oh"/></div></div></a></div><blockquote class="jb"><p id="d371" class="jc jd ht bd je jf jg jh ji jj jk jl ek translated">加入Coinmonks <a class="ae jn" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jn" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="abb2" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">另外，阅读</h1><ul class=""><li id="fae9" class="km kn ht ko b kp kq kr ks kt ku kv kw kx ky jl kz la lb lc dt translated"><a class="ae jn" href="https://coincodecap.com/huobi-crypto-trading-signals" rel="noopener ugc nofollow" target="_blank">用于Huobi的加密交易信号</a> | <a class="ae jn" rel="noopener" href="/coinmonks/hitbtc-review-c5143c5d53c2"> HitBTC审查</a></li><li id="3d62" class="km kn ht ko b kp nq kr nr kt ns kv nt kx nu jl kz la lb lc dt translated"><a class="ae jn" href="https://coincodecap.com/traderwagon-review" rel="noopener ugc nofollow" target="_blank"> TraderWagon回顾</a> | <a class="ae jn" href="https://coincodecap.com/kraken-vs-gemini-vs-bityard" rel="noopener ugc nofollow" target="_blank">北海巨妖vs双子星vs BitYard </a></li><li id="3adc" class="km kn ht ko b kp nq kr nr kt ns kv nt kx nu jl kz la lb lc dt translated"><a class="ae jn" href="https://coincodecap.com/ftx-futures-trading" rel="noopener ugc nofollow" target="_blank">如何在FTX交易所交易期货</a></li><li id="17bc" class="km kn ht ko b kp nq kr nr kt ns kv nt kx nu jl kz la lb lc dt translated"><a class="ae jn" href="https://coincodecap.com/okex-kucoin" rel="noopener ugc nofollow" target="_blank"> OKEx vs KuCoin </a> | <a class="ae jn" href="https://coincodecap.com/celsius-alternatives" rel="noopener ugc nofollow" target="_blank">摄氏替代品</a> | <a class="ae jn" href="https://coincodecap.com/buy-vechain" rel="noopener ugc nofollow" target="_blank">如何购买VeChain </a></li><li id="5a41" class="km kn ht ko b kp nq kr nr kt ns kv nt kx nu jl kz la lb lc dt translated"><a class="ae jn" href="https://coincodecap.com/profitfarmers-review" rel="noopener ugc nofollow" target="_blank"> ProfitFarmers点评</a> | <a class="ae jn" href="https://coincodecap.com/cornix-trading-bot" rel="noopener ugc nofollow" target="_blank">如何使用Cornix交易机器人</a></li></ul></div></div>    
</body>
</html>