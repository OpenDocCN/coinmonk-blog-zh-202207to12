<html>
<head>
<title>Authenticating users with ethers.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ethers.js验证用户</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/authenticating-users-with-ethers-js-4395506dcf3c?source=collection_archive---------2-----------------------#2022-07-03">https://medium.com/coinmonks/authenticating-users-with-ethers-js-4395506dcf3c?source=collection_archive---------2-----------------------#2022-07-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/e5b93e5a96f6e505a6c8bc3426674789.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QYCh6KyrQwEjTW4Ndw7w3Q.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@markusspiske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae jf" href="https://unsplash.com/s/photos/authentication?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="391b" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">使用ethers.js和MetaMask之类的钱包来验证用户是很简单的。这个想法是创建一个消息来标识想要认证用户的应用程序，并发送这个消息由钱包签名，钱包保存它的私钥。</p><blockquote class="ke kf kg"><p id="86d6" class="jg jh kh ji b jj jk jl jm jn jo jp jq ki js jt ju kj jw jx jy kk ka kb kc kd hm dt translated">交易新手？试试<a class="ae jf" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae jf" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote><p id="7540" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">签名必须发送到后端，后端有消息的副本。它将检索签署消息的地址，从而识别用户。</p><p id="10d0" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">让我们在代码中看到这一点。以下3行代码应该足以生成消息签名:</p><pre class="kl km kn ko fq kp kq kr ks aw kt dt"><span id="541b" class="ku kv ht kq b fv kw kx l ky kz">const provider = new ethers.providers.Web3Provider(window.ethereum)     const signer = provider.getSigner()     <br/>const signedMessage = await signer.signMessage("Message")</span></pre><p id="bd35" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">消息“message”必须替换为包含应用程序名称的字符串，最好还包含当前日期。这是为了防止签名被重复使用。</p><p id="dca8" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">上面的代码将调用wallet，如下图所示:</p><figure class="kl km kn ko fq iu fe ff paragraph-image"><div class="fe ff la"><img src="../Images/aa46e61232de8a82af7794502ca05376.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*7OQXXvNQrEWEP8vqEcENfg.png"/></div></figure><p id="c3f3" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">签名后，可以使用<em class="kh">console . log(signed message)</em>查看签名，如下图所示:</p><figure class="kl km kn ko fq iu fe ff paragraph-image"><div class="fe ff lb"><img src="../Images/d7096c12c5c8859eb1c84d29d5c72193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*rqgJ4UYjSCpG4Itt4CaHJg.png"/></div></figure><p id="3f27" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这是必须发送到后端的签名，在后端，可以使用另一个ether.js方法轻松检索签署消息的地址:</p><pre class="kl km kn ko fq kp kq kr ks aw kt dt"><span id="2056" class="ku kv ht kq b fv kw kx l ky kz">const signerAddr = await ethers.utils.verifyMessage("Message", signedMessage)</span></pre><p id="806a" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">通过这种确认，可以为已经通过身份验证的用户创建一个临时会话。</p><p id="2c22" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">感谢阅读！</strong></p></div></div>    
</body>
</html>