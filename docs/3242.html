<html>
<head>
<title>10 Simple Ways to Save Gas with Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">10种简单可靠的省油方法</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/10-simple-ways-to-save-gas-with-solidity-f74cd2a59089?source=collection_archive---------2-----------------------#2022-09-06">https://medium.com/coinmonks/10-simple-ways-to-save-gas-with-solidity-f74cd2a59089?source=collection_archive---------2-----------------------#2022-09-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/08d7feff48527a7658976fdf2616a107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OXQt-wvivqLIwGxunNh5pg.jpeg"/></div></div></figure><p id="c6ff" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">下面是一些简单的方法，你可以在合同中节省汽油。完整的列表似乎是无穷无尽的，但都归结为找到最有效的方法，以最少的操作执行一个动作。</p><h2 id="eb05" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">目录</h2><ol class=""><li id="51bb" class="ku kv ht jd b je kw ji kx jm ky jq kz ju la jy lb lc ld le dt translated">状态数据与字节码数据</li><li id="bc4a" class="ku kv ht jd b je lf ji lg jm lh jq li ju lj jy lb lc ld le dt translated">do-while vs for循环的威力</li><li id="129c" class="ku kv ht jd b je lf ji lg jm lh jq li ju lj jy lb lc ld le dt translated">i++对++i</li><li id="5305" class="ku kv ht jd b je lf ji lg jm lh jq li ju lj jy lb lc ld le dt translated">忽略安全数学—未选中{}</li><li id="c085" class="ku kv ht jd b je lf ji lg jm lh jq li ju lj jy lb lc ld le dt translated">坚持首选数据类型</li><li id="003c" class="ku kv ht jd b je lf ji lg jm lh jq li ju lj jy lb lc ld le dt translated">呼叫数据与内存</li><li id="2c0a" class="ku kv ht jd b je lf ji lg jm lh jq li ju lj jy lb lc ld le dt translated">使用内存缓存读取变量</li><li id="5131" class="ku kv ht jd b je lf ji lg jm lh jq li ju lj jy lb lc ld le dt translated">有效的变量管理</li><li id="d35b" class="ku kv ht jd b je lf ji lg jm lh jq li ju lj jy lb lc ld le dt translated">第一次写入时节省电量</li><li id="e2b7" class="ku kv ht jd b je lf ji lg jm lh jq li ju lj jy lb lc ld le dt translated">调用结构数据</li></ol></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h2 id="7abd" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">1.状态数据与字节码数据</h2><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="14d6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">通过将<code class="eh lx ly lz ma b">_b</code>存储为常量，它将作为不可变数据存储在契约的字节码中。我们的神奇数字<code class="eh lx ly lz ma b">1000</code>也是如此。另一方面，<code class="eh lx ly lz ma b">_a</code>存储在契约的状态中，需要一个<code class="eh lx ly lz ma b">SLOAD</code>操作来读取它。</p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h2 id="264c" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">2.do-while vs for循环的威力</h2><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="1eb9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">几乎在每一种编码语言中，循环都是非常标准的，这种熟悉会让我们自满。</p><p id="25c2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">标准的<code class="eh lx ly lz ma b">for loop</code>将在执行语句前检查条件。A <code class="eh lx ly lz ma b">do while</code>将至少执行一次该语句，然后检查条件，以节省汽油。</p><blockquote class="mb mc md"><p id="1d30" class="jb jc me jd b je jf jg jh ji jj jk jl mf jn jo jp mg jr js jt mh jv jw jx jy hm dt translated"><strong class="jd hu">警告:</strong>只有当你确定代码应该至少执行一次时才使用do-while，并且记住处理你的条件以防止无限循环和耗尽。</p></blockquote><p id="877e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">有关do-while循环与while循环有何不同的信息，请查看本文:</p><div class="mi mj fm fo mk ml"><a href="https://www.guru99.com/while-vs-do-while.html" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab ej"><div class="mn ab mo cl cj mp"><h2 class="bd hu fv z el mq eo ep mr er et hs dt translated">while和do-while的区别:举例说明</h2><div class="ms l"><h3 class="bd b fv z el mq eo ep mr er et ek translated">循环多次执行语句序列，直到所述条件变为假。一个循环由两个…</h3></div><div class="mt l"><p class="bd b gc z el mq eo ep mr er et ek translated">www.guru99.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz iz ml"/></div></div></a></div></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h2 id="23c6" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">3.i++对++i</h2><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="4ccc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我知道，我知道，这看起来有点疯狂，但数字不会说谎——但为什么会更便宜呢？</p><p id="2a3e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh lx ly lz ma b">i++</code>通过将原始值存储在存储器中来增加<code class="eh lx ly lz ma b">i</code>的值，增加它，然后将结果值存储在临时存储器中并返回原始值。在返回时，<code class="eh lx ly lz ma b">i</code>的新值被更新。总之需要4次手术。</p><p id="3e09" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh lx ly lz ma b">++i</code>递增<code class="eh lx ly lz ma b">i</code>的值并返回该值，需要2次运算。</p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h2 id="d3d6" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">4.忽略安全数学—未选中{}</h2><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="4cdb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">来自实体文档:</p><p id="5022" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><a class="ae na" href="https://docs.soliditylang.org/en/v0.8.0/control-structures.html#checked-or-unchecked-arithmetic" rel="noopener ugc nofollow" target="_blank">https://docs . solidi tylang . org/en/v 0 . 8 . 0/control-structures . html # checked-or-unchecked-算术</a></p><blockquote class="mb mc md"><p id="01c5" class="jb jc me jd b je jf jg jh ji jj jk jl mf jn jo jp mg jr js jt mh jv jw jx jy hm dt translated">在Solidity 0.8.0之前，算术运算总是会在下溢或溢出的情况下换行，这导致了引入额外检查的库的广泛使用。</p><p id="7957" class="jb jc me jd b je jf jg jh ji jj jk jl mf jn jo jp mg jr js jt mh jv jw jx jy hm dt translated">从Solidity 0.8.0开始，默认情况下，所有的算术运算都会发生上溢和下溢，因此不需要使用这些库。</p><p id="fdaa" class="jb jc me jd b je jf jg jh ji jj jk jl mf jn jo jp mg jr js jt mh jv jw jx jy hm dt translated">为了获得前面的行为，可以使用未检查的块:</p></blockquote><p id="7cad" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这意味着您可以通过使用<code class="eh lx ly lz ma b">unchecked</code>块来避免对您的<code class="eh lx ly lz ma b">++i</code>进行不必要的检查，从而节省汽油。</p><p id="f970" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在上面的示例代码中，这样做是安全的，因为我们知道<code class="eh lx ly lz ma b">++i</code>不会溢出2个⁵⁶，当<code class="eh lx ly lz ma b">i == 200</code>时，我们的两个循环都将停止处理</p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h2 id="2c18" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">5.坚持首选数据类型</h2><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="1520" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">EVM(以太坊虚拟机)由256位(32字节)变量驱动。这意味着在我们上面的循环中，<code class="eh lx ly lz ma b">uint16</code>变量在被使用前被转换为<code class="eh lx ly lz ma b">uint256</code>，这种转换耗费了汽油。</p><p id="7c29" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如你所见，我们通过使用变量<code class="eh lx ly lz ma b">i</code>的<code class="eh lx ly lz ma b">uint256</code>来节省汽油。</p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h2 id="6a5b" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">6.呼叫数据与内存</h2><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="2716" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">来自实体文档:</p><p id="c84c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><a class="ae na" href="https://docs.soliditylang.org/en/v0.5.11/types.html?highlight=memory#data-location" rel="noopener ugc nofollow" target="_blank">https://docs.soliditylang.org/en/v0.5.11/types.html?高亮显示=存储器#数据位置</a></p><blockquote class="mb mc md"><p id="f4e7" class="jb jc me jd b je jf jg jh ji jj jk jl mf jn jo jp mg jr js jt mh jv jw jx jy hm dt translated">Calldata仅对外部协定函数的参数有效，并且对于此类参数是必需的。Calldata是一个不可修改的、非持久的存储函数参数的区域，其行为很像内存。</p></blockquote><p id="fdaf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">建议尽可能尝试使用calldata。它避免了不必要的拷贝，从而降低了天然气价格，并确保数据是不可变的。</p><p id="4369" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">值得注意的是，由于solidity 0.6.9对<code class="eh lx ly lz ma b">memory</code>和<code class="eh lx ly lz ma b">calldata</code>的使用不受函数可见性的限制。</p><p id="d1ad" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">有关<code class="eh lx ly lz ma b">storage</code>、<code class="eh lx ly lz ma b">memory</code>和<code class="eh lx ly lz ma b">calldata</code>之间差异的更多详细信息，请查看本文:</p><div class="mi mj fm fo mk ml"><a rel="noopener follow" target="_blank" href="/coinmonks/solidity-storage-vs-memory-vs-calldata-8c7e8c38bce"><div class="mm ab ej"><div class="mn ab mo cl cj mp"><h2 class="bd hu fv z el mq eo ep mr er et hs dt translated">可靠性—存储与内存和呼叫数据</h2><div class="ms l"><h3 class="bd b fv z el mq eo ep mr er et ek translated">Solidity中数据位置之间难以捉摸的比较。</h3></div><div class="mt l"><p class="bd b gc z el mq eo ep mr er et ek translated">medium.com</p></div></div><div class="mu l"><div class="nb l mw mx my mu mz iz ml"/></div></div></a></div></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h2 id="fce0" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">7.使用内存缓存读取变量</h2><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="c1de" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">访问冷存储变量(第一次读取)的成本是<code class="eh lx ly lz ma b">2100 gas</code>和其后的<code class="eh lx ly lz ma b">100 gas</code>——热存储访问</p><p id="fad7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可以通过缓存存储变量并读取缓存数据而不是存储数据来节省时间。从存储阵列读取数据时也是如此。</p><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="7691" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在上面的例子中，我们将<code class="eh lx ly lz ma b">_arr</code>存储在<code class="eh lx ly lz ma b">SaveGas2 &gt; loop()</code>的内存中。所有的读取都是从新的<code class="eh lx ly lz ma b">arr</code>中调用的。</p><p id="94b4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">只要存储阵列不是太大，这是一个很好的节省气体的方法。数据必须被复制到内存中，因此大的数组将是低效的。</p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h2 id="006e" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">8.有效的变量管理</h2><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="8034" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果你打算重用一个像<code class="eh lx ly lz ma b">solution</code>这样的变量，并且你知道它不会继承前一个循环的值，你可以通过在循环之外定义变量来节省时间——比较<code class="eh lx ly lz ma b">SaveGas</code>和<code class="eh lx ly lz ma b">SaveGas2</code>中的循环。</p><p id="173f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">此外，如果你知道没有溢出的风险，你可以通过在<code class="eh lx ly lz ma b">unchecked</code>块中嵌套<code class="eh lx ly lz ma b">solution</code>计算来节省更多的汽油。</p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h2 id="886a" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">9.第一次写入时节省电量</h2><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="98dc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">将存储值从零值改变为非零值将花费<code class="eh lx ly lz ma b">20000 gas</code>，并且所有非零的第n次写入将花费<code class="eh lx ly lz ma b">5000 gas</code>。我们可以通过为<code class="eh lx ly lz ma b">_data</code>定义一个非零值来为第一个调用该函数的用户节省一些时间。</p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h2 id="f41d" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">10.调用结构数据</h2><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="7b07" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">EVM按顺序存储数据，试图将所有内容打包到256位槽(32字节)中。在上面的例子中，结构数据被安排成<code class="eh lx ly lz ma b">x</code>和<code class="eh lx ly lz ma b">y</code>将占用一个256位的内存槽，而<code class="eh lx ly lz ma b">z</code>将占用它自己的槽——非常整洁。</p><p id="ecc5" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在读取我们的值时，我们可以通过最小化我们必须读取和/或缓存的内存槽的数量来节省能源。</p><p id="218f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh lx ly lz ma b">SaveGas &gt; getUserZ()</code>将相关的<code class="eh lx ly lz ma b">MyData</code>结构存储在内存中——复制两个内存插槽，然后读取相关数据。</p><p id="6325" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh lx ly lz ma b">SaveGas2 &gt; getUserZ()</code>正在从包含<code class="eh lx ly lz ma b">z</code>的单个内存插槽中读取数据。</p><h1 id="b805" class="nc ka ht bd kb nd ne nf kf ng nh ni kj nj nk nl km nm nn no kp np nq nr ks ns dt translated">去哪里找我</h1><p id="55c6" class="pw-post-body-paragraph jb jc ht jd b je kw jg jh ji kx jk jl jm nt jo jp jq nu js jt ju nv jw jx jy hm dt translated">我通常可以在酷猫不和谐频道<br/> <a class="ae na" href="https://t.co/PjlbnmaW3a?amp=1" rel="noopener ugc nofollow" target="_blank">找到https://discord.gg/WhBAAHnSz4</a></p><p id="a38b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">或者在推特上<br/>T19】https://twitter.com/xtremetom</p><div class="mi mj fm fo mk ml"><a href="https://twitter.com/coolcatsnft" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab ej"><div class="mn ab mo cl cj mp"><h2 class="bd hu fv z el mq eo ep mr er et hs dt translated">JavaScript不可用。</h2><div class="ms l"><h3 class="bd b fv z el mq eo ep mr er et ek translated">编辑描述</h3></div><div class="mt l"><p class="bd b gc z el mq eo ep mr er et ek translated">twitter.com</p></div></div><div class="mu l"><div class="nw l mw mx my mu mz iz ml"/></div></div></a></div><blockquote class="nx"><p id="2ea5" class="ny nz ht bd oa ob oc od oe of og jy ek translated">交易新手？试试<a class="ae na" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae na" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>