<html>
<head>
<title>How to make your NFTs reveal in Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何让你的NFTs在坚实中显露出来</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-make-your-nfts-reveal-in-solidity-d231ec8413c6?source=collection_archive---------1-----------------------#2022-08-23">https://medium.com/coinmonks/how-to-make-your-nfts-reveal-in-solidity-d231ec8413c6?source=collection_archive---------1-----------------------#2022-08-23</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/dbf704fe8e92a69f46ff09e76624b14d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aih9Qhe1G7hDnJCJoH5tFw.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">AI art generated from article’s title</figcaption></figure><p id="fec5" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">随着NFT面积每天都在增长，更多新的机制和实验正在进入无价像素的世界。NFT发布期间最流行的方法之一是显示切换功能。</p><p id="6aeb" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">显示功能代表最初隐藏带有占位符图像的NFT图片。在本文中，我们将介绍实现这种行为的过程，并分析为什么您可能会在您的集合中使用它。</p><h1 id="74f9" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">理论</h1><p id="97b1" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">首先，让我们深入NFTs的理论来定义我们的揭示所需的步骤。NFT遵循不可替换令牌的<a class="ae lg" href="https://eips.ethereum.org/EIPS/eip-721" rel="noopener ugc nofollow" target="_blank"> ERC721 </a>标准，并且所有的生成集合也遵循<code class="eh lh li lj lk b">ERC721Metadata</code>接口。</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="b7e4" class="lt ke ht lk b fv lu lv l lw lx"><strong class="lk hu">interface</strong> ERC721Metadata <em class="ly">/* is ERC721 */</em> {<br/>    <em class="ly">/// @notice A descriptive name for a collection of NFTs in this contract<br/></em>    <strong class="lk hu">function</strong> name() <strong class="lk hu">external</strong> <strong class="lk hu">view</strong> <strong class="lk hu">returns</strong> (<strong class="lk hu">string</strong> _name);<br/><br/>    <em class="ly">/// @notice An abbreviated name for NFTs in this contract<br/></em>    <strong class="lk hu">function</strong> symbol() <strong class="lk hu">external</strong> <strong class="lk hu">view</strong> <strong class="lk hu">returns</strong> (<strong class="lk hu">string</strong> _symbol);<br/><br/>    <em class="ly">/// @notice A distinct Uniform Resource Identifier (URI) for a given asset.<br/></em>    <em class="ly">/// @dev Throws if `_tokenId` is not a valid NFT. URIs are defined in RFC<br/></em>    <em class="ly">///  3986. The URI may point to a JSON file that conforms to the "ERC721<br/></em>    <em class="ly">///  Metadata JSON Schema".<br/></em>    <strong class="lk hu">function</strong> tokenURI(<strong class="lk hu">uint256</strong> _tokenId) <strong class="lk hu">external</strong> <strong class="lk hu">view</strong> <strong class="lk hu">returns</strong> (<strong class="lk hu">string</strong>);<br/>}</span></pre><p id="c4cb" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这个接口允许我们为集合中的每个NFT指定名称、符号和tokenURI。我们感兴趣的是负责返回项目元数据值的<code class="eh lh li lj lk b">tokenURI</code>函数。</p></div><div class="ab cl lz ma hb mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hm hn ho hp hq"><p id="5e85" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">所以我们实现Reveal的任务如下:<br/> <strong class="jh hu"> 1。</strong>在智能合约中创建一个标志变量，指示NFT是否隐藏/显示<br/> <strong class="jh hu"> 2。</strong>添加切换(或设置为真)标志变量值的外部函数，该函数只能由所有者<br/> <strong class="jh hu"> 3访问。</strong>覆盖<code class="eh lh li lj lk b">tokenURI</code>方法，为隐藏阶段的每个NFT返回相同的单个元数据文件，并在显示<br/> <strong class="jh hu"> 4后返回适当的NFT元数据。</strong>上传隐藏阶段元数据到IPFS</p><h1 id="6ddb" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">更新智能合同</h1><p id="19eb" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">我不会深入解释常见的NFT智能合约，假设你已经有一个；)如果没有，那就看看提供节能铸造的<a class="ae lg" href="https://www.erc721a.org/" rel="noopener ugc nofollow" target="_blank"> ERC721A </a>标准，这样你的客户就不会花很多交易费了。我也将在本教程中使用ERC721A。</p><p id="5dc2" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">让我们将flag属性添加到现有的契约类中，并用<code class="eh lh li lj lk b">false</code>对其进行初始化:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="6915" class="lt ke ht lk b fv lu lv l lw lx">bool public revealed = false;</span></pre><p id="677e" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">然后让我们添加一个函数来改变我们的<code class="eh lh li lj lk b">revealed</code>值，并确保它只能被<code class="eh lh li lj lk b">owner</code>调用。为此，我建议从OpenZeppelin <code class="eh lh li lj lk b">Ownable</code>契约中派生出来，为我们增加<code class="eh lh li lj lk b">onlyOwner</code>修改器。</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="1901" class="lt ke ht lk b fv lu lv l lw lx">contract HiddenReveal is ERC721A, Ownable {<br/>  bool public revealed = false;</span><span id="b801" class="lt ke ht lk b fv mg lv l lw lx">  function reveal() external onlyOwner {<br/>      revealed = true;<br/>  }<br/>}</span></pre><p id="f326" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">如你所见，我没有切换<code class="eh lh li lj lk b">revealed</code>值，只是设置了<code class="eh lh li lj lk b">true</code>。这样你就不会让你的社区紧张，担心你可能会在揭露后再次隐藏他们的非功能性测试🙃您可以使其切换当前值或设置为传递到函数中的值。</p><p id="7dd2" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">现在是最有趣的部分:基于我们的<code class="eh lh li lj lk b">revealed</code>标志覆盖<code class="eh lh li lj lk b">tokenURI</code>函数。</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="fd44" class="lt ke ht lk b fv lu lv l lw lx">function tokenURI(uint256 tokenId) public view virtual override returns (string memory) {<br/>    if (!_exists(tokenId)) revert URIQueryForNonexistentToken();<br/><br/>    string memory baseURI = _baseURI();<br/>    string memory metadataPointerId = !revealed ? 'unrevealed' :     _toString(tokenId);<br/>    string memory result = string(abi.encodePacked(baseURI, metadataPointerId, '.json'));<br/><br/>    return bytes(baseURI).length != 0 ? result : '';<br/>}</span></pre><ol class=""><li id="342a" class="mh mi ht jh b ji jj jm jn jq mj ju mk jy ml kc mm mn mo mp dt translated">检查带有此类<code class="eh lh li lj lk b">tokenId</code>的令牌是否存在，如果不存在，则返回自定义错误</li><li id="287e" class="mh mi ht jh b ji mq jm mr jq ms ju mt jy mu kc mm mn mo mp dt translated">获取<code class="eh lh li lj lk b">baseURI</code>值，将其与<code class="eh lh li lj lk b">tokenId</code>连接，并获得元数据URL</li><li id="f91a" class="mh mi ht jh b ji mq jm mr jq ms ju mt jy mu kc mm mn mo mp dt translated">检查当前的<code class="eh lh li lj lk b">revealed</code>状态，如果是<code class="eh lh li lj lk b">false</code>则使用<code class="eh lh li lj lk b">unrevealed</code>字符串代替<code class="eh lh li lj lk b">tokenId</code>，将其存储到<code class="eh lh li lj lk b">metadataPointerId</code></li><li id="5ebe" class="mh mi ht jh b ji mq jm mr jq ms ju mt jy mu kc mm mn mo mp dt translated">串联<code class="eh lh li lj lk b">baseURI</code>、<code class="eh lh li lj lk b">metadataPointerId</code>和<code class="eh lh li lj lk b">.json</code>扩展</li><li id="37c3" class="mh mi ht jh b ji mq jm mr jq ms ju mt jy mu kc mm mn mo mp dt translated">返回的<code class="eh lh li lj lk b">result</code>是被指定的baseURI</li></ol></div><div class="ab cl lz ma hb mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hm hn ho hp hq"><p id="fac2" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">对于每个NFT，<code class="eh lh li lj lk b">revealed=false</code>的最终结果将是这样的:</p><p id="63cf" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><code class="eh lh li lj lk b">https://www.mybaseurilink.com/folderipfshash/unrevealed.json</code>或<code class="eh lh li lj lk b">ipfs://folderipfshash/unrevealed.json</code></p><p id="10e7" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">以下是具有隐藏/显示功能的完整智能合约代码:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="dc9f" class="lt ke ht lk b fv lu lv l lw lx">contract HiddenReveal is ERC721A, Ownable {<br/>    string private _baseTokenURI;<br/><br/>    bool public revealed = false;<br/><br/>    function _baseURI() internal view virtual override returns (string memory) {<br/>        return _baseTokenURI;<br/>    }<br/><br/>    function tokenURI(uint256 tokenId) public view virtual override returns (string memory) {<br/>        if (!_exists(tokenId)) revert URIQueryForNonexistentToken();<br/><br/>        string memory baseURI = _baseURI();<br/>        string memory metadataPointerId = !revealed ? 'unrevealed' : _toString(tokenId);<br/>        string memory result = string(abi.encodePacked(baseURI, metadataPointerId, '.json'));<br/><br/>        return bytes(baseURI).length != 0 ? result : '';<br/>    }<br/><br/>    function setBaseURI(string calldata baseURI) external onlyOwner {<br/>        _baseTokenURI = baseURI;<br/>    }<br/><br/>    function reveal() external onlyOwner {<br/>        revealed = true;<br/>    }<br/>}</span></pre><blockquote class="mv mw mx"><p id="1425" class="jf jg ly jh b ji jj jk jl jm jn jo jp my jr js jt mz jv jw jx na jz ka kb kc hm dt translated">请注意，这个智能合同不是生产就绪，因为它没有薄荷功能lol。但是您可以使用它作为参考，将功能插入到您的解决方案中</p></blockquote><h1 id="dade" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">建立IPFS</h1><p id="31d7" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">完成智能合同部分后，您必须为未披露的项目元数据设置存储。一般来说，你只需要在一个单独的IPFS文件夹中存储一个占位符图像和<code class="eh lh li lj lk b">unrevealed.json</code>元数据文件。</p><p id="7478" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">然后，通过用文件夹的散列调用契约上的<code class="eh lh li lj lk b">setBaseURI</code>,将您的智能契约连接到IPFS存储。</p><p id="e9c3" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这里有一个<code class="eh lh li lj lk b">unrevealed.json</code>的例子:</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="17c7" class="lt ke ht lk b fv lu lv l lw lx">{<br/>  "name": "@nfedosenko Hide/Reveal",<br/>  "description": "Tutorial on how to create Reveal functionality on your NFT",<br/>  "image": "ipfs://hAshToYoUrPlAcEhoLderImAge"<br/>}</span></pre><h1 id="3749" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">结论</h1><p id="127b" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">总而言之，展示功能是一个伟大的营销工具和一个微小的机制，可以轻松地添加到每一个NFT滴。此外，您可以指定多个展示阶段，将它们定义为一个枚举，并为项目的后期制作阶段添加一些娱乐元素！</p><p id="36c5" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">顺便说一句，这和许多其他的优化和技术都是在我的NFT收藏中实现的，具有独特的艺术和实用性🔥所以我欢迎你来看看并加入我们的俱乐部:<a class="ae lg" href="https://www.pussyloversclub.io/" rel="noopener ugc nofollow" target="_blank"> p*ssyloversclub.io </a></p><blockquote class="nb"><p id="846c" class="nc nd ht bd ne nf ng nh ni nj nk kc ek translated">交易新手？尝试<a class="ae lg" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae lg" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>