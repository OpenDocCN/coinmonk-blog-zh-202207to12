<html>
<head>
<title>How to develop and deploy smart contracts with Foundry &amp; Openzeppelin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何利用Foundry &amp; Openzeppelin开发和部署智能合同</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-develop-and-deploy-smart-contracts-with-foundry-openzeppelin-6bba51ddb438?source=collection_archive---------2-----------------------#2022-11-25">https://medium.com/coinmonks/how-to-develop-and-deploy-smart-contracts-with-foundry-openzeppelin-6bba51ddb438?source=collection_archive---------2-----------------------#2022-11-25</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="74da" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Foundry是一个用Rust编写的以太坊应用程序开发的非常快速、可移植和模块化的工具包。</p><p id="1c01" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">铸造厂由三部分组成:</p><p id="cbd7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://github.com/foundry-rs/foundry/tree/master/forge" rel="noopener ugc nofollow" target="_blank"> Forge </a>:以太坊测试框架(比如Truffle、Hardhat、DappTools)。</p><p id="e9b2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://github.com/foundry-rs/foundry/tree/master/cast" rel="noopener ugc nofollow" target="_blank"> Cast </a>:用于与EVM智能合约交互、发送交易、获取链数据的CLI。</p><p id="9ac9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://github.com/foundry-rs/foundry/tree/master/anvil" rel="noopener ugc nofollow" target="_blank"> Anvil </a>:本地以太坊节点，类似于Ganache或者Hardhat网络。</p><h1 id="74bf" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated"><strong class="ak">为什么要用？</strong></h1><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff kn"><img src="../Images/ca2ad147d1c2f090e2bfca6e646c1226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SpttNRShCalW2K5p.jpg"/></div></div></figure><ul class=""><li id="51f6" class="kz la ht is b it iu ix iy jb lb jf lc jj ld jn le lf lg lh dt translated">速度很快，运行测试时不再浪费时间。</li><li id="c141" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn le lf lg lh dt translated">它允许你在solidity中编写测试，这最小化了上下文切换。</li><li id="3e36" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn le lf lg lh dt translated">许多测试功能，如fuzzing、console.log和作弊代码，为您提供了更多的功能和灵活性。</li></ul><h1 id="62c3" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">我们将在本文中讨论的主题</h1><ol class=""><li id="c205" class="kz la ht is b it ln ix lo jb lp jf lq jj lr jn ls lf lg lh dt translated">项目设置</li><li id="4b62" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn ls lf lg lh dt translated">如何在Foundry中安装依赖项(例如。OpenZeppelin)</li><li id="4e4d" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn ls lf lg lh dt translated">将Foundry与VSCode集成</li><li id="e8bb" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn ls lf lg lh dt translated">使用Foundry编写合同和测试用例</li><li id="5d71" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn ls lf lg lh dt translated">了解铸造中的痕迹</li><li id="dc69" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn ls lf lg lh dt translated">使用Foundry生成气体报告</li><li id="8ead" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn ls lf lg lh dt translated">使用Foundry部署合同</li></ol><h1 id="76c8" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">装置</h1><p id="a229" class="pw-post-body-paragraph iq ir ht is b it ln iv iw ix lo iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">铸造的安装在铸造书里有很好的解释，看看这里的说明</p><p id="f295" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://book.getfoundry.sh/getting-started/installation" rel="noopener ugc nofollow" target="_blank">https://book.getfoundry.sh/getting-started/installation</a></p><h1 id="da8a" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">设置项目</h1><p id="a545" class="pw-post-body-paragraph iq ir ht is b it ln iv iw ix lo iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">一旦安装了铸造车间，我们就可以使用</p><pre class="ko kp kq kr fq lw lx ly bn lz ma bi"><span id="fe48" class="mb jq ht lx b be mc md l me mf">forge init foundry-demo // forge-demo is name of the project</span></pre><p id="9677" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建项目后，使用命令检查一切是否正常工作</p><pre class="ko kp kq kr fq lw lx ly bn lz ma bi"><span id="a1b4" class="mb jq ht lx b be mc md l me mf">cd foundry-demo &amp;&amp; forge build</span></pre><h1 id="7350" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">安装依赖项</h1><p id="52d7" class="pw-post-body-paragraph iq ir ht is b it ln iv iw ix lo iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">默认情况下，Forge使用<a class="ae jo" href="https://git-scm.com/book/en/v2/Git-Tools-Submodules" rel="noopener ugc nofollow" target="_blank"> git子模块</a>来管理依赖关系，这意味着它可以与任何包含智能契约的GitHub存储库一起工作。</p><p id="21a3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要使用<strong class="is hu"> OpenZeppelin </strong>我们需要将它作为一个依赖项安装在我们的项目中，为此使用命令</p><pre class="ko kp kq kr fq lw lx ly bn lz ma bi"><span id="d795" class="mb jq ht lx b be mc md l me mf">forge install OpenZeppelin/openzeppelin-contracts<br/>// forge install is command which is used for installing  dependencies <br/>// &lt;https://github.com/OpenZeppelin/openzeppelin-contracts&gt;<br/>// use {{username}}/{{repo_name}} from the github url</span></pre><h1 id="2c44" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">将Foundry与VSCode集成</h1><p id="eeea" class="pw-post-body-paragraph iq ir ht is b it ln iv iw ix lo iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">将<strong class="is hu"> OpenZeppelin </strong>作为依赖项安装后，尝试在契约中从它导入一些东西(你的契约在/src目录下)，如果你使用的是VSCode，会弹出一个错误</p><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff mg"><img src="../Images/aa843b963b37c2e5830cc301ac5b98f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4k7zsZrv7WH8KBut"/></div></div></figure><p id="d0a8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要修复此错误，请运行以下命令</p><pre class="ko kp kq kr fq lw lx ly bn lz ma bi"><span id="9e5e" class="mb jq ht lx b be mc md l me mf">forge remappings &gt; remappings.txt</span></pre><p id="c2c8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个命令的作用是在项目的根目录下创建一个remappings.txt文件</p><p id="b5fb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此时，文件中的内容可能如下所示，</p><pre class="ko kp kq kr fq lw lx ly bn lz ma bi"><span id="a020" class="mb jq ht lx b be mc md l me mf">ds-test/=lib/forge-std/lib/ds-test/src/<br/>forge-std/=lib/forge-std/src/<br/>openzeppelin-contracts/=lib/openzeppelin-contracts/contracts/</span></pre><p id="7f81" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">更多详情请访问这里<a class="ae jo" href="https://book.getfoundry.sh/config/vscode" rel="noopener ugc nofollow" target="_blank">https://book.getfoundry.sh/config/vscode</a></p><h1 id="7d32" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">写合同</h1><p id="d398" class="pw-post-body-paragraph iq ir ht is b it ln iv iw ix lo iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">重命名文件<code class="eh mh mi mj lx b">src/Counter.sol</code> → <code class="eh mh mi mj lx b">src/FDemo.sol</code>，我们的ERC721智能合约的代码如下</p><figure class="ko kp kq kr fq ks"><div class="bz el l di"><div class="mk ml l"/></div></figure><h1 id="48d5" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">使用Foundry测试合同</h1><p id="2529" class="pw-post-body-paragraph iq ir ht is b it ln iv iw ix lo iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">让我们从重命名测试文件开始，以匹配我们的合同名称<code class="eh mh mi mj lx b">Counter.t.sol</code> → <code class="eh mh mi mj lx b">FDemo.t.sol</code></p><p id="64f0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Forge在测试中使用以下关键字:</p><ul class=""><li id="608b" class="kz la ht is b it iu ix iy jb lb jf lc jj ld jn le lf lg lh dt translated"><code class="eh mh mi mj lx b">setUp</code>:在每个测试用例运行之前调用的可选函数</li></ul><pre class="ko kp kq kr fq lw lx ly bn lz ma bi"><span id="4e74" class="mb jq ht lx b be mc md l me mf">function setUp() public {<br/>    testNumber = 42;<br/>}</span></pre><ul class=""><li id="e2a8" class="kz la ht is b it iu ix iy jb lb jf lc jj ld jn le lf lg lh dt translated"><code class="eh mh mi mj lx b">test</code>:前缀为<code class="eh mh mi mj lx b">test</code>的函数作为测试用例运行</li></ul><pre class="ko kp kq kr fq lw lx ly bn lz ma bi"><span id="3bd9" class="mb jq ht lx b be mc md l me mf">function testNumberIs42() public {     <br/>  assertEq(testNumber, 42); <br/>}</span></pre><ul class=""><li id="dec6" class="kz la ht is b it iu ix iy jb lb jf lc jj ld jn le lf lg lh dt translated"><code class="eh mh mi mj lx b">testFail</code>:测试前缀的倒数——如果函数没有恢复，测试失败</li></ul><pre class="ko kp kq kr fq lw lx ly bn lz ma bi"><span id="4498" class="mb jq ht lx b be mc md l me mf">function testNumberIs42() public {     <br/>  assertEq(testNumber, 42); <br/>}</span></pre><p id="5131" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所以，现在我们只有一个方法<code class="eh mh mi mj lx b">mint</code>，所以我们将为这个方法编写一个测试用例</p><p id="e39c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这将是一个非常简单的问题</p><figure class="ko kp kq kr fq ks"><div class="bz el l di"><div class="mk ml l"/></div></figure><p id="a493" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，要运行这个测试，我们可以使用命令<code class="eh mh mi mj lx b">forge test</code></p><p id="2bf2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果我们想要探索更多关于测试用例的细节/事件/流程，我们可以在运行测试用例时使用跟踪来启用跟踪，使用-vvv或-vvv</p><p id="b907" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">附加的截图显示了有和没有痕迹的测试用例的结果</p><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff mg"><img src="../Images/f8da8e1175c14a662ce6fd13915a680b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kgX9gigS1r5uRaWZ"/></div></div></figure><p id="c857" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">关于踪迹的更多细节:<a class="ae jo" href="https://book.getfoundry.sh/forge/traces" rel="noopener ugc nofollow" target="_blank">https://book.getfoundry.sh/forge/traces</a></p><h1 id="2fb1" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">使用Foundry生成气体报告</h1><p id="9697" class="pw-post-body-paragraph iq ir ht is b it ln iv iw ix lo iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">使用<strong class="is hu"> —气体报告</strong>和测试命令生成气体报告</p><pre class="ko kp kq kr fq lw lx ly bn lz ma bi"><span id="77d7" class="mb jq ht lx b be mc md l me mf">forge test --gas-report</span></pre><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff mg"><img src="../Images/14e536963ee611b8621b4db52ce36363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lFq2lcRfBnk8BUGa"/></div></div></figure><p id="fc79" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">更多关于天然气的详细报道，请点击这里:【https://book.getfoundry.sh/forge/gas-reports T21】</p><h1 id="f6af" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">部署和验证与Foundry的合同</h1><p id="6b48" class="pw-post-body-paragraph iq ir ht is b it ln iv iw ix lo iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">Forge可以使用<code class="eh mh mi mj lx b">[forge create](&lt;https://book.getfoundry.sh/reference/forge/forge-create.html&gt;)</code>命令将智能合约部署到给定的网络。</p><p id="c792" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Forge可以使用<code class="eh mh mi mj lx b">[forge create](&lt;https://book.getfoundry.sh/reference/forge/forge-create.html&gt;)</code>命令将智能合约部署到给定的网络。</p><p id="0df0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在部署契约时，我们可以使用forge创建一些选项</p><ul class=""><li id="3b01" class="kz la ht is b it iu ix iy jb lb jf lc jj ld jn le lf lg lh dt translated"><code class="eh mh mi mj lx b">—rpc-url</code>:我们想要部署合同的网络的RPC URL(在我们的例子中，我们将使用polygon mumbai testnet的Rpc URL)</li><li id="2411" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn le lf lg lh dt translated"><code class="eh mh mi mj lx b">-constructor-args</code>:将参数传递给构造函数</li><li id="89c0" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn le lf lg lh dt translated"><code class="eh mh mi mj lx b">-private-key</code>:部署者钱包的私钥</li></ul><p id="6dd3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果我们想验证我们的合同，我们可以选择通过<code class="eh mh mi mj lx b">--verify</code> &amp; &amp; <code class="eh mh mi mj lx b">--etherscan-api-key</code></p><pre class="ko kp kq kr fq lw lx ly bn lz ma bi"><span id="5cf3" class="mb jq ht lx b be mc md l me mf">$ forge create --rpc-url &lt;your_rpc_url&gt; \\<br/>    --constructor-args "ForgeUSD" "FUSD" 18 1000000000000000000000 \\<br/>    --private-key &lt;your_private_key&gt; src/MyToken.sol:MyToken \\<br/>    --etherscan-api-key &lt;your_etherscan_api_key&gt; \\<br/>    --verify</span></pre><p id="827e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们现在就部署</p><pre class="ko kp kq kr fq lw lx ly bn lz ma bi"><span id="b6a4" class="mb jq ht lx b be mc md l me mf">forge create --rpc-url &lt;https://rpc.ankr.com/polygon_mumbai&gt; <br/>--private-key &lt;your_private_key&gt;  src/FDemo.sol:FDemo <br/>--etherscan-api-key &lt;your_etherscan_api_key&gt; <br/>--verify</span></pre><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff mg"><img src="../Images/715b1a59a9714116c147bdf52bce70d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bennTFz91RaZJgk5"/></div></div></figure><p id="103d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">完整代码:<a class="ae jo" href="https://github.com/Deep1144/foundry-demo-contract" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p><blockquote class="mm mn mo"><p id="efc6" class="iq ir mp is b it iu iv iw ix iy iz ja mq jc jd je mr jg jh ji ms jk jl jm jn hm dt translated">💡在Twitter上关注我，了解更多类似的精彩内容<a class="ae jo" href="https://twitter.com/transitive_bs" rel="noopener ugc nofollow" target="_blank">@</a><a class="ae jo" href="https://twitter.com/pateldeep_eth" rel="noopener ugc nofollow" target="_blank">Patel deep _ eth</a><br/>T5】Linkedin</p></blockquote><blockquote class="mt"><p id="0fa7" class="mu mv ht bd mw mx my mz na nb nc jn ek translated">交易新手？尝试<a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>