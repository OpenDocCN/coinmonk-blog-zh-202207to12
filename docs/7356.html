<html>
<head>
<title>Proof of Reserves for Bitcoin Holdings — How to Compute in BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">比特币持有量的储备证明——如何在BigQuery中计算</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/proof-of-reserves-for-bitcoin-holdings-how-to-compute-in-bigquery-6f6c5bc8648d?source=collection_archive---------24-----------------------#2022-12-12">https://medium.com/coinmonks/proof-of-reserves-for-bitcoin-holdings-how-to-compute-in-bigquery-6f6c5bc8648d?source=collection_archive---------24-----------------------#2022-12-12</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="8dc9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">FTX的垮台震惊了整个密码界。如果crypto坚持其核心原则——不要相信、核实并总是自行保管你的资产，这场灾难本来是可以避免的。</p><p id="670b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">随着FTX危机的蔓延，集中交易所正在寻求重建投资者信心。主要交易所已经分享了它们的热钱包和冷钱包地址的细节，作为它们对透明度和促进生态系统信任的承诺的一部分。</p><p id="7d96" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本文中，我们将使用Google BigQuery通过交易所披露的钱包地址来查询比特币余额。您可以参考此<a class="ae jo" href="https://trigolabs.io/btc-wallet-addresses/" rel="noopener ugc nofollow" target="_blank">列表</a>获取BTC钱包地址。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/25e8540103441b69fed2027c15317285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dDfpfegNR0G9ZEsjQBL7XQ.jpeg"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Proof of reserves on cryptocurrency exchanges</figcaption></figure><p id="a2a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了便于您参考，币安的BTC钱包地址如下所示:</p><ul class=""><li id="7194" class="kf kg ht is b it iu ix iy jb kh jf ki jj kj jn kk kl km kn dt translated"><a class="ae jo" href="https://explorer.btc.com/btc/search/34xp4vRoCGJym3xR7yCVPFHoCNxv4Twseo" rel="noopener ugc nofollow" target="_blank">34xp 4 vrocgjym 3 xr 7 ycvpfhocnxv 4 twseo</a></li><li id="6ea4" class="kf kg ht is b it ko ix kp jb kq jf kr jj ks jn kk kl km kn dt translated"><a class="ae jo" href="https://explorer.btc.com/btc/search/3LYJfcfHPXYJreMsASk2jkn69LWEYKzexb" rel="noopener ugc nofollow" target="_blank">3 lyjfcfpxyjremsask 2 jkn 69 lweykzexb</a></li><li id="88e5" class="kf kg ht is b it ko ix kp jb kq jf kr jj ks jn kk kl km kn dt translated"><a class="ae jo" href="https://explorer.btc.com/btc/search/3M219KR5vEneNb47ewrPfWyb5jQ2DjxRP6" rel="noopener ugc nofollow" target="_blank">3m 219 kr 5 venen b 47 ewrpfwyb 5 jq 2 djxrp 6</a></li><li id="8471" class="kf kg ht is b it ko ix kp jb kq jf kr jj ks jn kk kl km kn dt translated"><a class="ae jo" href="https://explorer.btc.com/btc/address/bc1qm34lsc65zpw79lxes69zkqmk6ee3ewf0j77s3h" rel="noopener ugc nofollow" target="_blank">BC 1 QM 34 LSC 65 zpw 79 lxes 69 zkqmk 6 ee 3 ewf 0j 77s 3h</a></li></ul><p id="2bd3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您不想运行查询，您可以在<a class="ae jo" href="https://trigolabs.io/bitcoin/" rel="noopener ugc nofollow" target="_blank">比特币仪表盘</a>上查看BTC余额。确保选择“选择类别”作为交换，并选择“交换”作为币安余额。</p><p id="c515" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">计算币安交易所BTC余额的完整查询如下所示。代码细节在<a class="ae jo" rel="noopener" href="/@vivbellavita/guide-to-query-wallet-balances-of-bitcoin-in-bigquery-a4b52ec2466a">使用BigQuery </a>查询比特币余额指南中讨论。</p><p id="5269" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">其中</strong>用于“double_entry_book_grouped”中，以尽早对数据进行分区，从而减少计算资源并提高性能。</p><ul class=""><li id="a31b" class="kf kg ht is b it iu ix iy jb kh jf ki jj kj jn kk kl km kn dt translated"><strong class="is hu">其中</strong> <strong class="is hu">包含_substr(`address `，` string`) </strong> —用于搜索BTC钱包地址</li></ul><pre class="jq jr js jt fq kt ku kv bn kw kx bi"><span id="46bf" class="ky kz ht ku b be la lb l lc ld">WITH double_entry_book AS (<br/>    -- debits<br/>    SELECT array_to_string(inputs.addresses, ",") AS address, -inputs.value AS value, <br/>    DATE(block_timestamp) AS date<br/>    FROM `bigquery-public-data.crypto_bitcoin.inputs` AS inputs<br/>    UNION ALL<br/>    -- credits<br/>    SELECT array_to_string(outputs.addresses, ",") AS address, outputs.value AS value, <br/>    DATE(block_timestamp) AS date<br/>    FROM `bigquery-public-data.crypto_bitcoin.outputs` AS outputs<br/>), <br/><br/>double_entry_book_grouped AS (<br/>    SELECT date, address, SUM(value / POWER(10,8)) AS value<br/>    FROM double_entry_book<br/><br/>    -- Binance<br/>    WHERE contains_substr(`address`, '34xp4vRoCGJym3xR7yCVPFHoCNxv4Twseo') OR<br/>    -- Binance 2<br/>    contains_substr(`address`, '3LYJfcfHPXYJreMsASk2jkn69LWEYKzexb') OR<br/>    -- Binance 3<br/>    contains_substr(`address`, '3M219KR5vEneNb47ewrPfWyb5jQ2DjxRP6') OR<br/>    -- Binance 4<br/>    contains_substr(`address`, 'bc1qm34lsc65zpw79lxes69zkqmk6ee3ewf0j77s3h')<br/>    <br/>    GROUP BY date, address<br/>),<br/><br/>daily_balances_gappy AS (<br/>    SELECT date, address,<br/>    SUM(value) OVER (PARTITION BY address ORDER BY date) AS balance,<br/>    LEAD(date, 1, CURRENT_DATE()) OVER (PARTITION BY address ORDER BY date) AS next_date<br/>    FROM double_entry_book_grouped<br/>),<br/><br/>all_dates AS (<br/>    SELECT date FROM UNNEST(GENERATE_DATE_ARRAY('2009-01-01', CURRENT_DATE())) AS date<br/>),<br/><br/>daily_balances_gapless AS (<br/>    SELECT address, all_dates.date, balance<br/>    FROM daily_balances_gappy<br/>    JOIN all_dates ON daily_balances_gappy.date &lt;= all_dates.date AND all_dates.date &lt; daily_balances_gappy.next_date<br/>),<br/><br/>all_daily_balances AS (<br/>    SELECT DISTINCT date, SUM(balance) OVER(PARTITION BY date) AS balance<br/>    FROM daily_balances_gapless<br/>)<br/><br/>SELECT * FROM all_daily_balances<br/>ORDER BY date</span></pre><h1 id="cc01" class="le kz ht bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma dt translated">结论</h1><p id="280e" class="pw-post-body-paragraph iq ir ht is b it mb iv iw ix mc iz ja jb md jd je jf me jh ji jj mf jl jm jn hm dt translated">您可以通过将<strong class="is hu">中的字符串替换为其各自的钱包地址来尝试将此代码用于其他交换，其中包含_substr(`address `，` string`) </strong>。此处提供了各大交易所的BTC钱包地址<a class="ae jo" href="https://trigolabs.io/btc-wallet-addresses/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="3075" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意安全。记住“不是你的钥匙，不是你的硬币”。</p><p id="045c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">另请参阅:</p><ul class=""><li id="6cf1" class="kf kg ht is b it iu ix iy jb kh jf ki jj kj jn kk kl km kn dt translated"><a class="ae jo" rel="noopener" href="/dev-genius/an-easy-way-to-access-bitcoin-block-data-using-bigquery-2f5d9be6ae63">使用BigQuery访问比特币块数据的简单方法</a></li><li id="f321" class="kf kg ht is b it ko ix kp jb kq jf kr jj ks jn kk kl km kn dt translated">在BigQuery中计算平均、中间和总比特币交易费用</li><li id="2084" class="kf kg ht is b it ko ix kp jb kq jf kr jj ks jn kk kl km kn dt translated">比特币:使用BigQuery监控矿工收入</li></ul></div><div class="ab cl mg mh hb mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hm hn ho hp hq"><p id="4511" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> <em class="mn">感谢阅读！</em> </strong></p><p id="88d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您喜欢这篇文章并想了解更多，请考虑关注我。我定期发布与链上分析、机器学习和BigQuery相关的主题。我尽量让我的文章简单而精确，尽可能提供代码、例子和模拟。</p></div></div>    
</body>
</html>