<html>
<head>
<title>Ethernaut Level 4 Telephone [Foundry-Hardhat]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太四级电话[铸造厂-安全帽]</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethernaut-level-4-telephone-foundry-hardhat-599aff68a9b4?source=collection_archive---------21-----------------------#2022-12-14">https://medium.com/coinmonks/ethernaut-level-4-telephone-foundry-hardhat-599aff68a9b4?source=collection_archive---------21-----------------------#2022-12-14</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/084a3a4589d2f7e86fd1632e80dfac94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*__ZDL5XYN6kJRu_SGC_1Eg.png"/></div></div></figure><blockquote class="jb"><p id="5e84" class="jc jd ht bd je jf jg jh ji jj jk jl ek translated"><a class="ae jm" href="https://github.com/Chirag21/Ethernaut-solutions" rel="noopener ugc nofollow" target="_blank"> Ethernaut-Solutions </a>库包含使用Foundry和Hardhat的解决方案。</p></blockquote><p id="f83f" class="pw-post-body-paragraph jn jo ht jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj jl hm dt translated">这个关卡教你<code class="eh kk kl km kn b">tx.origin</code>和<code class="eh kk kl km kn b">msg.sender</code>的区别。<code class="eh kk kl km kn b">tx.origin</code>和<code class="eh kk kl km kn b">msg.sender</code>都是全局可用的变量。</p><blockquote class="jb"><p id="b368" class="jc jd ht bd je jf ko kp kq kr ks jl ek translated">交易新手？在<a class="ae jm" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易</a>上尝试<a class="ae jm" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae jm" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote><h1 id="831e" class="kt ku ht bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">目标</h1><ul class=""><li id="49da" class="lr ls ht jp b jq lt ju lu jy lv kc lw kg lx jl ly lz ma mb dt translated">成为合同的所有者</li></ul><p id="bba0" class="pw-post-body-paragraph jn jo ht jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj jl hm dt translated"><code class="eh kk kl km kn b">tx.origin:</code></p><ul class=""><li id="0a48" class="lr ls ht jp b jq mc ju md jy mh kc mi kg mj jl ly lz ma mb dt translated"><a class="ae jm" href="https://ethereum.org/en/developers/docs/accounts/" rel="noopener ugc nofollow" target="_blank"> EOA </a>(外部拥有的账户)或发起交易的用户的钱包地址</li><li id="1540" class="lr ls ht jp b jq mk ju ml jy mm kc mn kg mo jl ly lz ma mb dt translated">变量<code class="eh kk kl km kn b">tx.origin</code>将始终指向外部账户</li><li id="a7a5" class="lr ls ht jp b jq mk ju ml jy mm kc mn kg mo jl ly lz ma mb dt translated">合同地址不能是<code class="eh kk kl km kn b"> tx.origin</code>,因为合同不能启动交易</li></ul><p id="c8c9" class="pw-post-body-paragraph jn jo ht jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj jl hm dt translated"><code class="eh kk kl km kn b">msg.sender:</code></p><ul class=""><li id="c3e9" class="lr ls ht jp b jq mc ju md jy mh kc mi kg mj jl ly lz ma mb dt translated">调用该函数的直接帐户</li><li id="d398" class="lr ls ht jp b jq mk ju ml jy mm kc mn kg mo jl ly lz ma mb dt translated"><code class="eh kk kl km kn b">msg.sender</code>可以是合同或外部账户</li></ul><p id="f8c4" class="pw-post-body-paragraph jn jo ht jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj jl hm dt translated">考虑以下场景，</p><figure class="mq mr ms mt fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mp"><img src="../Images/70a745ccb89d8afbba4b9368b87357bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sE9KxhCMER0og2ttW-_qQw.png"/></div></div></figure><ul class=""><li id="d4d1" class="lr ls ht jp b jq mc ju md jy mh kc mi kg mj jl ly lz ma mb dt translated">在场景1中，<code class="eh kk kl km kn b">tx.origin</code>和<code class="eh kk kl km kn b">msg.sender</code>相同</li><li id="b13b" class="lr ls ht jp b jq mk ju ml jy mm kc mn kg mo jl ly lz ma mb dt translated">在场景2中，<code class="eh kk kl km kn b">tx.origin</code>保持不变，而<code class="eh kk kl km kn b">msg.sender </code>改变为中间契约的地址。</li></ul></div><div class="ab cl mu mv hb mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="hm hn ho hp hq"><h1 id="a1ae" class="kt ku ht bd kv kw nb ky kz la nc lc ld le nd lg lh li ne lk ll lm nf lo lp lq dt translated">分析</h1><p id="14a3" class="pw-post-body-paragraph jn jo ht jp b jq lt js jt ju lu jw jx jy ng ka kb kc nh ke kf kg ni ki kj jl hm dt translated">注意<code class="eh kk kl km kn b">Telephone</code>契约的<code class="eh kk kl km kn b">changeOwner()</code>函数是<code class="eh kk kl km kn b">public</code>，可以被任何人调用。</p><pre class="mq mr ms mt fq nj kn nk bn nl nm bi"><span id="aa3f" class="nn ku ht kn b be no np l nq nr">  function changeOwner(address _owner) public {<br/>    if (tx.origin != msg.sender) {<br/>      owner = _owner;<br/>    }<br/>  }</span></pre><p id="5139" class="pw-post-body-paragraph jn jo ht jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj jl hm dt translated">它检查<code class="eh kk kl km kn b">tx.origin != msg.sender</code>是否。因此，为了利用这个函数，我们需要确保<code class="eh kk kl km kn b">tx.origin</code>不等于<code class="eh kk kl km kn b">msg.sender</code>。我们可以通过创建一个调用该函数的中介契约来实现这一点。我们可以使用场景2来利用这种情况，如图所示。</p></div><div class="ab cl mu mv hb mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="hm hn ho hp hq"><h1 id="a1e7" class="kt ku ht bd kv kw nb ky kz la nc lc ld le nd lg lh li ne lk ll lm nf lo lp lq dt translated">剥削</h1><p id="ea52" class="pw-post-body-paragraph jn jo ht jp b jq lt js jt ju lu jw jx jy ng ka kb kc nh ke kf kg ni ki kj jl hm dt translated">让我们创建一个契约来破解关卡。</p><p id="bef8" class="pw-post-body-paragraph jn jo ht jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj jl hm dt translated">转到<a class="ae jm" href="https://remix.ethereum.org/#optimize=false&amp;runs=200&amp;evmVersion=null&amp;version=soljson-v0.8.17+commit.8df45f5f.js" rel="noopener ugc nofollow" target="_blank"> Remix IDE </a>并创建以下合同。</p><figure class="mq mr ms mt fq iu"><div class="bz el l di"><div class="ns nt l"/></div></figure><p id="3f16" class="pw-post-body-paragraph jn jo ht jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj jl hm dt translated">在部署协定时，将实例地址传递给构造函数。您可以通过在dev控制台中键入<code class="eh kk kl km kn b">instance</code>来获得实例地址。上述合同的<code class="eh kk kl km kn b">changeOwner</code>功能调用<code class="eh kk kl km kn b">Telephone</code>合同的<code class="eh kk kl km kn b">changeOwner</code>。</p><p id="d4bd" class="pw-post-body-paragraph jn jo ht jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj jl hm dt translated">在此交易中，<code class="eh kk kl km kn b">tx.origin</code>是您的钱包地址，而<code class="eh kk kl km kn b">msg.sender</code>是<code class="eh kk kl km kn b">TelephoneHack</code>合同的<code class="eh kk kl km kn b">address</code>。这将通过<code class="eh kk kl km kn b">tx.origin != msg.sender</code>检查，并将您的地址设置为<code class="eh kk kl km kn b">owner</code>。</p><p id="a04a" class="pw-post-body-paragraph jn jo ht jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj jl hm dt translated">在Ehternaut站点的开发控制台中，通过键入以下命令来检查所有者，</p><pre class="mq mr ms mt fq nj kn nk bn nl nm bi"><span id="3198" class="nn ku ht kn b be no np l nq nr">await contract.owner()</span></pre><p id="a6c9" class="pw-post-body-paragraph jn jo ht jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj jl hm dt translated">提交实例。</p><p id="bc66" class="pw-post-body-paragraph jn jo ht jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj jl hm dt translated">关卡通过！！！😄</p></div><div class="ab cl mu mv hb mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="hm hn ho hp hq"><h1 id="a15f" class="kt ku ht bd kv kw nb ky kz la nc lc ld le nd lg lh li ne lk ll lm nf lo lp lq dt translated">关键要点</h1><ul class=""><li id="c414" class="lr ls ht jp b jq lt ju lu jy lv kc lw kg lx jl ly lz ma mb dt translated">切勿使用<code class="eh kk kl km kn b">tx.origin</code>进行授权检查</li><li id="8918" class="lr ls ht jp b jq mk ju ml jy mm kc mn kg mo jl ly lz ma mb dt translated">使用<code class="eh kk kl km kn b">msg.sender</code>对即时发送者进行授权</li><li id="ed17" class="lr ls ht jp b jq mk ju ml jy mm kc mn kg mo jl ly lz ma mb dt translated">使用<code class="eh kk kl km kn b">(tx.origin == msg.sender)</code>如果你想只有EOA可以调用你的合同。</li></ul><blockquote class="jb"><p id="4f1f" class="jc jd ht bd je jf jg jh ji jj jk jl ek translated"><em class="nu"/><a class="ae jm" href="https://medium.com/r?url=https%3A%2F%2Fgithub.com%2FChirag21%2FEthernaut-solutions" rel="noopener"><em class="nu">以太解决方案</em> </a> <em class="nu">库包含使用Foundry和Hardhat的解决方案。</em></p><p id="1e69" class="jc jd ht bd je jf ko kp kq kr ks jl ek translated"><em class="nu">解决使用铸造厂:- </em></p><p id="787d" class="jc jd ht bd je jf ko kp kq kr ks jl ek translated"><a class="ae jm" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/test/foundry/4_Telephone.t.sol" rel="noopener ugc nofollow" target="_blank">测试</a>，<a class="ae jm" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/script/4_TelephoneScript.sol" rel="noopener ugc nofollow" target="_blank">漏洞利用脚本</a></p><p id="f791" class="jc jd ht bd je jf ko kp kq kr ks jl ek translated"><em class="nu">使用安全帽的解决方案:- </em></p><p id="95bf" class="jc jd ht bd je jf ko kp kq kr ks jl ek translated"><a class="ae jm" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/test/hardhat/4_Telephone.test.ts" rel="noopener ugc nofollow" target="_blank">测试</a>，<a class="ae jm" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/scripts/4_telephone_exploit.ts" rel="noopener ugc nofollow" target="_blank">漏洞利用脚本</a></p></blockquote><figure class="nw nx ny nz oa iu fe ff paragraph-image"><a href="https://www.buymeacoffee.com/0xcsp"><div class="fe ff nv"><img src="../Images/679392ad412abc67dd16f3b9fefa799d.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*769MixcK_s6-z4fwRrIpMQ.png"/></div></a></figure><h1 id="af31" class="kt ku ht bd kv kw kx ky kz la lb lc ld le ob lg lh li oc lk ll lm od lo lp lq dt translated">更多级别</h1><div class="oe of fm fo og oh"><a rel="noopener follow" target="_blank" href="/coinmonks/ethernaut-level-5-token-foundry-hardhat-d9d52e5ce39a"><div class="oi ab ej"><div class="oj ab ok cl cj ol"><h2 class="bd hu fv z el om eo ep on er et hs dt translated">以太5级令牌[铸造厂-安全帽]</h2><div class="oo l"><h3 class="bd b fv z el om eo ep on er et ek translated">Ethernaut-Solutions存储库包含使用Foundry和Hardhat的解决方案。</h3></div><div class="op l"><p class="bd b gc z el om eo ep on er et ek translated">medium.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov iz oh"/></div></div></a></div><div class="oe of fm fo og oh"><a href="https://coinsbench.com/ethernaut-level-3-coin-flip-foundry-hardhat-7387686fec3d" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab ej"><div class="oj ab ok cl cj ol"><h2 class="bd hu fv z el om eo ep on er et hs dt translated">以太3级——掷硬币[铸造-安全帽]</h2><div class="oo l"><h3 class="bd b fv z el om eo ep on er et ek translated">Ethernaut-Solutions存储库包含使用Foundry和Hardhat的解决方案。</h3></div><div class="op l"><p class="bd b gc z el om eo ep on er et ek translated">coinsbench.com</p></div></div><div class="oq l"><div class="ow l os ot ou oq ov iz oh"/></div></div></a></div><blockquote class="jb"><p id="1cf7" class="jc jd ht bd je jf jg jh ji jj jk jl ek translated">加入Coinmonks <a class="ae jm" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jm" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="abb2" class="kt ku ht bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">另外，阅读</h1><ul class=""><li id="fae9" class="lr ls ht jp b jq lt ju lu jy lv kc lw kg lx jl ly lz ma mb dt translated"><a class="ae jm" href="https://coincodecap.com/huobi-crypto-trading-signals" rel="noopener ugc nofollow" target="_blank">火币的加密交易信号</a> | <a class="ae jm" rel="noopener" href="/coinmonks/hitbtc-review-c5143c5d53c2"> HitBTC审核</a></li><li id="3d62" class="lr ls ht jp b jq mk ju ml jy mm kc mn kg mo jl ly lz ma mb dt translated"><a class="ae jm" href="https://coincodecap.com/traderwagon-review" rel="noopener ugc nofollow" target="_blank"> TraderWagon回顾</a> | <a class="ae jm" href="https://coincodecap.com/kraken-vs-gemini-vs-bityard" rel="noopener ugc nofollow" target="_blank">北海巨妖vs双子星vs BitYard </a></li><li id="3adc" class="lr ls ht jp b jq mk ju ml jy mm kc mn kg mo jl ly lz ma mb dt translated"><a class="ae jm" href="https://coincodecap.com/ftx-futures-trading" rel="noopener ugc nofollow" target="_blank">如何在FTX交易所交易期货</a></li><li id="17bc" class="lr ls ht jp b jq mk ju ml jy mm kc mn kg mo jl ly lz ma mb dt translated"><a class="ae jm" href="https://coincodecap.com/okex-kucoin" rel="noopener ugc nofollow" target="_blank"> OKEx vs KuCoin </a> | <a class="ae jm" href="https://coincodecap.com/celsius-alternatives" rel="noopener ugc nofollow" target="_blank">摄氏替代品</a> | <a class="ae jm" href="https://coincodecap.com/buy-vechain" rel="noopener ugc nofollow" target="_blank">如何购买VeChain </a></li><li id="5a41" class="lr ls ht jp b jq mk ju ml jy mm kc mn kg mo jl ly lz ma mb dt translated"><a class="ae jm" href="https://coincodecap.com/profitfarmers-review" rel="noopener ugc nofollow" target="_blank"> ProfitFarmers点评</a> | <a class="ae jm" href="https://coincodecap.com/cornix-trading-bot" rel="noopener ugc nofollow" target="_blank">如何使用Cornix Trading Bot </a></li></ul></div></div>    
</body>
</html>