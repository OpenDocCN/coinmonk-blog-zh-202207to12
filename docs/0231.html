<html>
<head>
<title>NFT Minter Dapp on CSC -Part2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NFT敏特Dapp对CSC-第2部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/nft-minter-dapp-on-csc-part2-694d71d6c470?source=collection_archive---------63-----------------------#2022-07-04">https://medium.com/coinmonks/nft-minter-dapp-on-csc-part2-694d71d6c470?source=collection_archive---------63-----------------------#2022-07-04</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="151c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">嘿嘿嘿！</p><p id="5323" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">0Xlive在这里</p><p id="39d2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你有没有试过不用React ro Vue做单页nft minter dapp？</p><p id="1371" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们想创建一个使用纯JS的nft minter，可以很容易地部署在任何地方(甚至是博客)。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/e5b1b7a4e886a92ae2e118fd5a4c681d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R9HRpepp5OrNbCkXY4xJgQ.jpeg"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">Artwork by 0Xlive</figcaption></figure><h2 id="ffa6" class="ke kf ht bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky dt translated">描述</h2><p id="70c5" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">我们想创建一个铸造页面，每个用户都可以铸造自己的国王作为头像。我们需要web3.js与区块链互动，Metamask钱包。</p><p id="0aa0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们开始吧！</p><h2 id="aea1" class="ke kf ht bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky dt translated">Index.html</h2><p id="2678" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">我们希望在单页中创建nft minter dapp。我们的dapp应该有一个文本框来获取金额，连接钱包和薄荷按钮。创建一个index.html文件，把这个代码放在里面:</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="cd51" class="ke kf ht lf b fv lj lk l ll lm">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="UTF-8" /&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;<br/>    &lt;title&gt;Web3 Minting Demo&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;button onclick="connectMetamask()"&gt;Connect To Metamask&lt;/button&gt;<br/>    &lt;br /&gt;<br/><br/>    &lt;label for="to_mint"&gt;number of nfts to mint (1-10):&lt;/label&gt;<br/>    &lt;input<br/>      id="to_mint"<br/>      type="number"<br/>      name="to_mint"<br/>      value="1"<br/>      min="1"<br/>      max="10"<br/>      required<br/>    /&gt;<br/>    &lt;br /&gt;<br/>    &lt;button onclick="mint()"&gt;Mint&lt;/button&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><h2 id="19bf" class="ke kf ht bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky dt translated">Web3.js</h2><p id="fd4d" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">我们希望在浏览器中使用web3.js，因此我们应该在Head块中导入归档文件:</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="a180" class="ke kf ht lf b fv lj lk l ll lm">&lt;script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"&gt;&lt;/script&gt;</span></pre><p id="a3f0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">它会将web3.js导入到browser.jsdeliver的cdn是更好的选择。</p><h2 id="9af7" class="ke kf ht bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky dt translated">明特</h2><p id="36c0" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">web.js帮助我们与区块链交互。首先，我们需要设置合同地址:</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="0c8e" class="ke kf ht lf b fv lj lk l ll lm">const mainnetContract = "CONTRACT ADDRESS";</span></pre><p id="0c03" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但这还不够！</p><p id="923d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要使用合同，我们需要合同ABI。</p><blockquote class="ln lo lp"><p id="3663" class="iq ir lq is b it iu iv iw ix iy iz ja lr jc jd je ls jg jh ji lt jk jl jm jn hm dt translated">交易新手？试试<a class="ae lu" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae lu" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote><h2 id="ba44" class="ke kf ht bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky dt translated">ABI</h2><p id="c297" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">在<a class="ae lu" href="https://en.wikipedia.org/wiki/Computer_software" rel="noopener ugc nofollow" target="_blank">计算机软件</a>中，<strong class="is hu">应用二进制接口</strong> ( <strong class="is hu"> ABI </strong>)是两个二进制程序模块之间的<a class="ae lu" href="https://en.wikipedia.org/wiki/Interface_(computing)" rel="noopener ugc nofollow" target="_blank">接口</a>。通常，这些模块中的一个是<a class="ae lu" href="https://en.wikipedia.org/wiki/Library_(computing)" rel="noopener ugc nofollow" target="_blank">库</a>或<a class="ae lu" href="https://en.wikipedia.org/wiki/Operating_system" rel="noopener ugc nofollow" target="_blank">操作系统</a>工具，另一个是用户正在运行的程序。</p><p id="6373" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一个<em class="lq"> ABI </em>定义了如何在<a class="ae lu" href="https://en.wikipedia.org/wiki/Machine_code" rel="noopener ugc nofollow" target="_blank">机器码</a>中访问数据结构或计算例程，这是一种低级的、硬件相关的格式。相比之下，<a class="ae lu" href="https://en.wikipedia.org/wiki/Application_programming_interface" rel="noopener ugc nofollow" target="_blank"> <em class="lq"> API </em> </a>在<a class="ae lu" href="https://en.wikipedia.org/wiki/Source_code" rel="noopener ugc nofollow" target="_blank">源代码</a>中定义了这种访问，这是一种相对高级的、独立于硬件的、通常<a class="ae lu" href="https://en.wikipedia.org/wiki/Human-readable" rel="noopener ugc nofollow" target="_blank">人类可读的</a>格式。ABI的一个常见方面是<a class="ae lu" href="https://en.wikipedia.org/wiki/Calling_convention" rel="noopener ugc nofollow" target="_blank">调用约定</a>，它决定了如何将数据作为输入提供给计算例程，或者从计算例程中读取数据作为输出。这方面的例子有<a class="ae lu" href="https://en.wikipedia.org/wiki/X86_calling_conventions" rel="noopener ugc nofollow" target="_blank"> x86调用约定</a>。</p><p id="eceb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">遵守ABI(可能是也可能不是官方标准化的)通常是编译器、操作系统或库作者的工作。然而，当用混合编程语言编写程序，或者甚至用不同的编译器编译用同一种语言编写的程序时，应用程序员可能不得不直接处理ABI。(wikipedia.org)</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="4bb8" class="ke kf ht lf b fv lj lk l ll lm">const mainnetAbi = [PASTE CONTRACT ABI HERE!];</span></pre><p id="14b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们设定了每吨的价格</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="6f67" class="ke kf ht lf b fv lj lk l ll lm">const cost = "60000000000000000"; //this is in Wei</span></pre><p id="fa4e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要使用私钥签署交易，我们必须从元掩码请求访问wallet</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="ab95" class="ke kf ht lf b fv lj lk l ll lm">var Web3;<br/>var window;<br/><br/>async function getAccounts() {<br/>  try {<br/>    let acc = await window.ethereum.request({<br/>      method: "eth_requestAccounts",<br/>    });<br/><br/>    return acc;<br/>  } catch (e) {<br/>    return [];<br/>  }<br/>}<br/><br/>async function connectMetamask() {<br/>  if (window.ethereum) {<br/>    try {<br/>      const result = await this.getAccounts();<br/>      if (Array.isArray(result) &amp;&amp; result.length &gt; 0) {<br/>        let acc = result[0];<br/>        return acc;<br/>      } else {<br/>        return false;<br/>      }<br/>    } catch (err) {<br/>      return false;<br/>    }<br/>  } else {<br/>    return false;<br/>  }<br/>}</span></pre><p id="840c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在是实现Mint()函数的时候了</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="1ac4" class="ke kf ht lf b fv lj lk l ll lm">async function mint() {<br/>  let totalToMint = document.getElementById("to_mint").value;<br/>  var web3 = new Web3(Web3.givenProvider);<br/>  window.contract = await new web3.eth.Contract(mainnetAbi, mainnetContract);<br/>  const transactionParameters = {<br/>    to: mainnetContract,<br/>    from: (await this.getAccounts())[0],<br/>    value: bigInt(cost).multiply(bigInt(totalToMint.toString())).toString(16),<br/>    data: window.contract.methods.mintCraniums(totalToMint).encodeABI(),<br/>  };<br/>  try {<br/>    await window.ethereum.request({<br/>      method: "eth_sendTransaction",<br/>      params: [transactionParameters],<br/>    });<br/>  } catch (error) {<br/>    console.log(error);<br/>  }<br/>}</span></pre><p id="fe55" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在上面的代码中，它将从to_mint元素中获取金额，并使用合同地址和合同abi与合同进行交互。最后使用eth_sendTransaction方法签署事务。</p><p id="8633" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">恭喜你！</p><p id="e908" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们已经使用web3.js、metamask和pure js创建了一个单页面nft minter dapp</p></div></div>    
</body>
</html>