# æ„å¼å†°æ·‡æ·‹Â·V2 &è¶…æµä½“

> åŸæ–‡ï¼š<https://medium.com/coinmonks/gelato-v2-superfluid-eb13166ac414?source=collection_archive---------5----------------------->

åˆ° 2023 å¹´ï¼Œè®©æ‚¨çš„æµè‡ªåŠ¨åŒ–å˜å¾—æ›´åŠ å®¹æ˜“ï¼ï¼

![](img/aeb1c28c5000b10062d7c3f109ebeb62.png)

Gelato Automate

æ„å¼å†°æ·‡æ·‹ç½‘ç»œåœ¨è¿‡å»å‡ ä¸ªæœˆå‘å¸ƒäº†æ–°ç‰ˆæœ¬ã€‚åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°å˜åŒ–ï¼Œå¹¶å‡†å¤‡å¥½è‡ªåŠ¨åŒ–æ‚¨çš„æµã€‚

æ–°çš„**æ„å¼å†°æ·‡æ·‹ç‰ˆæœ¬ V2 éµå¾ªæ¨¡å—åŒ–çš„æ–¹æ³•ï¼Œå…è®¸æ›´å¤šçš„çµæ´»æ€§ã€‚**

æˆ‘ä»¬å°†ä»è¶…æµ [#dev-support](https://discord.com/channels/752490247643725875/752493348169711696) discord é¢‘é“ä¸­æœ€å¸¸è§çš„é—®é¢˜ä¹‹ä¸€å¼€å§‹:â€œå¦‚ä½•å®‰æ’åœæ­¢ä¸€ä¸ªæµï¼Ÿâ€ï¼Œå°½ç®¡è¯¥åŠŸèƒ½æ˜¯åœ¨ Superfluid dashboard ä¸­å®ç°çš„ï¼Œä½†äº†è§£å¦‚ä½•ä»¥ç¼–ç¨‹æ–¹å¼å®ç°å®ƒæ˜¯å€¼å¾—çš„ã€‚

åœ¨è¿™é‡Œä½ å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ¼”ç»ƒè§†é¢‘ã€‚

ç”±äºæˆ‘ä»¬è¦å››å¤„è½¬è½¬ï¼Œæ‰€ä»¥è®©æˆ‘ä»‹ç»/æ›´æ–°ä¸€ä¸‹è®©æ„å¼å†°æ·‡æ·‹å¯åŠ¨å¹¶è¿è¡Œçš„ 3x3 æ­¥éª¤:

1.  **æœ‰çº¿æ„å¼å†°æ·‡æ·‹åŸºç¡€è®¾æ–½**:æˆ‘ä»¬çš„åˆåŒæ›´æ–°ï¼Œå…è®¸ä¸æ„å¼å†°æ·‡æ·‹çš„é€šä¿¡è‡ªåŠ¨åŒ–
2.  **èèµ„ç­–ç•¥:**æœ‰ä¸¤ç§å¯ä¾›é€‰æ‹©çš„äº¤æ˜“æ”¯ä»˜æ–¹å¼ï¼›ä»æ„å¼å†°æ·‡æ·‹å¹³è¡¡æˆ–æ¯ç¬”äº¤æ˜“æ”¯ä»˜æœ¬èº«ã€‚æˆ‘ä»¬é€‰æ‹©æ¯ç¬”äº¤æ˜“éƒ½è¦è‡ªå·±ä¹°å•ã€‚æˆ‘ä»¬å¿…é¡»åˆ«å¿˜äº†ä¸ºåˆåŒæä¾›èµ„é‡‘ã€‚æ›´å¤šå…³äºä»˜æ¬¾çš„ä¿¡æ¯å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ã€‚
3.  **æ„å¼å†°æ·‡æ·‹è‡ªå®šä¹‰é€»è¾‘:**åŒ…æ‹¬ä»»åŠ¡åˆ›å»ºã€æ£€æŸ¥å™¨æ¡ä»¶ã€å¾…æ‰§è¡Œä»»åŠ¡ã€‚
    -ä»»åŠ¡åˆ›å»ºå¯ä»¥ä»åˆåŒ/SDK æˆ–é€šè¿‡æ„å¼å†°æ·‡æ·‹è‡ªåŠ¨åŒ– UI åŠ¨æ€å®Œæˆ
    -åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ£€æŸ¥æ¡ä»¶å¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€æ£€æŸ¥å…³é—­æµçš„æ—¶é—´ã€‚
    -å¯æ‰§è¡Œå‡½æ•°ä¹Ÿå¾ˆç®€å•ï¼Œå°±å¥½åƒæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªæµï¼Œæˆ‘ä»¬çŸ¥é“å¦‚ä½•å…³é—­å®ƒã€‚æˆ‘ä»¬åº”è¯¥è®°ä½ï¼Œæ‰§è¡Œå…³é—­åŠŸèƒ½çš„ EOA/å¥‘çº¦å¿…é¡»å¾—åˆ°æµæ‰€æœ‰è€…çš„æˆæƒæ‰èƒ½å…³é—­æµ

# äº²è‡ªåŠ¨æ‰‹

å›è´­ç¤ºä¾‹å¯åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°:

[](https://github.com/donoso-eth/superfluid-gelato-automation) [## GitHub-donoso-eth/è¶…æµä½“-å‡èƒ¶-è‡ªåŠ¨åŒ–

### ä¸€ä¸ªè¶…çº§ç®€å•çš„é“¸é€ /å®‰å…¨å¸½æ··åˆé¡¹ç›®ï¼Œåˆ©ç”¨è¶…æµä½“çš„ CFA è®¿é—®æ§åˆ¶åˆ—è¡¨åŠŸèƒ½å’Œæ„å¼å†°æ·‡æ·‹â€¦

github.com](https://github.com/donoso-eth/superfluid-gelato-automation) 

å¯¹äºå¦‚ä½•å¼€å§‹ä¸€ä¸ªæµï¼Œæˆ‘ä»¬æœ‰ä¸åŒçš„é€‰æ‹©:ä½¿ç”¨ superfluid dashboardã€SDK æˆ–åˆåŒä¸­çš„ cfaLibraryã€‚

è®©æˆ‘ä»¬è€ƒè™‘å¦‚ä½•å…³é—­æµï¼Œæˆ‘ä»¬å¿…é¡»è®°ä½ï¼Œæ„å¼å†°æ·‡æ·‹æ“ä½œåˆåŒå°†è°ƒç”¨å¯æ‰§è¡Œå‡½æ•°ï¼Œæ„å¼å†°æ·‡æ·‹æ“ä½œåˆåŒå°†è°ƒç”¨å¯æ‰§è¡Œå‡½æ•°ï¼Œåœ¨è¶…æµä¸­ï¼Œåªæœ‰æµçš„å‘é€è€…æˆ–æ¥æ”¶è€…å¯ä»¥å…³é—­/åœæ­¢æµã€‚

åœ¨[è¶…æµ ACL(è®¿é—®æ§åˆ¶åˆ—è¡¨](https://docs.superfluid.finance/superfluid/developers/constant-flow-agreement-cfa/cfa-access-control-list-acl) t)çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æˆæƒä¸€ä¸ªæ™ºèƒ½åˆçº¦æ¥åœæ­¢æµã€‚è¿™å°†ä½¿æˆ‘ä»¬çš„ç”Ÿæ´»æ›´å®¹æ˜“ï¼Œå› ä¸ºä»åˆåŒä¸­æˆ‘ä»¬å¯ä»¥

## æ„å¼å†°æ·‡æ·‹

å¦‚æœæˆ‘ä»¬éµå¾ªä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬å¿…é¡»:

1.  æœ‰çº¿æ„å¼å†°æ·‡æ·‹åŸºç¡€è®¾æ–½:
    æˆ‘ä»¬å°†æŠŠ Gelato æ–‡ä»¶å¤¹å¤åˆ¶åˆ°æˆ‘ä»¬çš„åˆåŒæ–‡ä»¶å¤¹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ–‡ä»¶ã€‚æ–‡ä»¶å¤¹ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤º

![](img/e1d53a536b0c06a4b5475ad16b470530.png)

Gelato Helper Contracts

ç»§æ‰¿ OpsReady åˆåŒ

```
contract CloseStream is OpsReady {

    constructor( address _ops ) 
     OpsReady(_ops, address(this)){

    }
```

2.èèµ„ç­–ç•¥ï¼Œæˆ‘ä»¬å°†ä¸ºæ¯ç¬”äº¤æ˜“æ”¯ä»˜çš„ç›®æ ‡åˆåŒã€‚æˆ‘ä»¬å¿…é¡»ä¸ºæˆ‘ä»¬çš„åˆåŒæä¾›èµ„é‡‘ï¼Œå¹¶ç¡®ä¿è´¹ç”¨é€šè¿‡æ‰§è¡Œè½¬ç§»åˆ°æ„å¼å†°æ·‡æ·‹

3.æ„å¼å†°æ·‡æ·‹è‡ªå®šä¹‰é€»è¾‘
æˆ‘ä»¬å°†ä»å¥‘çº¦ä¸­åŠ¨æ€åˆ›å»ºä»»åŠ¡ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å°†ç”¨æ¥åˆ›å»ºä»»åŠ¡çš„ä»£ç ã€‚

```
 taskId = ops.createTask(execAddress, execData, moduleData, ETH);
```

æ‰§è¡Œä»»åŠ¡çš„åˆåŒåœ°å€

`exexData()`ä»»åŠ¡å°†è¦æ‰§è¡Œçš„ä»£ç 

```
 bytes memory execData = 
abi.encodeWithSelector(this.closeStream.selector, sender,receiver);
// closeStream is the executable function
```

`moduleData`å°±æ˜¯æˆ‘ä»¬å¦‚ä½•é…ç½®æˆ‘ä»¬çš„ä»»åŠ¡ã€‚æœ‰å››ä¸ªé…ç½®æ¨¡å—:
- **è§£æå™¨**:å½“æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰é€»è¾‘æ¥æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¿…é¡»æ‰§è¡Œæ—¶ã€‚
- **æ—¶é—´**:å½“æ‰§è¡Œå°†åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹å‘ç”Ÿ
- **ä»£ç†**:å½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸“ç”¨çš„æ¶ˆæ¯å‘é€è€…
- **Single_exec** :å½“æˆ‘ä»¬åªéœ€è¦ä¸€æ¬¡æ‰§è¡Œ

`ETH`æ”¯ä»˜äº¤æ˜“çš„ä»£å¸

åœ¨æˆ‘ä»¬çš„ç”¨ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†è®¾ç½® **TimeModule å’Œ SingleExec** æ¨¡å—ï¼Œç¡®ä¿å¯æ‰§è¡Œå‡½æ•°åœ¨è¦æ±‚çš„æ—¶é—´æˆ³è¿è¡Œï¼Œå¹¶ä¸”åªè¿è¡Œä¸€æ¬¡(æˆ‘ä»¬åªå…³é—­æµä¸€æ¬¡)ã€‚æˆ‘ä»¬åƒè¿™æ ·æ„å»ºæˆ‘ä»¬çš„æ¨¡å—æ•°æ®:

```
 bytes memory timeArgs = 
    abi.encode(uint128(block.timestamp + duration), duration);

    Module[] memory modules = new Module[](2);

    modules[0] = Module.TIME;
    modules[1] = Module.SINGLE_EXEC;

    bytes[] memory args = new bytes[](1);

    args[0] = timeArgs;

    ModuleData memory moduleData = ModuleData(modules, args);
```

å…³äºæ¨¡å—çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨æ‰¾åˆ°

æˆ‘ä»¬ä¸éœ€è¦ checker æ¡ä»¶ã€‚

å¯æ‰§è¡Œå‡½æ•°æœ€ç»ˆå°†æ˜¯:

```
 function closeStream(address sender, address receiver) external onlyOps {

       (uint256 fee, address feeToken) = ops.getFeeDetails();
       _transfer(fee, feeToken); // fee transferred

       _cfaLib.deleteFlow(sender, receiver, superToken);

       taskId = bytes32(0);

    }
```

## åˆåŒ

æˆ‘ä»¬çš„åˆåŒ:

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåˆåŒå‡†å¤‡å…³é—­æµã€‚æˆ‘ä»¬å¿…é¡»åªåˆ›å»ºä¸€ä¸ªæµï¼Œæˆæƒæˆ‘ä»¬çš„å¥‘çº¦æ¥åœæ­¢è¯¥æµï¼Œå¹¶åˆ›å»ºä»»åŠ¡æ¥å…³é—­è¯¥æµã€‚

## å‰§æœ¬

åˆåŒéƒ¨ç½²:

```
yarn deploy goerli
```

æ§åˆ¶å°å°†è®°å½•å¦‚ä¸‹å†…å®¹:

```
Close Stream deployed succsessfully 
at: 0xCC7FA88DB7df720EA72872ad7C19fd85026047d9
```

æˆ‘ä»¬å°†æŠŠéƒ¨ç½²çš„åœ°å€å¤åˆ¶åˆ°`./scripts/Helpers.ts`ä¸­ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥ä½¿ç”¨ã€‚

```
export const CloseStreamAddress = "0xCC7FA88DB7df720EA72872ad7C19fd85026047d9";
```

æˆ‘ä»¬å°†éªŒè¯æˆ‘ä»¬çš„åˆåŒï¼Œä»¥ä¾¿ç¨åä¸ etherscan è¿›è¡Œäº¤äº’

```
yarn verify goerli // in scripts/verify.ts
```

æˆ‘ä»¬ç°åœ¨å°†å¼€å§‹ä¸€ä¸ªæµã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SDK æˆ–ç›´æ¥ä»[è¶…æµä»ªè¡¨æ¿](https://app.superfluid.finance/)ä¸­å®Œæˆã€‚å€ŸåŠ© SDK:

```
yarn startStream goerli // in scripts/startStream.ts
```

æˆæƒæˆ‘ä»¬çš„æ™ºèƒ½åˆåŒæ¥é˜»æ­¢æ°´æµ

```
yarn authorizeControl goerli // in scripts/authorizeControl.ts
```

åˆ›å»ºæ„å¼å†°æ·‡æ·‹ä»»åŠ¡æ¥å…³é—­æµ

```
yarn createTaskStopStream goerli // in scripts/createTaskStopStream.ts
```

å¦‚æœæˆ‘ä»¬æŸ¥çœ‹ gelato åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ä»»åŠ¡å·²ç»åœ¨è¿è¡Œäº†

![](img/2a6bc06e3fd1b6cd94ca32b1d7c0c8a9.png)

## ç§

å¦‚æœæˆ‘ä»¬ç­‰å¾…å‡ åˆ†é’Ÿï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä»»åŠ¡æ‰§è¡Œï¼Œæˆ‘ä»¬çš„æµå°†è¢«å…³é—­ï¼

# ç»“è®º

å°† gelato ç½‘ç»œæ¥å…¥æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦**å¹¶**é‡Šæ”¾è‡ªåŠ¨åŒ–çš„å…¨éƒ¨æ½œåŠ›**ç›¸å¯¹ç®€å•ã€‚åšè¿™ä»¶äº‹æœ‰å‡ ç§æ–¹æ³•ã€‚æˆ‘ä»¬é€‰æ‹©äº†æœ€å¸¸ç”¨çš„ä¸€ä¸ªã€‚**

> èŠ±äº›æ—¶é—´ä»ç›´å‡æœºä¸Šäº†è§£è¶…æµä½“å’Œæ„å¼å†°æ·‡æ·‹æ˜¯å¦‚ä½•å·¥ä½œçš„æ˜¯å€¼å¾—çš„

æ„å¼å†°æ·‡æ·‹ V2 å¼•å…¥äº†æ¨¡å—çš„æ¦‚å¿µï¼Œè¿™ç»™äº†å¼€å‘äººå‘˜æ›´å¤šçš„çµæ´»æ€§æ¥é€‰æ‹©å¦‚ä½•é…ç½®ä»»åŠ¡ã€‚åœ¨ç¬¬ä¸€æ¬¡ä¹‹åï¼Œç¼–ç /è§£ç æ˜¯ç®€å•çš„ã€‚

è¿™ç¯‡æ–‡ç« **å¯ä»¥å¸®åŠ©å…¶ä»–å¼€å‘è€…å¿«é€Ÿå¯åŠ¨å¹¶è¿è¡Œ**gelatoï¼Œå¹¶å°†å…¶åº”ç”¨äºè¶…æµä½“æµã€‚

æ•¬è¯·å…³æ³¨ä¸€æœˆä»½ï¼Œåœ¨æ„å¼å†°æ·‡æ·‹[é“¾å¤–è§£æå™¨](https://docs.gelato.network/developer-services/automate/guides/writing-a-resolver/off-chain-resolver)çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬å°†å›ç­” 0xFran.eth/lens çš„æ¨ç‰¹ï¼ï¼

ä½ å¯ä»¥åœ¨æ¨ç‰¹ä¸Šè”ç³»æˆ‘ [@donoso_eth](https://twitter.com/donoso_eth?ref=hackernoon.com)

# èµ„æº

## æ„å¼å†°æ·‡æ·‹

[æ„å¼å†°æ·‡æ·‹ç½‘](https://www.gelato.network/)
[æ„å¼å†°æ·‡æ·‹è‡ªåŠ¨åŒ– app](https://app.gelato.network/?ref=gelato.network)
[æ„å¼å†°æ·‡æ·‹æ–‡æ¡£](https://docs.gelato.network/introduction/what-is-gelato)

## è¶…æµä½“

[è¶…æµé‡‘è](https://www.superfluid.finance/)
[è¶…æµä»ªè¡¨ç›˜](https://app.superfluid.finance/)
[è¶…æµæ–‡æ¡£](https://docs.superfluid.finance/superfluid/)

**æ„å¼å†°æ·‡æ·‹ V1 &è¶…æµä½“è¶…çº§åº”ç”¨ç¯‡**

[](/@javier_donoso/superfluid-gelato-for-stream-scheduling-7c32ed975f04) [## è¶…æµå’Œæ„å¼å†°æ·‡æ·‹ç”¨äºæµè°ƒåº¦

### ğŸš€äº†è§£å¦‚ä½•åœ¨è¶…çº§åº”ç”¨ä¸­è‡ªåŠ¨å¯åŠ¨/åœæ­¢è¶…æµæµ

medium.com](/@javier_donoso/superfluid-gelato-for-stream-scheduling-7c32ed975f04)