<html>
<head>
<title>Deploying VRF Coordinator V2 Mock for Local Blockchain Environments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为本地区块链环境部署VRF协调员V2·莫克</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/deploying-vrf-coordinator-v2-mock-for-local-blockchain-environments-26674903e4c9?source=collection_archive---------2-----------------------#2022-08-28">https://medium.com/coinmonks/deploying-vrf-coordinator-v2-mock-for-local-blockchain-environments-26674903e4c9?source=collection_archive---------2-----------------------#2022-08-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="26b8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最近我花了几个小时试图使用新版的Chainlink非常有用的随机数生成器VRFCoordinatorV2Mock，它来自Youtube上Patrick Collins的综合<a class="ae jo" href="https://www.youtube.com/watch?v=M576WGiDBdQ" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">区块链教程</strong> </a>，不幸的是，它使用的是旧版本。虽然实际的实现很容易，但是要弄清楚到底要做什么不同，可能需要一点脑力和宝贵的时间。</p><p id="db49" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面是在您的本地区块链环境中实现VRFCoordinatorV2Mock的分步指南。</p><h1 id="0408" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">先决条件</h1><p id="7888" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">对于这篇文章，您需要python的基础知识和一些扎实的知识，以及用两种语言编写和编译代码的必要工具，比如VSCode。您还需要安装ganache和python pip包solcx和brownie，并在brownie-config.yaml文件中包含chainlink依赖项。在这里  <strong class="is hu"> </strong>从Chainlink的github库<a class="ae jo" href="https://github.com/smartcontractkit/chainlink-mix/blob/main/contracts/test/VRFCoordinatorV2Mock.sol" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">获取VRF协调员V2 Mock，并将该文件包含在您的合同/测试文件夹中。</strong></a></p><p id="5ac2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">本质上，本指南假设您已经使用了Chainlink的VRFCoordinator的早期版本，或者按照Patrick Collin的教程学习了智能合约彩票部分。</p><h1 id="afa0" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">步骤1:部署VRF协调员V2·莫克</h1><p id="96a5" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">与第一个版本不同，VRFCoordinatorV2Mock在部署时采用两个参数，<em class="ks"> _baseFee </em>和<em class="ks"> _gasPriceLink </em>。<em class="ks"> _baseFee </em>是指为使用合同而向甲骨文支付的费用或溢价，每个区块链都不相同。你可以在这里找到完整的列表。<em class="ks"> _gasPriceLink </em>是发送交易的gas价格，通常是基于部署交易的层的价格动态设置的某个值。</p><p id="8c5c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了让您的模拟合同生效，将<em class="ks"> _baseFee </em>设置为250000000000000(这对应于0.25LINK)，将<em class="ks"> _gasPriceLink </em>设置为100000000。但是，如果mock拒绝生成随机数(称为randomWords)，可以随意给<em class="ks"> _gasPriceLink添加额外的零。这通常取决于合同的大小。</em></p><p id="0779" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，通过在deploy.py脚本(或任何运行代码的python脚本)中包含下面的代码，您可以部署并确保无论何时在本地区块链上都将部署VRF协调器模拟契约。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/40e5d6fd8b57b3dd9fa3ae2b4c85f92c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FHUZymk5ir037xSM06aBcg.jpeg"/></div></div></figure><h1 id="9e5b" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">步骤2:创建并资助本地VRF订阅</h1><p id="d94f" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">接下来，您必须创建VRF订阅才能使用该合同。在mainnet上，这可以在<a class="ae jo" href="http://vrf.chain.link" rel="noopener ugc nofollow" target="_blank"> VRF订阅管理器</a>完成。然而，在我们的本地模拟契约中，您必须自己调用这些方法。createSubscription方法不带参数，不返回任何内容。创建的订阅的ID可以通过访问“subscription created”事件来获取。有了这个ID，订阅就必须通过调用fundSubscription方法用高于先前设置的<em class="ks"> _baseFee，</em>的任意数量的链接来提供资金。这需要两个参数:<em class="ks"> _subID </em>(订阅ID)和<em class="ks"> _amount </em>(基金链接的金额)。我建议资金至少有300000000000000000(3链接)。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff lf"><img src="../Images/751e6869f146cf27487515164d272f8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JPUoisn9UkcEjhY0QO7krg.jpeg"/></div></div></figure><h1 id="79c3" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">第三步:提出请求</h1><p id="d296" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">向VRF协调员提出请求。这可以通过直接或通过合同调用requestRandomWords方法来实现。无论哪种方式，该函数都有五个参数，因此必须注意确保它们的正确性。参数1是<em class="ks"> _keyhash </em>。在mainnet上，这将因网络而异，可在此处 找到<a class="ae jo" href="https://docs.chain.link/docs/vrf/v2/supported-networks/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">。在开发中，任何网络的keyhash都可以做得很好。参数2是<em class="ks"> _subId </em>，我们已经在上面生成了。参数3为<em class="ks">_ minimumRequestConfirmations</em>，可以是任意数字，但建议设置为3。参数4是<em class="ks"> _callbackGasLimit </em>，Chainlink推荐设置为100000。然而，在下面的例子中，我添加了一个额外的零。这将确保我们不会因气体估计错误而恢复原状。参数5是<em class="ks"> _numWords </em>，它告诉契约要生成多少个随机数。与第一个版本不同，VRFCoordinatorV2Mock可以一次生成多个随机数。</strong></a></p><p id="58e8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">requestRandomWords方法发出一个唯一的requestID，可以从RandomWordsRequested事件中访问该request id。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff lg"><img src="../Images/cb1a96e4c7642937eef012152309d278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FHhVfGmGN7KthwwJ8tleEQ.jpeg"/></div></div></figure><h1 id="c74a" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">第四步:满足要求</h1><p id="1b5b" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">最后一步将需要您部署的合同的地址。这是因为VRFCoordinatorV2Mock的工作原理是通过您的契约的fulfillRandomWords方法将生成的单词发送到您的契约。<strong class="is hu">你的合同必须有这个方法来接收随机数。</strong></p><p id="743d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过调用VRFCoordinatorV2Mock的fulfillRandomWords函数来完成请求。这需要两个参数:<em class="ks"> _requestId </em>，上面生成的请求的Id和<em class="ks"> _consumer </em>，您的契约的地址。通过访问发出的事件“RandomWordsFulfilled”的“success”索引，可以知道实现的成功。如果为真，则该词已成功发送到您的合同中。如果错误，你可能需要调整你的天然气和资金数字多一点，或者确认你的合同地址是正确的。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff lh"><img src="../Images/d17ce2e89d7019d6dc50318ab4bb1315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X_55xGNY9CSt4vHyBd_vXQ.jpeg"/></div></div><figcaption class="li lj fg fe ff lk ll bd b be z ek">Calling fulfillRandomWords</figcaption></figure><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff lm"><img src="../Images/86add1d01b3c97c540f49e3eddb8dc75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LQVZ89ri9XJ1U5BeAAo-Ig.jpeg"/></div></div><figcaption class="li lj fg fe ff lk ll bd b be z ek">Solidity code for ExampleContract</figcaption></figure><p id="0e93" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">记住:生成的单词是一个数组，每个单词都必须使用适当的索引来访问，比如s_randomwords[0]，s_randomwords[1]等。</p><h1 id="1512" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">注意事项:</h1><p id="413d" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">&gt;模拟合同模仿已经部署在本地开发环境中的区块链mainnet上的真实合同。这使得运行本地测试成为可能，而不必总是与mainnet交互，这是一个慢得多的过程。</p><p id="8522" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">&gt;在上面的示例中，在每个事务之后调用wait(1 ),以确保在使用事务中的值之前事务已经完成。虽然不是绝对必要的，但建议这样做，尤其是在mainnet上。</p></div><div class="ab cl ln lo hb lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hm hn ho hp hq"><p id="8aff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">欢迎提问！</strong></p><p id="cf01" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ks">关注我了解更多区块链、Javascript、PHP、Python或纯编程故事。</em></p><p id="b474" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" rel="noopener" href="/@peterogwara">媒介</a> | <a class="ae jo" href="https://twitter.com/petermarie_" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae jo" href="https://github.com/PeterMarie" rel="noopener ugc nofollow" target="_blank"> Github </a> | <a class="ae jo" href="https://www.amazon.com/author/peterogwara" rel="noopener ugc nofollow" target="_blank">亚马逊</a></p><blockquote class="lu"><p id="033c" class="lv lw ht bd lx ly lz ma mb mc md jn ek translated">交易新手？尝试<a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>