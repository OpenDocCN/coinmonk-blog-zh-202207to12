<html>
<head>
<title>Proxy — Unstructured Storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代理—非结构化存储</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/proxy-unstructured-storage-7f41a9ac22f2?source=collection_archive---------10-----------------------#2022-10-05">https://medium.com/coinmonks/proxy-unstructured-storage-7f41a9ac22f2?source=collection_archive---------10-----------------------#2022-10-05</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="4cb6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这种存储模式类似于<a class="ae jo" rel="noopener" href="/coinmonks/proxy-inherited-storage-7887f63944e6">继承存储</a>模式，但是有一个很大的区别。逻辑契约不需要知道代理的存储布局。</p><p id="fa0d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我在<a class="ae jo" rel="noopener" href="/coinmonks/variable-immutability-proxy-112b861a9cb4">的上一篇文章</a>中写道，开发人员创建不同类型的存储来避免存储冲突。在继承存储模式中，所有状态变量都被写入存储的第一个槽中。但是这导致了一个很大的风险，这个槽可能被覆盖。</p><p id="59f1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，在非结构化存储模式中，所有代理的状态变量(如逻辑契约的地址)都被写入伪随机槽中。这个槽的索引是这样产生的</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="936f" class="jy jz ht ju b fv ka kb l kc kd"><em class="ke">bytes32 private constant implementationPosition = bytes32(uint256(<br/>keccak256(‘eip1967.proxy.implementation’)) – 1 ));</em></span></pre><p id="32db" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">结果取决于输入，'<em class="ke">EIP 1967 . proxy . implementation</em>'在我们的例子中，它保存为一个常量，所以没有什么会覆盖它，因为常量值不存储在存储器中。写代理状态变量的槽由<a class="ae jo" href="http://eips.ethereum.org/EIPS/eip-1967" rel="noopener ugc nofollow" target="_blank"> EIP-1967 </a>定义。</p><p id="e810" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">可靠性使用带有2个⁵⁶插槽的存储器。所以，我们的逻辑覆盖这一个槽的机会非常非常小。</p><p id="e129" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该模式的其余部分与继承存储相同。因此，新的逻辑契约必须继承旧的逻辑契约的所有状态变量。</p><h1 id="1260" class="kf jz ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">摘要</h1><h2 id="495c" class="jy jz ht bd kg lc ld le kk lf lg lh ko jb li lj ks jf lk ll kw jj lm ln la lo dt translated">优势</h2><ul class=""><li id="1f16" class="lp lq ht is b it lr ix ls jb lt jf lu jj lv jn lw lx ly lz dt translated">覆盖代理的状态变量的风险是最小的</li><li id="8c86" class="lp lq ht is b it ma ix mb jb mc jf md jj me jn lw lx ly lz dt translated">这只是简单的方法</li></ul><h2 id="05aa" class="jy jz ht bd kg lc ld le kk lf lg lh ko jb li lj ks jf lk ll kw jj lm ln la lo dt translated">不足之处</h2><ul class=""><li id="25e3" class="lp lq ht is b it lr ix ls jb lt jf lu jj lv jn lw lx ly lz dt translated">新版本需要继承可能包含许多他们不使用的状态变量的存储。因此，随着时间的推移，这种方法的实施成本可能会很高。</li><li id="2055" class="lp lq ht is b it ma ix mb jb mc jf md jj me jn lw lx ly lz dt translated">该逻辑的所有实现变得与特定的代理契约紧密耦合，并且不能被声明不同状态变量的其他代理契约使用。</li></ul></div><div class="ab cl mf mg hb mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hm hn ho hp hq"><p id="fb33" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我希望这篇文章对你有用。如果你有任何想法，我如何能使我的帖子更好，请告诉我。我随时准备学习。你可以在<a class="ae jo" href="https://pl.linkedin.com/in/szymon-skrzy%C5%84ski-881462214" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae jo" href="https://t.me/eszymi" rel="noopener ugc nofollow" target="_blank"> Telegram </a>上和我连线。</p><p id="0b39" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你想和我谈论这个话题或者我写的其他话题，请随意。我乐于交谈。</p><p id="f9fe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">快乐学习！</p><blockquote class="mm"><p id="6927" class="mn mo ht bd mp mq mr ms mt mu mv jn ek translated">交易新手？尝试<a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>