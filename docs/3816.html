<html>
<head>
<title>All Your Uniswap v3 Liquidity Farming Calculations Are Dead Wrong! Here’s Why</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你所有的Uniswap v3流动性农业计算都是完全错误的！原因如下</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/all-your-uniswap-v3-liquidity-farming-calculations-are-dead-wrong-heres-why-20bd47f55d69?source=collection_archive---------0-----------------------#2022-09-18">https://medium.com/coinmonks/all-your-uniswap-v3-liquidity-farming-calculations-are-dead-wrong-heres-why-20bd47f55d69?source=collection_archive---------0-----------------------#2022-09-18</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/d00a85c0a5ffb401788556c806fe4190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WL0AizJKPCoivd-MxS9AAQ.png"/></div></div></figure><h1 id="8475" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated"><strong class="ak"> 2 x 2 = 5 </strong></h1><p id="e19f" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">你知道这是错的，但当你第一次看到它时，你会事后批评自己，并认为:“也许我的计算有问题”。对吗？</p><p id="8ca9" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">嗯，当我发现Uniswap V3用户界面上显示的流动性和TVL(锁定总价值)数字完全错误时，我就是这样感觉的。</p><p id="67f1" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">Uniswap是以太坊和整个区块链行业最大的分散金融(DeFi)项目。成千上万的流动性提供者每天都在使用这些数据来构建他们的投资策略。那么这些数字怎么可能不准确呢？</p><blockquote class="lc"><p id="520c" class="ld le ht bd lf lg lh li lj lk ll kw ek translated">我花了几个小时试图在我的计算中找出一个错误，你猜怎么着？我没有犯任何错误。而且情况甚至比不准确的TVL还要糟糕。</p></blockquote><p id="d806" class="pw-post-body-paragraph jz ka ht kb b kc lm ke kf kg ln ki kj kk lo km kn ko lp kq kr ks lq ku kv kw hm dt translated">不过还是一步一步来，从问题入手。</p><h1 id="2075" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">问题是</h1><p id="31b8" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">首先，什么是TVL，它是如何使用的？简而言之，TVL被定义为当前由用户委托给区块链或协议的所有加密资产的美元价值。例如，这些资产可能是分散式交易所、过桥或借贷协议的总流动性，或者是PoS区块链的总押记资产。</p><p id="b93b" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">加密市场投资者和其他参与者在多种情况下使用TVL:</p><ol class=""><li id="67b3" class="lr ls ht kb b kc kx kg ky kk lt ko lu ks lv kw lw lx ly lz dt translated">方案健康评估。这就是为什么流行的协议在主页上吹嘘他们的TVL。更大的TVL =更多的用户信任=更低的风险=稳定的利润。</li><li id="9241" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">协议之间的比较。如果我是一个加密交易者，我更喜欢使用DeFi工具，比如分散的交易所或桥梁，TVL更高。</li><li id="d06e" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">协议增长的衡量。看到协议或项目的TVL快速增长的投资者认为这是看好协议象征性价格的信号。</li></ol><p id="c2f0" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">看来知道<strong class="kb hu">准确的</strong> TVL数字很重要，对吗？</p><blockquote class="lc"><p id="acb3" class="ld le ht bd lf lg lh li lj lk ll kw ek translated">但是如果我说关于Uniswap v3 TVL的大多数可用数据是误导性的呢？然而，最让我吃惊的是，官方的<a class="ae mf" href="https://info.uniswap.org/#/" rel="noopener ugc nofollow" target="_blank"> Uniswap图表应用</a>也有问题！我是这样发现的。</p></blockquote><p id="fba6" class="pw-post-body-paragraph jz ka ht kb b kc lm ke kf kg ln ki kj kk lo km kn ko lp kq kr ks lq ku kv kw hm dt translated">我当时在做一个流动性分析项目，将Uniswap v3上的官方数据与我使用原始区块链数据进行的计算进行比较。这一步对于符合最高的数据质量标准至关重要。为了开始验证，我选择了一个流行的流动性池，USDC-韦瑟(0.3%的费用水平)。</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/f15047765197befe31493a2e0543ea7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mSWDQJLpm4sc25aB3rIAFg.png"/></div></div></figure><p id="0edb" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">看看Uniswap v3上的pool 3——它有令人印象深刻的3 . 33亿美元的TVL(根据撰写本文时Uniswap的官方图表)和6100万美元的健康日交易量。</p><p id="c0ff" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">我立刻遇到了一个问题:我计算出的TVL价值是1.76亿美元，而不是Uniswap网站上公布的3.33亿美元。好吧，bug发生了。但是在开始调试之前，我决定在最流行的以太坊区块链探索者<a class="ae mf" href="https://etherscan.io/" rel="noopener ugc nofollow" target="_blank">以太扫描</a>上验证TVL。从技术上讲，每个Uniswap v3池都是一个智能合同。因此，区块链探险家可以显示池中拥有的代币余额，这就是TVL。</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/b9c0477e5ea43b3b9049860ec6b23f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pv1borWzqBu33M4mw2j7FQ.png"/></div></div></figure><p id="5c93" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">我预计该池的令牌余额会比Uniswap报告的TVL稍大一些。这是因为资金池持有流动性以及已累计但尚未申请的费用。但是这个余额几乎是Uniswap报告的一半，而且，令人惊讶的是，这个数字和我的计算结果是一样的！</p><p id="4126" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">对不同资产的流动性进行比较，也显示出巨大的差异。此时，我意识到这个错误与我的数学技能无关。</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/918d9c31a22d33b6f8c3bc65af1c6622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1RwHhso0x45HZ-GjogD3A.png"/></div></div></figure><p id="e1cb" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">但是这怎么可能发生呢？经过研究，我发现Uniswap依赖于分散的区块链索引服务<a class="ae mf" href="https://thegraph.com/en/" rel="noopener ugc nofollow" target="_blank"> The Graph </a>。通过这项服务，任何开发人员都可以为特定的区块链数据用例添加个人分析代码(称为子图)，并通过API提供分析。</p><p id="c24f" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">uni WAP实验室为uni WAP协议分析创建了自己的子图，并通过<a class="ae mf" href="https://thegraph.com/hosted-service" rel="noopener ugc nofollow" target="_blank">图形托管服务</a>提供这些子图。好在它的代码是<a class="ae mf" href="https://github.com/Uniswap/v3-subgraph" rel="noopener ugc nofollow" target="_blank">公开的</a>。然而，坏消息是它的TVL计算错误。</p><p id="1c51" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">对该代码的简要分析表明，它考虑了所有互换和流动性事件，但不考虑费用。Uniswap池对每次互换收取0.01%至1%的费用。该费用从交易资产中扣除，并计入流动性提供者。反过来，流动性提供者可以随时收取应计费用。</p><p id="f92a" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">然而，当前的Uniswap v3子图显示的数字就好像没有累计和收取费用一样。因此，Uniswap v3 TVL的数字与每次交换的实际情况有偏差。</p><blockquote class="lc"><p id="a729" class="ld le ht bd lf lg lh li lj lk ll kw ek translated">你可能会疑惑:“写这篇文章之前，你有没有在GitHub上提交过问题单？”是的，这是我发现错误后的第一个意图。你知道吗？那期<a class="ae mf" href="https://github.com/Uniswap/v3-subgraph/issues/74" rel="noopener ugc nofollow" target="_blank">已经登录</a>，由一个核心开发者在2021年11月创建！</p></blockquote><p id="54c7" class="pw-post-body-paragraph jz ka ht kb b kc lm ke kf kg ln ki kj kk lo km kn ko lp kq kr ks lq ku kv kw hm dt translated">那么，为什么这个问题没有得到解决呢？我不知道。也许这个错误在发现的时候可以忽略不计。然而，这是一个累积误差，随着每次交换而增加。因此，随着池中费用和交易量的增长，由误差产生的TVL差异将导致与现实的更大差异。我们可以看到，在像USDC联邦理工学院这样的大资金池中，收取更高的0.3%的费用——这已经失去了控制！目前几乎是真实数字的两倍。</p><h1 id="b3ff" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">让我们验证总TVL</h1><p id="2179" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">好了，我们现在知道了，单个池中的TVL数被扭曲了。我们将在下面探讨这如何影响投资决策。但在此之前，让我们看看这些错误如何影响Uniswap v3协议的总TVL。据报道，在撰写本文时，这款TVL的价格接近120亿美元。</p><blockquote class="lc"><p id="d491" class="ld le ht bd lf lg lh li lj lk ll kw ek translated">你不必是数据科学家也能看出这里有问题。</p></blockquote><figure class="ml mm mn mo mp iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/97558450cd8b52d8938e5e65522912a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5YudWywF_AYrqUU3ZfZkJg.png"/></div></div></figure><p id="6476" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">我们可以从上面看到，据报道，TVL缓慢但稳定地从5亿美元增长到2022年3月6日的45亿美元。然后疯狂的事情发生了，TVL在2022年3月7日被报道为254b美元。这是整个以太坊网络有史以来最高TVL的2.5倍——在一天之内！很明显，这是数据上的错误。接下来的几周，TVL报100-200亿美元。</p><blockquote class="lc"><p id="a7a4" class="ld le ht bd lf lg lh li lj lk ll kw ek translated">此时，我对Uniswap analytics的数据完全失去了信任。但是我们怎么才能知道真正的TVL呢？我有两个选择。</p></blockquote><p id="0756" class="pw-post-body-paragraph jz ka ht kb b kc lm ke kf kg ln ki kj kk lo km kn ko lp kq kr ks lq ku kv kw hm dt translated"><strong class="kb hu">选项1 </strong> —叉出并固定Uniswap v3子图。这个选项的缺点是子图重新索引需要几天时间。我也不喜欢图形使用的GraphQL语言。</p><p id="61ae" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">幸运的是，我有<strong class="kb hu">选项2</strong>—<a class="ae mf" href="https://datamint.ai/" rel="noopener ugc nofollow" target="_blank">Datamint</a>的高性能分析数据库，用于所有Uniswap v3和以太坊数据，随时可用于复杂的在线查询。</p><p id="5680" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">经过一些实验，我创建了下面的算法来精确计算TVL。查看下面的分步过程。</p><ol class=""><li id="1aa4" class="lr ls ht kb b kc kx kg ky kk lt ko lu ks lv kw lw lx ly lz dt translated">使用这两个步骤计算所有现有Uniswap v3池的TVL。</li><li id="9588" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">将所有ERC-20代币转入和转出池合同(包括所有无人认领的费用)相加，并匹配<a class="ae mf" href="http://etherscan.io" rel="noopener ugc nofollow" target="_blank">以太网扫描</a>上的代币余额</li><li id="4b23" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">添加所有流动性事件，包括流入和流出，然后将所有掉期事件添加到<strong class="kb hu">费用账户</strong></li><li id="533b" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">比较这两种方法，确保不存在无法解释的差异</li><li id="7f7b" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">移除少于50次交换或0.00000000000001令牌量的废弃和空池(检测到7，863个池(包括2，083对稳定池)，我的算法移除了112个空/废弃池)</li></ol><p id="6249" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">6.为每个代币寻找稳定硬币的路径，以将池TVL转换为美元值</p><p id="b68d" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">7.移除具有破损美元值的低流动性池，因为一些池在完全移除流动性后可能显示不足的值(查看下图作为示例)</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/33ba8f9318910fdc3d939b4ee3b952eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lQMpno0NgRWniJImheRuVw.png"/></div></div></figure><p id="f9fa" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">8.将所有剩余货币对的TVL转换为美元值，并将它们相加</p><p id="54b1" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">经过多次反复核对，我得出了一个TVL的计算方法。我启动了它，想在计算执行的时候去喝咖啡，但是它在我站起来之前就结束了。这是使用高性能分析数据库的唯一缺点。</p><blockquote class="lc"><p id="27b3" class="ld le ht bd lf lg lh li lj lk ll kw ek translated">你准备好看到结果了吗？</p></blockquote><figure class="ml mm mn mo mp iu fe ff paragraph-image"><div class="fe ff mq"><img src="../Images/9c7cfd9ab674d2b1df9e725643a50c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*x3Sn35ppqihjSXduNtYaWg.png"/></div></figure><blockquote class="lc"><p id="6815" class="ld le ht bd lf lg mr ms mt mu mv kw ek translated">几乎比报道的$ <strong class="ak"> 11，8b… </strong>少<strong class="ak"> 4倍</strong>由你自己下结论。</p></blockquote><p id="7fce" class="pw-post-body-paragraph jz ka ht kb b kc lm ke kf kg ln ki kj kk lo km kn ko lp kq kr ks lq ku kv kw hm dt translated"><strong class="kb hu"> <em class="mw">免责声明</em> </strong> <em class="mw">:我的计算可能包含误差。在面向企业客户的数据项目中，我们使用记录的方法、自动测试和许多其他工具来实现最高的数据质量。这些工具对于像这样的个人研究项目来说是多余的。这项研究强调了现有数据中的明显问题，而不是提供最终的解决方案。</em></p><h1 id="5dc6" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">好的，我们会修正TVL计算——会有帮助吗？</h1><p id="fcc3" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">问题不在于错误的数字，而在于我们根据这些数字做出的决定。例如，大多数流动性提供者的利润计算器使用这些数字进行预测。</p><p id="38c1" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">然而，修正TVL计算并不困难。要么Uniswap实验室在他们的子图代码中修复它，要么计算器开发人员开始使用其他数据源。核心问题是，我们能否确信计算器的预测是正确的。</p><blockquote class="lc"><p id="30ff" class="ld le ht bd lf lg lh li lj lk ll kw ek translated">我做了一些计算，简短的答案是— <strong class="ak">甚至不接近</strong>。</p></blockquote><p id="c280" class="pw-post-body-paragraph jz ka ht kb b kc lm ke kf kg ln ki kj kk lo km kn ko lp kq kr ks lq ku kv kw hm dt translated">我知道这是个大胆的主张。许多流动性提供者使用现有的计算器，并影响耗资数千万美元的决策。但是，让我们来看一下计算步骤，以便您可以做出自己的判断。</p><p id="fe75" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">首先，让我们回顾一下Uniswap v3协议的一些核心概念。</p><p id="182f" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">其主要创新之一是集中流动性。本质上，通过Uniswap v3，您可以选择您希望您的资金发挥流动性提供者作用的价格范围。这是一个惊人的概念，可以给协议用户带来巨大的价值。流动性提供者限制了他们对非永久性损失的暴露，当波动性较低时，交易者可以享受较小的价格滑动。但是所有这些潜在的好处都是有代价的。</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/ad3aa235dd1f8eb2244a4be6d2358349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nf6qZHIfzt4OJGt-5GG6mg.png"/></div></div></figure><p id="cd10" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">因此，我们想了解Uniswap v3流动性提供商的收益是如何计算的。</p><p id="a1a1" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">在Uniswap v3中，流动性提供者选择提供流动性的价格范围。一旦价格在这个范围内，他就会得到他那份交换费。乍一看，流动性提供者希望他的流动性头寸的价格范围尽可能宽。但是，流动性在这个范围内按比例分配。因此，范围越大，每笔交易的掉期费用就越低。</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/31483de35870765b71f0ae47e99f3d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*WbHpEF6Jtf_BOuBWXXND5g.jpeg"/></div></figure><p id="57cb" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">在这个例子中，选项A显示流动性提供者选择了一个更宽的价格范围，而选项2显示了一个相同金额的更窄的价格范围。假设在这两种情况下，价格都在选择的价格范围内，流动性提供者在选项b中获得3倍以上的费用。但是，如果价格波动更大，流动性提供者可能会在选项a中获得更高的利润。</p><blockquote class="my mz na"><p id="4f3f" class="jz ka mw kb b kc kx ke kf kg ky ki kj nb kz km kn nc la kq kr nd lb ku kv kw hm dt translated">因此，在现实中，选择正确的价格区间取决于在错过价格的风险和每次交易获得较低回报之间找到最佳平衡。</p></blockquote><p id="67bb" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">还有一个参数会影响流动性提供者的利润，并且经常被忽视。我不知道有任何LP利润计算器考虑它，这个参数可以改变一切。你现在一定在想这是什么。这是LP的分布。考虑下面的例子:</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div class="fe ff ne"><img src="../Images/a54c7c52c598b41bf6e2b857abd67469.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*vhvOAl1AnOZpddhNBJrs8Q.jpeg"/></div></figure><p id="e577" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">在这个例子中，两个流动性提供者(LP1和LP2)有头寸。LP1的仓位很窄，为3美元。LP2有5美元的宽仓。在这种情况下，如果价格没有离开LP1的位置范围，他将获得比LP2多3倍的费用。那是因为LP2在这个区间只有1美元。而这1美元是和LP1的3美元竞争的。</p><p id="55e9" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">如果您观察任何Uniswap v3池的流动性分布，您会发现它并不均匀。</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/a8796e3b0e6d4032d7343578ca636095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJ5PfTH7uJJURIez1dn2DQ.png"/></div></div></figure><p id="8814" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">门槛越高，竞争越激烈。流动性提供者需要在选择有竞争力的区间和价格冲击概率较低的区间之间找到平衡。这就是为什么这种分布在LP利润预测和策略构建中起着重要作用。唯一的问题是…我不确定这个分布是否计算正确。</p><h1 id="aa5a" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">好像这还不够——流动性狙击手</h1><p id="f38b" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">成为流动性提供者就是要猜测价格、竞争状态和交易量。如果一个有限合伙人有一个愿望，那就是事先知道交易的未来以调整流动性头寸。</p><p id="77be" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">但是如果我告诉你这是可能的呢？</p><p id="abd3" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">在研究过程中，一些不同寻常的流动性提供商引起了我的注意。他们一天内多次增加和减少大量流动性头寸(超过1000万美元)。更令人惊讶的是，他们总是在同一块增加和减少流动性。</p><p id="36ee" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">让我们看一个例子:</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/338cb7569a6585fdc8ceedce9c0136f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iQKVQ3AKjKLNv-pSGFLvyg.png"/></div></div></figure><p id="eec1" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">我们有三个交易，都在块15413416中，位置3-5，以自下而上的顺序执行。采用Execute方法的第一笔交易是一份名为“MEV Bot”的合同，为USDC-韦瑟基金增加了2200万美元的流动性。</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/c88eeac8a8c314046c74fa3c456fbd16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RAw3BinEIw9n_XMEW039Yw.png"/></div></div><figcaption class="nf ng fg fe ff nh ni bd b be z ek">MEV Bot adding liquidity</figcaption></figure><p id="f9d4" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">第二笔交易是通过WETH从USDC到DogeChain的掉期交易。这是一笔价值约为16，500美元的普通掉期交易。</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/30873ec456ca9dd87e2dfad5b9f6cacb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0WyvzsIaG-k1UVR2HqvaSQ.png"/></div></div><figcaption class="nf ng fg fe ff nh ni bd b be z ek">Standard swap transaction</figcaption></figure><p id="9246" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">第三笔交易又是“MEV Bot”，从USDC-韦瑟资金池中取走了2200万美元的流动性。</p><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/1b30f6c1eb904e07cfe11580a9f83303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXxNrEHXOilm_R2dlHhNLQ.png"/></div></div><figcaption class="nf ng fg fe ff nh ni bd b be z ek">MEV Bot removing liquidity</figcaption></figure><p id="664f" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">例子中发生的事情被称为“<strong class="kb hu">流动性狙击</strong>”。让我解释一下这是如何工作的:</p><ol class=""><li id="09b1" class="lr ls ht kb b kc kx kg ky kk lt ko lu ks lv kw lw lx ly lz dt translated">有人发了一笔交易，把USDC换成了多吉钱</li><li id="2c9f" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">MEV Bot在mempool中检测到了这个事务，并使用Flashbots技术或类似技术激活了一个与矿池的私有链接</li><li id="772f" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">MEV Bot向矿商支付报酬，以包括一项掉期交易和两项特定顺序的交易，从而提取价值</li><li id="211a" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">MEV Bot为一个非常狭窄的价格区间增加了如此多的流动性(2200万美元)，如此有效地，USDC-多杰钦交易的所有费用利润都归他所有</li><li id="bfd7" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">MEV Bot然后移除流动资金并赚取费用(约35美元)</li></ol><p id="948f" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">因此，他扣除汽油费后的毛利润约为30美元。不是很喜欢？是的，但是他在一分钟内多次执行这个策略，所有这些加起来。可以<a class="ae mf" href="https://etherscan.io/address/0xa57bd00134b2850b2a1c55860c9e9ea100fdd6cf" rel="noopener ugc nofollow" target="_blank">自己去查</a>。</p><p id="df6a" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">作为流动性提供者，这对你意味着什么？这意味着流动性狙击手可以从你的费用利润中拿走很大一部分。</p><h1 id="0849" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">结论</h1><p id="f159" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">请不要让我难过。我坚信Uniswap是一个具有巨大潜力的伟大项目。我也尊重Uniswap v3核心的集中流动性的思想。然而，我发现Uniswap生态系统的分析部分还远未成熟。我相信这种情况很快就会改变！</p><p id="c76a" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">让我总结一下我的研究发现:</p><ol class=""><li id="afce" class="lr ls ht kb b kc kx kg ky kk lt ko lu ks lv kw lw lx ly lz dt translated">Uniswap v3海图中的TVL数据非常不准确。同样的错误存在于所有依赖官方Uniswap v3子图的分析工具中。</li><li id="7cb5" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">Uniswap v3 TVL的总费用为314亿美元，而官方网站报告的费用为118亿美元(在撰写本文时)。</li><li id="a59d" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated">Uniswap v3流动性提供商的计算器对现实生活中的策略没有什么价值，因为它们没有考虑竞争和流动性狙击手。</li></ol><figure class="mh mi mj mk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/33ab8164d4096473ccc55ce2d4658446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HpPFJqn12o8RYdPHcDjw9A.png"/></div></div><figcaption class="nf ng fg fe ff nh ni bd b be z ek">Famous Dilbert series modified to fit liquidity providers’ reality.</figcaption></figure><p id="5746" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">幸运的是，您现在可以更好地理解Uniswap v3流动性池在现实生活中是如何工作的，并可以相应地调整您的研究。</p><p id="c4d3" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">我没有资格提供财务建议，但我认为只有两个选择可以建立一个显著的流动性提供策略:</p><ol class=""><li id="b30a" class="lr ls ht kb b kc kx kg ky kk lt ko lu ks lv kw lw lx ly lz dt translated"><strong class="kb hu">简单的</strong>。使用历史性能数据。尝试一些小额度的流动性头寸，看看哪些选择效果更好。显然，这只有在假设市场稳定的情况下才行得通。</li><li id="8a39" class="lr ls ht kb b kc ma kg mb kk mc ko md ks me kw lw lx ly lz dt translated"><strong class="kb hu">高级</strong>。进行研究并相应地优化LP策略。正如我们在上面提到的，这需要深入理解Uniswap v3协议、数学和博弈论能力，以及强大的数据分析工具来实时处理大量数据。</li></ol><p id="f45e" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">这两种选择都有一个共同点——你的决策是基于数据，而不是直觉或随机工具。有时候处理数据很困难，但这是值得的。</p><p id="b3fc" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated">在<a class="ae mf" href="https://datamint.ai" rel="noopener ugc nofollow" target="_blank"> <strong class="kb hu"> Datamint </strong> </a>，我们随时为您的定制数据项目提供帮助。</p><h1 id="2194" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">愿数据伴随你！</h1><p id="149f" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated"><strong class="kb hu">更新(21.09.2022): </strong>截至9月21日(文章发表3天后)，Uniswap实验室在UI级别修复了TVL显示(<a class="ae mf" href="https://github.com/Uniswap/v3-info/commit/be78c8a87c37fc95d1aefdb1fff081f902989a02" rel="noopener ugc nofollow" target="_blank">提交</a>)。子图也被<a class="ae mf" href="https://github.com/Uniswap/v3-subgraph/issues/74" rel="noopener ugc nofollow" target="_blank">更新了</a>，所以在重新同步之后(根据开发者的估计，这需要大约5周的时间)，它也会有准确的数据！</p><p id="448d" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated"><em class="mw">关于作者:</em> Ivan Vakhmyanin是一位拥有多年经验的数据分析和可视化(BI、大数据、数据科学)专家。他也是一个区块链和Web 3.0专家，使来自领先的区块链平台(以太坊，BNB智能链，索拉纳等)的链上数据可供分析。Ivan热衷于通过为专家和高管开发数据驱动管理领域的教育和项目来分享经验。</p><p id="4c15" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated"><strong class="kb hu"> Datamint </strong>是一家专注于定制研发的增值区块链数据提供商。欲了解更多详情，请访问我们的网站:https://datamint.ai </p><p id="e60c" class="pw-post-body-paragraph jz ka ht kb b kc kx ke kf kg ky ki kj kk kz km kn ko la kq kr ks lb ku kv kw hm dt translated"><em class="mw">原刊有</em><a class="ae mf" href="https://www.cryptopolitan.com/uniswap-v3-liquidity-farming-calculations/" rel="noopener ugc nofollow" target="_blank"><em class="mw"/></a><em class="mw">。</em></p><blockquote class="lc"><p id="0c06" class="ld le ht bd lf lg lh li lj lk ll kw ek translated">交易新手？试试<a class="ae mf" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae mf" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>