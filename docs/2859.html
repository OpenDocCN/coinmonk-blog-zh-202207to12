<html>
<head>
<title>Securing Keys with HSMs (Hardware Secure Module)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用HSMs(硬件安全模块)保护密钥</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/securing-keys-with-hsms-hardware-secure-module-d4015a9bdc5?source=collection_archive---------0-----------------------#2022-08-29">https://medium.com/coinmonks/securing-keys-with-hsms-hardware-secure-module-d4015a9bdc5?source=collection_archive---------0-----------------------#2022-08-29</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/c69cbcbc661f48f48f0eaae2d8b5c560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7M2lGmR8RPGplOrH"/></div></div></figure><blockquote class="jb"><p id="2f4b" class="jc jd ht bd je jf jg jh ji jj jk jl ek translated">HSM(硬件安全模块)是专门的硬件设备，可以防止篡改，用于存储密钥。规则是所有的密钥永远留在HSM设备中。</p><p id="c8f7" class="jc jd ht bd je jf jm jn jo jp jq jl ek translated">当我们需要使用它们时，我们在HSM的安全执行环境中进行操作。</p></blockquote><h1 id="1a21" class="jr js ht bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dt translated">主要HSM供应商</h1><p id="0bd4" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">HSM供应商需要通过NIST的认证程序。一些已经存在一段时间的主要供应商有金雅拓(由Thales拥有)、SafeNet(由金雅拓拥有)、Thales、nCipher(由EnTrust拥有)、FutureX和Utimaco。这些解决方案的管理费用很高，金雅拓HSM公司大约为29，000美元，泰雷兹公司大约为9，500美元，而Utimaco公司大约为15，000美元。此外，您需要将这些HSM设备存放在安全的地方，这可能会花费一大笔钱，甚至更多。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lm"><img src="../Images/10f916c2d2a878dab6be040faea1e9d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qRvvM0KGE3YJ6if1NWPxzw.png"/></div></div></figure><p id="65f8" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">有人不需要高昂的开销来使用HSM，你可以轻松地租赁云提供商的HSM来完成这项工作。近年来，云提供商也成为主要竞争者，如AWS、Google和Azure，提供云HSM。使用云HSM没有开销成本，但有云成本，这取决于您使用它们的时间和方式，例如，AWS每月花费约1，058美元(1 HSM x每月730小时x 1.45美元= 1，058.50美元)。云HSM提供商的另一个主要区别是，物理设备位于云提供商的站点，而不是您的站点。您最有可能使用云提供商提供的服务(密钥管理服务— KMS)来与他们站点上的HSM设备进行交互。</p><p id="2956" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">当找到HSM供应商时，请使用以下网站验证由NIST颁发的供应商证书:</p><div class="lw lx fm fo ly lz"><a href="https://csrc.nist.gov/projects/cryptographic-module-validation-program/validated-modules/search?SearchMode=Basic&amp;ModuleName=hsm&amp;CertificateStatus=Active&amp;ValidationYear=0" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hu fv z el me eo ep mf er et hs dt translated">搜索-加密模块验证计划|中国证监会|中国证监会</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">使用此表单搜索已验证加密模块的信息。选择要搜索的基本搜索类型…</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">csrc.nist.gov</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn iz lz"/></div></div></a></div><h1 id="3656" class="jr js ht bd jt ju jv jw jx jy jz ka kb kc mo ke kf kg mp ki kj kk mq km kn ko dt translated">HSM用例</h1><h2 id="ba78" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">公开密钥基础设施</h2><p id="9ae5" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">所有证书颁发机构(ca)都需要使用HSMs。证书颁发机构使用HSM设备来签署证书，因此应用程序可以相信颁发的证书是合法的，并且得到了CA的认可。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nf"><img src="../Images/9a469f5c8e944e43501b65092de64268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iyYvvcGX-73Z1Cjo.png"/></div></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://www.ravenswoodtechnology.com/components-of-a-pki-part-5/" rel="noopener ugc nofollow" target="_blank">https://www.ravenswoodtechnology.com/components-of-a-pki-part-5/</a></figcaption></figure><p id="e582" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">我们需要HSM来签署证书，以防止坏人使用被劫持的证书。如果黑客获得了客户端证书，他们将无法通过签名来验证自己，因为HSM中的私钥只能对证书进行签名。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div class="fe ff nl"><img src="../Images/cb20189ee946c24f43d5db58e860b1b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/0*V3NyBcY3Yc3-4VOE.png"/></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://www.ravenswoodtechnology.com/components-of-a-pki-part-5/" rel="noopener ugc nofollow" target="_blank">https://www.ravenswoodtechnology.com/components-of-a-pki-part-5/</a></figcaption></figure><p id="78f3" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">以下是CA/B论坛的基本要求:</p><blockquote class="jb"><p id="3f77" class="jc jd ht bd je jf jm jn jo jp jq jl ek translated">CA应保护其系统或设备中的私钥，该系统或设备至少满足FIPS 140第3级或适当的通用标准保护配置文件或安全目标EAL 4(或更高)，其中包括保护私钥和其他资产免受已知威胁的要求。</p></blockquote><h2 id="31f8" class="mr js ht bd jt ms nm mu jx mv nn mx kb la no mz kf le np nb kj li nq nd kn ne dt translated">自动取款机的借记卡密码</h2><p id="61d8" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">HSM用于保护借记卡PIN，银行不能公开PIN，因为有人会用它来抢劫客户，所以他们使用HSM设备来验证PIN。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nr"><img src="../Images/67214f84b767a794b5576cee40316630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zI4Iy5ADszL6cwV_Vxc26Q.png"/></div></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://www.emv-connection.com/downloads/2015/03/PIN-Change-at-the-ATM-FINAL-033015.pdf" rel="noopener ugc nofollow" target="_blank">https://www.emv-connection.com/downloads/2015/03/PIN-Change-at-the-ATM-FINAL-033015.pdf</a></figcaption></figure><h2 id="ae7d" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">保护加密货币</h2><p id="6d7d" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">随着加密货币的出现，HSM变得越来越流行。加密货币本质上是公钥和私钥对，由于HSM是为了保护密钥而构建的，因此非常适合这项工作。</p><p id="38d9" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">在加密领域，HSM是交易的签名者。因为私钥总是在HSM中，所以事务被发送到HSM进行签名。</p><p id="2347" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">下面是Kaleido如何使用Azure、AWS或HashiCorp cloud HSM来签署交易。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ns"><img src="../Images/efe6e036b3b14198f40879e581856177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*maxlztxuRx6pt83Y.png"/></div></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://www.kaleido.io/blockchain-platform/aws-cloudhsm-signer" rel="noopener ugc nofollow" target="_blank">https://www.kaleido.io/blockchain-platform/aws-cloudhsm-signer</a></figcaption></figure><h1 id="0a9f" class="jr js ht bd jt ju jv jw jx jy jz ka kb kc mo ke kf kg mp ki kj kk mq km kn ko dt translated">HSM里面有什么？</h1><p id="4d09" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">HSMs设备通常作为PCIe卡和网络附加设备提供。PCIe卡可以安装到服务器中，网络附加设备是它的硬件。</p><p id="8d02" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">下图是一台Linux机器上的HSM·PCIe设备。通常，这种Linux服务器运行在Intel E5500服务器上，具有4gb的RAM和500 GBs的硬盘。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nt"><img src="../Images/c223d5db2a8d9dd0752637597e791440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o9MxQE3BZe2WVQrre-ghmw.png"/></div></div></figure><p id="8c36" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">下图是PCIe·HSM；这张PCIe卡位于服务器上，是所有奇迹发生的地方。它有传感器，可以检测温度、电压、电源的变化，以及保护箔的篡改。物理保护层和电池有助于在HSM断电时擦除内存中的内容。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div class="fe ff nu"><img src="../Images/c11bbc5606e2853dfa694a478cc728c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/0*4RVW0y5c-vePgRwr"/></div></figure><h2 id="9d77" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated"><strong class="ak">PCIe·HSM有什么？</strong></h2><ul class=""><li id="7e0b" class="nv nw ht kr b ks kt kw kx la nx le ny li nz jl oa ob oc od dt translated">德州仪器TMS320C64x DSP，执行密码运算。</li><li id="383e" class="nv nw ht kr b ks oe kw of la og le oh li oi jl oa ob oc od dt translated">真随机数生成器(TRNG)和确定性随机位生成器(DRBG)来帮助它提供熵</li><li id="38cf" class="nv nw ht kr b ks oe kw of la og le oh li oi jl oa ob oc od dt translated">包含加密所有密钥的设备密钥的密钥RAM</li></ul><h2 id="b5db" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated"><strong class="ak">什么是设备密钥？打开所有钥匙的钥匙。</strong></h2><p id="dbe2" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">设备密钥在HSM投入运行时创建。最重要的是，它加密所有的密钥和安全参数。HSMs中的密钥不能提取、导出、导入或操作。</p><h2 id="5a5f" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">主备份密钥(MBK)</h2><p id="86a3" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">主备份密钥，顾名思义，备份密钥。它们是用于加密备份的256位AES密钥，可以使用n/m方案分割成许多份。</p><h2 id="f503" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated"><strong class="ak">支持的按键</strong></h2><p id="c35b" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">大多数HSM设备支持RSA、DSA、ECDSA (NIST和Brainpool <br/>曲线)、DH、ECDH、AES、DES、3DES、SHA1、SHA2、SHA3、RIPEMD等。</p><h1 id="d20e" class="jr js ht bd jt ju jv jw jx jy jz ka kb kc mo ke kf kg mp ki kj kk mq km kn ko dt translated">PKCS 11号——克里托基</h1><p id="28cc" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">PKCS#11是一种加密令牌接口标准，也称为Crytoki，具有一套用于加密、解密、签名生成、签名验证和密钥存储的加密服务。</p><p id="016d" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">PKCS#11是加密硬件设备之间的互操作性标准，它通过统一的API函数抽象出设备差异。并非所有设备都必须使用所有PKCS#11功能，只要不与PKCS#11冲突，它们可以具有附加功能。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff oj"><img src="../Images/53813090ae5f24bdf48e7ba929dd7f28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AcFY6kweAQllDQwc8M1QuA.png"/></div></div></figure><p id="0628" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">基于这个标准，公司创造了他们的功能。以下是AWS生成AES密钥的功能示例:</p><figure class="ln lo lp lq fq iu"><div class="bz el l di"><div class="ok ol l"/></div></figure><h2 id="09ca" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">PKCS#11中使用的对象</h2><p id="e692" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">PKCS#11使用三种类型的对象:密钥(秘密、公开和私有)、证书和数据(DSA/ECDSA参数等)。).Cryptoki不直接操纵这些对象。相反，它使用对象的句柄。</p><p id="d594" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">以下是PKCS#11中签名密钥对象的属性:</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff om"><img src="../Images/e6496cd44d395dcf5b246002497b43e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e9aQ4M1zSNEyBcnTWwGFhQ.png"/></div></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://i.blackhat.com/USA-19/Thursday/us-19-Campana-Everybody-Be-Cool-This-Is-A-Robbery.pdf" rel="noopener ugc nofollow" target="_blank">https://i.blackhat.com/USA-19/Thursday/us-19-Campana-Everybody-Be-Cool-This-Is-A-Robbery.pdf</a></figcaption></figure><p id="2211" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">每个对象都可以访问一个令牌，在令牌内部，它们得到一个插槽(“插件位置”)。该插槽包含加密对象并防止未经授权的访问。如果用户有权访问令牌，则他们只能访问与该令牌相关联的对象。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff on"><img src="../Images/2fd2e2e9fcb51a04c3ea0f173a8d652c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zPkA71LbRn_0QMONxP9bkA.png"/></div></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://i.blackhat.com/USA-19/Thursday/us-19-Campana-Everybody-Be-Cool-This-Is-A-Robbery.pdf" rel="noopener ugc nofollow" target="_blank">https://i.blackhat.com/USA-19/Thursday/us-19-Campana-Everybody-Be-Cool-This-Is-A-Robbery.pdf</a></figcaption></figure><h2 id="244a" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">储存；储备</h2><p id="86ee" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">永久数据存储在PCIe卡上用环氧树脂覆盖的闪存中。它包含一个Linux映像、定制模块、日志和PKCS#11对象。闪存被分区，PKCS#11对象被分开存储。加密密钥存储在外部存储器中。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff oo"><img src="../Images/d542eb725ec6ecda330c5ce0aa350291.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*amojvprhGAEXk_vh9GJUkg.png"/></div></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://i.blackhat.com/USA-19/Thursday/us-19-Campana-Everybody-Be-Cool-This-Is-A-Robbery.pdf" rel="noopener ugc nofollow" target="_blank">https://i.blackhat.com/USA-19/Thursday/us-19-Campana-Everybody-Be-Cool-This-Is-A-Robbery.pdf</a></figcaption></figure><h1 id="c62b" class="jr js ht bd jt ju jv jw jx jy jz ka kb kc mo ke kf kg mp ki kj kk mq km kn ko dt translated">HSM的优势</h1><p id="dc44" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">HSM是弹性设备，可以在极端天气条件、火灾或有人想要篡改您的设备时保护您的密钥。因为它们是硬件解决方案并且具有最高的安全等级，所以没有多少解决方案具有NIST FIPS 130 2级(一些在特定领域具有更高的等级，例如物理安全)。下面是一个标准的快照，告诉我们什么是FIPS水平的HSM合格。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff op"><img src="../Images/6fd788086a96f6f050118c7cd10a01ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HLyiiekB7Njv3s_QzcYr_Q.png"/></div></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://www.youtube.com/watch?v=pKOfiKthalo" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=pKOfiKthalo</a></figcaption></figure><p id="91c7" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">另一个积极的方面是HSM已经存在了几十年。因此，有大量关于HSM最佳实践的知识和几项关于HSM安全性的研究。</p><h1 id="99ff" class="jr js ht bd jt ju jv jw jx jy jz ka kb kc mo ke kf kg mp ki kj kk mq km kn ko dt translated">HSM的漏洞</h1><p id="29d0" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">尽管HSM有很多优点，但没有什么是牢不可破的。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff oq"><img src="../Images/c2e4e825603a974320544aee843e23ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VDGPmY4ZFqQsLdi-"/></div></div></figure><h2 id="9dbd" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated"><strong class="ak">安全网HSM密钥提取漏洞</strong></h2><p id="56c6" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">2015年1月30日，Gemini正在评估AWS使用的Luna G5 HSM，这时他们发现了一个允许提取密钥的漏洞。问题出在露娜的PCIe卡和AWS的云HSM使用的网络设备上。</p><p id="afbe" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">Safenet的问题是，他们使用了几个不可靠的PKCS#11函数，尤其是从密钥中提取密钥(密钥派生)和XOR-base-and-data函数。</p><p id="419f" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated"><strong class="kr hu">从密钥中提取密钥(密钥派生)</strong></p><p id="6d9f" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">密钥派生函数将一个密钥创建为另一个密钥的函数。一个例子是BIP-32，其中一个比特币高清钱包由一个单一种子短语衍生的一系列地址组成。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff or"><img src="../Images/27dad1824e568a0cae7bb2222b2bcfd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7iEUWAch4y6Kvp837eSPdQ.png"/></div></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://www.cryptsoft.com/pkcs11doc/STANDARD/pkcs-11v2-30m1-d7.pdf" rel="noopener ugc nofollow" target="_blank">https://www.cryptsoft.com/pkcs11doc/STANDARD/pkcs-11v2-30m1-d7.pdf</a></figcaption></figure><p id="320b" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">该方案通过从现有密钥中获取一个偏移量和长度的连续比特序列来生成新密钥；它基本上提取一个子串。</p><p id="6cfe" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated"><strong class="kr hu">攻击！</strong></p><p id="1a18" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">我们首先从最高有效位开始，提取2个字节。现在，我们可以使用派生的密钥HMAC选择的消息。给定这个原语，可以用蛮力进行攻击，我们可以通过尝试已知消息/HMAC对的所有可能性来发现短密钥。</p><p id="5fdf" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">现在，我们可以重复，在不同的偏移量处导出另一个短密钥，使用选择的消息攻击进行强力攻击，然后重复，直到所有密钥字节都被恢复。这是全自动的，Luna G5只需要几秒钟，而CloudHSM中使用的更强大的SA7000则需要更少的时间。</p><p id="69f4" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated"><strong class="kr hu">椭圆曲线密钥</strong></p><p id="5ff8" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">这种攻击适用于AES、通用HMAC秘密和椭圆曲线私钥，但不适用于RSA、普通DSA和Diffie Hellman。</p><p id="a47a" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">对于椭圆曲线密钥，截断的字节数组是密钥的秘密标量部分。比特币ECDSA密钥的“秘密”部分的一个例子是secp256k1中的离散对数。在内部，这些离散对数只是存储为一个32字节的标量值，从密钥中提取密钥的方案可用于连续显示该标量值的块。</p><p id="d656" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">有关该漏洞的更多信息可在下面找到:</p><div class="lw lx fm fo ly lz"><a href="https://randomoracle.wordpress.com/2015/08/13/safenet-hsm-key-extraction-vulnerability-part-i/" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hu fv z el me eo ep mf er et hs dt translated">关于Safenet HSM密钥提取漏洞CVE-2015-5464(上)</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">这一系列的文章对我们发现的密钥提取漏洞提供了更深入的解释…</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">randomoracle.wordpress.com</p></div></div><div class="mi l"><div class="os l mk ml mm mi mn iz lz"/></div></div></a></div><p id="2c6c" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">以下是Gemini针对该漏洞发布的公告:</p><div class="lw lx fm fo ly lz"><a href="https://www.gemini.com/blog/your-bitcoin-wallet-may-be-at-risk-safenet-hsm-key-extraction-vulnerability" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hu fv z el me eo ep mf er et hs dt translated">你的比特币钱包可能面临风险:Safenet HSM密钥提取漏洞| Gemini</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">作为下一代比特币交易所，确保比特币在存款上的安全性是双子的重中之重。也许…</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">www.gemini.com</p></div></div><div class="mi l"><div class="ot l mk ml mm mi mn iz lz"/></div></div></a></div><h2 id="b59c" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">莱杰对HSM弱点的分析</h2><p id="8dde" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated"><strong class="kr hu">莱杰如何使用HSMs？</strong></p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div class="fe ff ou"><img src="../Images/a3e88aa4948d95c185e27a7eb0206a5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/0*2La9eQNZJjuL4WNu"/></div></figure><p id="6caa" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">硬件钱包Ledger使用HSMs来确保客户收到的ledger设备是合法的。莱杰必须这样做，因为已经发生了几次黑客攻击，向客户发送虚假设备来窃取他们的加密货币。</p><div class="lw lx fm fo ly lz"><a href="https://www.forbes.com/sites/leemathews/2021/06/18/cybercrooks-are-mailing-users-fake-ledger-devices-to-steal-their-cryptocurrency/?sh=275258e4dbad" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hu fv z el me eo ep mf er et hs dt translated">网络诈骗者正在向用户邮寄伪造的账本设备，窃取他们的加密货币</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">莱杰的硬件钱包是一种非常受欢迎的安全存储加密货币的方式。如此受欢迎，事实上，以至于…</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">www.forbes.com</p></div></div><div class="mi l"><div class="ov l mk ml mm mi mn iz lz"/></div></div></a></div><p id="7a15" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">验证设备的过程称为证明。每次设置或更新账本设备时，连接到HSM的服务器都会向客户的设备发送一个挑战(来自HSM的随机生成的号码),以证明其合法性。如果服务器可以验证签名，它就是有效的。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ow"><img src="../Images/94cf9f11daf41271fc3a1ca875643096.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OlbxOKsUpIBe_xnk.png"/></div></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://www.ledger.com/a-closer-look-into-ledger-security-the-root-of-trust" rel="noopener ugc nofollow" target="_blank">https://www.ledger.com/a-closer-look-into-ledger-security-the-root-of-trust</a></figcaption></figure><div class="lw lx fm fo ly lz"><a href="https://www.ledger.com/a-closer-look-into-ledger-security-the-root-of-trust" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hu fv z el me eo ep mf er et hs dt translated">深入了解分类帐安全性:信任的根源|分类帐</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">在之前的文章中，我们已经仔细研究了安全元素和我们的定制操作系统——BOLOS。这个…</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">www.ledger.com</p></div></div><div class="mi l"><div class="ox l mk ml mm mi mn iz lz"/></div></div></a></div><p id="7ec5" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated"><strong class="kr hu">莱杰对HSM漏洞的研究(大家冷静这是抢劫)</strong></p><p id="2ccc" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">2019年8月8日，莱杰在美国BlackHat会议上发表了关于HSM设备漏洞的演讲。通过他们的研究，他们发现了14个内存损坏漏洞，这些漏洞允许他们远程执行代码，最终泄露设备中的每个密钥。</p><p id="5113" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">他们用于这项研究的HSM设备允许开发人员开发可以在HSM上执行的自定义模块，因此他们创建了一个安装了自定义外壳和调试器的模块。为了使他们的研究自动化，他们使用了一个模糊器，从宿主向HSM发送变异信息。变异的消息导致内核模块崩溃和内存不足问题，从而导致HSM DDoS，因此他们必须过滤消息。</p><p id="4e05" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">他们发现的一个漏洞非常接近心脏出血。</p><blockquote class="oy oz pa"><p id="ada6" class="kp kq pb kr b ks lr ku kv kw ls ky kz pc lt lc ld pd lu lg lh pe lv lk ll jl hm dt translated"><strong class="kr hu">什么是Heartbleed？</strong></p><p id="7457" class="kp kq pb kr b ks lr ku kv kw ls ky kz pc lt lc ld pd lu lg lh pe lv lk ll jl hm dt translated">Heartbleed是一个缓冲区溢出问题，在心跳消息中泄漏了额外的信息，因此得名heartbleed。</p><p id="c645" class="kp kq pb kr b ks lr ku kv kw ls ky kz pc lt lc ld pd lu lg lh pe lv lk ll jl hm dt translated">心跳请求需要下面的命令，其中<strong class="kr hu"> bp </strong>是它要复制到的位置，<strong class="kr hu"> pl </strong>是它要复制的位置，<strong class="kr hu">有效负载</strong>是被复制数据的长度。有效载荷代表有效载荷的存储长度，通常是16位整数。</p><p id="400d" class="kp kq pb kr b ks lr ku kv kw ls ky kz pc lt lc ld pd lu lg lh pe lv lk ll jl hm dt translated"><code class="eh pf pg ph pi b">memcpy(bp, pl, payload);</code></p><p id="bf94" class="kp kq pb kr b ks lr ku kv kw ls ky kz pc lt lc ld pd lu lg lh pe lv lk ll jl hm dt translated">在提供信息之前，应该有一个边界检查来验证输入请求并返回所请求的确切有效负载长度。如果没有进行边界检查，心跳机制会分配一个内存缓冲区，而不进行验证检查。</p><p id="2b04" class="kp kq pb kr b ks lr ku kv kw ls ky kz pc lt lc ld pd lu lg lh pe lv lk ll jl hm dt translated">内存缓冲区是传输中的数据的临时存储，可以包含敏感信息和财务信息、凭证、cookies等。如果分配不当，它可能会在心跳消息中暴露敏感数据。</p></blockquote><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff pj"><img src="../Images/04fc7abee690d8a15dcf19311b866558.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NjTYKXt4ynyC83dM"/></div></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://www.malwarebytes.com/blog/news/2019/09/everything-you-need-to-know-about-the-heartbleed-vulnerability" rel="noopener ugc nofollow" target="_blank">https://www.malwarebytes.com/blog/news/2019/09/everything-you-need-to-know-about-the-heartbleed-vulnerability</a></figcaption></figure><div class="lw lx fm fo ly lz"><a href="https://www.vox.com/2014/6/19/18076318/heartbleed" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hu fv z el me eo ep mf er et hs dt translated">心脏出血虫，解释说</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">2014年，安全研究人员发现了保护网络安全的加密技术SSL的一个严重缺陷。的…</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">www.vox.com</p></div></div><div class="mi l"><div class="pk l mk ml mm mi mn iz lz"/></div></div></a></div><p id="8ea8" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">下面是设置属性值的HSM模块代码。他们在这里发现了一种类似心脏出血的细菌。注意下面传递给malloc的大小和传递给memcpy的大小是不同的。不同的大小会导致复制到属性值的部分数据无法完全初始化。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff pl"><img src="../Images/9ad2a340dff080d3d896173714c33e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HiGccwGbXrIiMb76Z0u3lw.png"/></div></div></figure><p id="2cef" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">利用该漏洞，他们能够暴露HSM的内存缓冲区，下面的输出显示了泄露的管理员密码。</p><figure class="ln lo lp lq fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff pm"><img src="../Images/0055968a231b17c181f497e7a60b42b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8QMUw9ipUQx2PchSZPXDGg.png"/></div></div><figcaption class="ng nh fg fe ff ni nj bd b be z ek">Source: <a class="ae nk" href="https://i.blackhat.com/USA-19/Thursday/us-19-Campana-Everybody-Be-Cool-This-Is-A-Robbery.pdf" rel="noopener ugc nofollow" target="_blank">https://i.blackhat.com/USA-19/Thursday/us-19-Campana-Everybody-Be-Cool-This-Is-A-Robbery.pdf</a></figcaption></figure><p id="c6ac" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">演讲中讨论了更多的漏洞，我强烈建议您查看Ledger在BlackHat上对HSM漏洞的分析。</p><p id="861b" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated"><a class="ae nk" href="https://i.blackhat.com/USA-19/Thursday/us-19-Campana-Everybody-Be-Cool-This-Is-A-Robbery.pdf" rel="noopener ugc nofollow" target="_blank">https://I . black hat . com/USA-19/Thursday/us-19-坎帕纳-every one-Be-Cool-This-Is-A-robbing . pdf</a></p><figure class="ln lo lp lq fq iu"><div class="bz el l di"><div class="pn ol l"/></div></figure><h1 id="ba5a" class="jr js ht bd jt ju jv jw jx jy jz ka kb kc mo ke kf kg mp ki kj kk mq km kn ko dt translated">这个故事的寓意</h1><p id="7c55" class="pw-post-body-paragraph kp kq ht kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jl hm dt translated">HSM设备高度安全，目前被全球一些最大的机构所使用。但是世界在发展，黑客变得越来越聪明，最终，HSM将不再是牢不可破的。</p><p id="c0d2" class="pw-post-body-paragraph kp kq ht kr b ks lr ku kv kw ls ky kz la lt lc ld le lu lg lh li lv lk ll jl hm dt translated">我们需要停止将HSMs视为密钥管理的解决方案，而更像是管理密钥的工具。未来，组织将需要开发分层的方法和流程来更好地保护其HSM设备。</p><h1 id="8aeb" class="jr js ht bd jt ju jv jw jx jy jz ka kb kc mo ke kf kg mp ki kj kk mq km kn ko dt translated">如果你喜欢这个帖子，那么你可以请我喝咖啡，先谢谢你了！</h1><figure class="ln lo lp lq fq iu fe ff paragraph-image"><a href="https://www.buymeacoffee.com/mindegg"><div class="fe ff po"><img src="../Images/a1233cad962cc6f028e9c77a539e1db6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*potoHNl5y6ETEioG.png"/></div></a></figure><h1 id="5562" class="jr js ht bd jt ju jv jw jx jy jz ka kb kc mo ke kf kg mp ki kj kk mq km kn ko dt translated">痴迷？潜得更深</h1><h2 id="5295" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">云HSM最佳实践—谷歌</h2><figure class="ln lo lp lq fq iu"><div class="bz el l di"><div class="pn ol l"/></div></figure><h2 id="a816" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">让HSM变得经济实惠的开放项目— CrypTech Alpha</h2><div class="lw lx fm fo ly lz"><a href="https://www.crowdsupply.com/cryptech/open-hardware-security-module" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hu fv z el me eo ep mf er et hs dt translated">密码技术阿尔法</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">安全和隐私CrypTech Alpha是一个独立的原型密钥存储和硬件加密平台…</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">www.crowdsupply.com</p></div></div><div class="mi l"><div class="pp l mk ml mm mi mn iz lz"/></div></div></a></div><h2 id="0288" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">HSM用例—密码数学</h2><div class="lw lx fm fo ly lz"><a href="https://www.cryptomathic.com/news-events/blog/key-management-and-use-cases-for-hsms" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hu fv z el me eo ep mf er et hs dt translated">HSMs的关键管理和使用案例</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">电子商务的兴起使企业组织和银行能够更容易地扩展其业务和服务…</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">www.cryptomathic.com</p></div></div></div></a></div><h2 id="f8cb" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">加密密钥管理基础知识权威指南— Townsend Security</h2><div class="lw lx fm fo ly lz"><a href="https://info.townsendsecurity.com/definitive-guide-to-encryption-key-management-fundamentals" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hu fv z el me eo ep mf er et hs dt translated">加密密钥管理基础的权威指南</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">回到顶部NIST将加密密钥生命周期定义为运行前、运行中、运行后…</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">info.townsendsecurity.com</p></div></div><div class="mi l"><div class="pq l mk ml mm mi mn iz lz"/></div></div></a></div><h2 id="9887" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">关于逆转和利用FIPS 140–2 HSM固件的演示——BRX侦察2017 (Fotis Loukos)</h2><figure class="ln lo lp lq fq iu"><div class="bz el l di"><div class="pr ol l"/></div></figure><h2 id="f565" class="mr js ht bd jt ms mt mu jx mv mw mx kb la my mz kf le na nb kj li nc nd kn ne dt translated">棒极了PKI</h2><div class="lw lx fm fo ly lz"><a href="https://github.com/viralpoetry/awesome-pki" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hu fv z el me eo ep mf er et hs dt translated">GitHub - viralpoetry/awesome-pki:文章、手册、研究论文、博客、视频的集合…</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">与公钥相关的文章、手册、研究论文、博客、视频和软件的集合…</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">github.com</p></div></div><div class="mi l"><div class="ps l mk ml mm mi mn iz lz"/></div></div></a></div><blockquote class="jb"><p id="6921" class="jc jd ht bd je jf jg jh ji jj jk jl ek translated">交易新手？试试<a class="ae nk" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae nk" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>