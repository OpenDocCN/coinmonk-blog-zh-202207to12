<html>
<head>
<title>CSC101- Time-Based Smart Contract</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CSC101-基于时间的智能合同</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/csc101-time-based-smart-contract-79ebde37d811?source=collection_archive---------29-----------------------#2022-12-01">https://medium.com/coinmonks/csc101-time-based-smart-contract-79ebde37d811?source=collection_archive---------29-----------------------#2022-12-01</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="0973" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有时你可能需要在特定的时间运行一个功能或事件。这里我们利用可靠性引入基于时间的智能合同。在本教程中，我们将研究基于时间的事件及其通过solidity的实现。这是基于时间的智能合约(如授权合约)中使用的方法之一。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/78db353f85d00a7149d8bc2b6bc3c9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nYib8N6wIy-Papn96wyEKg.png"/></div></div></figure><h2 id="f3ba" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">与时间一起工作</h2><p id="b34a" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">在solidity中，我们使用整数来存储Unix时间格式的时间。看看下面的智能合同。</p><pre class="jp jq jr js fq la lb lc bn ld le bi"><span id="f8eb" class="lf kb ht lb b be lg lh l li lj">// SPDX-License-Identifier: GPL-2.0<br/>pragma solidity ^0.8.10;<br/><br/>contract Time{<br/><br/>    uint public Time;<br/><br/>    constructor(uint _Time){<br/>        Time = _Time;<br/>    }<br/><br/>    function getCurrentTime()public view returns(uint){<br/>        return block.timestamp;<br/>    }<br/><br/>}</span></pre><ul class=""><li id="bff4" class="lk ll ht is b it iu ix iy jb lm jf ln jj lo jn lp lq lr ls dt translated">我们使用类型单元(无符号整数)来存储Unix时间戳。</li><li id="217b" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated">在solidity中，<strong class="is hu"> block.timestamp </strong>给出当前时间。我们可以通过调用<strong class="is hu"> getCurrentTime()来验证这一点。</strong></li><li id="d2cf" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated">我们还可以使用Unix时间格式执行不同的操作，如<strong class="is hu">=</strong>、<strong class="is hu"> ≤ </strong>、<strong class="is hu"> ≥ </strong>。</li></ul><p id="7b8d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">坚固性提供了一些处理时间的原生单位。我们可以使用以下单位:<code class="eh ly lz ma lb b">seconds</code>、<code class="eh ly lz ma lb b">minutes</code>、<code class="eh ly lz ma lb b">hours</code>、<code class="eh ly lz ma lb b">days</code>、<code class="eh ly lz ma lb b">weeks</code>、<code class="eh ly lz ma lb b">years</code>。这些单位将转换成特定时间长度<strong class="is hu">中的秒数的<code class="eh ly lz ma lb b">uint</code>。</strong>比如<code class="eh ly lz ma lb b">1 minutes</code>是60，1小时是3600 (60秒x 60分钟)等等。</p><pre class="jp jq jr js fq la lb lc bn ld le bi"><span id="cf70" class="lf kb ht lb b be lg lh l li lj">uint a = 3 hours; //  10800 or 3*60*60<br/>uint b = 5 minutes // 300 or 5*60<br/>uint d = 2 weeks // 1209600 or 2*7*24*60*60</span></pre><p id="e268" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这些单元对于在智能合约中处理日期和时间非常有用，因为它们允许我们使用像<code class="eh ly lz ma lb b">+</code>和<code class="eh ly lz ma lb b">-</code>这样的数学运算符。</p><h2 id="9b1e" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">检查时间是否已过</h2><p id="64d4" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">下面的代码显示了如何检查自合同部署以来是否已经过了10分钟:</p><pre class="jp jq jr js fq la lb lc bn ld le bi"><span id="258b" class="lf kb ht lb b be lg lh l li lj">pragma solidity &gt;=0.8.10;<br/><br/>contract MyContract {<br/>  uint deployDate;<br/>  constructor(){<br/>    deployDate = now;<br/>  }<br/>  // Will return `true` if 10 minutes have passed since `the contract was deployed<br/>  function tenMinutesHavePassed() public view returns (bool) {<br/>    return (now &gt;= (deployDate + 10 minutes));<br/>  }<br/>}</span></pre><h2 id="4edf" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">添加和休息日</h2><p id="be1b" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">我们可以使用任何时间单位的数学运算符<code class="eh ly lz ma lb b">+</code>和<code class="eh ly lz ma lb b">-</code>来计算具体日期:</p><pre class="jp jq jr js fq la lb lc bn ld le bi"><span id="7903" class="lf kb ht lb b be lg lh l li lj">uint date = 1638352800; // 2012-12-01 10:00:00<br/>uint later = date + 1 days;<br/>uint nextYear = date + 1 years;<br/>uint before = date - 3 days;<br/>uint prevWeek = date - 1 weeks;</span></pre><h2 id="369a" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">相对时间</h2><p id="7801" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">为了演示如何利用时间来影响交易处理，我将开发一个智能合同来帮助我在指定的时间段内省钱。那段时间，我(或者其他任何人！)可以在合同里存乙醚，但是合同不让我提取任何乙醚，直到等待期结束。</p><p id="ebcf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">坚固性有内置的“时间单位”。例如，我可以指定<code class="eh ly lz ma lb b">3 days</code>或<code class="eh ly lz ma lb b">5 years</code>。储蓄合同将以天数指定的等待期为参数。因为EVM自然地以秒为单位存储时间，所以契约必须用一天中的秒数来衡量等待时间，这是由Solidity中的字面<code class="eh ly lz ma lb b">1 days</code>给出的。</p><pre class="jp jq jr js fq la lb lc bn ld le bi"><span id="285b" class="lf kb ht lb b be lg lh l li lj">pragma solidity ^0.8.10;<br/><br/>contract Time{<br/>    address owner;<br/>    uint256 deadline;<br/>    modifier onlyOwner() {<br/>        require(msg.sender == owner);<br/>        _;<br/>    }<br/>    function deposit(uint256 amount) public payable {<br/>        require(msg.value == amount);<br/>    }<br/>    function Savings(uint256 numberOfDays) public payable {<br/>        owner = msg.sender;<br/>        deadline = now + (numberOfDays * 1 days);<br/>    }<br/>    function withdraw() public onlyOwner {<br/>        require(now &gt;= deadline);<br/>        msg.sender.transfer(address(this).balance);<br/>    }<br/>}</span></pre><p id="67a0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上面的代码演示了以下新概念:</p><ul class=""><li id="01ed" class="lk ll ht is b it iu ix iy jb lm jf ln jj lo jn lp lq lr ls dt translated"><code class="eh ly lz ma lb b">(numberOfDays * 1 days)</code>以秒为单位计算<code class="eh ly lz ma lb b">numberOfDays</code>天的时间。</li><li id="0b17" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated"><code class="eh ly lz ma lb b">now + (numberOfDays * 1 days)</code>计算代表未来<code class="eh ly lz ma lb b">numberOfDays</code>天的EVM时间。</li><li id="6323" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated"><code class="eh ly lz ma lb b">now &gt;= deadline</code>测试当前时间是否大于或等于<code class="eh ly lz ma lb b">deadline</code>。(即，截止日期是否已过？)</li></ul><p id="dde2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">储蓄合同由不允许提款的天数参数化。在此期间，任何<code class="eh ly lz ma lb b">withdraw</code>交易都会失败。这段时间过后，取款将会成功。</p><p id="ed07" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">任何时候都允许存款。还要注意，构造函数有<code class="eh ly lz ma lb b">payable</code>修饰符，它允许在部署期间将ether附加(和转移)到契约上。</p><ul class=""><li id="d7f4" class="lk ll ht is b it iu ix iy jb lm jf ln jj lo jn lp lq lr ls dt translated">区块链中的每个块都包括一个时间戳，该时间戳被指定为自Unix纪元以来的秒数。时间值是整数。</li><li id="e5d4" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated">Solidity smart contracts可以访问当前块的时间戳作为<code class="eh ly lz ma lb b">now</code>或<code class="eh ly lz ma lb b">block.timestamp</code>。</li><li id="1618" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated">Solidity提供了方便的时间单位，如<code class="eh ly lz ma lb b">days</code>和<code class="eh ly lz ma lb b">years</code>，这有助于计算时间跨度。</li></ul><blockquote class="mb"><p id="fa5b" class="mc md ht bd me mf mg mh mi mj mk jn ek translated">交易新手？尝试<a class="ae ml" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae ml" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p><p id="debb" class="mc md ht bd me mf mm mn mo mp mq jn ek translated">加入Coinmonks <a class="ae ml" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae ml" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae ml" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="ka kb ht bd kc kd mr kf kg kh ms kj kk jb mt km kn jf mu kp kq jj mv ks kt ku dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="lk ll ht is b it kv ix kw jb mw jf mx jj my jn lp lq lr ls dt translated"><a class="ae ml" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae ml" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated"><a class="ae ml" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae ml" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated"><a class="ae ml" rel="noopener" href="/coinmonks/top-3-telegram-channels-for-crypto-traders-in-2021-8385f4411ff4">密码电报信号</a> | <a class="ae ml" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated"><a class="ae ml" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae ml" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated"><a class="ae ml" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">开发者最佳加密API</a></li><li id="b359" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated">最佳<a class="ae ml" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="3c98" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated"><a class="ae ml" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae ml" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9487" class="lk ll ht is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls dt translated">杠杆代币的终极指南</li></ul></div></div>    
</body>
</html>