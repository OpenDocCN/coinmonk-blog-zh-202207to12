<html>
<head>
<title>Tutorial: Blockchain Transaction Retrieval</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:区块链交易检索</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/tutorial-blockchain-transaction-retrieval-601875014a7e?source=collection_archive---------25-----------------------#2022-08-26">https://medium.com/coinmonks/tutorial-blockchain-transaction-retrieval-601875014a7e?source=collection_archive---------25-----------------------#2022-08-26</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="d445" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">使用Python、SQL和Google BigQuery提取区块链上的特定事务</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/f15980303f66191c2bc1f3ece242c478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a2SMZgkE0e4REt_y"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Photo by <a class="ae jy" href="https://unsplash.com/@theshubhamdhage?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">GuerrillaBuzz Crypto PR</a> on <a class="ae jy" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fe70" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">你有没有想过使用区块链交易来生成你自己的分析，但不知道在哪里以及如何提取它们？</p><p id="85db" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">那么，这篇文章以教程的形式给出了一个可能的解决方案，可以很容易地根据您未来的密码学习的需要进行调整。</p><h1 id="5ebb" class="kv kw ht bd kx ky kz la lb lc ld le lf iz lg ja lh jc li jd lj jf lk jg ll lm dt translated"><strong class="ak"> 1。要求:</strong></h1><p id="25c4" class="pw-post-body-paragraph jz ka ht kb b kc ln iu ke kf lo ix kh ki lp kk kl km lq ko kp kq lr ks kt ku hm dt translated">为了遵循教程，你需要满足两个要求。更准确地说，您应该:</p><ul class=""><li id="7915" class="ls lt ht kb b kc kd kf kg ki lu km lv kq lw ku lx ly lz ma dt translated">一个谷歌账户(使用谷歌Colab和BigQuery)</li><li id="188e" class="ls lt ht kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">SQL知识</li></ul><h1 id="0377" class="kv kw ht bd kx ky kz la lb lc ld le lf iz lg ja lh jc li jd lj jf lk jg ll lm dt translated">2.连接到您的Google帐户:</h1><p id="f9d7" class="pw-post-body-paragraph jz ka ht kb b kc ln iu ke kf lo ix kh ki lp kk kl km lq ko kp kq lr ks kt ku hm dt translated">在您处理完需求之后，您可以继续打开一个新的Google Colab笔记本。我使用Google Colab而不是Jupyter的原因是它更容易连接到Google BigQuery，这是一个存储数据的平台。接下来，所需的包已经安装好了，所以只需要导入它们，如下所示。</p><pre class="jj jk jl jm fq mg mh mi mj aw mk dt"><span id="3971" class="ml kw ht mh b fv mm mn l mo mp">from google.colab import auth<br/>from google.cloud import bigquery</span></pre><p id="ace1" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">通过调用下面的代码，您允许笔记本访问您的Google Cloud数据。</p><pre class="jj jk jl jm fq mg mh mi mj aw mk dt"><span id="2453" class="ml kw ht mh b fv mm mn l mo mp">auth.authenticate_user()</span></pre><p id="1092" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">运行之后，会出现一个如下图所示的弹出窗口。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mq"><img src="../Images/07629c655756e645b449f68432d37d39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D05I2JtfmgErrD5TbtkhuQ.png"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Fig. 1— Pop-up window 1</figcaption></figure><p id="250a" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">按下<code class="eh mr ms mt mh b">Allow</code>，您将被引导至一个页面，在该页面上您可以选择想要使用的Google帐户。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff mu"><img src="../Images/02d2e9e076d5ca3d2ce43bffde299255.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*ibk0KuYB7TYM81O_mC6c9A.png"/></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Fig. 2— Pop-up window 2</figcaption></figure><p id="87d0" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">如果一切顺利，你的笔记本应该有权限访问你的谷歌账户。</p><h1 id="126e" class="kv kw ht bd kx ky kz la lb lc ld le lf iz lg ja lh jc li jd lj jf lk jg ll lm dt translated">3.创建和连接谷歌云项目:</h1><p id="59ca" class="pw-post-body-paragraph jz ka ht kb b kc ln iu ke kf lo ix kh ki lp kk kl km lq ko kp kq lr ks kt ku hm dt translated">此时，需要一个Google Cloud项目，它可以很容易地在Google Cloud仪表板中创建。如果你在这方面需要任何帮助，看看谷歌的<a class="ae jy" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects" rel="noopener ugc nofollow" target="_blank">官方文档。</a></p><p id="2d4e" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">最后，新创建的项目的ID在下面的单元格中使用，以允许您的笔记本访问该项目的BigQuery环境。</p><pre class="jj jk jl jm fq mg mh mi mj aw mk dt"><span id="e045" class="ml kw ht mh b fv mm mn l mo mp">project_id = 'clever-arcadia-342004' #use your own project_id<br/>client = bigquery.Client(project=project_id)</span></pre><h1 id="bbab" class="kv kw ht bd kx ky kz la lb lc ld le lf iz lg ja lh jc li jd lj jf lk jg ll lm dt translated">4.选择适当的表格:</h1><p id="e732" class="pw-post-body-paragraph jz ka ht kb b kc ln iu ke kf lo ix kh ki lp kk kl km lq ko kp kq lr ks kt ku hm dt translated">最初，您需要选择要从中提取事务的区块链。在教程里，我用的是比特币。然而，在撰写本文时(2022年8月)，BigQuery还提供比特币现金(BCH)、以太坊(ETH)、以太坊经典(ETC)、Dash (DASH)、Dogecoin (DOGE)、Litecoin (LTC)和ZCash (ZEC)。之后，您只需将“crypto_bitcoin”替换为“crypto_”以及您在以下单元格的代码中选择的区块链(即“crypto_ethereum_classic”、“crypto_dash”等)。</p><pre class="jj jk jl jm fq mg mh mi mj aw mk dt"><span id="502c" class="ml kw ht mh b fv mm mn l mo mp">dataset_ref = client.dataset('crypto_bitcoin', project='bigquery-public-data')<br/>dataset = client.get_dataset(dataset_ref)<br/>table_ref = dataset.table('transactions')<br/>table = client.get_table(table_ref)</span></pre><h1 id="19c2" class="kv kw ht bd kx ky kz la lb lc ld le lf iz lg ja lh jc li jd lj jf lk jg ll lm dt translated">5.查询交易:</h1><p id="b598" class="pw-post-body-paragraph jz ka ht kb b kc ln iu ke kf lo ix kh ki lp kk kl km lq ko kp kq lr ks kt ku hm dt translated">现在，您已经准备好开始查询事务了。为此，您需要了解一些SQL，就像开头提到的那样。为了简单起见，我检索了比特币分类账上的前10笔交易。您还负责选择您想要获取的字段。在我的例子中，我选择了块的时间戳、涉及的地址、转移的值和费用。</p><pre class="jj jk jl jm fq mg mh mi mj aw mk dt"><span id="e2d4" class="ml kw ht mh b fv mm mn l mo mp">N = 10 * 2 # multipled by 2 because BTC transactions are first sending the total amount held by the sender and then the sender receives the change back in another transaction</span><span id="ed59" class="ml kw ht mh b fv mv mn l mo mp">query = """ SELECT block_timestamp, inputs.addresses, outputs.addresses, outputs.value, fee</span><span id="6f7a" class="ml kw ht mh b fv mv mn l mo mp">FROM `bigquery-public-data.crypto_bitcoin.transactions` AS transactions, transactions.outputs as outputs, transactions.inputs as inputs</span><span id="7e85" class="ml kw ht mh b fv mv mn l mo mp">WHERE transactions.block_timestamp_month = "2009-01-01"</span><span id="4974" class="ml kw ht mh b fv mv mn l mo mp">LIMIT """ + str(N)</span><span id="3bfd" class="ml kw ht mh b fv mv mn l mo mp"><br/>query_job = client.query(query)</span></pre><h1 id="fcac" class="kv kw ht bd kx ky kz la lb lc ld le lf iz lg ja lh jc li jd lj jf lk jg ll lm dt translated">6*.解析Pandas数据帧中的结果</h1><p id="d684" class="pw-post-body-paragraph jz ka ht kb b kc ln iu ke kf lo ix kh ki lp kk kl km lq ko kp kq lr ks kt ku hm dt translated">或者，您可以在Pandas数据框架中解析查询结果，如下面的代码所示。</p><pre class="jj jk jl jm fq mg mh mi mj aw mk dt"><span id="500b" class="ml kw ht mh b fv mm mn l mo mp">import pandas as pd</span><span id="7cf6" class="ml kw ht mh b fv mv mn l mo mp">dates = list()<br/>senders = list()<br/>receivers = list()<br/>amounts = list()<br/>fees = list()</span><span id="ff4d" class="ml kw ht mh b fv mv mn l mo mp">i = 0<br/>for row in query_job:<br/>  if (row[1][0]!=row[2][0]):<br/>    dates.append(row[0])<br/>    senders.append(row[1][0])<br/>    receivers.append(row[2][0])<br/>    amounts.append(row[3])<br/>    fees.append(row[4])<br/>  i+=1</span><span id="64e1" class="ml kw ht mh b fv mv mn l mo mp">df = pd.DataFrame({‘Date’: dates, ‘Sender’: senders, ‘Receiver’: receivers, ‘Amount’: amounts, ‘Fees’:fees})</span></pre><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mw"><img src="../Images/b825d8f8baf07b1d88e558d73fd774ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_gdK5y_9HpLN4te9o7tc6g.png"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Fig. 3 — Resulted DataFrame</figcaption></figure><h2 id="4aae" class="ml kw ht bd kx mx my mz lb na nb nc lf ki nd ne lh km nf ng lj kq nh ni ll nj dt translated">现在您知道了如何从您最喜欢的区块链中检索交易，并在您的分析中使用它们！</h2><p id="d365" class="pw-post-body-paragraph jz ka ht kb b kc ln iu ke kf lo ix kh ki lp kk kl km lq ko kp kq lr ks kt ku hm dt translated">如果你想看完整的代码或者下载笔记本，可以在我的<a class="ae jy" href="https://github.com/dragos-pop/Crypto/blob/main/Blockchain-Txn-Retrieval/Demo-BTC.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div><div class="ab cl nk nl hb nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="hm hn ho hp hq"><p id="029a" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">感谢您的宝贵时间！</p><p id="7d4f" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">如果你喜欢读这篇文章，请给它一个掌声，并关注更多的密码相关的文章！</p><blockquote class="nr"><p id="04c3" class="ns nt ht bd nu nv nw nx ny nz oa ku ek translated">交易新手？试试<a class="ae jy" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a>或者<a class="ae jy" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>