<html>
<head>
<title>Learn Solidity lesson 11. Creating and interacting with a contract.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习第11课坚固性。创建合同并与之交互。</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/learn-solidity-lesson-11-creating-and-interacting-with-a-contract-18ce50879063?source=collection_archive---------1-----------------------#2022-07-30">https://medium.com/coinmonks/learn-solidity-lesson-11-creating-and-interacting-with-a-contract-18ce50879063?source=collection_archive---------1-----------------------#2022-07-30</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/b624ccf101b0b7f7392f7c11c3403079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gcEup4f0JSNrQY704zVmIw.jpeg"/></div></div></figure><p id="cb35" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在这节课中，我们将使用我们已经学过的材料来写一份智能合同。然后，我们将部署到一个以太坊测试网络，如Goerli，并使用一个块浏览器来验证和交互合同。</p><p id="ea39" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">假设有人想把他们的意愿放在区块链上，为此他们会为它写一个聪明的契约。这个人打算只把钱留给别人作为遗产。因此，这个人需要在契约中存储的所有信息就是一个将姓名与值相关联的变量，如下所示:对于Ana，这个人将留下100美元。对于鲍勃，这个人会留下80美元。对于汤姆，这个人会留下120美元。诸如此类。</p><p id="2f23" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这个变量的类型必须是<code class="eh jz ka kb kc b">mapping</code>，因为映射将值(留给继承人的值)与键(继承人的名字)相关联。这个名为<code class="eh jz ka kb kc b">inheritance</code>的变量创建如下。</p><pre class="kd ke kf kg fq kh kc ki kj aw kk dt"><span id="5bb7" class="kl km ht kc b fv kn ko l kp kq">mapping(string =&gt; uint) inheritance;</span></pre><p id="e59c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">注意，在创建变量时，我们没有指明它的可见性，所以它采用了它的默认值:<em class="kr"> internal </em>。因此，变量<code class="eh jz ka kb kc b">inheritance</code>不能从外部访问。</p><p id="59ed" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们需要创建一个函数来添加新的继承人。也就是说，向映射添加新的键/值对的函数。这可以通过下面的函数来实现。</p><pre class="kd ke kf kg fq kh kc ki kj aw kk dt"><span id="53a3" class="kl km ht kc b fv kn ko l kp kq">function addHeir(string memory _name, uint _value) public {<br/>   inheritance[_name] = _value;<br/>}</span></pre><p id="cccf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">函数<code class="eh jz ka kb kc b">addHeir </code>有两个参数，一个类型为<em class="kr">字符串</em>，另一个类型为<em class="kr"> uint </em>。记住，在字符串的情况下，我们需要指定变量在内存中。关于这一点我们将在另一节课中解释。</p><p id="3998" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">该函数具有公共可见性，因为我们希望它能够被外部调用。函数体只包含一条语句，它将新值(<code class="eh jz ka kb kc b">_value</code>)关联到新键(<code class="eh jz ka kb kc b">_name</code>)。如果键已经存在，它将改变它的值。</p><p id="6bbb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了检索关于继承的信息，必须创建第二个函数，即读取变量<code class="eh jz ka kb kc b">inheritance</code>。这个函数必须接收一个密钥并返回密钥的值。</p><pre class="kd ke kf kg fq kh kc ki kj aw kk dt"><span id="674f" class="kl km ht kc b fv kn ko l kp kq">function recoverInheritance(string memory _name) public view returns (uint) {<br/>   return inheritance[_name];<br/>}</span></pre><p id="dab2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">上述函数只有一个参数，即键，并返回与该键相关联的值。为了读取映射的<em class="kr">类型的变量，我们使用语法<strong class="jd hu">变量[key] </strong>。在我们这里，<code class="eh jz ka kb kc b">inheritance[_name]</code>。</em></p><p id="9473" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">该函数必须是公共的，以便从外部调用。可变性修饰符<em class="kr">视图</em>用于向编译器表明该函数不会改变区块链的世界状态。</p><p id="cd1f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果我们将变量<code class="eh jz ka kb kc b">inheritance</code>定义为public，上面的函数可以省略。当我们这样做时，编译器为我们创建了一个与上面一模一样的函数，目的是检索变量值。</p><p id="5c74" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">完整的合同可以在下面找到。</p><pre class="kd ke kf kg fq kh kc ki kj aw kk dt"><span id="964c" class="kl km ht kc b fv kn ko l kp kq">pragma solidity ^0.8.7;</span><span id="7b05" class="kl km ht kc b fv ks ko l kp kq">contract Inheritance {<br/>   mapping(string =&gt; uint) inheritance;</span><span id="a664" class="kl km ht kc b fv ks ko l kp kq">   function addHeir(string memory _name, uint _value) public {<br/>      inheritance[_name] = _value;<br/>   }</span><span id="e926" class="kl km ht kc b fv ks ko l kp kq">   function recoverInheritance(string memory _name) public view returns (uint) {<br/>      return inheritance[_name];<br/>   }<br/>}</span></pre><p id="6096" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们可以将它部署到Remix虚拟机上。之后，可以调用创建的两个函数，如下图所示。</p><figure class="kd ke kf kg fq iu fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/a22812a7028ce07fd779a06b2df3d469.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*Xot7wROu2NKR7LcY0Jj9CA.png"/></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">Public functions can be invoked externally.</figcaption></figure><p id="af4e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">函数<code class="eh jz ka kb kc b">recoverInheritance</code>不会改变区块链的状态，所以它可以被调用。函数<code class="eh jz ka kb kc b">addHeir</code>改变了一个状态变量，因此只能通过事务调用。</p><h1 id="a270" class="ky km ht bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">在测试网上部署</h1><p id="f73e" class="pw-post-body-paragraph jb jc ht jd b je lv jg jh ji lw jk jl jm lx jo jp jq ly js jt ju lz jw jx jy hm dt translated">在上一课中，我们在浏览器中安装了MetaMask，因此现在我们可以部署到真实的区块链。我会把它部署到格利。为此，我们需要通过水龙头获得的格利醚。</p><p id="c00d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在Goerli上部署合同就像在本地部署一样简单。只需将环境选项改为<em class="kr">注入提供者—元掩码</em>，如下图所示。</p><figure class="kd ke kf kg fq iu fe ff paragraph-image"><div class="fe ff ma"><img src="../Images/9bb333cc3290ce5d324b80fff63a2efc.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*SZTyAcsbgDPkywgofH8rXw.png"/></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">In ENVIRONMENT, change the option to Injected Provider — Metamask.</figcaption></figure><p id="028b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，当您单击<em class="kr"> Deploy </em>按钮时，MetaMask应该会打开，询问您是确认还是拒绝交易。我们可以在下图中看到这一点。</p><figure class="kd ke kf kg fq iu fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/3c84850cb4f4551cee0c3cb53b6c9c3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*55nO4Pv7CgzRLixPC43yTA.png"/></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">We must confirm or reject the transaction on MetaMask.</figcaption></figure><p id="acb0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在用您的私钥签署任何交易(或签署任何东西)之前，MetaMask将要求您确认这样的请求。</p><p id="1805" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们记住程序。Remix编写了部署契约的事务，并发送给MetaMask进行签名。既然是交易，就需要签名，Remix没有权限访问你的私钥。一旦您确认了请求，MetaMask将对其进行签名，并将其发送到网络中的一个节点，这是在MetaMask中配置的。</p><p id="9929" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">确认交易后，Remix将以与本地部署相同的方式进行。确认后，事务将显示在调试区域，如下图所示。</p><figure class="kd ke kf kg fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mc"><img src="../Images/9a9f037d1baaac971aa1a91b179ebdc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lP9DRB6uG0Y52eead7OhIQ.png"/></div></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">Transaction submission is confirmed by Remix.</figcaption></figure><p id="b77c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">请注意，在etherscan 上的调试区域中有一个名为<em class="kr">视图的链接。通过此链接，用户可以在块浏览器中查看事务。我们将在下面看到什么是块浏览器。之前，我只想指出，Remix将创建一个与契约交互的环境，正如它在本地部署中所做的那样，显示了两个可调用的函数</em></p><p id="891a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">唯一的区别是，现在，当调用一个作为事务的函数时，需要在MetaMask中确认该事务，以便它用您的私钥对它进行签名。</p><h1 id="027b" class="ky km ht bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">块浏览器</h1><p id="7f65" class="pw-post-body-paragraph jb jc ht jd b je lv jg jh ji lw jk jl jm lx jo jp jq ly js jt ju lz jw jx jy hm dt translated">一个<strong class="jd hu">区块浏览器</strong>是一个网站(或任何环境)，允许用户查看关于区块链、其区块和其交易的信息。</p><p id="ac62" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">以太坊网络最著名的block explorer是<a class="ae md" href="http://etherscan.io" rel="noopener ugc nofollow" target="_blank"> etherscan.io </a>，歌力思网络的block explorer可以在goerli.etherscan.io/的<a class="ae md" href="http://goerli.etherscan.io/" rel="noopener ugc nofollow" target="_blank">访问。</a></p><p id="95a2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在下图中，我们看到了在Goerli网络的block explorer中生成合同部署的事务。</p><figure class="kd ke kf kg fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff me"><img src="../Images/a5c69bdb4f9d9990a0c5ec7e97e01c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KkleJzsaM0lpphy8TIRSyQ.jpeg"/></div></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">The transaction in the block explorer.</figcaption></figure><p id="d8a2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在本节中，我们将学习如何在block explorer中验证契约并与之交互，类似于我们使用Remix所做的。</p><p id="4161" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要验证合同并查看有关合同的其他信息，请访问地址<strong class="jd hu">goerli . ethers can . io/address/【合同地址】</strong>，或在页面右上角的搜索栏中搜索合同地址。我的网址是goer Li . ethers can . io/address/0xb 383 C4 ad 3 e 327d 13 a 571956 ca 0061051 e 3167112。</p><figure class="kd ke kf kg fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mf"><img src="../Images/72e152bd05c59254f9d963bc9a1aa696.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-T_KY7J-C0qutYiqn9lXuw.png"/></div></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">Click the Contract tab to see information about the contract code.</figcaption></figure><p id="ba87" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">因为契约还没有被验证，所以只显示它的字节码。为了让块浏览器显示用Solidity编写的合同代码，必须对其进行验证。注意在句子<em class="kr">‘您是合同创建者吗？立即验证并发布您的合同源代码！</em>。点击<em class="kr">验证并发布</em>。</p><p id="70a0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">单击该链接时，将打开一个表单，其中包含一些可供选择的选项。在<em class="kr">中，请选择编译器类型</em>，选择<em class="kr"> Solidity —单个文件</em>，因为我们的整个合同包含在一个文件中。在<em class="kr">请选择编译器版本</em>中，您必须选择Remix使用的编译器版本。如果你不记得，检查Remix的<em class="kr"> Solidity编译器</em>标签，如下图所示。</p><figure class="kd ke kf kg fq iu fe ff paragraph-image"><div class="fe ff mg"><img src="../Images/d502628c579ac315c2be1aadd98d0bc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*SOY0UmexJWACeMY1C66Pcg.png"/></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">The tab <em class="mh">Solidity Compiler </em>indicates which compiler version was used to compile the contract.</figcaption></figure><p id="2706" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您还必须为合同选择一个许可证，但此选择不会影响验证。</p><p id="edb2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">点击继续，在下一页的标题为<em class="kr">的字段中粘贴合同代码，在</em>下方输入实体合同代码。因为这个契约没有构造函数，所以我们只需要验证这个契约。</p><p id="e691" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">勾选复选框以证明你不是机器人(我假设你不是机器人)，然后点击<em class="kr">验证并发布</em>按钮。下一次您访问上面的同一个地址时，块浏览器将显示可靠的契约代码，而不仅仅是它的字节码。这一点可以从下图中看出。</p><figure class="kd ke kf kg fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mi"><img src="../Images/59ed291e5b6f6bb79aaed6fb997b0d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auYujxilRhlmmeM3P7LO5A.png"/></div></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">Once verified, the Solidity code is displayed.</figcaption></figure><p id="5525" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">一旦通过验证，还可以通过块浏览器与合同进行交互。</p><h1 id="2a42" class="ky km ht bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">使用块管理器与合同交互</h1><p id="839f" class="pw-post-body-paragraph jb jc ht jd b je lv jg jh ji lw jk jl jm lx jo jp jq ly js jt ju lz jw jx jy hm dt translated">当我们使用Remix与契约进行交互时，Remix负责编写事务并发送给MetaMask进行签名。块资源管理器也能够写入事务，如下图所示。</p><figure class="kd ke kf kg fq iu fe ff paragraph-image"><div class="fe ff mj"><img src="../Images/92dffa6c87fce89aacfc6d164d8401b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*_pyscMTXxlSFLfiVj4Yr9Q.png"/></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">Interacting with the contract in the block explorer.</figcaption></figure><p id="c875" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要连接到MetaMask(或任何其他钱包)，您需要点击<em class="kr">连接到Web3 </em>。一旦连接到元掩码，只需填写功能字段并点击<em class="kr">写</em>按钮。</p><p id="f8b8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">元掩码将再次被触发，您需要确认交易。记住:<strong class="jd hu">每次MetaMask要签交易的时候，都会要求你确认。</strong></p><p id="2375" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要调用合同，单击位于<em class="kr">写合同</em>旁边的<em class="kr">读合同</em>按钮。打电话不需要连接MetaMask，因为不需要表明身份。您可以使用块浏览器与合同进行交互，就像您使用Remix一样。</p><p id="f800" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">块资源管理器不仅仅在与契约交互时有用。可以列出和搜索所有交易，不仅包括合同，还包括任何以太坊账户。基本上，任何有关区块链历史的信息都可以在块管理器中检索到。</p><p id="fd6b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在本课程中，我们不会涵盖block explorer的所有可能性，但强烈建议您了解其功能。这是区块链发展最重要的工具之一。</p><p id="89d3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">感谢阅读！</strong></p><p id="f27a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">欢迎对本文提出意见和建议。</p><p id="2ce8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">欢迎任何投稿。<a class="ae md" href="http://www.buymeacoffee.com/jpmorais" rel="noopener ugc nofollow" target="_blank">www.buymeacoffee.com/jpmorais</a></p><blockquote class="mk"><p id="c3a6" class="ml mm ht bd mn mo mp mq mr ms mt jy ek translated">交易新手？尝试<a class="ae md" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae md" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>