<html>
<head>
<title>Analysis of the Grim Finance Hack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">严峻的金融黑客分析</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/analysis-of-the-grim-finance-hack-6d2327fb0fb3?source=collection_archive---------30-----------------------#2022-09-21">https://medium.com/coinmonks/analysis-of-the-grim-finance-hack-6d2327fb0fb3?source=collection_archive---------30-----------------------#2022-09-21</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="2697" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当一个程序的操作在中途停止，重新启动，并且两者都完美地运行，没有执行问题时，重入就发生了。</p><p id="14b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了获得Spirit-LP证书，攻击者使用快速贷款来借入WFTM和BTC令牌，并为Spirit Swap带来流动性。攻击者调用GrimBoostVault契约中的depositFor()，利用证书作为Grim Finance的抵押品。</p><p id="23b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">用户指定的令牌可以在用户在DepositFor()中指定后，通过safeTransferFrom()传输到Grim Boost Vault中。这将根据合同和转移前后保单池收到的资金之间的差额为用户创建担保品。</p><p id="d748" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但是，攻击者会传递令牌合同地址，因为depositFor()不会验证用户指定的资金的有效性。</p><p id="e635" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当GrimBoostVault通过safeTransferFom函数调用恶意协定的transferFrom函数时，协定再次使用depositFor函数。</p><p id="5fba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">合同可以多次重入，并将其用作SPIRIT-LP证书中的抵押品。通过这样做，保证了GrimBoostVault期望在重新进入之前和之后收到的令牌之间存在差异。</p><p id="3de3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，depositFor函数计算差额，并给予攻击者相应的担保品。</p><p id="2bd6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">攻击者可以获得更多的抵押品，因为他们已经多次签订了GrimBoostVault合同。使他们能够从GrimBoostVault合同中提取比以前提供的更多的SPIRIT-LP流动性证书。</p><p id="d452" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，黑客从WFTM和BTC代币池中移除流动性，并使用SPIRIT-LP流动性证书偿还快速贷款。</p><p id="6327" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">GrimBoostVault契约的depositFor函数是这次攻击的源头。它缺乏重入保护，并且无法验证用户传递的令牌的真实性。</p><p id="8585" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，智能合约可能会重新进入depositFor()并获得比预期多得多的抵押品。</p><p id="1c74" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">SlowMist安全团队建议监控对函数的外部调用，以发现由外部调用带来的威胁(如重入攻击),并验证用户提交的参数，以确保它们符合预期。</p><p id="0b92" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个漏洞应该在智能契约审计期间被发现，因为针对可重入性漏洞的推荐编码实践和指南已经存在多年了。</p><p id="6343" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在恶意令牌合同形成前一小时左右，攻击者使用Tornado Cash为以太坊(ETH)和币安智能链(BSC)钱包提供资金。</p><p id="85dc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了将和戴从Fantom Mainnet转移到ETH Mainnet，攻击者使用了一个桥。</p><p id="a859" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们的发现表明，许多DeFi应用程序漏洞是由于基本的智能合约开发错误造成的。由于区块链的防篡改特性，这些错误有可能严重损害DeFi应用。</p><p id="9cd4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">尽管许多攻击利用了各种漏洞，但研究工作已经成功地识别和阻止了这些攻击，这正是推动区块链快速发展的原因。</p><blockquote class="jo"><p id="f908" class="jp jq ht bd jr js jt ju jv jw jx jn ek translated">交易新手？试试<a class="ae jy" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae jy" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>