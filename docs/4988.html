<html>
<head>
<title>A possible $500 million loss on the World’s largest crypto exchange</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">世界上最大的密码交易所可能损失5亿美元</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/a-possible-500-million-loss-on-the-worlds-largest-crypto-exchange-d84edfdafc08?source=collection_archive---------16-----------------------#2022-10-14">https://medium.com/coinmonks/a-possible-500-million-loss-on-the-worlds-largest-crypto-exchange-d84edfdafc08?source=collection_archive---------16-----------------------#2022-10-14</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/04bd878fa0b3cfde25ed90cb138e3bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X6kO3UsTzsztyUHICLyZkg.png"/></div></div></figure><p id="cf06" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">据世界上最大的加密货币交易所币安的代表称，一次价值5.7亿美元的黑客攻击影响了与该公司相关的区块链。这是今年打击加密货币行业的一系列攻击中的最新一起。</p><p id="9a87" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在一条推文中，币安首席执行官赵昌鹏表示，在BNB连锁店使用的区块链“桥”上的令牌被盗，该连锁店在2月份之前被称为币安智能连锁店。</p><p id="3279" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">利用区块链桥，加密货币可以在其他应用之间移动。</p><p id="cbc0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">根据研究人员Chainalysis的说法，小偷越来越关注他们，大约20亿美元在13次不同的黑客攻击中被盗，主要是在今年。</p><p id="e485" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">根据赵的帖子，窃贼偷走了价值近1亿美元的加密货币。</p><p id="6621" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">后来，根据BNB·钱恩的一篇博客文章，黑客总共取走了200万枚BNB硬币，价值约5.7亿美元。</p><p id="90b4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">根据来自币安代表的邮件，大部分BNB仍在黑客的数字钱包地址中，约有1亿美元的价值仍“未被追回”</p><p id="e6b4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">BNB链支持BNB，原名币安币，根据数据提供商CoinGecko的数据，它是世界上第五大加密货币，市值超过450亿美元。</p><h2 id="4e4f" class="jz ka ht bd kb kc kd ke kf kg kh ki kj jm kk kl km jq kn ko kp ju kq kr ks kt dt translated">币安黑客事件的技术细节</h2><p id="c8b1" class="pw-post-body-paragraph jb jc ht jd b je kv jg jh ji kw jk jl jm kx jo jp jq ky js jt ju kz jw jx jy hm dt translated">五个小时前，一名攻击者从币安大桥偷走了200万BNB(约5 . 66亿美元)。在那段时间里，我一直在与多方密切合作，以甄别和解决这个问题。事情是这样的。</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div class="fe ff la"><img src="../Images/702267f21ac72572cfdc63487ac8079d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*JrUURnNbSG5Lkun4d3fH_w.jpeg"/></div></figure><p id="2fc6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这一切都是从<a class="ae ku" href="https://twitter.com/zachxbt" rel="noopener ugc nofollow" target="_blank"> @zachxbt </a>突然发给我攻击者的地址开始的。当我点进去的时候，我看到了一个价值数亿美元的账户。要么有人拉下了一个巨大的地毯，要么有一个大规模的黑客攻击正在进行</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div class="fe ff lf"><img src="../Images/740dc24b26e9b050390753e748b5268c.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*Hc9iDLBuRMVnXJ2FG7evGA.png"/></div></figure><p id="f9b7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">起初，我以为<a class="ae ku" href="https://twitter.com/VenusProtocol" rel="noopener ugc nofollow" target="_blank"> @VenusProtocol </a>又被黑了。然而，只需要几秒钟就可以确定攻击者*真的*向Venus存入了超过2亿美元。相反，我需要弄清楚这些资金来自哪里</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lg"><img src="../Images/183f63ec4500c1ebc71b7059e88a82c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*FsrOGvNxeI_gkMtjV4Rqpg.png"/></div></div></figure><p id="79f8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">答案是攻击者以某种方式说服币安大桥只需给他们送去100万BNB。两次。</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lh"><img src="../Images/278a9881f1bc21409194fefee598ac68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J5Hevn19zKjFMUsgKFJkHw.png"/></div></div></figure><p id="7292" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要么是币安最终泄露了Web3有史以来最大的秘密，要么是攻击者发现了一个严重的错误。</p><p id="1bc6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我从对比攻击者的交易和合法取款开始。我注意到的第一件事是攻击者使用的身高总是相同的——110217401。合法取款使用的高度要大得多，比如270822321</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div class="fe ff li"><img src="../Images/31258f70c63950ba4b9818e0fafccbd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*izN0JFprN9oah-enClzIBg.png"/></div></figure><figure class="lb lc ld le fq iu fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/247590048e3b9af9811533b86ff0e0a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*PloJmVGX6plRlLaxVHGX6Q.png"/></div></figure><p id="7b09" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我还注意到攻击者的证明比合法取款的证明要短得多。这两个事实让我相信攻击者已经找到了一种方法来伪造那个特定块(110217401)的证明。现在我必须弄清楚这些证明是如何工作的</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div class="fe ff la"><img src="../Images/75c458f2726df76ff2a400fd63e2bf1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*A0PXhckbHGl9qlEUgOvhCw.png"/></div></figure><p id="c4f0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在币安上，有一个特殊的预编译契约用于验证IAVL树。如果你对IAVL树一无所知，不要担心。大概有95%的内容我还是不明白。幸运的是，你和我需要复制的只是剩下的5%…</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div class="fe ff lk"><img src="../Images/8319d23b2fe653919fb7e175008fbc1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*bxqian1Z9kXeBm6ts2DYpQ.png"/></div></figure><p id="33bf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">好的，所以基本上，当你验证一个IAVL树时，你指定了一个“操作”列表。币安桥通常期望其中的两个:一个“iavl:v”操作和一个“multistore”操作。以下是它们的实现</p><div class="ll lm fm fo ln lo"><a href="https://github.com/cosmos/iavl/blob/de0740903a67b624d887f9055d4c60175dcfa758/proof_iavl_value.go#L61-L82" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab ej"><div class="lq ab lr cl cj ls"><h2 class="bd hu fv z el lt eo ep lu er et hs dt translated">iavl/proof _ iavl _ value . go at de 0740903 a67b 624d 887 f 9055 d4c 60175 dcfa 758 cosmos/iavl</h2><div class="lv l"><h3 class="bd b fv z el lt eo ep lu er et ek translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lw l"><p class="bd b gc z el lt eo ep lu er et ek translated">github.com</p></div></div><div class="lx l"><div class="ly l lz ma mb lx mc iz lo"/></div></div></a></div><p id="fe97" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了伪造一个证明，我们需要两个操作都成功，并且我们需要最后一个操作(multistore)返回一个固定值(指定块的散列:110217401)。看一下实现，我们可以努力说服自己，操纵根散列是不可能的，或者至少是非常困难的。或者你可以相信我的话。这意味着我们需要输入值等于提交id之一</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff md"><img src="../Images/7372a638a454d35c187685411388f91d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R-thrfCdEMmpaiyyqzp6qw.png"/></div></div></figure><figure class="lb lc ld le fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff me"><img src="../Images/831139350af997ec18e2edd37f510da2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*By7Z2Oi2zcqe9R7o3q1d3A.png"/></div></div></figure><p id="b578" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">“multistore”操作的输入值是“iavl:v”操作的输出值。这意味着我们希望以某种方式控制这里的根变量，同时仍然通过值验证。</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div class="fe ff mf"><img src="../Images/d3077954f633a241ca0dcec9f66dbaf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*YkxceIDnsjf5K8TnuU5xTg.png"/></div></figure><figure class="lb lc ld le fq iu fe ff paragraph-image"><div class="fe ff mf"><img src="../Images/8cbea77e588812d8f97ab75829e5445a.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*H7c_72zAbADRHr0pJI_ggw.png"/></div></figure><p id="5bd0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">那么根散列是如何计算的呢？这发生在一个叫做COMPUTEHASH的函数中。在一个非常非常高的层次上，它递归地遍历每一条路径和每一片叶子，进行一系列哈希运算，实际上实现细节并不重要</p><div class="ll lm fm fo ln lo"><a href="https://github.com/cosmos/iavl/blob/de0740903a67b624d887f9055d4c60175dcfa758/proof_range.go#L237-L290" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab ej"><div class="lq ab lr cl cj ls"><h2 class="bd hu fv z el lt eo ep lu er et hs dt translated">iavl/proof _ range . go at de 0740903 a67b 624d 887 f 9055 d4c 60175 dcfa 758 cosmos/iavl</h2><div class="lv l"><h3 class="bd b fv z el lt eo ep lu er et ek translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lw l"><p class="bd b gc z el lt eo ep lu er et ek translated">github.com</p></div></div><div class="lx l"><div class="mg l lz ma mb lx mc iz lo"/></div></div></a></div><p id="e56d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">重要的是，由于哈希函数的工作方式，我们基本上可以肯定地说，任何(path，nleaf)对都将产生唯一的哈希。如果我们想伪造证据，这些需要保持不变。</p><p id="83f8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">查看合法事务中证明的布局，我们看到它有一个很长的路径，没有内部节点，只有一个叶节点。这个叶子节点包含了我们恶意负载的散列！如果我们不能修改这个叶节点，那么我们需要添加一个新的。</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div class="fe ff mh"><img src="../Images/426f3cad23430b0d0a503d835339d08f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*aAzbF0VtsFD7vhGweV4aeA.png"/></div></figure><p id="b55e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">当然，如果我们添加一个新的叶节点，我们还需要添加一个新的内部节点来匹配</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mi"><img src="../Images/e0215bb81254e7a7645fe2d82dd7a1b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OUjRFXW0MX7fnpvbu4Briw.png"/></div></div></figure><p id="2942" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在我们只剩下最后一个障碍要面对了。我们实际上如何让COMPUTEHASH返回我们想要的根HASH呢？注意，最终我们需要一个包含非零右散列的路径。当我们发现一个匹配时，我们断言它匹配中间根散列</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div class="fe ff la"><img src="../Images/2ee1ea2a9e4f70e64829217079e9d0f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*DgQU8FgypE6Z7ZhmspnDlQ.png"/></div></figure><p id="9181" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们对代码进行一点测试，这样我们就可以知道我们需要什么样的散列。</p><figure class="lb lc ld le fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mj"><img src="../Images/1595615961d2d58b2425a293181234aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ya3J6wzWg3HKGT1lw6OX-A.png"/></div></div></figure><figure class="lb lc ld le fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mk"><img src="../Images/47208f1beb0ac92b210e0869b8bf40a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RHFyMBj8b6y9Px5x2ukmmA.png"/></div></div></figure><p id="aad4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">剩下的就是把所有的东西放在一起。我们将采用合法的证明并对其进行修改，以便:</p><p id="e9d7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="ml"> 1)我们为我们伪造的有效载荷添加了新的一页</em></p><p id="da31" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="ml"> 2)我们添加一个空白的内部节点来满足证明者</em></p><p id="5e47" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="ml"> 3)我们使用正确的根哈希调整我们的叶子以提前退出</em></p><figure class="lb lc ld le fq iu"><div class="bz el l di"><div class="mm mn l"/></div></figure><p id="5cc4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">(值得注意的是，这并不是攻击者使用的确切方法。他们的证明路径要短得多，我不确定他们到底是如何得出这个结论的。然而，其余的利用是相同的，我相信展示如何从头开始构建它是有价值的)</p><p id="c3de" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">总之，在币安桥验证证据的方式上有一个缺陷，这可能会允许攻击者伪造任意消息。幸运的是，这里的攻击者只伪造了两条消息，但损害可能会严重得多。</p><p id="e3f5" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了防止未来的黑客攻击，币安称之为“社区驱动、开源和去中心化的生态系统”的BNB链表示，它将添加一个新的“治理机制”，并增加验证器的数量。</p><p id="d15f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在有史以来最大的加密货币抢劫案之一中，黑客在3月份从区块链一座名为Ronin Bridge的桥上窃取了超过6.15亿美元。美国将此次盗窃事件归咎于朝鲜黑客，这是有史以来规模最大的一次。</p><blockquote class="mo"><p id="9e24" class="mp mq ht bd mr ms mt mu mv mw mx jy ek translated">交易新手？尝试<a class="ae ku" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae ku" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>