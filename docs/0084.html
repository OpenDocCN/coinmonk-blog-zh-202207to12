<html>
<head>
<title>Building Smart Contracts with OpenZeppelin (Everything You Need To Know)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与OpenZeppelin建立智能合同(您需要知道的一切)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/learning-openzeppelin-everything-you-need-to-know-5152a0ad8c4?source=collection_archive---------17-----------------------#2022-07-02">https://medium.com/coinmonks/learning-openzeppelin-everything-you-need-to-know-5152a0ad8c4?source=collection_archive---------17-----------------------#2022-07-02</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="307e" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">OpenZepplin库简介</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/73d71db6be5421a7cce12adf189112b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gnC-hU43GQsDFRBs"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Photo by <a class="ae jy" href="https://unsplash.com/@fakurian?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Milad Fakurian</a> on <a class="ae jy" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl jz ka hb kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hm hn ho hp hq"><h1 id="8317" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx dt translated">介绍</h1><p id="c4f8" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated"><strong class="la hu"> OpenZeppelin </strong>是<strong class="la hu">协议</strong>、<strong class="la hu">模板</strong>、&amp;、<strong class="la hu">实用程序</strong>的<strong class="la hu">开源库</strong>，用于<strong class="la hu">智能合约开发</strong>。这包括令牌标准的实现、灵活的基于角色的许可方案、&amp;可重用组件。</p><h1 id="f098" class="kg kh ht bd ki kj lu kl km kn lv kp kq iz lw ja ks jc lx jd ku jf ly jg kw kx dt translated">装置</h1><p id="72c3" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">OpenZeppelin通过项目中的本地安装来使用。</p><pre class="jj jk jl jm fq lz ma mb mc aw md dt"><span id="7adb" class="me kh ht ma b fv mf mg l mh mi">npm install @openzeppelin/contracts</span></pre><h1 id="8e78" class="kg kh ht bd ki kj lu kl km kn lv kp kq iz lw ja ks jc lx jd ku jf ly jg kw kx dt translated">代币</h1><p id="0d27" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">OpenZeppelin库提供了对<code class="eh mj mk ml ma b">ERC20</code>、<code class="eh mj mk ml ma b">ERC721</code>、<code class="eh mj mk ml ma b">ERC777</code>、&amp;、<code class="eh mj mk ml ma b">ERC1155.</code>的实现</p><h2 id="7ded" class="me kh ht bd ki mm mn mo km mp mq mr kq lh ms mt ks ll mu mv ku lp mw mx kw my dt translated">ERC20</h2><p id="f7f7" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">OpenZeppelin提供了对<code class="eh mj mk ml ma b">ERC20</code> <strong class="la hu">可替换令牌</strong>标准的支持。</p><p id="f483" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">下面是一个ERC20令牌的实现:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><h2 id="1dd0" class="me kh ht bd ki mm mn mo km mp mq mr kq lh ms mt ks ll mu mv ku lp mw mx kw my dt translated">ERC777</h2><p id="87aa" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">OpenZeppelin提供对<code class="eh mj mk ml ma b">ERC777</code> <strong class="la hu">可替换令牌</strong>标准的支持。虽然与前面列出的协议相似，但该标准提供了对事务挂钩、委托操作符和其他一些生活质量改进的支持。</p><p id="9a53" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">这里是一个ERC777令牌的实现:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><h2 id="d760" class="me kh ht bd ki mm mn mo km mp mq mr kq lh ms mt ks ll mu mv ku lp mw mx kw my dt translated">ERC721</h2><p id="a539" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">OpenZeppelin提供了对<code class="eh mj mk ml ma b">ERC721</code> <strong class="la hu">不可替换令牌</strong>标准的支持。</p><p id="0b0b" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">这里是一个ERC721令牌的实现:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><h2 id="ba3c" class="me kh ht bd ki mm mn mo km mp mq mr kq lh ms mt ks ll mu mv ku lp mw mx kw my dt translated">ERC1155</h2><p id="1d11" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">OpenZeppelin提供了对<code class="eh mj mk ml ma b">ERC1155</code> <strong class="la hu">可互换不可知令牌</strong>标准的支持。这个标准允许<strong class="la hu">多个令牌</strong>由一个契约来表示，而不管可替换性如何。</p><p id="612e" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">这里是一个ERC1155令牌的实现:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><h1 id="bc59" class="kg kh ht bd ki kj lu kl km kn lv kp kq iz lw ja ks jc lx jd ku jf ly jg kw kx dt translated">管理</h1><p id="f55f" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">OpenZeppelin为智能合约提供了<strong class="la hu">基于角色的管理</strong>。</p><h2 id="c0e9" class="me kh ht bd ki mm mn mo km mp mq mr kq lh ms mt ks ll mu mv ku lp mw mx kw my dt translated">可拥有的</h2><p id="abaa" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated"><code class="eh mj mk ml ma b">Ownable</code>合同可以扩展以提供所有者特定的限制。默认情况下，部署地址被设置为合同所有者。</p><p id="e65e" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated">在适用的情况下,<code class="eh mj mk ml ma b">onlyOwner</code>修饰符用于强制所有者独占执行。</p><p id="6678" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">下面是可拥有契约的一个实现:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><h2 id="d751" class="me kh ht bd ki mm mn mo km mp mq mr kq lh ms mt ks ll mu mv ku lp mw mx kw my dt translated">访问控制</h2><p id="2da9" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">可以扩展<code class="eh mj mk ml ma b">AccessControl</code>契约，以提供更细粒度的基于角色的限制。这意味着可以相互独立地声明和设置各个角色。</p><p id="0f57" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><code class="eh mj mk ml ma b">onlyRole(role)</code>修饰符用于强制角色独占执行。</p><p id="a3a7" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><code class="eh mj mk ml ma b">grantRole(role, account)</code>和<code class="eh mj mk ml ma b">revokeRole(role, account)</code>函数分别用于管理和撤销角色。但是，这些功能只能由关联的管理角色调用。如果最初未由<code class="eh mj mk ml ma b"> _setRoleAdmin(role, adminRole)</code>设置，则使用由<code class="eh mj mk ml ma b">_setupRole(role, account)</code>在编译时设置的<code class="eh mj mk ml ma b">DEFAULT_ADMIN_ROLE</code>。</p><p id="08e8" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">下面是访问控制契约的一个实现:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><p id="0e65" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><code class="eh mj mk ml ma b">getRoleMemberCount(role)</code>函数用于检索具有特定角色的帐户数量，而<code class="eh mj mk ml ma b">getRoleMember(role, index)</code>函数用于获取角色成员的地址。</p><p id="ebbc" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">下面是一个获取指定角色所有成员的循环:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><h2 id="fcd1" class="me kh ht bd ki mm mn mo km mp mq mr kq lh ms mt ks ll mu mv ku lp mw mx kw my dt translated">TimelockController</h2><p id="6359" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated"><code class="eh mj mk ml ma b">TimelockController</code>模块充当时间锁控制器。它充当由提议者和执行者管理的代理，延迟维护操作，以便用户在提交之前有机会检查它们。</p><p id="0357" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated">默认情况下，部署地址获得管理权限。该角色授予分别通过<code class="eh mj mk ml ma b">PROPOSER_ROLE</code>、<code class="eh mj mk ml ma b">EXECUTOR_ROLE</code>、&amp;、<code class="eh mj mk ml ma b">ADMIN_ROLE</code>标签分配提议者、执行者和其他管理员的权利。</p><h1 id="436a" class="kg kh ht bd ki kj lu kl km kn lv kp kq iz lw ja ks jc lx jd ku jf ly jg kw kx dt translated">管理</h1><p id="243b" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">OpenZeppelin为智能合同提供了对链上治理的支持。</p><h2 id="da09" class="me kh ht bd ki mm mn mo km mp mq mr kq lh ms mt ks ll mu mv ku lp mw mx kw my dt translated">代币</h2><p id="1147" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">通过扩展<code class="eh mj mk ml ma b">ERC20Votes</code>，可以为<code class="eh mj mk ml ma b">ERC20</code>合同提供投票功能。</p><p id="271b" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">这里是一个具有投票功能的ERC20令牌:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><p id="31a5" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated">投票支持也可用于带有<code class="eh mj mk ml ma b">ERC721Votes</code>的<code class="eh mj mk ml ma b">ERC721</code>。</p><h2 id="ab1e" class="me kh ht bd ki mm mn mo km mp mq mr kq lh ms mt ks ll mu mv ku lp mw mx kw my dt translated">管理者</h2><p id="fcda" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">为了配置治理协议，必须创建一个调控器契约。</p><p id="bcc9" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><code class="eh mj mk ml ma b">Governor</code>基础契约是治理协议的核心。任何附加功能都是通过扩展模块来实现的。</p><p id="fae7" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">以下是常用模块列表:</em></p><ul class=""><li id="c87e" class="nh ni ht la b lb mz le na lh nj ll nk lp nl lt nm nn no np dt translated"><code class="eh mj mk ml ma b">GovernorVotes</code>:挂钩到<code class="eh mj mk ml ma b">IVotes</code>实例，根据账户的令牌余额确定账户的投票权。</li><li id="8a31" class="nh ni ht la b lb nq le nr lh ns ll nt lp nu lt nm nn no np dt translated"><code class="eh mj mk ml ma b">GovernorQuorumFraction</code>:定义执行提议所需的令牌总供应量的百分比。</li><li id="e559" class="nh ni ht la b lb nq le nr lh ns ll nt lp nu lt nm nn no np dt translated"><code class="eh mj mk ml ma b">GovernorCountingSimple</code>:定义一个简单的投票方案(<code class="eh mj mk ml ma b">FOR</code> / <code class="eh mj mk ml ma b">AGAINST</code> / <code class="eh mj mk ml ma b">ABSTAIN</code>)</li><li id="4605" class="nh ni ht la b lb nq le nr lh ns ll nt lp nu lt nm nn no np dt translated"><code class="eh mj mk ml ma b">GovernorTimelockControl</code>:定义一个要使用的<code class="eh mj mk ml ma b">TimelockController</code>。</li></ul><p id="be36" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">下面是一个简单的调控器契约:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><h2 id="96b7" class="me kh ht bd ki mm mn mo km mp mq mr kq lh ms mt ks ll mu mv ku lp mw mx kw my dt translated">提案生命周期</h2><p id="f102" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">OpenZeppelin与第三方治理工具兼容。这意味着可以通过脚本或治理应用程序(如<strong class="la hu"> Tally </strong>或<strong class="la hu"> Defender)来制定和执行提议。</strong></p><p id="f8f9" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated">手动创建提案时，必须调用<code class="eh mj mk ml ma b">propose(targets, values, calldata, description)</code>功能。</p><p id="f59c" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">这是一个使用Ethers.js的财政拨款提案的部署:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><p id="36c1" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated">如果提议成功，它可以调用<code class="eh mj mk ml ma b">execute(target, values, calldata, descriptionHash)</code>函数。如果调控器强制执行一个<code class="eh mj mk ml ma b">TimeController</code>，那么在执行之前必须首先调用<code class="eh mj mk ml ma b">queue(target, values, calldata, descriptionHash)</code>。</p><p id="fcae" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">下面是一个建议队列调用:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><p id="3957" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">下面是一个提议执行调用:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><h1 id="e935" class="kg kh ht bd ki kj lu kl km kn lv kp kq iz lw ja ks jc lx jd ku jf ly jg kw kx dt translated">公用事业</h1><p id="f180" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">OpenZeppelin提供了许多有用的实用程序。</p><h2 id="5d97" class="me kh ht bd ki mm mn mo km mp mq mr kq lh ms mt ks ll mu mv ku lp mw mx kw my dt translated">ECDSA</h2><p id="e5ca" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated"><code class="eh mj mk ml ma b">ECDSA</code>(椭圆曲线数字签名算法)实用程序提供了恢复和管理以太坊账户ECDSA签名的功能。</p><p id="bed6" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><code class="eh mj mk ml ma b">recover(signature)</code>函数用于恢复数据签名人，并将其地址进行比较以验证签名。</p><blockquote class="nv nw nx"><p id="4b4d" class="ky kz ne la b lb mz iu ld le na ix lg ny nb lj lk nz nc ln lo oa nd lr ls lt hm dt translated">⚠️ <strong class="la hu">警告:</strong>哈希解密可能取决于签名格式</p></blockquote><p id="ed08" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">下面是以太坊签名消息哈希的链上恢复:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><h1 id="21c6" class="kg kh ht bd ki kj lu kl km kn lv kp kq iz lw ja ks jc lx jd ku jf ly jg kw kx dt translated">Base64</h1><p id="6ee2" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated"><code class="eh mj mk ml ma b">Base64</code>实用程序允许将<code class="eh mj mk ml ma b">bytes32</code>类型的dat转换成<code class="eh mj mk ml ma b">Base64</code>字符串表示。这对于为不可替换的令牌构建URL安全的令牌URIs非常有用。</p><p id="7230" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated"><em class="ne">下面是编码成Base64数据URI的JSON元数据:</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure></div><div class="ab cl jz ka hb kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hm hn ho hp hq"><h1 id="9256" class="kg kh ht bd ki kj kk kl km kn ko kp kq iz kr ja ks jc kt jd ku jf kv jg kw kx dt translated">就是这样！</h1><p id="93a1" class="pw-post-body-paragraph ky kz ht la b lb lc iu ld le lf ix lg lh li lj lk ll lm ln lo lp lq lr ls lt hm dt translated">正如我在我的页面上所说的，这些是我个人笔记本上的笔记。如果有任何明显的错误，请随时留下评论，以便我可以修复它们。还有，如果有你想从我这里看到的内容，请告诉我！</p><p id="865a" class="pw-post-body-paragraph ky kz ht la b lb mz iu ld le na ix lg lh nb lj lk ll nc ln lo lp nd lr ls lt hm dt translated">资源:<a class="ae jy" href="https://docs.openzeppelin.com/" rel="noopener ugc nofollow" target="_blank">https://docs.openzeppelin.com/</a></p><blockquote class="ob"><p id="2c23" class="oc od ht bd oe of og oh oi oj ok lt ek translated">交易新手？尝试<a class="ae jy" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae jy" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>