<html>
<head>
<title>NFT airdrop/whitelist implementation with MerkleTree.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用MerkleTree实现NFT空投/白名单。</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/nft-airdrop-whitelist-implementation-with-merkletree-1afbaf4c0935?source=collection_archive---------4-----------------------#2022-08-09">https://medium.com/coinmonks/nft-airdrop-whitelist-implementation-with-merkletree-1afbaf4c0935?source=collection_archive---------4-----------------------#2022-08-09</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="83b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本文中，我们将为您的NFT集合的空投/白名单分解MerkleTree proof实现。(+测试)。使用多边形孟买。</p><blockquote class="jo jp jq"><p id="93de" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">如果你不明白这个算法是如何工作的，我建议你在开始工作之前先看一下之前的<a class="ae jv" rel="noopener" href="/coinmonks/solidity-merkle-tree-41c2d2b1071f">文章</a>(我在这里已经详细解释了Merkle算法)。<br/>我也建议你在开始之前阅读这篇<a class="ae jv" rel="noopener" href="/@ItsCuzzo/using-merkle-trees-for-nft-whitelists-523b58ada3f9">文章</a>。它将帮助您更深入地理解代码是如何工作的。</p></blockquote><h1 id="f20b" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">先决条件</h1><p id="ea0b" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">您需要安装以下工具来成功粉碎此版本:</p><ul class=""><li id="8ae4" class="kz la ht is b it iu ix iy jb lb jf lc jj ld jn le lf lg lh dt translated"><a class="ae jv" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点</a></li><li id="f3ad" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn le lf lg lh dt translated"><a class="ae jv" href="https://hardhat.org/" rel="noopener ugc nofollow" target="_blank">安全帽</a></li><li id="6074" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn le lf lg lh dt translated"><a class="ae jv" href="https://www.chaijs.com/" rel="noopener ugc nofollow" target="_blank">柴</a></li><li id="a920" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn le lf lg lh dt translated"><a class="ae jv" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank">元掩码</a></li></ul><h1 id="9515" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">我们走吧</h1><p id="f35f" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">首先，我们将使用<a class="ae jv" href="https://wizard.openzeppelin.com/#erc721" rel="noopener ugc nofollow" target="_blank"> openzeppelin向导</a>创建一个简单的nft契约。</p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff ln"><img src="../Images/c0c8a271804a0e19de350e36c8fcf549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0hIi9ydc7ZLDyeHN0JfJzw.png"/></div></div><figcaption class="lz ma fg fe ff mb mc bd b be z ek">An example of what your wizard should look like</figcaption></figure><p id="299f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们增加了创建新nft的可能性(<em class="jr"> Mintable </em>属性)并添加了<em class="jr"> AutoIncrementIds </em>属性，这样，创建的NFT的计数器将自动增加，我们不需要编写额外的函数。<br/>还添加了<em class="jr">角色</em>属性。因此，我们有一个主要的管理员，以及一个minter角色，我们将给予Airdrop合同(该合同将能够创建NFT，并将其分发到合适的地址)。复制这段代码，我们以后会用到它。</p><blockquote class="jo jp jq"><p id="22c5" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">重要提示:在新版本的openzeppelin中，您需要在<strong class="is hu"> _setupRole </strong>上更改<strong class="is hu"> _grandRole </strong></p></blockquote><p id="74df" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们还将使用MerkleProof <a class="ae jv" href="https://docs.openzeppelin.com/contracts/4.x/api/utils#MerkleProof" rel="noopener ugc nofollow" target="_blank">库</a>——它允许我们方便地使用merkle树，并在树中验证我们的候选证明。</p><h1 id="5ebb" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">让我们开始写代码吧</h1><p id="e12a" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">将<a class="ae jv" href="https://github.com/kumancev/nft-merkle-tree" rel="noopener ugc nofollow" target="_blank"> githab </a>中的代码复制到您的工作目录中，安装并安装所有的依赖项:</p><pre class="lo lp lq lr fq md me mf mg aw mh dt"><span id="bdd9" class="mi jx ht me b fv mj mk l ml mm">$ git clone <a class="ae jv" href="https://github.com/kumancev/nft-merkle-tree.git" rel="noopener ugc nofollow" target="_blank">https://github.com/kumancev/nft-merkle-tree.git</a><br/>$ npm install</span></pre><p id="b59b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后创建和设置你的<strong class="is hu">。环境</strong>文件</p><pre class="lo lp lq lr fq md me mf mg aw mh dt"><span id="a396" class="mi jx ht me b fv mj mk l ml mm">PRIVATE_KEY=""  // your metamask account<br/>POLYGONSCAN_API_KEY=""  // your polygon api key</span></pre><h2 id="bb00" class="mi jx ht bd jy mn mo mp kc mq mr ms kg jb mt mu kk jf mv mw ko jj mx my ks mz dt translated">代码审查</h2><p id="a248" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">我们的项目中将有三个智能合同。</p><pre class="lo lp lq lr fq md me mf mg aw mh dt"><span id="c3c9" class="mi jx ht me b fv mj mk l ml mm">contracts-|<br/>          |-nft-airdrop-|<br/>                        |-Airdrop.sol<br/>                        |-IERC721.sol<br/>                        |-SuperNFT.sol</span></pre><p id="a61e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="jr"> SuperNFT.sol </em>是从openzeppelin向导复制的代码。我们NFT合约的<em class="jr"> IERC721.sol </em>接口，能够使用safeMint()函数。<br/>我们来分解一下<em class="jr"> Airdrop.sol </em>合同:</p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff na"><img src="../Images/3dc4172317de376ae69a7064285d1d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3t1n0n3xZYcpNE0z-bnDw.png"/></div></div></figure><p id="b7cc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们需要制定编译契约:</p><pre class="lo lp lq lr fq md me mf mg aw mh dt"><span id="d013" class="mi jx ht me b fv mj mk l ml mm">$ npx hardhat compile</span></pre><p id="ac3e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当编写智能合同时，一定要<strong class="is hu">为它们编写测试</strong>。<em class="jr">测试智能合同和编写智能合同一样重要。</em></p><h2 id="0aaa" class="mi jx ht bd jy mn mo mp kc mq mr ms kg jb mt mu kk jf mv mw ko jj mx my ks mz dt translated">测试智能合同</h2><p id="62f7" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">转到<em class="jr"> test/nft-airdrop/ </em>文件夹，<em class="jr"> Airdrop.test.ts </em>文件。</p><blockquote class="jo jp jq"><p id="3aaf" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">如果您对智能合约进行了更改，则必须重新编译它们。</p></blockquote><pre class="lo lp lq lr fq md me mf mg aw mh dt"><span id="3194" class="mi jx ht me b fv mj mk l ml mm">$ npx hardhat clean<br/>$ npx hardhat compile</span></pre><p id="7ef5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在让我们分解一下我们的<em class="jr"> Airdrop.sol </em>契约的测试代码。<br/>由于我们使用了TypeChain，它在编译时自动生成了<em class="jr">工厂</em>和<em class="jr">接口</em>。我们将需要它们来测试和将来在网络上部署合同。</p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff nb"><img src="../Images/75777a6067deabcdd5560616cfd5f8b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1dUNlCaUqLE5LIcfvU6lrQ.png"/></div></div></figure><p id="0220" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我们本地的安全帽网络上运行测试:</p><pre class="lo lp lq lr fq md me mf mg aw mh dt"><span id="7b9f" class="mi jx ht me b fv mj mk l ml mm">$ npx hardhat test test/nft-airdrop/Airdrop.test.ts</span></pre><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff nc"><img src="../Images/cc3799d62e87cd902d9403093756b703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hk5siVX4XK5DQXtX8vG4hg.png"/></div></div></figure><p id="cd89" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">测试运行成功，是时候将合同上传到网络上了。</p><h2 id="ba16" class="mi jx ht bd jy mn mo mp kc mq mr ms kg jb mt mu kk jf mv mw ko jj mx my ks mz dt translated">部署smartcontracts以测试网络</h2><p id="0eb5" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">转到<em class="jr">脚本/nft-airdrop/ </em>文件夹，部署<em class="jr">。ts </em>文件。代码将与我们为测试编写的代码几乎相同。</p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff nb"><img src="../Images/3a86218b96a0bfcd2b8c71b93327347c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X81R11H_AoQC4YAeerD01w.png"/></div></div></figure><blockquote class="jo jp jq"><p id="5d2d" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">您将离线存储候选人(表格，数据库)和证明也将离线生成)。由于这超出了本文的范围，我们将直接在部署脚本中生成证明(证明变量<strong class="is hu">)。</strong></p></blockquote><p id="b03f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，让我们在本地网络上测试我们的部署脚本。</p><pre class="lo lp lq lr fq md me mf mg aw mh dt"><span id="f6f4" class="mi jx ht me b fv mj mk l ml mm">$ npx hardhat run script/nft-airdrop/deploy.ts</span></pre><p id="9159" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您应该看到以下内容:</p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff nd"><img src="../Images/574f5b28c7b49203ff2a157ead4b10cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DAOf3CdPg4pSjR7cxHEVwA.png"/></div></div></figure><p id="6cfd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">我们将需要nft铸造的证据</strong></p><p id="63bf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，让我们将部署部署到孟买多边形网络:</p><pre class="lo lp lq lr fq md me mf mg aw mh dt"><span id="28e7" class="mi jx ht me b fv mj mk l ml mm">$ npx hardhat run script/nft-airdrop/deploy.ts --network matic</span></pre><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff ne"><img src="../Images/939856af1518dc443fd82e961f27f5d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UqIfLvjSGOG6xnTLrxJg6g.png"/></div></div></figure><h2 id="90e5" class="mi jx ht bd jy mn mo mp kc mq mr ms kg jb mt mu kk jf mv mw ko jj mx my ks mz dt translated">最后一步。NFT造币厂。</h2><p id="72c7" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">去Polygon <a class="ae jv" href="https://mumbai.polygonscan.com/" rel="noopener ugc nofollow" target="_blank"> Mumbai </a>，输入你部署时得到的空投合同地址。在智能合同页面，进入<em class="jr">“写合同”</em>选项卡，连接您的钱包。</p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff nf"><img src="../Images/8ec5d315733df137c848f80902029e8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6tyhVQj1c6QuS9Wj3M-g8g.png"/></div></div></figure><p id="5ad9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后在字段(1.claim — merkleProof (bytes32[]))中输入4个不带引号的散列，用方括号括起来，这是在删除时得到的</p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff ng"><img src="../Images/b3a994e6d8d3bb183e8e03e1ae63ae33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LLQYBxTnrUpZlsmfdmVQAA.png"/></div></div></figure><p id="27e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下一个声明NFT，请注意，如果我们通过“for”方法使用进入白名单的确认，天然气价格会低得多。</p><p id="3c3a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，如果我们转到NFT合同的地址，并在“ownerOf”方法的“Read Contract”选项卡中输入0(第一个NFT令牌的所有者)，我们会看到我们钱包的地址。</p><figure class="lo lp lq lr fq ls fe ff paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="fe ff nh"><img src="../Images/d0fbc17471cedab0f7ded68a7231a5fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*99rXJjGixtk0iGJO2cg8Zg.png"/></div></div></figure><p id="a162" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我想给你推荐一篇描述现代坚固性开发问题的文章&amp;nft。<br/>代码复制的问题等等很多东西。一个非常深入的分析与解决方案和代码的例子。这篇文章是由臭名昭著的nft集合Nuclear Neadrs的开发者之一写的。<br/>如果你想真正理解代码优化，花点时间看看这篇<a class="ae jv" rel="noopener" href="/@nftchance/the-gas-efficient-way-of-building-and-launching-an-erc721-nft-project-for-2022-b3b1dac5f2e1"> <strong class="is hu">帖子</strong> </a>。</p><p id="fb2d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当我写这篇文章的时候，我发现了可能是唯一的<strong class="is hu"> </strong> <a class="ae jv" href="https://www.youtube.com/watch?v=0_9UotlUSSo" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">视频</strong> </a>，它描述了创建具有如此大的修改堆栈的nft集合(免费mint +白名单Mint (Merkle) +公共Mint + PaymentSplitter)。唯一的问题是法国作者，但我们用同一种语言编写代码，所以你应该能搞清楚。</p><h1 id="e23f" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">就是这样！你太棒了！😎</h1><blockquote class="ni"><p id="26e1" class="nj nk ht bd nl nm nn no np nq nr jn ek translated">加入Coinmonks <a class="ae jv" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jv" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="ea7e" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ns kj kk kl nt kn ko kp nu kr ks kt dt translated">另外，阅读</h1><ul class=""><li id="85d1" class="kz la ht is b it ku ix kv jb nv jf nw jj nx jn le lf lg lh dt translated"><a class="ae jv" href="https://coincodecap.com/wazirx-nft-review" rel="noopener ugc nofollow" target="_blank">瓦济里克斯NFT评论</a>|<a class="ae jv" href="https://coincodecap.com/bitsgap-vs-pionex" rel="noopener ugc nofollow" target="_blank">Bitsgap vs Pionex</a>|<a class="ae jv" href="https://coincodecap.com/tangem-wallet-review" rel="noopener ugc nofollow" target="_blank">Tangem评论</a></li><li id="919c" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn le lf lg lh dt translated"><a class="ae jv" href="https://coincodecap.com/create-a-dapp-on-ethereum-using-solidity" rel="noopener ugc nofollow" target="_blank">如何使用Solidity在以太坊上创建DApp？</a></li><li id="2012" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn le lf lg lh dt translated"><a class="ae jv" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a> | <a class="ae jv" href="https://coincodecap.com/okex-vs-binance" rel="noopener ugc nofollow" target="_blank"> OKEx vs币安</a></li><li id="5185" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn le lf lg lh dt translated"><a class="ae jv" href="https://coincodecap.com/binance-vs-ftx" rel="noopener ugc nofollow" target="_blank">币安vs FTX </a> | <a class="ae jv" href="https://coincodecap.com/solana-wallets" rel="noopener ugc nofollow" target="_blank">最佳(SOL)索拉纳钱包</a></li><li id="8596" class="kz la ht is b it li ix lj jb lk jf ll jj lm jn le lf lg lh dt translated"><a class="ae jv" href="https://coincodecap.com/swap-crypto-on-uniswap" rel="noopener ugc nofollow" target="_blank">如何在Uniswap上交换加密？</a> | <a class="ae jv" href="https://coincodecap.com/a-ads-review" rel="noopener ugc nofollow" target="_blank"> A-Ads评论</a></li></ul></div></div>    
</body>
</html>