<html>
<head>
<title>Schedule Randomness with Gelato and Witnet, API3 &amp; Chainlink Vrf</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用意式冰淇淋和威特网、API3和Chainlink Vrf实现日程随机性</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/schedule-randomness-with-gelato-and-witnet-api3-chainlink-vrf-1ebc0aac37d?source=collection_archive---------7-----------------------#2022-09-27">https://medium.com/coinmonks/schedule-randomness-with-gelato-and-witnet-api3-chainlink-vrf-1ebc0aac37d?source=collection_archive---------7-----------------------#2022-09-27</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="10c6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">了解如何将意式冰淇淋与Witnet、API3和Chainlink Vrf结合使用，以实现随机性的自动化</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/39409a9a4677ad720cb5ead9aa55da31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mhquMMINCtSp0PxLNZu34A.png"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">Schedule the randomness</figcaption></figure><h1 id="ee55" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">目录</h1><p id="d31e" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated"><a class="ae lh" href="#bf36" rel="noopener ugc nofollow"><strong class="is hu">web中的随机性3 </strong> </a> <br/> - <a class="ae lh" href="#91bb" rel="noopener ugc nofollow">当前解决方案</a> <br/> - <a class="ae lh" href="#abd1" rel="noopener ugc nofollow">自动化和随机性</a> <br/> <a class="ae lh" href="#070d" rel="noopener ugc nofollow"> <strong class="is hu">展示案例项目</strong> </a> <strong class="is hu"> <br/> </strong> - <a class="ae lh" href="#3ff0" rel="noopener ugc nofollow">步骤1)意式冰淇淋为司仪</a> <br/> - <a class="ae lh" href="#cf36" rel="noopener ugc nofollow">步骤2)API 3 qrg为随机组件</a>-<a class="ae lh" href="#3ff0" rel="noopener ugc nofollow">步骤3) </a> <a class="ae lh" href="#97e8" rel="noopener ugc nofollow"> Witnet</a></p><p id="4947" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">从轮盘赌到动作冒险游戏，随机性在游戏世界中扮演着重要角色。它适用于任何动态创建对手或场景的场景，以及那些用户需要“即时”随机性的场景。</p><p id="b060" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这与我在20世纪80年代的记忆大相径庭，当时游戏远没有那么令人愉快，因为一切都是可预测的——如果你的角色去执行一次任务，下次你玩这个任务时就会完全一样。你可以想象，这很快变得很无聊。</p><p id="62ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然而，随机性在web3生态系统中还有许多其他用途，例如:</p><p id="7d00" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> DAOs &amp;公众参与</strong> <strong class="is hu">流程:</strong><strong class="is hu">最大的web3 </strong>特色之一就是<strong class="is hu">社区</strong>带动项目的存在。从长远来看，我认为成功的项目将是那些拥有强大而活跃的社区的项目。在这种情况下，需要随机性来确保奖励和参与过程的公平性。</p><p id="ba5f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> NFT一代:</strong>在过去的5年里，我们看到了非传统艺术和数字艺术的指数级增长。在某些情况下，NFT收藏有随机特征，影响价值。</p><p id="2859" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">彩票:</strong>除了传统的彩票游戏，DeFi生态系统还允许创新，如“无损失”彩票。</p><p id="30f2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于区块链的性质，矿工可以创建/丢弃块，并“重新滚动”骰子，直到找到一个特定的值，没有可操纵的随机性不能在链上创建。</p><blockquote class="li lj lk"><p id="91ee" class="iq ir ll is b it iu iv iw ix iy iz ja lm jc jd je ln jg jh ji lo jk jl jm jn hm dt translated">在所有情况下，尤其是在出现大额金额的彩票和NFT生成中，必须使用不可操纵的随机数。</p></blockquote><h2 id="91bb" class="lp kf ht bd kg lq lr ls kk lt lu lv ko jb lw lx ks jf ly lz kw jj ma mb la mc dt translated">当前解决方案</h2><p id="fe34" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated">当前大多数解决方案都使用Oracle离线。我们必须请求数字，这些数字(一旦可用)将使我们能够执行我们的定制逻辑。在本文中，我们将探索:</p><ul class=""><li id="b8cc" class="md me ht is b it iu ix iy jb mf jf mg jj mh jn mi mj mk ml dt translated"><strong class="is hu">证人网</strong></li><li id="eb0e" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><strong class="is hu"> API3 QRNG </strong></li><li id="b824" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><strong class="is hu">链环VRF </strong></li></ul><p id="b183" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本文中，我将展示如何结合意式冰淇淋实现这三种解决方案。</p></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><h2 id="abd1" class="lp kf ht bd kg lq lr ls kk lt lu lv ko jb lw lx ks jf ly lz kw jj ma mb la mc dt translated">自动化和随机性</h2><p id="5c56" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated">智能合约中对自动执行方法的需求与日俱增。然而，“大爆炸”将会发生，当区块链技术将扩展到非区块链业务。</p><p id="bdb9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">例如，所有过程(无论是哪个行业)都要接受质量控制，其中<strong class="is hu">依靠随机抽样来运行控制</strong>以确保不存在偏差。</p><p id="67aa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于在区块链通过神谕获取随机数的特殊性，需要两种方法:</p><ul class=""><li id="6651" class="md me ht is b it iu ix iy jb mf jf mg jj mh jn mi mj mk ml dt translated">一个向神谕请求随机数</li><li id="1c39" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated">第二个是当号码可用时的回拨。Chainlink Vrf和API3 QRNG执行你契约中的回调代码，然而Witnet不执行。</li></ul><blockquote class="li lj lk"><p id="ccb5" class="iq ir ll is b it iu iv iw ix iy iz ja lm jc jd je ln jg jh ji lo jk jl jm jn hm dt translated">意式冰淇淋通过创建一个任务来处理这种情况<strong class="is hu">，它将检查随机数何时可用，并执行任何自定义逻辑</strong>。运行一次后，此任务将被取消</p></blockquote><p id="0614" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我们的展示项目中，我们将为Witnet、Chainlink和API3演示这个用例。</p></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><h1 id="070d" class="ke kf ht bd kg kh my kj kk kl mz kn ko kp na kr ks kt nb kv kw kx nc kz la lb dt translated"><strong class="ak">展示案例项目</strong></h1><p id="19ad" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated">让我们想象一下，我们经营一家汽车工厂，我们的主要装配机器有20个部件。虽然我们做定期维护(自动化的另一个例子)，我们被要求每10分钟运行一次随机质量控制。这看起来是这样的:</p><ol class=""><li id="39b6" class="md me ht is b it iu ix iy jb mf jf mg jj mh jn nd mj mk ml dt translated">选择2个组件，每个组件可以每小时控制一次。</li><li id="d2bf" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn nd mj mk ml dt translated">选择控制级别:快速、中等或密集</li><li id="fbeb" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn nd mj mk ml dt translated">从500名员工中挑选一名来负责质量控制</li></ol><p id="332c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了运行防篡改质量控制并避免偏差，我们的系统必须为所有步骤生成随机结果。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff ne"><img src="../Images/b111c4008e91254d958f3c04a91e02c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b-Hg0eB5z3YT6mlyw5yMxg.png"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">Landing page</figcaption></figure><p id="fec6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">回购可以在<a class="ae lh" href="https://github.com/donoso-eth/schedule-the-randomness" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><p id="cc2e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将使用<strong class="is hu">意式冰淇淋作为仪式的主持人</strong>协调所有要运行的任务，比如调用oracles、检查结果是否可用以及更新组件数组。等等..Goerli上部署的dapp在<a class="ae lh" href="https://gelato-vrf.web.app" rel="noopener ugc nofollow" target="_blank">https://gelato-vrf . web . app</a>上直播</p><p id="3ef0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">主要合同“ScheduleTheRandomness”可在此处找到<a class="ae lh" href="https://github.com/donoso-eth/schedule-the-randomness/blob/master/hardhat/contracts/ScheduleTheRandomness.sol" rel="noopener ugc nofollow" target="_blank">。以太扫描验证的日志位于:</a></p><div class="nf ng fm fo nh ni"><a href="https://goerli.etherscan.io/address/0x6a0C105A74Ed3359ADDd877049BC129e224b48c0#code" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab ej"><div class="nk ab nl cl cj nm"><h2 class="bd hu fv z el nn eo ep no er et hs dt translated">ScheduleTheRandomness |地址0x 6a 0c 105 a 74 ed 3359 addd 877049 BC 129 e 224 b 48 c 0 |以太扫描</h2><div class="np l"><h3 class="bd b fv z el nn eo ep no er et ek translated">总共3个交易中的最近3个//spdx-license-identifier:unlicense pragma solidity ^0.8.0；导入…</h3></div><div class="nq l"><p class="bd b gc z el nn eo ep no er et ek translated">goerli.etherscan.io</p></div></div></div></a></div></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><h2 id="3ff0" class="lp kf ht bd kg lq lr ls kk lt lu lv ko jb lw lx ks jf ly lz kw jj ma mb la mc dt translated">步骤1)意式冰淇淋作为仪式的主人</h2><p id="8f21" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated">我们将使用冰淇淋来运行计划，每15分钟我们将做质量控制。为此，我们必须:</p><p id="174c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">a)连接意式冰淇淋基础设施，首先，我们必须复制<code class="eh nr ns nt nu b">IOPS.sol</code>和<code class="eh nr ns nt nu b">OpsReady.sol</code>这两个文件都可以在</p><div class="nf ng fm fo nh ni"><a href="https://github.com/donoso-eth/schedule-the-randomness/tree/master/hardhat/contracts/gelato" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab ej"><div class="nk ab nl cl cj nm"><h2 class="bd hu fv z el nn eo ep no er et hs dt translated">随机时间表/安全帽/合同/在多诺索-eth/随机时间表的冰淇淋</h2><div class="np l"><h3 class="bd b fv z el nn eo ep no er et ek translated">在GitHub上创建一个帐户，为donoso-eth/schedule-the randomness开发做贡献。</h3></div><div class="nq l"><p class="bd b gc z el nn eo ep no er et ek translated">github.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa jy ni"/></div></div></a></div><p id="c4cc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">b)复制文件后，我们可以插入导入并继承合同:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ob oc l"/></div></figure><p id="e790" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">c)创建一个定时任务:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ob oc l"/></div></figure><p id="2d9a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该任务将检查15分钟是否已经过去，以及旧的控制是否仍在运行<code class="eh nr ns nt nu b">checkQualityPlanIsActive()</code>，然后运行<code class="eh nr ns nt nu b">doQualityControl()</code>方法，在该方法中，控制流从请求随机数的不同调用开始。</p><p id="649d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">gelato的一个非常有趣的用法是，一旦随机数可用，就执行自定义逻辑。在Witnet的情况下，我们必须这样做，因为Witnet不提供回调，但我们也可以在Chainlink或API3中实现它，以便对回调的执行有更多的控制。</p><blockquote class="li lj lk"><p id="7392" class="iq ir ll is b it iu iv iw ix iy iz ja lm jc jd je ln jg jh ji lo jk jl jm jn hm dt translated">我们可以使用<strong class="is hu">意式冰淇淋来创建对随机预言机的请求</strong>，以及<strong class="is hu">控制回调执行</strong></p></blockquote><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff od"><img src="../Images/c23371f86e9f30a9181358e037a296eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nJ4tsSjk_BDhwYy3QsmmiQ.png"/></div></div></figure><h2 id="cf36" class="lp kf ht bd kg lq lr ls kk lt lu lv ko jb lw lx ks jf ly lz kw jj ma mb la mc dt translated"><strong class="ak">步骤2) </strong> API3 QRNG为随机成分</h2><p id="16b1" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated">在这一步中，我们将使用<a class="ae lh" href="https://docs.api3.org/qrng/" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">API3 QRNG</strong></a>by<a class="ae lh" href="https://api3.org/" rel="noopener ugc nofollow" target="_blank">API3</a>生成2个要控制的随机分量。</p><p id="85eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">a)我们需要将API3基础设施连接到我们的合同中，这意味着:<br/> -有必要将<code class="eh nr ns nt nu b">npm i @api3/airnode-protocol</code>和<code class="eh nr ns nt nu b">import “@api3/airnode-protocol/contracts/rrp/requesters/RrpRequesterV0.sol";</code>添加到您的合同中。</p><p id="b434" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">-我们必须继承契约，并在构造函数中传递相应链的airnode地址，地址可以在这里找到<a class="ae lh" href="https://docs.api3.org/qrng/reference/chains.html" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ob oc l"/></div></figure><p id="2f19" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">b)为了取回QRNG，我们必须资助airnode。为此，我们必须创建并资助一个<strong class="is hu"> <em class="ll">赞助商钱包</em> </strong>，要么通过<strong class="is hu"><em class="ll"/></strong><a class="ae lh" href="https://docs.api3.org/airnode/v0.7/reference/packages/admin-cli.html" rel="noopener ugc nofollow" target="_blank">API3管理CLI </a>要么通过从合同地址中派生出赞助商钱包地址:<br/> - <code class="eh nr ns nt nu b">npm i @api3/airnode-admin</code>派生出赞助商钱包<br/> -调用deriveSponsorWalletAddress()</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ob oc l"/></div></figure><p id="e120" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">xpub和airnode参数可以在API3提供者部分<a class="ae lh" href="https://docs.api3.org/qrng/reference/providers.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><blockquote class="li lj lk"><p id="9390" class="iq ir ll is b it iu iv iw ix iy iz ja lm jc jd je ln jg jh ji lo jk jl jm jn hm dt translated">API3 QRNG快速回顾:<strong class="is hu">我们设置并连接了基础设施</strong>，并且<strong class="is hu">创建了(&amp;资助)一个赞助商钱包</strong>来支付交易。现在我们将设置参数和各自的方法</p></blockquote><p id="1016" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">c)设置参数。我们需要将以下参数传递给我们的契约</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ob oc l"/></div></figure><p id="e48c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh nr ns nt nu b"><strong class="is hu">endpointIdUint256 </strong></code>和<code class="eh nr ns nt nu b"><strong class="is hu">endpointIdUintArray256</strong></code> <strong class="is hu"> </strong>也可以在API3提供者部分<a class="ae lh" href="https://docs.api3.org/qrng/reference/providers.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><p id="415e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">d)在最后一步中，我们将需要创建两个方法<code class="eh nr ns nt nu b">airnodeRrp.makeFullRequest()</code>和一个回调函数，在我们的例子中是请求中定义的<code class="eh nr ns nt nu b">fullfillRandomComponents()</code>。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="oe oc l"/></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">API3 extract snippet</figcaption></figure></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><h2 id="97e8" class="lp kf ht bd kg lq lr ls kk lt lu lv ko jb lw lx ks jf ly lz kw jj ma mb la mc dt translated">步骤2:随机控制类型的Witnet</h2><p id="5e48" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated">在此步骤中，我们将请求一个介于1和3之间的随机数来代表三种不同的控制类型(快速、中等、密集)。为此，我们将通过<a class="ae lh" href="https://witnet.io/" rel="noopener ugc nofollow" target="_blank"> Witnet oracle </a>使用<a class="ae lh" href="https://docs.witnet.io/smart-contracts/witnet-randomness-oracle/randomness-contract" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">随机性合同</strong> </a>。</p><p id="9ee3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">a)我们需要将API3基础设施连接到我们的合同中:<br/> <code class="eh nr ns nt nu b">npm i witnet-solidity-bridge</code>和<code class="eh nr ns nt nu b">import “witnet-solidity-bridge/contracts/interfaces/IWitnetRandomess.sol";</code>。</p><p id="75e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">b)为了与随机性契约进行交互，我们需要在我们的契约中创建它的一个实例。首先，我们必须复制我们正在处理的链地址<a class="ae lh" href="https://docs.witnet.io/smart-contracts/witnet-randomness-oracle/contract-addresses" rel="noopener ugc nofollow" target="_blank">(契约地址)</a>。在这个特殊的例子中，我们在Goerli上，所以我们将通过部署传递Goerli的随机性契约地址。之后，在构造函数中，我们将创建一个随机契约的实例</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ob oc l"/></div></figure><p id="b6bc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">c)我们将向Witnet请求一个随机数</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ob oc l"/></div></figure><p id="eefd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">d)不像API3和Chainlink Vrf Witnet不提供回调，但是，Randomness契约提供了<code class="eh nr ns nt nu b">isRandomized()</code>，一个返回随机数是否可以检索到的方法。一旦<code class="eh nr ns nt nu b">isRandomized()</code>为真，我们称之为<code class="eh nr ns nt nu b">witnet.random(3,0,latestRandomizingBlok);</code></p><blockquote class="li lj lk"><p id="7578" class="iq ir ll is b it iu iv iw ix iy iz ja lm jc jd je ln jg jh ji lo jk jl jm jn hm dt translated">我们将使用意式冰淇淋创建一个“动态”任务，该任务将检查<code class="eh nr ns nt nu b">isRandomized()</code>何时返回true，然后将检索随机数并继续控制流</p></blockquote><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="oe oc l"/></div></figure><p id="d6ae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在下图中，我们可以看到两个任务，第一个任务每15分钟运行一次，用于总体质量控制，第二个任务仅在等待Witnet随机数时才处于活动状态。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff of"><img src="../Images/d9effabf68f14e1a515a933e3b98681b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ssH7TwY0zehKn9W2v7NUww.png"/></div></div></figure><h2 id="7865" class="lp kf ht bd kg lq lr ls kk lt lu lv ko jb lw lx ks jf ly lz kw jj ma mb la mc dt translated">第三步:Chainlink Vrf选择员工</h2><p id="1355" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated">我们的最后一步是挑选一名员工来运行控制。为了做到这一点，我们将使用<a class="ae lh" href="https://chain.link/vrf" rel="noopener ugc nofollow" target="_blank"> Chainlink Vrf </a>来获得1到500(员工总数)之间的一个随机数。</p><p id="87ed" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">a) Chainlink Vrf要求我们为link创建一个受资助的订阅，稍后我们的合同(消费者合同)将使用该订阅来支付请求随机数的费用。你可以在这里做那个<a class="ae lh" href="https://vrf.chain.link/" rel="noopener ugc nofollow" target="_blank"/></p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff og"><img src="../Images/5c2cd252bc5e50af97af382c39838928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fxqmk-xBKiB7Md6INt4gPA.png"/></div></div></figure><p id="8e01" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建订阅并获得资金后，您可以作为消费者添加您的合同。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff oh"><img src="../Images/970a8cc94c76c1f9820e97dc42344f6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oQJin_sXsNAEr00_4p3PVg.png"/></div></div></figure><p id="8230" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将您的合同作为消费者添加到订阅后，我们可以继续进行设置</p><p id="231c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">b)我们需要将Chainlink Vrf基础设施纳入我们的合同，这意味着:</p><p id="3314" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">——<code class="eh nr ns nt nu b">npm i @chainlink/contracts</code>，还有</p><pre class="jp jq jr js fq oi nu oj ok aw ol dt"><span id="8271" class="lp kf ht nu b fv om on l oo op">import “@chainlink/contracts/src/v0.8/interfaces/VRFCoordinatorV2Interface.sol”; <br/>import “@chainlink/contracts/src/v0.8/VRFConsumerBaseV2.sol”<br/></span></pre><p id="7a97" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">-继承契约，并在构造函数中传递相应链的订阅ID和VRF协调器地址。地址可以在这里找到<a class="ae lh" href="https://docs.chain.link/docs/vrf/v2/supported-networks/" rel="noopener ugc nofollow" target="_blank"/>(在我们的例子中是Goerli)</p></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ob oc l"/></div></figure><p id="1808" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">c)现在我们的融资机制已经准备好，契约基础设施也已经连接好，我们必须编写我们的请求和回调方法<code class="eh nr ns nt nu b">COORDINATOR.requestRandomWords()</code>和<code class="eh nr ns nt nu b">fullfillRandomwords()</code>。当调用<code class="eh nr ns nt nu b">requestRandomWords(),</code>时，Chainlink Vrf为我们提供了设置不同参数的能力。代码和参数可以在这里找到:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="oe oc l"/></div></figure></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><h1 id="eb3d" class="ke kf ht bd kg kh my kj kk kl mz kn ko kp na kr ks kt nb kv kw kx nc kz la lb dt translated">结论</h1><p id="d5b9" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated">在我个人看来，本文中提到的所有技术(意式冰淇淋网络、Chainlink Vrf、Witnet和API3 QRNG)都非常易于使用和学习。</p><p id="f6ac" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一步一步，web3社区正在以一种非常有效的方式解决区块链固有的问题。<strong class="is hu">以同样的方式，意式冰淇淋网络解决了预定任务</strong>的问题，这里分析的三种<strong class="is hu"> Vrf技术</strong>提供了一种<strong class="is hu">非常高效的方式来创建和消耗链上随机数</strong>。</p><p id="77d2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当处理随机性时，意式冰淇淋网络可以以不同的方式使用，从在特定时间点调用随机数，到一旦随机数已经被传递，等待满足其他条件以便执行附加逻辑。</p><p id="0300" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我们的showcase项目中，为了简单起见，我们已经连续执行了三次随机调用，但是我们也可以并行执行随机调用，并创建一个任务来检查这三个数字是否都已经可用，并执行自定义逻辑。</p><p id="9d1b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">展望未来<strong class="is hu">,我们可以预见，通过提供一种非常优雅的方式来调度随机数请求和编排回调和执行逻辑，像意式冰淇淋网络这样的自动化协议是Vrf生成解决方案的完美匹配</strong>。</p></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><p id="925e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">感谢您的阅读！！</p><p id="8b52" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您有任何问题或意见，请发微博给我</p></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><h1 id="daa2" class="ke kf ht bd kg kh my kj kk kl mz kn ko kp na kr ks kt nb kv kw kx nc kz la lb dt translated">资源</h1><p id="8813" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hm dt translated"><strong class="is hu">API3<br/></strong><a class="ae lh" href="https://api3.org/" rel="noopener ugc nofollow" target="_blank">API3</a><br/><a class="ae lh" href="https://docs.api3.org/qrng/" rel="noopener ugc nofollow" target="_blank">API3 qrg</a><br/><a class="ae lh" href="https://docs.api3.org/qrng/reference/chains.html" rel="noopener ugc nofollow" target="_blank">air node addresses</a><br/><a class="ae lh" href="https://docs.api3.org/qrng/reference/providers.html" rel="noopener ugc nofollow" target="_blank">API3提供者</a> <br/> <a class="ae lh" href="https://docs.api3.org/airnode/v0.7/reference/packages/admin-cli.html" rel="noopener ugc nofollow" target="_blank"> API3管理CLI </a></p><p id="71b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">Witnet<br/></strong><a class="ae lh" href="https://witnet.io/" rel="noopener ugc nofollow" target="_blank">Witnet oracl</a>e<br/><a class="ae lh" href="https://docs.witnet.io/smart-contracts/witnet-randomness-oracle/randomness-contract" rel="noopener ugc nofollow" target="_blank">随机性合同</a> t <br/> <a class="ae lh" href="https://docs.witnet.io/smart-contracts/witnet-randomness-oracle/contract-addresses" rel="noopener ugc nofollow" target="_blank"> Witnet合同地址</a></p><p id="8589" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">链环Vrf <br/> </strong> <a class="ae lh" href="https://chain.link/vrf" rel="noopener ugc nofollow" target="_blank">链环Vrf </a> <br/> <a class="ae lh" href="https://vrf.chain.link/" rel="noopener ugc nofollow" target="_blank">链环龙头</a> <br/> <a class="ae lh" href="https://docs.chain.link/docs/vrf/v2/supported-networks/" rel="noopener ugc nofollow" target="_blank"> VRf协调人地址</a> s</p><p id="8339" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">意式冰淇淋<br/>T24<a class="ae lh" href="https://www.gelato.network/" rel="noopener ugc nofollow" target="_blank">意式冰淇淋网</a>T27<a class="ae lh" href="https://app.gelato.network/" rel="noopener ugc nofollow" target="_blank">意式冰淇淋OPS UI </a></strong></p><blockquote class="oq"><p id="1700" class="or os ht bd ot ou ov ow ox oy oz jn ek translated">交易新手？尝试<a class="ae lh" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae lh" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>