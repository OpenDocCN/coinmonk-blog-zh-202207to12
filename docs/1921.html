<html>
<head>
<title>Learn Solidity lesson 19. Timestamp.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习第19课坚固性。时间戳。</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/learn-solidity-lesson-19-timestamp-7ba91290c245?source=collection_archive---------2-----------------------#2022-08-09">https://medium.com/coinmonks/learn-solidity-lesson-19-timestamp-7ba91290c245?source=collection_archive---------2-----------------------#2022-08-09</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/a17f3e5b5ca6f95a81878d0b67acde6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLu2aJlew1_DvI0Q1_2fHw.jpeg"/></div></div></figure><p id="e5b8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在下面的课程中，我们将看到一些全局变量的使用。让我们从<em class="jz"> block.timestamp </em>属性开始，该属性返回从Unix时间到在网络上挖掘(验证)该块的时刻之间经过的时间值，以秒为单位。</p><p id="b319" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这是一个让学习者感到困惑的话题。由于区块链是一个分散的网络，每个事务由网络上的所有节点执行，并且它们在不同的时间执行。那么什么是街区时间呢？</p><p id="ca44" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了理解这一点，我们必须了解一个区块是如何添加到区块链的。如果共识机制是工作证明，则可以对其进行挖掘，如果共识机制是利害关系证明，则可以对其进行验证。无论如何，该块通过一个和单个节点被“添加”到区块链。</p><p id="c40a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我说得更清楚些。每个节点最终都会将该块添加到其区块链中，但只有一个节点可以决定链中的下一个块是什么。这个节点以下面的方式获得决定哪个块的权利:在工作证明的情况下，通过发现解决困难问题的随机数，或者在利害关系证明的情况下，随机地。</p><p id="0705" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">无论如何，每个区块链区块都有一个关联的帐户，负责最初将其添加到链中。正是这个帐户(这个节点)决定了添加块的确切时间，也就是说，谁决定了时间戳将是什么(有一些限制)。</p><p id="be89" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">当EVM在代码中遇到以下表达式时:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="33b2" class="kj kk ht kf b fv kl km l kn ko">block.timestamp</span></pre><p id="27a6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">它所做的是在块的头中检查其时间戳的值。每个数据块都有一个包含大量信息的头，包括它的时间戳。</p><h1 id="7488" class="kp kk ht bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">块和事务哪个先出现？</h1><p id="7dc6" class="pw-post-body-paragraph jb jc ht jd b je lm jg jh ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">一组事务形成一个块，但是事务需要来自该块的信息来读取属性，比如它们的时间戳。那么，事务和块哪个先出现？</p><p id="2460" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">他们同时出现；或者我们可以考虑街区优先。事务被分组到一个块中，并且那些事务基于关于该块的信息被执行。</p><p id="b63a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们看看这是怎么发生的。下面来看看合同。</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="65cc" class="kj kk ht kf b fv kl km l kn ko">pragma solidity ^0.8.7;<br/>    <br/>contract Timestamp {</span><span id="f99b" class="kj kk ht kf b fv lr km l kn ko">   uint public timestamp;</span><span id="e625" class="kj kk ht kf b fv lr km l kn ko">   function saveTimestamp() public {<br/>      timestamp = block.timestamp;<br/>   }</span><span id="b9ba" class="kj kk ht kf b fv lr km l kn ko">}</span></pre><p id="1a64" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">它所做的只是将<em class="jz">块.时间戳</em>分配给变量<code class="eh ls lt lu kf b">timestamp</code>。现在让我们发送一个事务来调用这个函数，它将包含在一个块中。块信息被记录在块头中。使用etherscan，我们可以检索这些信息，如下图所示。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lv"><img src="../Images/d2a53662cb4d3246b32e785d8bbf3cfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FOAy_rHzM_VBHnWz1zRw-A.png"/></div></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">Information about the block that includes the transaction.</figcaption></figure><p id="46ee" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">请注意块时间戳值:2022年8月8日，下午3:40:23。现在让我们检索分配给变量<code class="eh ls lt lu kf b">timestamp</code>的<em class="jz"> block.timestamp </em>的值。</p><p id="428a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">由于变量<code class="eh ls lt lu kf b">timestamp</code>是公共的，Solidity自动生成一个函数来检索它(一个getter函数)。结果可以在下图中看到。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff ma"><img src="../Images/a7da41881f9044145b1f7e7dfd9f9e32.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*nt3kNvw4spnUwtW4k6mF3g.png"/></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">The current value of the variable timestamp.</figcaption></figure><p id="7f3d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们将变量值转换为人类可以理解的日期/时间。请记住，时间戳是自1970年1月1日午夜以来经过的秒数。</p><p id="6c15" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果你热衷于做数学，你可以用纸和笔进行转换。或者使用像unixtimestamp.com/ T4这样的网站来进行转换。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mc"><img src="../Images/2264f1f76c0f971840aaba27a1dc369d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51o6NXDq6aPsRgkYaqFYBQ.png"/></div></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">Converting a value in seconds to date format.</figcaption></figure><p id="bbcb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们可以看到，转换后的值与块头相同:2022年8月8日15:40:23。每当我们执行一个新的事务时，变量<code class="eh ls lt lu kf b">timestamp </code>将接收新的值，以秒为单位，注册在包含该事务的块的头中。</p><h1 id="83d4" class="kp kk ht bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">带有block.timestamp的时间</h1><p id="a6fc" class="pw-post-body-paragraph jb jc ht jd b je lm jg jh ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">我们可以使用<em class="jz"> block.timestamp </em>属性来处理智能合约中的时间流逝。让我们写一份合同来做这件事。</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="7365" class="kj kk ht kf b fv kl km l kn ko">contract AboutTime {</span><span id="f49e" class="kj kk ht kf b fv lr km l kn ko">   uint public start;</span><span id="8e74" class="kj kk ht kf b fv lr km l kn ko">   constructor() {<br/>      start = block.timestamp;<br/>   }</span><span id="048f" class="kj kk ht kf b fv lr km l kn ko">   function withdraw() public {<br/>      require(block.timestamp &gt; start + 1 hours);<br/>      payable(msg.sender).transfer(address(this).balance);<br/>   }<br/>    <br/>}</span></pre><p id="606e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">上面的合同很简单。构造函数仅在部署时执行，并在部署契约时初始化变量<code class="eh ls lt lu kf b">start</code>。</p><p id="cf93" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">另一个功能，<code class="eh ls lt lu kf b">widthdraw</code>，可以用来将合同中包含的所有以太网发送到呼叫者的地址。下面的句子做到了这一点。</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="9304" class="kj kk ht kf b fv kl km l kn ko">payable(msg.sender).transfer(address(this).balance);</span></pre><p id="1010" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在其他课程中，我会更好地解释这句话中包含的所有项目。我现在穿上它只是为了激起你的好奇心。现在，只要相信它发送以太到一个地址。</p><p id="0a08" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我想引起注意的是下面这句话。</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="1c3d" class="kj kk ht kf b fv kl km l kn ko">require(block.timestamp &gt; start + 1 hours);</span></pre><p id="5c73" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要求交易执行的时刻(包含交易的块的标题中包含的日期)至少在合同部署后1小时。</p><p id="d85f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">当在部署后不到1小时尝试调用此函数时，事务将被恢复。例如，这种方法可用于强制某些资产(如乙醚或代币)在合同中保留一段时间，并且只能在该时间后提取。</p><h1 id="a6f4" class="kp kk ht bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">时间单位</h1><p id="9478" class="pw-post-body-paragraph jb jc ht jd b je lm jg jh ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">坚实度接受一些时间单位。他们是:</p><ul class=""><li id="ce04" class="md me ht jd b je jf ji jj jm mf jq mg ju mh jy mi mj mk ml dt translated">秒</li><li id="f99d" class="md me ht jd b je mm ji mn jm mo jq mp ju mq jy mi mj mk ml dt translated">分钟</li><li id="79b8" class="md me ht jd b je mm ji mn jm mo jq mp ju mq jy mi mj mk ml dt translated">小时</li><li id="f6be" class="md me ht jd b je mm ji mn jm mo jq mp ju mq jy mi mj mk ml dt translated">天</li><li id="3035" class="md me ht jd b je mm ji mn jm mo jq mp ju mq jy mi mj mk ml dt translated">周；星期</li></ul><p id="83b7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这些表达式以秒为单位转换为各自的值。我们可以在下面的声明中看到这一点。</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="5677" class="kj kk ht kf b fv kl km l kn ko">uint public constant week = 1 weeks;</span></pre><p id="20ac" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">由于变量是公共的，我们可以称它为。结果可以在下图中看到。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff mr"><img src="../Images/bbf845cec10a78365e039314d692db6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*fzP35krNPHTq1815TfL1Cg.png"/></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">The week unit is an alias for the value of a week, in seconds.</figcaption></figure><p id="9214" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">感谢阅读！</strong></p><p id="31d7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">欢迎对本文提出意见和建议。</p><p id="99b6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">欢迎任何投稿。<a class="ae mb" href="http://www.buymeacoffee.com/jpmorais" rel="noopener ugc nofollow" target="_blank">www.buymeacoffee.com/jpmorais</a></p><blockquote class="ms"><p id="0cf9" class="mt mu ht bd mv mw mx my mz na nb jy ek translated">加入Coinmonks <a class="ae mb" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae mb" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="a8f7" class="kp kk ht bd kq kr ks kt ku kv kw kx ky kz nc lb lc ld nd lf lg lh ne lj lk ll dt translated">另外，阅读</h1><ul class=""><li id="abae" class="md me ht jd b je lm ji ln jm nf jq ng ju nh jy mi mj mk ml dt translated"><a class="ae mb" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">密码本交易平台</a> | <a class="ae mb" rel="noopener" href="/coinmonks/coinmama-review-ace5641bde6e"> Coinmama审核</a></li><li id="18a6" class="md me ht jd b je mm ji mn jm mo jq mp ju mq jy mi mj mk ml dt translated"><a class="ae mb" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度加密交易所</a> | <a class="ae mb" rel="noopener" href="/coinmonks/bitcoin-savings-account-e65b13f92451">比特币储蓄账户</a></li><li id="c904" class="md me ht jd b je mm ji mn jm mo jq mp ju mq jy mi mj mk ml dt translated"><a class="ae mb" href="https://coincodecap.com/okex-kucoin" rel="noopener ugc nofollow" target="_blank"> OKEx vs KuCoin </a> | <a class="ae mb" href="https://coincodecap.com/celsius-alternatives" rel="noopener ugc nofollow" target="_blank">摄氏替代品</a> | <a class="ae mb" href="https://coincodecap.com/buy-vechain" rel="noopener ugc nofollow" target="_blank">如何购买VeChain </a></li><li id="26fa" class="md me ht jd b je mm ji mn jm mo jq mp ju mq jy mi mj mk ml dt translated"><a class="ae mb" href="https://coincodecap.com/binance-futures-trading" rel="noopener ugc nofollow" target="_blank">币安期货交易</a>|<a class="ae mb" href="https://coincodecap.com/mudrex-3commas-etoro" rel="noopener ugc nofollow" target="_blank">3 comas vs Mudrex vs eToro</a></li><li id="a60d" class="md me ht jd b je mm ji mn jm mo jq mp ju mq jy mi mj mk ml dt translated"><a class="ae mb" href="https://coincodecap.com/buy-monero" rel="noopener ugc nofollow" target="_blank">如何购买Monero </a> | <a class="ae mb" href="https://coincodecap.com/idex-review" rel="noopener ugc nofollow" target="_blank"> IDEX评论</a> | <a class="ae mb" href="https://coincodecap.com/bitkan-trading-bot" rel="noopener ugc nofollow" target="_blank"> BitKan交易机器人</a></li></ul></div></div>    
</body>
</html>