# 智能合同功能暴露了更深层次的软件漏洞

> 原文：<https://medium.com/coinmonks/smart-contract-capabilities-have-exposed-deeper-software-vulnerabilities-100523af0db3?source=collection_archive---------48----------------------->

**网络犯罪分子更频繁地利用分散金融平台的漏洞来获取加密货币，这让投资者损失了金钱**

根据 Chainalysis 的分析，今年前七个月，加密货币在攻击中被盗的金额达到了惊人的 19 亿美元，比去年同期增长了 60%。DeFi 协议是 2022 年几起最重大的加密货币盗窃案的目标，包括 3 月份价值 6.25 亿美元的电脑游戏 Axie Infinity 的 Ronin 网络黑客攻击。

DeFi 革命巩固了智能合约的地位。广泛的智能合约功能也揭示了支持分散金融服务的更深层次的不完善。

DeFi 协议的大多数盗窃都是由智能合同代码中的错误引起的。

智能合约中的漏洞很快被黑客利用。2022 年，Defiyield rekt [数据库](https://defiyield.app/rekt-database)中报告了 33 个智能合同漏洞。这些攻击造成的损失总计 12.46 亿美元。

一些常见的漏洞是重入、未处理的异常、锁定以太、事务顺序依赖、整数溢出和下溢以及无限制的操作。

让我们来看看历史上几起著名的抢劫案，了解发生了什么以及它们是如何被利用的。

**智能合约漏洞实例**

当谈到智能合同时，他们正在积极接管技术市场。然而，智能合同漏洞有可能导致远比它们旨在解决的问题更严重的问题，从对人们日常生活至关重要的行业运营中的严重问题，到特定公司在金钱和声誉方面不可挽回的损失。

考虑虫洞的情况，其中一系列事件最终导致 120k ETH 从虫洞桥上真正移除。攻击实际上如下进行:

*   通过调用 post_vaa，攻击者创建了一个验证器动作批准(vaa)。
*   为了铸造攻击中夺取的 120，000 ETH，这种 VAA 被用于完全包装的调用中。
*   攻击者合法地从桥上取走了铸造的代币。

VAA 生成过程的充分签名验证中的漏洞是导致攻击成功的原因。签名验证的角色委派了好几次，从 post_vaa 到 verify_signatures 再到 Secp256k1。

问题是，为了确保 Secp256k1 在 verify_signatures 之前被调用，虫洞契约调用了一个名为 load_instruction_at 的不赞成使用的命令。然而，这个命令不检查系统地址的值，指令 sysvar。

攻击者使用之前生成的名为 Secp256k1 contract 的帐户来构建虚假的 sysvar 指令版本。攻击者没有使用 sysvar 指令，而是传递了这个帐户。

Secp256k1 先前被调用的检查已经通过(即使它是在一个完全不同的上下文中)，所以签名被认为已经被正确验证。为了铸造被盗的 ETH，这产生了产生合法 VAA 所需的有效签名。

一系列的签名验证授权允许虫洞入侵。伪造的签名未经验证就被允许通过，因为开发人员使用了一个单一的、被否决的函数(它不验证地址)。

由于使用不推荐使用的函数而导致的糟糕的代码安全性使该项目损失了 3 亿多美元。

非常重要的是要注意，智能合约不是一个可以随时更新安全漏洞的网站或应用程序。与离线的传统系统相比，智能合同的结果是区块链网络记录，因此它不容易被退回或更新。

**Rari Capital**

2021 年 5 月 8 日，DeFi 项目 Rari Capital 成为智能合同黑客的目标。攻击者窃取了大约 60%的项目用户资金或价值约 1100 万美元的代币。对 Rari Capital 的攻击利用了该项目的智能合约计算流动性份额的方式。

问题中的以太坊池与 Alpha Finance 相关联，并将 ETH 存入 Alpha Finance 的 ibETH 令牌以产生收益。在签订本合同时，Rari Capital 团队不知道 Alpha Finance ibETH 池的两个方面:

**总 ETH 计算:**Rari Capital 的以太坊池确定 ibETH 的值为`ibETH. totalETH() / total supply= ibETH ()`。事实上，在 Alpha Finance 的 ibETH.work 函数中，ibETH.totalETH()的值可能会发生变化，但这个项目并不知道这一点。因此，有可能抬高 Rari Capital 资产池中 ibETH 的价值。

**契约访问:**项目也不知道在这个函数中，ibETH.work 的任何用户都有权调用他们喜欢的任何契约。这允许 Rari Capital 的以太坊池从函数内部调用取款和存款函数。

攻击者利用这两个元素来实施他们的攻击。他们通过使用 ibETH.work 函数来增加 Rari Capital 资产池中 ibETH 的价值，从而夸大了 ibETH.totalETH 的价值。

然后，他们使用 Rari Capital Ethereum 池的提款功能，请求比他们最初由于价值膨胀而投入的更多的 ETH。这让他们有机会榨干其他 Rari Capital 客户提供的价值。

**遗言**

几乎所有的 DeFi 应用程序都使用货币的数学运算。这些程序包括增加或减少帐户余额，以及转换代币汇率。攻击者经常瞄准算术运算漏洞。

总部位于美国的渗透测试公司 Bishop Fox 进行的研究显示，2021 年对 DeFI 项目的攻击中，51%的攻击使用智能合约漏洞作为主要的进入媒介，平台协议和设计问题占 18%。大多数攻击被认为是简单的。

根据区块链研究公司 Elliptic 的说法，这些协议“特别容易受到黑客攻击”，因为它们的开源代码、庞大的资产池和快速扩张可能会留下安全最佳实践的空白。

> 交易新手？试试[密码交易机器人](/coinmonks/crypto-trading-bot-c2ffce8acb2a)或者[复制交易](/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c)