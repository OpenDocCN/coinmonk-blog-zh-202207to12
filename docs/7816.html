<html>
<head>
<title>Ethernaut Level 7 Force [Foundry-Hardhat]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太7级力量[铸造-安全帽]</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethernaut-level-7-force-foundry-hardhat-581e92687422?source=collection_archive---------24-----------------------#2022-12-22">https://medium.com/coinmonks/ethernaut-level-7-force-foundry-hardhat-581e92687422?source=collection_archive---------24-----------------------#2022-12-22</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/4430666aaf0a88d66a3f8ea61d8837dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BSgzSR2sK19hYPoEWU0Qkg.png"/></div></div></figure><blockquote class="jb"><p id="9df0" class="jc jd ht bd je jf jg jh ji jj jk jl ek translated"><em class="jm"/><a class="ae jn" href="https://github.com/Chirag21/Ethernaut-solutions" rel="noopener ugc nofollow" target="_blank"><em class="jm">以太解决方案</em> </a> <em class="jm">库包含使用Foundry和Hardhat的解决方案。</em></p></blockquote><h1 id="c831" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">目标</h1><ul class=""><li id="636c" class="km kn ht ko b kp kq kr ks kt ku kv kw kx ky jl kz la lb lc dt translated">使合同余额大于零。</li></ul></div><div class="ab cl ld le hb lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hm hn ho hp hq"><p id="1070" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated"><code class="eh mb mc md me b">selfdestruct(address payable recipient)</code></p><p id="f058" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated"><code class="eh mb mc md me b">selfdestruct</code>销毁当前合同，将其资金发送到给定地址，并结束执行。请注意，它继承了EVM的一些注意事项:</p><ul class=""><li id="c2ac" class="km kn ht ko b kp lm kr lp kt mf kv mg kx mh jl kz la lb lc dt translated">收货合同的<code class="eh mb mc md me b">receive</code>或<code class="eh mb mc md me b">payable fallback</code>功能未执行。</li><li id="264c" class="km kn ht ko b kp mi kr mj kt mk kv ml kx mm jl kz la lb lc dt translated">契约只有在事务结束时才真正被销毁，而恢复可能会“撤销”销毁。</li><li id="4ada" class="km kn ht ko b kp mi kr mj kt mk kv ml kx mm jl kz la lb lc dt translated">乙醚的转移是不可避免的。</li></ul><p id="b829" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">此外，当前契约的所有函数都是可直接调用的，包括当前函数。即使合同被<code class="eh mb mc md me b">selfdestruct</code>删除，它仍然是区块链历史的一部分，并且可能被大多数以太坊节点保留。所以使用<code class="eh mb mc md me b">selfdestruct</code>并不等同于从硬盘上删除数据。</p></div><div class="ab cl ld le hb lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hm hn ho hp hq"><blockquote class="jb"><p id="e303" class="jc jd ht bd je jf mn mo mp mq mr jl ek translated">从顶级交易者那里复制交易机器人。免费试用<a class="ae jn" href="https://coincodecap.com/go/pionex-coinmonks" rel="noopener ugc nofollow" target="_blank"/>。</p></blockquote><h1 id="f8c4" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">分析</h1><p id="cbe9" class="pw-post-body-paragraph lk ll ht ko b kp kq ln lo kr ks lq lr kt ms lt lu kv mt lw lx kx mu lz ma jl hm dt translated">我们得到了以下合同:</p><pre class="mv mw mx my fq mz me na bn nb nc bi"><span id="7da6" class="nd jp ht me b be ne nf l ng nh">contract Force {/*<br/>                   MEOW ?<br/>         /\_/\   /<br/>    ____/ o o \<br/>  /~____  =ø= /<br/>c (______)__m_m)<br/>*/}</span></pre><p id="b798" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">不要让可爱的小猫欺骗你。这是一个没有任何功能的空合同。我们必须设法在合同上签字。</p><p id="3c58" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">我们可以通过以下方式之一向合同发送乙醚:</p><ul class=""><li id="d958" class="km kn ht ko b kp lm kr lp kt mf kv mg kx mh jl kz la lb lc dt translated">直接将以太发送到合同中；但是，要接收以太网传输，合同应具有<code class="eh mb mc md me b">receive</code>或<code class="eh mb mc md me b">payable fallback</code>功能。</li><li id="64ff" class="km kn ht ko b kp mi kr mj kt mk kv ml kx mm jl kz la lb lc dt translated">通过用于挖掘或验证区块的coinbase交易来接收奖励</li><li id="41df" class="km kn ht ko b kp mi kr mj kt mk kv ml kx mm jl kz la lb lc dt translated">可以在部署之前预先计算约定地址。攻击者可以在部署协定之前将以太发送到此地址，从而强制将以太存储在协定中。</li><li id="29a7" class="km kn ht ko b kp mi kr mj kt mk kv ml kx mm jl kz la lb lc dt translated">然后，调用契约中存储的所有以太网将被转移到调用<code class="eh mb mc md me b">selfdestruct()</code>时指定的地址。接收者没有机制来阻止这种情况，因为它发生在EVM级。</li></ul></div><div class="ab cl ld le hb lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hm hn ho hp hq"><h1 id="dc52" class="jo jp ht bd jq jr ni jt ju jv nj jx jy jz nk kb kc kd nl kf kg kh nm kj kk kl dt translated">剥削</h1><p id="809c" class="pw-post-body-paragraph lk ll ht ko b kp kq ln lo kr ks lq lr kt ms lt lu kv mt lw lx kx mu lz ma jl hm dt translated">让我们创建一个契约来破解关卡。</p><p id="af92" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">转到<a class="ae jn" href="https://remix.ethereum.org/#optimize=false&amp;runs=200&amp;evmVersion=null&amp;version=soljson-v0.8.17+commit.8df45f5f.js" rel="noopener ugc nofollow" target="_blank"> <strong class="ko hu">混合IDE </strong> </a>并创建以下合同。</p><figure class="mv mw mx my fq iu"><div class="bz el l di"><div class="nn no l"/></div></figure><p id="6758" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">注意，构造函数被声明为<code class="eh mb mc md me b">payable</code>。在部署上述契约的同时，发送一些以太(1卫)，这些以太将被添加到契约余额中。<code class="eh mb mc md me b">selfdestruct</code>将销毁合同并将乙醚转移至<code class="eh mb mc md me b">instance</code>即Force.sol</p><p id="5663" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">在Ethernaut站点上，打开开发控制台并检查实例平衡。</p><pre class="mv mw mx my fq mz me na bn nb nc bi"><span id="78c0" class="nd jp ht me b be ne nf l ng nh">await getBalance(instance)</span></pre><p id="4d70" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">它将大于0。</p><p id="b50c" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">提交实例。</p><p id="3d95" class="pw-post-body-paragraph lk ll ht ko b kp lm ln lo kr lp lq lr kt ls lt lu kv lv lw lx kx ly lz ma jl hm dt translated">关卡通过！！！😄</p></div><div class="ab cl ld le hb lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hm hn ho hp hq"><h1 id="d025" class="jo jp ht bd jq jr ni jt ju jv nj jx jy jz nk kb kc kd nl kf kg kh nm kj kk kl dt translated">关键要点</h1><ul class=""><li id="1230" class="km kn ht ko b kp kq kr ks kt ku kv kw kx ky jl kz la lb lc dt translated">不要靠<code class="eh mb mc md me b">address(this).balance</code>记账。参见<a class="ae jn" href="https://solidity-by-example.org/hacks/self-destruct/" rel="noopener ugc nofollow" target="_blank">自毁</a>。</li><li id="b9ee" class="km kn ht ko b kp mi kr mj kt mk kv ml kx mm jl kz la lb lc dt translated">如果<code class="eh mb mc md me b">selfdestruct</code>被实现，验证<code class="eh mb mc md me b">msg.sender = owner</code>。实施适当的访问控制。</li><li id="01f9" class="km kn ht ko b kp mi kr mj kt mk kv ml kx mm jl kz la lb lc dt translated">如果你想停用你的合同，你应该通过改变一些内部状态来代替<code class="eh mb mc md me b">disable</code>它们，这将导致所有的功能恢复。这使得无法使用契约，因为它会立即返回以太网。</li></ul></div><div class="ab cl ld le hb lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="hm hn ho hp hq"><blockquote class="jb"><p id="2072" class="jc jd ht bd je jf mn mo mp mq mr jl ek translated"><em class="jm"/><a class="ae jn" href="https://github.com/Chirag21/Ethernaut-solutions" rel="noopener ugc nofollow" target="_blank"><strong class="ak"><em class="jm">Ethernaut-Solutions</em></strong></a><em class="jm">资源库包含使用Foundry和Hardhat的解决方案。</em></p><p id="f3e5" class="jc jd ht bd je jf mn mo mp mq mr jl ek translated"><em class="jm">解决方案使用铸造:- </em></p><p id="32ec" class="jc jd ht bd je jf mn mo mp mq mr jl ek translated"><a class="ae jn" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/test/foundry/7_Force.t.sol" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> <em class="jm">测试</em></strong></a><strong class="ak"><em class="jm"/></strong><a class="ae jn" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/script/7_ForceScript.sol" rel="noopener ugc nofollow" target="_blank"><strong class="ak"><em class="jm">漏洞利用脚本</em> </strong> </a></p><p id="14a6" class="jc jd ht bd je jf mn mo mp mq mr jl ek translated"><em class="jm">使用安全帽的解决方案:- </em></p><p id="2b49" class="jc jd ht bd je jf mn mo mp mq mr jl ek translated"><a class="ae jn" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/test/hardhat/7_force.test.ts" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">测试</strong></a><strong class="ak"/><a class="ae jn" href="https://github.com/Chirag21/Ethernaut-Solutions-using-Foundry-Hardhat/blob/main/scripts/7_force_exploit.ts" rel="noopener ugc nofollow" target="_blank"><strong class="ak"><em class="jm">漏洞利用脚本</em> </strong> </a></p></blockquote><figure class="nq nr ns nt nu iu fe ff paragraph-image"><a href="https://www.buymeacoffee.com/0xcsp"><div class="fe ff np"><img src="../Images/679392ad412abc67dd16f3b9fefa799d.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*769MixcK_s6-z4fwRrIpMQ.png"/></div></a></figure><h1 id="16c8" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz nv kb kc kd nw kf kg kh nx kj kk kl dt translated">更多级别</h1><div class="ny nz fm fo oa ob"><a rel="noopener follow" target="_blank" href="/coinmonks/ethernaut-level-8-vault-foundry-hardhat-ed135ba10978"><div class="oc ab ej"><div class="od ab oe cl cj of"><h2 class="bd hu fv z el og eo ep oh er et hs dt translated">以太8级金库[铸造厂-安全帽]</h2><div class="oi l"><h3 class="bd b fv z el og eo ep oh er et ek translated">Ethernaut-Solutions存储库包含使用Foundry和Hardhat的解决方案。</h3></div><div class="oj l"><p class="bd b gc z el og eo ep oh er et ek translated">medium.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op iz ob"/></div></div></a></div><div class="ny nz fm fo oa ob"><a rel="noopener follow" target="_blank" href="/coinmonks/ethernaut-level-6-delegation-foundry-hardhat-917faaff3570"><div class="oc ab ej"><div class="od ab oe cl cj of"><h2 class="bd hu fv z el og eo ep oh er et hs dt translated">以太6级-委托[铸造-安全帽]</h2><div class="oi l"><h3 class="bd b fv z el og eo ep oh er et ek translated">Ethernaut-Solutions存储库包含使用Foundry和Hardhat的解决方案。</h3></div><div class="oj l"><p class="bd b gc z el og eo ep oh er et ek translated">medium.com</p></div></div><div class="ok l"><div class="oq l om on oo ok op iz ob"/></div></div></a></div><blockquote class="jb"><p id="2d8b" class="jc jd ht bd je jf jg jh ji jj jk jl ek translated">加入Coinmonks <a class="ae jn" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jn" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="ac5c" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">另外，阅读</h1><ul class=""><li id="8edc" class="km kn ht ko b kp kq kr ks kt ku kv kw kx ky jl kz la lb lc dt translated"><a class="ae jn" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a> | <a class="ae jn" href="https://coincodecap.com/pionex-review-exchange-with-crypto-trading-bot" rel="noopener ugc nofollow" target="_blank"> Pionex评论</a> | <a class="ae jn" rel="noopener" href="/coinmonks/coinrule-review-2021-a-beginner-friendly-crypto-trading-bot-daf0504848ba"> Coinrule评论</a></li><li id="0345" class="km kn ht ko b kp mi kr mj kt mk kv ml kx mm jl kz la lb lc dt translated"><a class="ae jn" rel="noopener" href="/coinmonks/ledger-vs-ngrave-zero-7e40f0c1d694">莱杰vs n rave</a>|<a class="ae jn" rel="noopener" href="/coinmonks/ledger-nano-s-vs-x-battery-hardware-price-storage-59a6663fe3b0">莱杰nano s vs x </a> | <a class="ae jn" rel="noopener" href="/coinmonks/binance-review-ee10d3bf3b6e">币安评论</a></li><li id="79c1" class="km kn ht ko b kp mi kr mj kt mk kv ml kx mm jl kz la lb lc dt translated"><a class="ae jn" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a> | <a class="ae jn" href="https://coincodecap.com/bingbon-review" rel="noopener ugc nofollow" target="_blank"> Bingbon评论</a></li><li id="8a62" class="km kn ht ko b kp mi kr mj kt mk kv ml kx mm jl kz la lb lc dt translated"><a class="ae jn" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit Exchange评论</a> | <a class="ae jn" href="https://coincodecap.com/bityard-reivew" rel="noopener ugc nofollow" target="_blank"> Bityard评论</a> | <a class="ae jn" href="https://coincodecap.com/jet-bot-review" rel="noopener ugc nofollow" target="_blank"> Jet-Bot评论</a></li><li id="bafb" class="km kn ht ko b kp mi kr mj kt mk kv ml kx mm jl kz la lb lc dt translated"><a class="ae jn" rel="noopener" href="/coinmonks/3commas-vs-pionex-vs-cryptohopper-best-crypto-bot-6a98d2baa203">3 commas vs crypto hopper</a>|<a class="ae jn" rel="noopener" href="/coinmonks/earn-crypto-interest-b10b810fdda3">赚取秘密利息</a></li></ul></div></div>    
</body>
</html>