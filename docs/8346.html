<html>
<head>
<title>A guide for writing an ERC721 upgradeable smart contract, testing it with truffle, and deploying it to the Göerli testnet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写ERC721可升级智能合同、使用truffle对其进行测试并将其部署到李二测试网的指南</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/a-guide-for-writing-an-erc721-upgradeable-smart-contract-testing-it-with-truffle-and-deploying-it-ff515249208c?source=collection_archive---------0-----------------------#2022-12-31">https://medium.com/coinmonks/a-guide-for-writing-an-erc721-upgradeable-smart-contract-testing-it-with-truffle-and-deploying-it-ff515249208c?source=collection_archive---------0-----------------------#2022-12-31</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/cdf2bf45ea1964f4739d1ce130356422.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OIdAr2G_6mEeGvEor9h9MA.png"/></div></div></figure><h2 id="c77e" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated"><strong class="ak"> <em class="jz">先决条件</em> </strong></h2><ul class=""><li id="ce86" class="ka kb ht kc b kd ke kf kg jm kh jq ki ju kj kk kl km kn ko dt translated"><em class="kp">开发智能合同需要熟悉Solidity编程语言。</em></li><li id="3cfb" class="ka kb ht kc b kd kq kf kr jm ks jq kt ju ku kk kl km kn ko dt translated"><em class="kp">以太坊及其如何处理交易的知识。</em></li><li id="5bbe" class="ka kb ht kc b kd kq kf kr jm ks jq kt ju ku kk kl km kn ko dt translated"><em class="kp">对气体概念的理解。(Gas是对在EVM上执行给定操作所需的计算工作量的度量，并以以太(ETH)支付。根据合同的复杂程度和网络的当前需求，天然气的成本可能会有所不同。)</em></li><li id="5142" class="ka kb ht kc b kd kq kf kr jm ks jq kt ju ku kk kl km kn ko dt translated"><em class="kp">了解如何使用Metamask、Truffle和Ganache等开发工具在本地测试和部署合同。</em></li></ul></div><div class="ab cl kv kw hb kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hm hn ho hp hq"><p id="13b1" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">ERC721是以太坊区块链上<em class="kp">不可替换令牌</em> (NFTs)的标准。不可替换令牌是唯一的数字资产，不能一对一地与其他令牌或资产交换。它们通常用于表示数字艺术、收藏品和游戏项目。</p><p id="065e" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">开始之前，请确保您的计算机上安装了以下工具:</p><ul class=""><li id="76f0" class="ka kb ht kc b kd le kf lh jm lt jq lu ju lv kk kl km kn ko dt translated">这是一个JavaScript运行时，允许你在你的计算机上运行JavaScript代码。你可以从官方网站(<a class="ae lw" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/</a>)下载。<em class="kp">我使用的是节点版本16 </em></li><li id="6077" class="ka kb ht kc b kd kq kf kr jm ks jq kt ju ku kk kl km kn ko dt translated"><strong class="kc hu"> <em class="kp"> npm </em> </strong>(节点包管理器):这是一个Node.js的包管理器，它允许你轻松地安装和管理你可以在你的JavaScript项目中使用的包(即库或模块)。安装Node.js时会自动安装npm。</li></ul></div><div class="ab cl kv kw hb kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hm hn ho hp hq"><p id="aa6a" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">安装好这些工具，让我们开始安装<strong class="kc hu">松露</strong>。打开终端并运行以下命令:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="1f62" class="mg jc ht mc b be mh mi l mj mk">npm install -g truffle</span></pre><p id="92a0" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">这将在你的计算机上全局安装Truffle，允许你从任何目录使用它。一旦松露安装完毕，我们就可以建立一个新的项目。为您的项目创建一个新目录，将其命名为<code class="eh ml mm mn mc b">MyToken</code>，在终端中导航到该目录，并运行以下命令:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="c2fd" class="mg jc ht mc b be mh mi l mj mk">npm init -y</span></pre><pre class="mo mb mc md bn me mf bi"><span id="6eb1" class="mg jc ht mc b be mh mi l mj mk">truffle init</span></pre><p id="104e" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">这将在您的项目中创建一个<em class="kp"> package.json </em>文件、<em class="kp"> truffle-config.js </em>文件和<code class="eh ml mm mn mc b">contracts/ </code>、<code class="eh ml mm mn mc b">migrations/</code>、<code class="eh ml mm mn mc b">test/</code>目录。在这个项目中，<em class="kp"> truffle-config.js </em>作为索引文件，就像节点项目中的index.js一样。因此在package.json文件中，<em class="kp"> index.js </em>应该替换为t <em class="kp"> ruffle-config.js </em>作为“主”键。文件夹结构的示例如下:</p><figure class="lx ly lz ma fq iu fe ff paragraph-image"><div class="fe ff mp"><img src="../Images/cca11ed8de4ab37d2b5d2b38a2ed5907.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*3ZKqom24tyBZ57fQgdA4OQ.png"/></div></figure><p id="9afa" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">将这些依赖项安装到我们的项目目录中:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="d4bc" class="mg jc ht mc b be mh mi l mj mk">npm install @openzeppelin/contracts-upgradeable</span></pre><pre class="mo mb mc md bn me mf bi"><span id="7d0d" class="mg jc ht mc b be mh mi l mj mk">npm install @truffle/hdwallet-provider</span></pre><pre class="mo mb mc md bn me mf bi"><span id="18ba" class="mg jc ht mc b be mh mi l mj mk">npm install dotenv </span></pre><pre class="mo mb mc md bn me mf bi"><span id="e963" class="mg jc ht mc b be mh mi l mj mk">npm install --save-dev @openzeppelin/truffle-upgrades</span></pre><p id="da67" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">接下来，我们需要编写我们的智能合同。在<code class="eh ml mm mn mc b">contracts/</code>目录下创建一个名为<em class="kp"> MyToken.sol </em>的新文件。我们名为<code class="eh ml mm mn mc b">MyToken</code>的样本契约如下所示:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="e80c" class="mg jc ht mc b be mh mi l mj mk">// SPDX-License-Identifier: MIT<br/>pragma solidity ^0.8.10;<br/><br/>import "@openzeppelin/contracts-upgradeable/token/ERC721/ERC721Upgradeable.sol";<br/>import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";<br/>import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";<br/>import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";<br/><br/>contract MyToken is<br/>    Initializable,<br/>    ERC721Upgradeable,<br/>    OwnableUpgradeable,<br/>    UUPSUpgradeable<br/>{<br/>    function initialize() public initializer {<br/>        __ERC721_init("MyToken", "MTK");<br/>        __Ownable_init();<br/>        __UUPSUpgradeable_init();<br/>    }<br/><br/>    function safeMint(address _to, uint256 _tokenId) public onlyOwner {<br/>        _safeMint(_to, _tokenId);<br/>    }<br/><br/>    function _authorizeUpgrade(address _newImplementation)<br/>        internal<br/>        override<br/>        onlyOwner<br/>    {}<br/>}</span></pre><p id="2c5e" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">您可以根据自己的需求添加任意多的功能。参见<a class="ae lw" href="https://docs.openzeppelin.com/contracts/4.x/" rel="noopener ugc nofollow" target="_blank"> <em class="kp"> openzeppelin </em> </a>开发安全智能合约。</p><p id="2b9f" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">在<code class="eh ml mm mn mc b">truffle-config.js</code>中，添加以下代码片段:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="3539" class="mg jc ht mc b be mh mi l mj mk">const HDWalletProvider = require('@truffle/hdwallet-provider');<br/>const fs = require('fs');<br/>require('dotenv').config({<br/>    path: '.env',<br/>});<br/><br/>var mnemonic = fs.readFileSync('.secret.development').toString().trim();<br/>var build_directory = './build-dev/contracts';<br/><br/>module.exports = {<br/>    networks: {<br/>        development: {<br/>            host: '127.0.0.1',<br/>            port: 8545,<br/>            network_id: '*',<br/>        },<br/>        goerli_testnet: {<br/>            provider: () =&gt;<br/>                new HDWalletProvider(<br/>                    mnemonic,<br/>                    `https://eth-goerli.g.alchemy.com/v2/YOUR_API_KEY`<br/>                ),<br/>            network_id: 5,<br/>            confirmations: 2,<br/>            timeoutBlocks: 200,<br/>            skipDryRun: true,<br/>            timeout: 5000,<br/>        },<br/>    },<br/>    compilers: {<br/>        solc: {<br/>            version: '0.8.10', <br/>            settings: {<br/>                optimizer: {<br/>                    enabled: true,<br/>                    runs: 1000,<br/>                },<br/>            },<br/>        },<br/>    },<br/><br/>    contracts_build_directory: build_directory,<br/>};</span></pre><p id="393c" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">确保用你的替换掉<code class="eh ml mm mn mc b">YOUR_API_KEY</code>和<code class="eh ml mm mn mc b">mnemonic</code>。为了便于记忆，将您的<em class="kp">私钥</em>(来自Metamask)添加到<code class="eh ml mm mn mc b">.secret.development </code>，并且不要忘记将该文件添加到<code class="eh ml mm mn mc b">.gitignore</code>。添加后，运行以下命令:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="401b" class="mg jc ht mc b be mh mi l mj mk">truffle compile --all</span></pre><p id="0027" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">我们合同的<strong class="kc hu"> ABI </strong>文件将在一个新的目录<code class="eh ml mm mn mc b">build-dev</code>中生成。<strong class="kc hu"><em class="kp">ABI是应用二进制接口。它们定义了智能合约中可用的方法和变量，我们可以使用这些方法和变量与智能合约进行交互。</em> </strong></p></div><div class="ab cl kv kw hb kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hm hn ho hp hq"><p id="2d29" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">接下来，我们将在<code class="eh ml mm mn mc b">migrations/ </code>目录中创建一个名为<em class="kp"> 1_initial_migration.js </em>的迁移文件。将以下片段添加到您的迁移文件中:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="e5a0" class="mg jc ht mc b be mh mi l mj mk">const { deployProxy } = require('@openzeppelin/truffle-upgrades');<br/><br/>const MyToken = artifacts.require('MyToken');<br/><br/>module.exports = async function (deployer) {<br/>    await deployProxy(MyToken, {<br/>        deployer,<br/>        kind: 'uups',<br/>    });<br/>};</span></pre><p id="9928" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">我们的合同接下来应该有测试用例。在我们的<code class="eh ml mm mn mc b">tests/</code>目录中，创建一个名为<code class="eh ml mm mn mc b">MyToken.test.js</code>的文件。该文件看起来像:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="a711" class="mg jc ht mc b be mh mi l mj mk">const { deployProxy } = require('@openzeppelin/truffle-upgrades');<br/><br/>const MyToken = artifacts.require('MyToken.sol');<br/><br/>contract('MyToken', function (accounts) {<br/>    beforeEach(async function () {<br/>        //Deploy a new contract for each test<br/>        this.factory = await deployProxy(MyToken, {<br/>            kind: 'uups',<br/>        });<br/>        this.userOne = accounts[1];<br/>    });<br/><br/>    it('Successful: Minting', async function () {<br/>        // userOne balance should be zero before minting<br/>        var userOneBalance = await this.factory.balanceOf(this.userOne);<br/>        assert.equal(userOneBalance, 0);<br/><br/>        // Mint tokenId 1 to userOne<br/>        await this.factory.safeMint(this.userOne, 1);<br/><br/>        // userOne balance should not be zero after minting<br/>        userOneBalance = await this.factory.balanceOf(this.userOne);<br/>        assert.equal(userOneBalance, 1);<br/>    });<br/>});</span></pre><p id="5ded" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">安装一个本地以太网:你需要一个本地以太网来测试你的合同。你可以使用像<em class="kp"> Ganache </em>或<em class="kp"> ganache-cli </em>这样的工具在你的机器上建立一个本地以太坊网络。要安装，请运行此命令:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="f9d1" class="mg jc ht mc b be mh mi l mj mk">npm install -g ganache</span></pre><p id="9f16" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">打开两个终端，在其中一个上运行以下命令:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="5432" class="mg jc ht mc b be mh mi l mj mk">ganache</span></pre><p id="b4a7" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">在另一台终端上运行以下命令:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="74cd" class="mg jc ht mc b be mh mi l mj mk">truffle test test/MyToken.test.js</span></pre><p id="c3a7" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">如果我们所有的测试用例都通过了，输出应该是这样的:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="7141" class="mg jc ht mc b be mh mi l mj mk">  Contract: MyToken<br/>    ✔ Successful: Minting (131ms)<br/><br/><br/>  1 passing (321ms)</span></pre><p id="78cf" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">使用<code class="eh ml mm mn mc b">ctl+c</code>，我们可以在测试完成后关闭ganache。</p></div><div class="ab cl kv kw hb kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hm hn ho hp hq"><p id="9313" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated"><em class="kp">在开始迁移之前，请确保您的帐户中有足够的goerli测试醚，因为迁移需要一些气体。你可以从</em> <a class="ae lw" href="https://goerlifaucet.com/" rel="noopener ugc nofollow" target="_blank"> <em class="kp">这里</em> </a> <em class="kp">得到。</em></p><p id="ca5b" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">一旦我们的测试用例通过，我们就可以开始了。因为我们已经配置了我们的<code class="eh ml mm mn mc b">truffle-config.js</code>和<code class="eh ml mm mn mc b">1_initial_migration.js</code>，运行这个命令:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="5ad8" class="mg jc ht mc b be mh mi l mj mk">truffle migrate --network goerli_testnet</span></pre><p id="83d3" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">输出如下所示:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="466e" class="mg jc ht mc b be mh mi l mj mk">Compiling your contracts...<br/>===========================<br/>&gt; Everything is up to date, there is nothing to compile.<br/><br/><br/>Starting migrations...<br/>======================<br/>&gt; Network name:    'goerli_testnet'<br/>&gt; Network id:      5<br/>&gt; Block gas limit: 30000000 (0x1c9c380)<br/><br/><br/>1_initial_migration.js<br/>======================<br/><br/>   Deploying 'MyToken'<br/>   -------------------<br/>   &gt; transaction hash:    0x61c049f1ffef6429a45c235eced73eb2a66176f9b7b2a77315b8564ca538e6d3<br/>   &gt; Blocks: 1            Seconds: 10<br/>   &gt; contract address:    0x16e876F6Ea4737AF03022A82a4a684989aB151D0<br/>   &gt; block number:        8231576<br/>   &gt; block timestamp:     1672474488<br/>   &gt; account:             0x3738d816E3D630C42Ca337278f40446343E8FFAb<br/>   &gt; balance:             1.689119818493581037<br/>   &gt; gas used:            2147609 (0x20c519)<br/>   &gt; gas price:           2.500000009 gwei<br/>   &gt; value sent:          0 ETH<br/>   &gt; total cost:          0.005369022519328481 ETH<br/><br/>   Pausing for 2 confirmations...<br/><br/>   -------------------------------<br/>   &gt; confirmation number: 1 (block: 8231577)<br/>   &gt; confirmation number: 2 (block: 8231578)<br/><br/>   Deploying 'ERC1967Proxy'<br/>   ------------------------<br/>   &gt; transaction hash:    0x0cc67bafe88cdcec68357c5d9e9500626a188a80406fc8cb675cb85a7dd040f3<br/>   &gt; Blocks: 2            Seconds: 21<br/>   &gt; contract address:    0xdD743626C508d08578842BC8FF0Bd00497fA76b5<br/>   &gt; block number:        8231580<br/>   &gt; block timestamp:     1672474536<br/>   &gt; account:             0x3738d816E3D630C42Ca337278f40446343E8FFAb<br/>   &gt; balance:             1.688266153490507843<br/>   &gt; gas used:            341466 (0x535da)<br/>   &gt; gas price:           2.500000009 gwei<br/>   &gt; value sent:          0 ETH<br/>   &gt; total cost:          0.000853665003073194 ETH<br/><br/>   Pausing for 2 confirmations...<br/><br/>   -------------------------------<br/>   &gt; confirmation number: 1 (block: 8231581)<br/>   &gt; confirmation number: 2 (block: 8231582)<br/>   &gt; Saving artifacts<br/>   -------------------------------------<br/>   &gt; Total cost:     0.006222687522401675 ETH<br/><br/>Summary<br/>=======<br/>&gt; Total deployments:   2<br/>&gt; Final cost:          0.006222687522401675 ETH</span></pre><p id="3bf2" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">在这里，我们可以看到正在发生两个事务。</p><ol class=""><li id="caf2" class="ka kb ht kc b kd le kf lh jm lt jq lu ju lv kk mq km kn ko dt translated"><em class="kp">第一笔交易是将智能合约的初始版本部署到区块链。该事务在区块链上创建一个新合同，并设置合同的代码和存储。</em></li><li id="8a9a" class="ka kb ht kc b kd kq kf kr jm ks jq kt ju ku kk mq km kn ko dt translated"><em class="kp">第二个事务是创建一个指向初始契约的新契约实例。这称为“代理合同”，用于管理初始合同的升级。代理协定存储初始协定的地址，并将调用转发给它。当您想要升级契约时，您可以简单地更新代理契约以指向该契约的新实现，并且对该契约的所有调用都将被转发到新实现。</em></li></ol><p id="a92b" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">我们现在已经将我们的MyToken合同部署到了Goerli testnet。你可以通过访问<a class="ae lw" href="https://goerli.etherscan.io/address/0xdD743626C508d08578842BC8FF0Bd00497fA76b5" rel="noopener ugc nofollow" target="_blank"> goerli.etherscan </a>来检查这一点</p></div><div class="ab cl kv kw hb kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hm hn ho hp hq"><p id="fceb" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">假设你想修改合同。对协定进行更改后，您必须编译协定并再次运行单元测试。一旦这两个步骤完成，在<code class="eh ml mm mn mc b">migrations/</code>目录中创建另一个名为<em class="kp"> 2_upgrade_MyToken.js，</em>的文件。升级文件看起来像:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="8c33" class="mg jc ht mc b be mh mi l mj mk">const { upgradeProxy } = require('@openzeppelin/truffle-upgrades');<br/><br/>const MTK = artifacts.require('MyToken');<br/><br/>module.exports = async function (deployer, network, accounts) {<br/>    const mtk = await MTK.deployed();<br/>    console.log('Existing', mtk.address);<br/>    await upgradeProxy(mtk.address, MTK, {<br/>        deployer,<br/>        kind: 'uups',<br/>    });<br/>    console.log('Upgraded');<br/>};</span></pre><p id="cd9d" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">运行以下命令:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="7952" class="mg jc ht mc b be mh mi l mj mk">truffle migrate -f 2 --network goerli_testnet</span></pre><p id="aa92" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">只要合同在更改后按预期工作，您就可以认为升级是成功的。</p><p id="95b0" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">最后，为了与部署的契约进行通信，创建一个名为<code class="eh ml mm mn mc b">scripts/</code>的新目录并添加必要的脚本，然后运行以下命令:</p><pre class="lx ly lz ma fq mb mc md bn me mf bi"><span id="94fa" class="mg jc ht mc b be mh mi l mj mk">truffle exec scripts/&lt;file_name&gt;.js --network goerli_testnet</span></pre></div><div class="ab cl kv kw hb kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hm hn ho hp hq"><p id="01df" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">在本文中，我们介绍了使用<em class="kp"> minting </em>功能创建一个简单的ERC721可升级合同、使用truffle suit测试我们的合同、将合同部署到Goerli测试网络以及升级已部署的合同的过程。</p><p id="6a5e" class="pw-post-body-paragraph lc ld ht kc b kd le lf lg kf lh li lj jm lk ll lm jq ln lo lp ju lq lr ls kk hm dt translated">感谢阅读，下次见。再见！</p><blockquote class="mr"><p id="717e" class="ms mt ht bd mu mv mw mx my mz na kk ek translated">交易新手？在<a class="ae lw" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易</a>上尝试<a class="ae lw" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae lw" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>