<html>
<head>
<title>Gelato V2 &amp; SuperFluid</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">意式冰淇淋·V2 &amp;超流体</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/gelato-v2-superfluid-eb13166ac414?source=collection_archive---------5-----------------------#2022-12-31">https://medium.com/coinmonks/gelato-v2-superfluid-eb13166ac414?source=collection_archive---------5-----------------------#2022-12-31</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="3cac" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">到2023年，让您的流自动化变得更加容易！！</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/aeb1c28c5000b10062d7c3f109ebeb62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JHb0PN5uLDB_CDIKOsXMHQ.png"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">Gelato Automate</figcaption></figure><p id="a68f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">意式冰淇淋网络在过去几个月发布了新版本。在这里，您可以找到变化，并准备好自动化您的流。</p><p id="a8f5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">新的<strong class="is hu">意式冰淇淋版本V2遵循模块化的方法，允许更多的灵活性。</strong></p><p id="d616" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将从超流<a class="ae ke" href="https://discord.com/channels/752490247643725875/752493348169711696" rel="noopener ugc nofollow" target="_blank"> #dev-support </a> discord频道中最常见的问题之一开始:“如何安排停止一个流？”，尽管该功能是在Superfluid dashboard中实现的，但了解如何以编程方式实现它是值得的。</p><p id="2c70" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这里你可以找到一个演练视频。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="kf kg l"/></div></figure><p id="6856" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于我们要四处转转，所以让我介绍/更新一下让意式冰淇淋启动并运行的3x3步骤:</p><ol class=""><li id="84fb" class="kh ki ht is b it iu ix iy jb kj jf kk jj kl jn km kn ko kp dt translated"><strong class="is hu">有线意式冰淇淋基础设施</strong>:我们的合同更新，允许与意式冰淇淋的通信自动化</li><li id="f1a4" class="kh ki ht is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp dt translated"><strong class="is hu">融资策略:</strong>有两种可供选择的交易支付方式；从意式冰淇淋平衡或每笔交易支付本身。我们选择每笔交易都要自己买单。我们必须别忘了为合同提供资金。更多关于付款的信息可以在这里看到。</li><li id="2dde" class="kh ki ht is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp dt translated"><strong class="is hu">意式冰淇淋自定义逻辑:</strong>包括任务创建、检查器条件、待执行任务。<br/> -任务创建可以从合同/SDK或通过意式冰淇淋自动化UI动态完成<br/> -在我们的例子中，检查条件很简单，因为我们只需检查关闭流的时间。<br/> -可执行函数也很简单，就好像我们已经创建了一个流，我们知道如何关闭它。我们应该记住，执行关闭功能的EOA/契约必须得到流所有者的授权才能关闭流</li></ol></div><div class="ab cl kv kw hb kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hm hn ho hp hq"><h1 id="01dc" class="lc ld ht bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz dt translated">亲自动手</h1><p id="29a7" class="pw-post-body-paragraph iq ir ht is b it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj me jl jm jn hm dt translated">回购示例可在以下位置找到:</p><div class="mf mg fm fo mh mi"><a href="https://github.com/donoso-eth/superfluid-gelato-automation" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab ej"><div class="mk ab ml cl cj mm"><h2 class="bd hu fv z el mn eo ep mo er et hs dt translated">GitHub-donoso-eth/超流体-凝胶-自动化</h2><div class="mp l"><h3 class="bd b fv z el mn eo ep mo er et ek translated">一个超级简单的铸造/安全帽混合项目，利用超流体的CFA访问控制列表功能和意式冰淇淋…</h3></div><div class="mq l"><p class="bd b gc z el mn eo ep mo er et ek translated">github.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw jy mi"/></div></div></a></div><p id="b617" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于如何开始一个流，我们有不同的选择:使用superfluid dashboard、SDK或合同中的cfaLibrary。</p><p id="4303" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们考虑如何关闭流，我们必须记住，意式冰淇淋操作合同将调用可执行函数，意式冰淇淋操作合同将调用可执行函数，在超流中，只有流的发送者或接收者可以关闭/停止流。</p><p id="27de" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在<a class="ae ke" href="https://docs.superfluid.finance/superfluid/developers/constant-flow-agreement-cfa/cfa-access-control-list-acl" rel="noopener ugc nofollow" target="_blank">超流ACL(访问控制列表</a> t)的帮助下，我们可以授权一个智能合约来停止流。这将使我们的生活更容易，因为从合同中我们可以</p><h2 id="bede" class="mx ld ht bd le my mz na li nb nc nd lm jb ne nf lq jf ng nh lu jj ni nj ly nk dt translated">意式冰淇淋</h2><p id="1a54" class="pw-post-body-paragraph iq ir ht is b it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj me jl jm jn hm dt translated">如果我们遵循上述步骤，我们必须:</p><ol class=""><li id="09b9" class="kh ki ht is b it iu ix iy jb kj jf kk jj kl jn km kn ko kp dt translated">有线意式冰淇淋基础设施:<br/>我们将把Gelato文件夹复制到我们的合同文件夹。我们可以在这里找到文件<a class="ae ke" href="https://github.com/donoso-eth/superfluid-gelato-automation/tree/main/src/gelato" rel="noopener ugc nofollow" target="_blank"/>。文件夹结构应该如下所示</li></ol><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff nl"><img src="../Images/e1d53a536b0c06a4b5475ad16b470530.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*mq84tE9FSzxLDixOtcpk6w.png"/></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">Gelato Helper Contracts</figcaption></figure><p id="0797" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">继承OpsReady合同</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="7d15" class="nr ld ht nn b be ns nt l nu nv">contract CloseStream is OpsReady {<br/><br/>    constructor( address _ops ) <br/>     OpsReady(_ops, address(this)){<br/><br/>    }</span></pre><p id="e646" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2.融资策略，我们将为每笔交易支付的目标合同。我们必须为我们的合同提供资金，并确保费用通过执行转移到意式冰淇淋</p><p id="9470" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3.意式冰淇淋自定义逻辑<br/>我们将从契约中动态创建任务。让我们看看我们将用来创建任务的代码。</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="3f74" class="nr ld ht nn b be ns nt l nu nv"> taskId = ops.createTask(execAddress, execData, moduleData, ETH);</span></pre><p id="ceca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">执行任务的合同地址</p><p id="f8f1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh nw nx ny nn b">exexData()</code>任务将要执行的代码</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="ff41" class="nr ld ht nn b be ns nt l nu nv">  bytes memory execData = <br/>abi.encodeWithSelector(this.closeStream.selector, sender,receiver);<br/>// closeStream is the executable function</span></pre><p id="0993" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh nw nx ny nn b">moduleData</code>就是我们如何配置我们的任务。有四个配置模块:<br/> - <strong class="is hu">解析器</strong>:当我们需要自定义逻辑来检查功能是否必须执行时。<br/> - <strong class="is hu">时间</strong>:当执行将在特定的时间点发生<br/> - <strong class="is hu">代理</strong>:当我们需要一个专用的消息发送者<br/> - <strong class="is hu"> Single_exec </strong>:当我们只需要一次执行</p><p id="083a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh nw nx ny nn b">ETH</code>支付交易的代币</p><p id="ebf8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我们的用例中，我们将设置<strong class="is hu"> TimeModule和SingleExec </strong>模块，确保可执行函数在要求的时间戳运行，并且只运行一次(我们只关闭流一次)。我们像这样构建我们的模块数据:</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="c827" class="nr ld ht nn b be ns nt l nu nv">    bytes memory timeArgs = <br/>    abi.encode(uint128(block.timestamp + duration), duration);<br/><br/>    Module[] memory modules = new Module[](2);<br/><br/>    modules[0] = Module.TIME;<br/>    modules[1] = Module.SINGLE_EXEC;<br/><br/>    bytes[] memory args = new bytes[](1);<br/><br/>    args[0] = timeArgs;<br/><br/>    ModuleData memory moduleData = ModuleData(modules, args);</span></pre><p id="ff38" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">关于模块的更多信息可以在找到<a class="ae ke" href="https://docs.gelato.network/developer-services/automate/guides" rel="noopener ugc nofollow" target="_blank"/></p><p id="13a3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们不需要checker条件。</p><p id="77c5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">可执行函数最终将是:</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="b5d0" class="nr ld ht nn b be ns nt l nu nv"><br/>    function closeStream(address sender, address receiver) external onlyOps {<br/><br/>       (uint256 fee, address feeToken) = ops.getFeeDetails();<br/>       _transfer(fee, feeToken); // fee transferred<br/><br/>       _cfaLib.deleteFlow(sender, receiver, superToken);<br/><br/>       taskId = bytes32(0);<br/><br/>    }</span></pre><h2 id="a61c" class="mx ld ht bd le my mz na li nb nc nd lm jb ne nf lq jf ng nh lu jj ni nj ly nk dt translated">合同</h2><p id="21ea" class="pw-post-body-paragraph iq ir ht is b it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj me jl jm jn hm dt translated">我们的合同:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="nz kg l"/></div></figure><p id="f0e5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">到目前为止，我们有一个合同准备关闭流。我们必须只创建一个流，授权我们的契约来停止该流，并创建任务来关闭该流。</p><h2 id="23c8" class="mx ld ht bd le my mz na li nb nc nd lm jb ne nf lq jf ng nh lu jj ni nj ly nk dt translated">剧本</h2><p id="661f" class="pw-post-body-paragraph iq ir ht is b it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj me jl jm jn hm dt translated">合同部署:</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="4188" class="nr ld ht nn b be ns nt l nu nv">yarn deploy goerli</span></pre><p id="3286" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">控制台将记录如下内容:</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="6ad8" class="nr ld ht nn b be ns nt l nu nv">Close Stream deployed succsessfully <br/>at: 0xCC7FA88DB7df720EA72872ad7C19fd85026047d9</span></pre><p id="1f27" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将把部署的地址复制到<code class="eh nw nx ny nn b">./scripts/Helpers.ts</code>中，以便以后可以使用。</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="298b" class="nr ld ht nn b be ns nt l nu nv">export const CloseStreamAddress = "0xCC7FA88DB7df720EA72872ad7C19fd85026047d9";</span></pre><p id="e8cc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将验证我们的合同，以便稍后与etherscan进行交互</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="767a" class="nr ld ht nn b be ns nt l nu nv">yarn verify goerli // in scripts/verify.ts</span></pre><p id="18b9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们现在将开始一个流。我们可以使用SDK或直接从<a class="ae ke" href="https://app.superfluid.finance/" rel="noopener ugc nofollow" target="_blank">超流仪表板</a>中完成。借助SDK:</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="c861" class="nr ld ht nn b be ns nt l nu nv">yarn startStream goerli // in scripts/startStream.ts</span></pre><p id="b7c7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">授权我们的智能合同来阻止水流</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="0dbd" class="nr ld ht nn b be ns nt l nu nv">yarn authorizeControl goerli // in scripts/authorizeControl.ts</span></pre><p id="5ff0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建意式冰淇淋任务来关闭流</p><pre class="jp jq jr js fq nm nn no bn np nq bi"><span id="5283" class="nr ld ht nn b be ns nt l nu nv">yarn createTaskStopStream goerli // in scripts/createTaskStopStream.ts</span></pre><p id="f466" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果我们查看gelato应用程序，我们可以看到我们的任务已经在运行了</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff oa"><img src="../Images/2a6bc06e3fd1b6cd94ca32b1d7c0c8a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ky_501_5DixapTTjYwf9dw.png"/></div></div></figure><h2 id="4c1a" class="mx ld ht bd le my mz na li nb nc nd lm jb ne nf lq jf ng nh lu jj ni nj ly nk dt translated">瞧</h2><p id="ebe6" class="pw-post-body-paragraph iq ir ht is b it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj me jl jm jn hm dt translated">如果我们等待几分钟，我们将看到任务执行，我们的流将被关闭！</p><h1 id="d11f" class="lc ld ht bd le lf ob lh li lj oc ll lm ln od lp lq lr oe lt lu lv of lx ly lz dt translated">结论</h1><p id="fce7" class="pw-post-body-paragraph iq ir ht is b it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj me jl jm jn hm dt translated">将gelato网络接入我们的智能合约<strong class="is hu">并<strong class="is hu">释放自动化的全部潜力</strong>相对简单。做这件事有几种方法。我们选择了最常用的一个。</strong></p><blockquote class="og oh oi"><p id="8593" class="iq ir oj is b it iu iv iw ix iy iz ja ok jc jd je ol jg jh ji om jk jl jm jn hm dt translated">花些时间从直升机上了解超流体和意式冰淇淋是如何工作的是值得的</p></blockquote><p id="ceff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">意式冰淇淋V2引入了模块的概念，这给了开发人员更多的灵活性来选择如何配置任务。在第一次之后，编码/解码是简单的。</p><p id="aaea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这篇文章<strong class="is hu">可以帮助其他开发者快速启动并运行</strong>gelato，并将其应用于超流体流。</p><p id="6905" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">敬请关注一月份，在意式冰淇淋<a class="ae ke" href="https://docs.gelato.network/developer-services/automate/guides/writing-a-resolver/off-chain-resolver" rel="noopener ugc nofollow" target="_blank">链外解析器</a>的帮助下，我们将回答0xFran.eth/lens的推特！！</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="on kg l"/></div></figure><p id="a04f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你可以在推特上联系我<a class="ae ke" href="https://twitter.com/donoso_eth?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank"> @donoso_eth </a></p><h1 id="08bd" class="lc ld ht bd le lf ob lh li lj oc ll lm ln od lp lq lr oe lt lu lv of lx ly lz dt translated">资源</h1><h2 id="dd57" class="mx ld ht bd le my mz na li nb nc nd lm jb ne nf lq jf ng nh lu jj ni nj ly nk dt translated">意式冰淇淋</h2><p id="9639" class="pw-post-body-paragraph iq ir ht is b it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj me jl jm jn hm dt translated"><a class="ae ke" href="https://www.gelato.network/" rel="noopener ugc nofollow" target="_blank">意式冰淇淋网</a> <br/> <a class="ae ke" href="https://app.gelato.network/?ref=gelato.network" rel="noopener ugc nofollow" target="_blank">意式冰淇淋自动化app </a> <br/> <a class="ae ke" href="https://docs.gelato.network/introduction/what-is-gelato" rel="noopener ugc nofollow" target="_blank">意式冰淇淋文档</a></p><h2 id="72c1" class="mx ld ht bd le my mz na li nb nc nd lm jb ne nf lq jf ng nh lu jj ni nj ly nk dt translated">超流体</h2><p id="6ffd" class="pw-post-body-paragraph iq ir ht is b it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj me jl jm jn hm dt translated"><a class="ae ke" href="https://www.superfluid.finance/" rel="noopener ugc nofollow" target="_blank">超流金融</a> <br/> <a class="ae ke" href="https://app.superfluid.finance/" rel="noopener ugc nofollow" target="_blank">超流仪表盘</a> <br/> <a class="ae ke" href="https://docs.superfluid.finance/superfluid/" rel="noopener ugc nofollow" target="_blank">超流文档</a></p><p id="2666" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">意式冰淇淋V1 &amp;超流体超级应用篇</strong></p><div class="mf mg fm fo mh mi"><a rel="noopener follow" target="_blank" href="/@javier_donoso/superfluid-gelato-for-stream-scheduling-7c32ed975f04"><div class="mj ab ej"><div class="mk ab ml cl cj mm"><h2 class="bd hu fv z el mn eo ep mo er et hs dt translated">超流和意式冰淇淋用于流调度</h2><div class="mp l"><h3 class="bd b fv z el mn eo ep mo er et ek translated">🚀了解如何在超级应用中自动启动/停止超流流</h3></div><div class="mq l"><p class="bd b gc z el mn eo ep mo er et ek translated">medium.com</p></div></div><div class="mr l"><div class="oo l mt mu mv mr mw jy mi"/></div></div></a></div></div></div>    
</body>
</html>