# 据估计，智能合同中的安全缺陷已经造成了超过 10 亿美元的价值损失

> 原文：<https://medium.com/coinmonks/security-defects-in-smart-contracts-are-estimated-to-have-caused-over-1-billion-in-lost-value-3d691a6e2df?source=collection_archive---------10----------------------->

## 部署的合同代码通常是不可变的，而从智能合同中窃取的资产通常是不可恢复的或难以跟踪的

在区块链时代，智能合约允许控制大量数据和价值，同时使用部署在区块链的代码运行不可变的逻辑。由于这些特点，一个由不可信的、分散的应用程序组成的蓬勃发展的生态系统已经成长起来，它比遗留系统具有许多优势。但是伴随这种好处而来的是风险，因为智能契约也可能被攻击者以对他们有利的方式破坏。

此外，像以太坊这样的公共区块链进一步复杂化了智能合约安全性。开发人员需要了解很多关于智能合同如何工作的知识，因为即使是一个小错误也可能危及他们的诚信。

## 实施适当的访问控制

如果您希望其他人与您的智能合约进行交互，为函数选择公共可见性是必要的。任何外部拥有的帐户(EOA)或合同帐户都可以调用公共函数。相比之下，私有函数只能从智能合约内部调用，而不能从外部帐户调用。让每个人都可以访问合同功能可能会有问题，特别是如果它允许任何人执行敏感的操作。

智能合同必须通过安全访问控制来保护，安全访问控制将对某些功能的访问限制到批准的实体，例如负责管理合同的帐户。

在智能合约中，Ownable 模式和基于角色的控制有助于实现访问控制。Ownable 模式使用一个地址作为契约的所有者。为受保护的函数分配一个 OnlyOwner 修饰符，确保契约在执行函数之前验证调用地址。当从契约所有者之外的地址调用受保护的函数时，不希望的访问被停止。

## 基于角色的访问控制

将单个地址注册为智能合同的所有者会增加集中化的风险，这意味着如果所有者的帐户密钥被泄露，攻击者将能够在所拥有的地址上攻击智能合同。因此，对多个管理帐户使用基于角色的访问控制模式可能是处理这一问题的最佳方式。使用基于角色的访问控制，一组受信任的参与者可以访问敏感功能，例如，一个帐户可以制造令牌，而另一个帐户可以执行升级或暂停合同。通过实现这种方法，可以分散访问控制，消除单点故障并减少信任假设。

## 具有多个签名的加密货币钱包

在一个帐户上使用多个签名来管理合同是使访问控制更加安全的另一种方式。多签名帐户不同于常规 eoa，因为它们由多个实体拥有，并且需要一定数量的帐户签名。

multisig 访问控制增加了一层额外的安全性，它使得对目标契约的操作需要得到多方的批准。如果您需要使用 Ownable 模式，这使得攻击者或内部人员更难操纵契约功能。

## 确保协定操作受到 require()、assert()和 revert()语句的保护

在区块链上部署智能合约允许任何人调用公共函数。但没有办法提前知道外部账户会如何影响合同，所以最好是制定内部保障措施。使用 require()、assert()和 revert()语句，可以确保智能协定以正确的方式运行。如果在这些语句运行时不满足某些条件，它们会导致异常或撤消状态更改。

Require():确定在执行被调用的函数之前是否满足预定义的条件。它是在函数开始时定义的。在继续之前，require 命令可用于检查用户输入的内容、验证状态变量或验证调用帐户。

assert(): assert()用于检测内部错误并检查契约不变量。不变量是关于契约状态的逻辑断言，在函数的整个执行过程中都成立。例如，代币合约的最大供应量或余额就是不变量的一个例子。使用 assert()可以防止契约进入易受攻击的状态，如果进入易受攻击的状态，对状态变量的更改将被逆转。

revert():在 if-else 语句中，如果不满足条件，revert()将抛出异常。

## 验证智能合约及其代码的正确性

由于在以太坊虚拟机中运行的代码不能被更改，智能合约在构建时受到更高水平的质量保证。为了确保你的用户是安全的，你必须彻底测试你的合同，并留意任何意想不到的结果。

通常通过用模拟数据编写小单元测试来测试智能契约，因为这是用户期望发送给契约的内容。单元测试对于确保智能合约按预期工作非常重要。

不幸的是，智能合约的单元测试在单独使用时效果甚微。单元测试可能会显示一个函数在模拟数据上运行良好，但它们的有效性取决于所编写的测试，这使得很难检测到遗漏的边缘情况和可能危及智能合约的漏洞。

最好的方法是使用静态和动态分析来结合单元测试和基于属性的测试。

形式验证是检查智能合约安全性的另一种方式。与常规测试不同，形式验证证明智能合约是无错误的。正式规范捕获了期望的安全属性，为了实现这一点，契约的正式模型必须符合正式规范。

## 结束语

检测智能合同中安全缺陷的最佳方式是在测试后进行独立审查。发现智能合同中所有缺陷的唯一方法是让没有参与合同制定的人来审查它。

然而，你不应该把审计视为灵丹妙药。智能契约审计主要是为了对代码进行第二次检查，这可以帮助开发人员找到他们在第一次构建和测试代码时遗漏的问题。尽管如此，他们不会抓住每一个错误。为了充分利用智能合同审计，您还应该遵循与审计员合作的最佳实践，例如正确记录代码和添加行内注释。

建立 bug 奖励计划是从公司外部获得代码评审的另一种方式。审计和 bug 奖励计划的存在并不能免除你生产高质量代码的义务，良好的智能合约安全的第一步是使用正确的设计和开发过程。

> 交易新手？试试[加密交易机器人](/coinmonks/crypto-trading-bot-c2ffce8acb2a)或者[复制交易](/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c)