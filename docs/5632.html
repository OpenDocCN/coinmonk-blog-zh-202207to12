<html>
<head>
<title>Random Numbers In Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可靠性中的随机数</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/keccak-adding-pseudorandom-numbers-to-your-smart-contract-6908f9d9e3ef?source=collection_archive---------12-----------------------#2022-10-28">https://medium.com/coinmonks/keccak-adding-pseudorandom-numbers-to-your-smart-contract-6908f9d9e3ef?source=collection_archive---------12-----------------------#2022-10-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/04d9cb4b5ffff146aae274df38e31fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9URT1Q-rykoRUbdw"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@rocinante_11?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mick Haupt</a> on <a class="ae jf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2ca6" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">警告:</strong>这是<strong class="ji hu">而不是</strong>一种向你的智能合约添加随机数的安全方式，如果你计划将它部署到任何类型的mainnet-你应该看看像<a class="ae jf" href="https://chain.link/vrf" rel="noopener ugc nofollow" target="_blank"> Chainlink的VRF </a>这样的东西。使用我们将在文章中讨论的方法仅仅是为了学习，将这些代码部署到mainnet将会使您的契约暴露在许多攻击媒介之下。这是给你的警告，不听就别想告我，到头来丢了你的刀库。</p></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><h1 id="ea46" class="kl km ht bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">“为什么”:</h1><p id="f585" class="pw-post-body-paragraph jg jh ht ji b jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz ln kb kc kd hm dt translated">所以在过去的几天/周末，你一直在做一些简单的web3游戏或彩票，你就要完成了。你已经编写了你的测试，花了几个小时阅读日志错误，防弹你的合同(在部署<em class="lo">至少</em> 300个合同给Goerli之后)，并且完成了UI。唯一的问题:你的游戏<strong class="ji hu">超级无聊</strong>。没有情趣，没有变化。当你的角色攻击老板时，命中目标。当boss玩家攻击你的时候，他们就打。游戏来回进行。不是很有说服力，是吗？</p><p id="ef43" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们想给这种游戏体验增加一些趣味，因为每个人都知道真正的战斗充满了机会。如果在攻击/防御功能上有所变化的话，这个游戏将会更吸引最终用户。</p><p id="7145" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">建立一个具体的目标:假设当任何角色攻击时，如果随机数小于5，他们可能会错过。如果更高，我们可以说他们击中了，并从对手那里扣除必要的生命值。因此，简而言之，我们需要添加一个函数来返回数字1-10，这样我们就可以适当地路由游戏。</p><p id="de0b" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在这篇文章中，我们将涵盖一个快速和肮脏的方式来实现这一点。</p></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><h1 id="a729" class="kl km ht bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">介绍凯克卡:</h1><p id="5489" class="pw-post-body-paragraph jg jh ht ji b jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz ln kb kc kd hm dt translated"><a class="ae jf" href="https://keccak.team/" rel="noopener ugc nofollow" target="_blank"> Keccak </a>(读作“ketchak”)最好被描述为一系列“海绵函数”。海绵函数是一种算法，在这种算法中，固定长度的输入被接受并带有任意数量的填充值，然后被转换并映射到固定长度的输出。</p><p id="cf56" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我知道这听起来有点吓人，但是让我们来分析一下。我提到了三个主要部分；输入、一些填充值和输出。</p><h2 id="0efa" class="lp km ht bd kn lq lr ls kr lt lu lv kv jr lw lx kz jv ly lz ld jz ma mb lh mc dt translated">一个接一个地走:</h2><ul class=""><li id="3b5d" class="md me ht ji b jj lj jn lk jr mf jv mg jz mh kd mi mj mk ml dt translated">输入:这个非常简单。从凯克的角度来看，这是你在改变什么。</li><li id="ad37" class="md me ht ji b jj mm jn mn jr mo jv mp jz mq kd mi mj mk ml dt translated">填充:<em class="lo">这些是应该总是唯一的数据点</em>。如前所述，keccak将固定输入映射到固定输出。如果你要传递一个固定的变量，比如说，unsigned int (uint) '7 '，输出总是相同的。注意到这一点，您可以选择使用类似“now”的变量，该变量引用提出下一个块的节点中的全局系统时间戳。增加一些这样的变量会使伪造随机性或预测结果变得更加困难，但无论如何，这仍然不应该被混淆为安全。</li><li id="64d7" class="md me ht ji b jj mm jn mn jr mo jv mp jz mq kd mi mj mk ml dt translated">输出:输入的结果+添加到keccak函数中的任何填充变量。我们将使用该输出的子集来生成我们的“随机”数字1-10。</li></ul><p id="c176" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">当它被分解并从离散数学演讲中提取出来时，它并不是那么糟糕(顺便说一下，这里有一个更多的链接，如果那是<a class="ae jf" href="https://keccak.team/sponge_duplex.html" rel="noopener ugc nofollow" target="_blank">你的事情</a>)。</p></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><h1 id="8e3f" class="kl km ht bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">代码:</h1><p id="cefa" class="pw-post-body-paragraph jg jh ht ji b jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz ln kb kc kd hm dt translated">代码本身非常简单，感谢GeeksForGeeks向我介绍了这个概念。</p><pre class="mr ms mt mu fq mv mw mx my aw mz dt"><span id="a6e4" class="lp km ht mw b fv na nb l nc nd">pragma solidity ^0.6.6;</span><span id="60aa" class="lp km ht mw b fv ne nb l nc nd">contract YourContract {</span><span id="7891" class="lp km ht mw b fv ne nb l nc nd">//One of our state variables to add padding to Keccak<br/>uint nonce = 0;</span><span id="e06c" class="lp km ht mw b fv ne nb l nc nd">//the meat and potatoes, what will yield our 'random' numbers<br/>function randMod(uint _modulus) internal returns(uint) {</span><span id="6824" class="lp km ht mw b fv ne nb l nc nd">    //increment to ensure no repeated inputs<br/>    nonce++;</span><span id="2fee" class="lp km ht mw b fv ne nb l nc nd">    //cast the value returned from the modulus of the <br/>    return uint(keccak256(abi.encodePacked(<br/>          //the current timestamp, mentioned previously<br/>          now,<br/>          //a reference to whomever sent the transaction<br/>          msg.sender,<br/>          //the nonce that we incremented in the lines above<br/>          nonce)<br/>       )) % _modulus;<br/>    }<br/>}</span></pre><p id="2e97" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">通过在代码中添加nonce状态变量和randMod函数，您就可以开始比赛了。只要调用randMod，并传入_modulus参数，就可以根据契约中的返回值添加逻辑门！</p><p id="50e6" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">为了解决前面的问题陈述，我们将制作一个标准的if-else逻辑门，并检查随机数是否大于5，如果是，攻击角色将成功着陆，否则，他们将失败。轻松点。</p></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><h1 id="8cb6" class="kl km ht bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">关闭:</h1><p id="2441" class="pw-post-body-paragraph jg jh ht ji b jj lj jl jm jn lk jp jq jr ll jt ju jv lm jx jy jz ln kb kc kd hm dt translated">如果你还没有一份正在处理的智能合同，但想自己尝试一下，你可以启动一个<a class="ae jf" href="https://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank">混音</a>的快速会话来探索，或者你可以去<a class="ae jf" href="http://buildspace.so" rel="noopener ugc nofollow" target="_blank"> buildspace </a>！</p><p id="76d1" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">如果你不知道什么是buildspace，它是一个结构非常好的免费资源，可以用来学习web3开发的基础知识。我不会从吸引人们访问网站中获得任何经济利益，所以你可以放心，我的推荐是真诚的。Buildspace是目前我所知道的最好的web3学习资源，所以我想让尽可能多的人知道它。</p><p id="15d4" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">然而，<em class="lo">我确实</em>偶尔会对课程进行编辑/改进，这是我添加的一个额外挑战的例子！如果你想开始构建一个<a class="ae jf" href="https://buildspace.so/p/create-turn-based-nft-game/lessons/what-we-building" rel="noopener ugc nofollow" target="_blank">以太坊回合制NFT游戏</a>并使用Keccak添加伪随机机会，现在<em class="lo">现场直播的课程计划</em>包含你需要的一切！</p><p id="715c" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">你到底在等什么？</p></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><p id="b787" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">非常感谢您的阅读，我希望您喜欢这篇关于Keccak的介绍，并且理解为什么它只应用于学习目的。也许在以后的文章中，我会解释如何真正地使用<em class="lo">可验证的</em>随机数。如果你对此感兴趣，请在评论中告诉我！</p><p id="2436" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">下次见。</p><blockquote class="nf"><p id="a035" class="ng nh ht bd ni nj nk nl nm nn no kd ek translated">交易新手？试试<a class="ae jf" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a>或<a class="ae jf" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>