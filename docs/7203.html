<html>
<head>
<title>Examination of the Fortress Protocol Hack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对堡垒协议黑客的检查</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/examination-of-the-fortress-protocol-hack-e261c96ea450?source=collection_archive---------19-----------------------#2022-12-08">https://medium.com/coinmonks/examination-of-the-fortress-protocol-hack-e261c96ea450?source=collection_archive---------19-----------------------#2022-12-08</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="f626" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">5月9日上午11点，《堡垒协议》遭到敌意攻击，导致其资金被盗。这是堡垒协议的治理合同的设计缺陷和对伞状网络甲骨文的任意操纵促成了攻击。</p><p id="1530" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">5月8日周日，黑客利用保护伞公司的oracle智能合约链中的一个缺陷，操纵了一流数据对MAHA-USD和FTS-USD的价格馈送数据。操纵价格之后，MahaDAO和Fortress都被进一步利用。</p><p id="cd53" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">攻击者首先利用龙卷风现金在以太坊上购买$FTS代币。</p><p id="d770" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">他买了足够多的票，超过了所需的400，000票和担保法定人数。他能够控制治理合同，并最终获得一个提案(提案ID11)的通过。旨在改变信贷协议中附属条款的一系列行动。</p><p id="08ec" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">之后，由于贷款安排，攻击者可以轻松获得大量资产。完成后，他们使用Celer网络将资金转移到以太坊，然后使用Tornado Cash隐藏他们的踪迹。</p><p id="74f4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然而，在以太和戴到达混音器之前，他们在Uniswap上切换了几次。然后他们用龙卷风现金进行组合。由于不清楚的原因，像和这样的稳定硬币通过Uniswap被换成了稳定硬币DAI和包裹乙醚。</p><p id="ef0c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">袭击者小心翼翼。他利用Tornado的隐私协议在开始和结束时执行他的操作。以太坊上发送者和接收者之间可能存在的任何联系都被龙卷风现金混合协议打破，从而创造了理想的掩护。</p><h2 id="dc78" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">攻击相关信息</h2><p id="9ab0" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">这些是攻击堡垒协议中涉及的地址，这是一个基于币安智能链的DeFi贷款协议。</p><p id="b6de" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">攻击者地址:<br/><a class="ae ko" href="https://bscscan.com/address/0xA6AF2872176320015f8ddB2ba013B38Cb35d22Ad" rel="noopener ugc nofollow" target="_blank">https://bscscan . com/Address/0x a6 af 2872176320015 F8 DDB 2 ba 013 b 38 CB 35d 22 ad</a></p><p id="e3f6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">交易哈希:<br/><a class="ae ko" href="https://bscscan.com/tx/0x13d19809b19ac512da6d110764caee75e2157ea62cb70937c8d9471afcb061bf" rel="noopener ugc nofollow" target="_blank">https://bscscan . com/tx/0x 13d 19809 b 19 AC 512 da 6d 110764 caee 75 e 2157 ea 62 CB 70937 c 8d 9471 afcb 061 BF</a></p><p id="a954" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">FTS令牌合同地址:<br/><a class="ae ko" href="https://bscscan.com/address/0x4437743ac02957068995c48e08465e0ee1769fbe" rel="noopener ugc nofollow" target="_blank">https://bscscan . com/Address/0x 4437743 AC 02957068995 c48e 08465 e0ee 1769 FBE</a></p><h2 id="3dd5" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">深入的分析</h2><p id="cbfc" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">攻击者为正式攻击设定了19天的准备期。4月29日通过TornadoCash获得了总计20个ETH，12.4个ETH通过cBridge连接到币安智能链。</p><p id="270e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">《堡垒协议》的治理令牌总供应量为100亿FTS，于2022年4月21日发行。由于$FTS的低价，以大约11.4 ETH购买了大约400，000个FTS代币，占总供应量的4%。</p><p id="a873" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">正是在5月4日，攻击者创建了一个恶意的提议合同:</p><p id="9c3d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae ko" href="https://bscscan.com/address/0x0dB3B68c482b04c49cD64728AD5D6d9a7B8E43e6" rel="noopener ugc nofollow" target="_blank">https://bscscan . com/address/0x 0 db 3 b 68 c 482 b 04 c 49 CD 64728 ad 5d 6d 9 a 7 b 8 e 43 e 6</a></p><p id="22f9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在下一步中，提议的合同被添加到提议11，提议队列。在为期三天的投票中，攻击者在5月7日投票结束前几个小时，通过使用他们之前购买的40万个令牌中的一部分，投票支持该提案。</p><p id="a323" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">0xc 368 AFB 2 AFC 499 e 7 ebb 575 ba 3 e 717497385 ef 962 B1 f 1922561 BCB 13 f 85336252；<br/>0x 83 a4 F8 f 52 b 8 f 9 e 6 ff 1 DD 76546 a 772475824d 9 aa 5b 953808 DBC 34 D1 f 39250 f 29d</p><p id="e269" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用下图，我们可以看到治理契约的成功通过需要满足两个条件:</p><figure class="kq kr ks kt fq ku fe ff paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="fe ff kp"><img src="../Images/98fd7fa169b38c72cc0bc39a1e14d29d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JY5n0Snj4o9HZCa0HIzQtg.png"/></div></div></figure><ul class=""><li id="245a" class="lb lc ht is b it iu ix iy jb ld jf le jj lf jn lg lh li lj dt translated">赞成票多于反对票</li><li id="f3a7" class="lb lc ht is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj dt translated">赞成票的数量大于或等于FTS代币供应总量的4%(400，000 FTS)。</li></ul><p id="85f7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">投票后，提案获得批准，并在两天的等待期后生效。</p><p id="88a1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2天后，5月9日，用户创建了攻击合同并开始攻击。</p><p id="b2a4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">以下是攻击合同在恶意提议执行期间采取的步骤:</p><p id="f34b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了使FTS代币更具杠杆作用，杠杆比率应该从0变为0.7，这将允许攻击者借出杠杆化的FTS代币价值的70%。</p><p id="6228" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">担保品价格合同通过堡垒协议接收:<a class="ae ko" href="https://bscscan.com/address/0x00fcF33BFa9e3fF791b2b819Ab2446861a318285" rel="noopener ugc nofollow" target="_blank">https://bscscan . com/address/0x 00 fcf 33 BFA 9 E3 ff 791 B2 b 819 ab 2446861 a 318285</a></p><p id="3da7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下图说明了用于估算代币价格的不同预测:</p><figure class="kq kr ks kt fq ku fe ff paragraph-image"><div class="fe ff lp"><img src="../Images/f4e5526ac9ade6cbdc992d54609df00a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*Plq4Y7tIzAR7T87QQrIcAg.jpeg"/></div></figure><p id="eef0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">例如，FTS使用伞状甲骨文来确定其价格:</p><p id="2825" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae ko" href="https://bscscan.com/address/0xc11B687cd6061A6516E23769E4657b6EfA25d78E" rel="noopener ugc nofollow" target="_blank">https://bscscan . com/address/0xc 11 b 687 CD 6061 a 6516 e 23769 e 4657 b 6 EFA 25d 78 e</a></p><p id="7091" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用下图，我们可以看到Oracle的“提交多重签名价格馈送”功能中的漏洞:</p><figure class="kq kr ks kt fq ku fe ff paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="fe ff lq"><img src="../Images/c3e98c56fc2c4aca206519ad4797898e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jja8m1tZGJS7Q1CzG_XB5g.jpeg"/></div></div></figure><p id="2710" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果签名的数量超过所需的签名数，则无法验证签名者是否拥有正确的提要。这使得攻击者能够使用任何帐户生成签名。</p><p id="ff41" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">攻击发生后，保护伞公司迅速更新了合同并修复了漏洞:</p><p id="eaa3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae ko" href="https://bscscan.com/address/0x49D0D57cf6697b6a44050872CDb760945B710Aab" rel="noopener ugc nofollow" target="_blank">https://bscscan . com/address/0x 49d 0d 57 cf 6697 b 6 a 44050872 CDB 760945 b 710 aab</a></p><p id="9ea3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，更新后的提交功能还会检查签名者权限。</p><p id="8ffe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">至于攻击，攻击者设法操纵甲骨文机器，并为设定了非常高的价格，从而允许他出借所有代币，包括、、、、ETH、LTC、、ADA、DAI、DOT和SHIB。</p><figure class="kq kr ks kt fq ku fe ff paragraph-image"><div class="fe ff lr"><img src="../Images/9097046bc68a512a419bca06928a8e46.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*6g_f9FYve-F19GUblfT5rg.jpeg"/></div><figcaption class="ls lt fg fe ff lu lv bd b be z ek">List of Stolen Fortress Assets</figcaption></figure><p id="c30a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过Anyswap和cBridge，所有这些代币都被桥接到以太坊网络，并兑换成大约三百万USDT。该USDT在被改变成ETH和DAI之后，随后通过以太坊网络被传送到TornadoCash。</p><h2 id="9386" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">摘要</h2><p id="74f8" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">作为此次攻击的一部分，Oracle价格操纵协议中的一个缺陷和治理协议中的一个漏洞被利用。</p><p id="8e1c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在创建治理契约时，将令牌投票模型的设计逻辑考虑在内是至关重要的，这样可以使有害的攻击难以执行。</p><p id="0399" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">检查分散的Oracle很重要，但考虑外部Oracle是否能与协议一起工作也很重要。</p><p id="0de4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在此之前，还发生了两起引人注目的袭击事件。受影响最严重的网络是Axie的Ronin，损失超过6亿美元。同样，逆向金融公司损失了价值超过1500万美元的资产。同样是在过去的一个月里，今年的第二大违反事件针对的是Rari的保险丝协议。</p><p id="3f14" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在加密货币生态系统中，散布恐惧是一种常见的做法，因为漏洞会越来越频繁地影响DeFi协议和不和谐服务器。因此，密码领域的安全似乎是今年最大的问题。</p><blockquote class="lw"><p id="7d9b" class="lx ly ht bd lz ma mb mc md me mf jn ek translated">交易新手？试试<a class="ae ko" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae ko" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>