# DeFi 协议是如何泄露的？

> 原文：<https://medium.com/coinmonks/how-are-defi-protocols-compromised-fac9d23497f8?source=collection_archive---------42----------------------->

根据最近的研究，2022 年，DeFi 和 Web3 已经因违规和欺诈损失了 20 亿美元。自第二季度损失率下降以来，加密货币价值的下降可能已经让用户和黑客都失去了兴趣。

DeFi 协议特别容易被黑客攻击，因为它们的开源代码可供网络罪犯研究以寻找漏洞，并且协议进入市场和快速扩张的动机很可能导致它们在宽松的安全最佳实践方面犯错误。

直到 2021 年，密码交换安全系统的入侵是最常见的加密货币盗窃方法；目前，DeFi 黑客更加普遍。

最致命的 DeFi 攻击发生在 3 月份，当时 Ronin 网络被攻破，导致超过 6.5 亿美元的加密货币通过 Tornado Cash mixer 从广受欢迎的 Axie Infinity NFT(不可替换令牌)游戏中被洗钱。根据 Crystal 的数据，该服务在 2022 年上半年收到了约 350，000 个以太网(ETH)，超过了所有通过 Tornado Cash 进行的 ETH 的一半。

就美元而言，以太坊区块链站被盗金额最大，这可能是因为它是使用最广泛的 DeFi 平台。紧随其后的是索拉纳、币安智能链、Fantom 和 Polygon。

【2022 年 1 月开始——Crypto.com 黑客

Crypto.com 的风险监控系统在 2022 年 1 月 17 日星期一发现了少量用户帐户上的未经授权的活动。交易在用户没有进入 2FA 认证控制的情况下被批准。为了确保只有经过授权的活动才会发生，Crypto.com 撤销了所有客户的 2FA 令牌，并引入了额外的安全强化措施。因此，所有客户都必须重新登录并设置他们的 2FA 令牌。2FA 的实现提高了用户凭证和用户可以访问的资源的安全性。与依赖单因素身份认证(SFA)的身份认证技术相比，双因素身份认证提供了更好的安全性，在单因素身份认证中，用户只需提供一个参数，通常是密码。为了采用双因素身份验证，用户必须提供密码作为第一个因素和另一个不同的因素，通常是安全令牌或生物特征因素，如指纹或面部扫描。黑客把所有的资金都退回来了。

**量子比特金融黑客**

黑客获得了建立在币安智能链上的量子金融，并从中窃取了 8000 多万美元。从量子比特的 QBridge 协议中，与攻击相关的地址窃取了 206，809 个币安硬币(BNB)。

Qubit Finance 利用区块链的速度、自动化和安全性有效、安全地连接贷款人和借款人，将自己表现为一个分散的货币市场平台。

Qubit Finance 除了提供借贷服务之外，还运行以太坊-BSC 桥梁。这个漏洞的目标是这座桥。在量子金融提供的桥的情况下，你将你的 ERC-20 代币存入桥，作为交换，你可以在币安智能链上使用 BEP-20 代币。

在没有任何 ETH 链接到该交易的情况下，攻击者使用了 QBridge 合约的 deposit()函数。攻击者在函数调用过程中输入了恶意数据。数据参数必须指定在发出具有该值的事件之前已经存放了多少以太币。在 BSC 上，根据存放在以太坊桥中的 ETH 数量，生成特定数量的量子位 xETH。它根据 QBridge 契约的存款逻辑调用 IQBridgeHandler。原始令牌地址 WETH 令牌应发送到 QBridgeHandler，如果发送 tx 的用户不持有 WETH 令牌，则不应进行传输。“总之，存款功能是一个一旦存款被创建就不应该使用的功能，然而它仍然存在于合同中。

*黑客利用量子金融代码中的逻辑缺陷，能够在币安智能链上输入欺诈数据并提取代币，而以太坊上没有代币。*

# 现金剥削

黑客首先使用他的 20 亿个未识别代币铸造了 20 亿个现金代币。这个动作之所以可行，是因为 Cashio 的代码中有一个 bug。

请记住，为了兑现现金，客户必须首先存入同等价值的抵押品。简而言之，在整个存款过程中，将执行一轮验证，以确保协议账户和担保账户持有相同的令牌类型。如果不是这样，传输将被停止。可悲的是，Cashio 忽视了为其使用的账户建立信任基础。因此，验证程序变得无效，黑客能够创建一个虚构的帐户网络，并铸造惊人的 20 亿现金代币。

黑客通过 Cashio 平台烧毁了 Cashio 存款中所有基础萨伯·USDT-USDC LP 代币的 20 亿新铸造现金代币中的一部分，基本上耗尽了 Cashio 的所有 stablecoin 存款。黑客随后通过 Solana 的 Saber 协议将上述所有 USDT-USDC LP 令牌交换为 1640 万美元的 USDC 和 1080 万美元的 USDT。

然后，黑客使用 Saber 将所有现金令牌分别兑换成 860 万美元的 UST 和 1700 万美元的 USDC。这很快使现金代币的公开市场价格降至零。在 USDC、USDT 和 UST 从 Cashio 和 Saber 窃取总计 5280 万美元后，黑客使用 Solana 上的 Jupiter 流动性聚合器将 USDC 和 USDT 的 1530 万美元转换为 3,773.9737 ETH。然后这个以太网通过虫洞桥在三次交易中被发送到一个以太坊地址。黑客随后使用 Jupiter 将另外 2100 万美元的 USDC 转换为 2050 万美元的 UST，然后使用虫洞桥将 2900 万美元的 UST 和最后 790 万美元的 USDC 发送到同一个以太坊钱包地址。

**豆茎攻击**

该协议的多数表决治理方案被攻击者利用，攻击者利用一个漏洞作为整个攻击的基础。简单地说，任何拥有 2/3(绝对多数)选票的人都有能力在任何时候通过 BIP 法案。

由于通过套利交易赚钱的有趣可能性，闪贷在 DeFi 越来越受欢迎。然而，DeFi 是许多黑客的家园，他们利用这些贷款窃取大量的加密货币。(快速贷款不需要抵押品，因为初始贷款必须在交易结束时归还。)如果借款人无法保证还款，则交易失败。

10 亿美元的紧急贷款用于从 Aave 购买 3.5 亿台 DAI、5 亿台和 1.5 亿台，从 Uniswap v2 购买 3200 万台 BEAN，从 SushiSwap 购买 1160 万台。

10 亿美元的紧急贷款用于从 Aave 购买 3.5 亿台 DAI、5 亿台和 1.5 亿台，从 Uniswap v2 购买 3200 万台 BEAN，从 SushiSwap 购买 1160 万台。在使用 BEAN 进行治理投票的曲线池中，这些令牌被用来增加流动性。为了创建 BEAN3CRV-f，攻击者首先使用戴、、制造了 3CRV。然后，由于将 3200 万美元的 BEAN 和 2500 万美元的 LUSD 存入另一个合同，创建了一个新的令牌 BEAN3LUSD-f。

然后，攻击者将上述资产放入豆茎筒仓中，在那里他们能够收集足够的茎和种子，以控制 70%的流通(LP 存款人每存一粒豆获得的种子是豆存款的两倍)。有了这个份额，攻击者就能够使用 emergencyCommit 函数并获得 2/3 的绝对多数票。

攻击者现在部署并批准了一个伪造的协议改进提案(BIP18 ),耗尽了池资金并将令牌(BEAN/WETH-BEAN LP/BEAN 3 crv-f/BEANLUSD-f)转移给了攻击者。攻击者能够通过使用硬币混合工具 TornadoCash 来实现这一点，以获得 24,830 WETH 的利润(约 7600 万美元；剩余的 1.06 亿美元用于偿还给 AAVE 的紧急贷款。

通过让人们认为 BIP18 专门用于为乌克兰捐款地址收集捐款，攻击者成功地误导了社区。emergencyCommit 函数帮助攻击者在投票后立即执行计划，就这样，Beanstalk 损失了 1 . 82 亿美元。一旦攻击者通过闪贷获得了多数治理份额。

**幕后**

黑客的标准工具包使他们能够从网络的主版本中获得区块链的完整副本，然后完全微调一个漏洞，就好像它发生在真实的网络中一样。黑客经常利用第三方服务和商业逻辑数学模型中的缺陷。智能合同创建者在交易时经常需要比他们现在可能拥有的更多的相关信息。结果，他们被迫使用外部资源，比如神谕。这些服务在不可靠的环境中无法正常工作，因此使用它们会带来巨大的风险。尽管许多开发人员缺乏必要的技能，但他们仍然试图快速部署项目。由于智能合约的开源性质，黑客可以很容易地复制并对其进行微小的更改。

价格操纵是闪贷攻击的常见组成部分。攻击者可以通过在一次交易中出售大量借来的代币来降低它们的价格，然后在代币的价值非常低时对其进行各种操作，然后再购回它们。

> 加入 Coinmonks [电报频道](https://t.me/coincodecap)和 [Youtube 频道](https://www.youtube.com/c/coinmonks/videos)了解加密交易和投资

# 另外，阅读

*   [加密复制交易平台](/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c) | [五大 BlockFi 替代方案](https://coincodecap.com/blockfi-alternatives)
*   [CoinLoan 点评](https://coincodecap.com/coinloan-review)|[Crypto.com 点评](/coinmonks/crypto-com-review-f143dca1f74c) | [火币保证金交易](/coinmonks/huobi-margin-trading-b3b06cdc1519)
*   [Bybit vs 币安](https://coincodecap.com/bybit-binance-moonxbt)|[stealth x 回顾](/coinmonks/stealthex-review-396c67309988) | [Probit 回顾](https://coincodecap.com/probit-review)
*   [顶级付费加密货币和区块链课程](https://coincodecap.com/blockchain-courses)
*   [密码交易机器人](/coinmonks/crypto-trading-bot-c2ffce8acb2a)|[15 大 P2E NFT 游戏](https://coincodecap.com/p2e-nft-games)