<html>
<head>
<title>Precautions while developing smart contracts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开发智能合同时的注意事项</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/precautions-while-developing-smart-contracts-e90e8e42535f?source=collection_archive---------18-----------------------#2022-07-06">https://medium.com/coinmonks/precautions-while-developing-smart-contracts-e90e8e42535f?source=collection_archive---------18-----------------------#2022-07-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/a394a9ebeff74a6ae4461a3ad254eeff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b70P8XYxhCU1rwHzyfILaw.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Security Precautions</figcaption></figure><p id="22b7" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">可升级性</p><p id="f2e0" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">由于需求或新的错误，您的智能合约中会有新功能的要求，但一旦您部署了智能合约，就不可能更改合约(嗯…)，但通常会更改概念和理解。</p><p id="00c6" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">有许多方法可以升级您的合同功能:</p><ol class=""><li id="56ab" class="kd ke ht jh b ji jj jm jn jq kf ju kg jy kh kc ki kj kk kl dt translated">创建一个升级的合同，然后从旧合同联系它，但有一些需要考虑的问题，如它不应该破坏功能，数据不应该孤立，它不应该花费高昂的天然气费。这可以通过两种方式实现:</li></ol><p id="7e1b" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">A.创建注册中心合同:注册中心合同将具有新的、更新的和旧的合同的地址，并在升级合同时更改角色</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="5f75" class="kv kw ht kr b fv kx ky l kz la">pragma solidity ^0.5.0;<br/><br/>contract RegisterContract {<br/>    address backendContract; // new updated contract<br/>    address[] previousBackends;// all the old version contract<br/>    address owner;<br/><br/>    constructor() {<br/>        owner = msg.sender;<br/>    }<br/><br/>    modifier onlyOwner() {<br/>        require(msg.sender == owner)<br/>        _;<br/>    }<br/><br/>    function changeBackend(address newBackend) public<br/>    onlyOwner()<br/>    returns (bool)<br/>    {<br/>        if(newBackend != address(0) &amp;&amp; newBackend != backendContract) {<br/>            previousBackends.push(backendContract);<br/>            backendContract = newBackend;<br/>            return true;<br/>        }<br/><br/>        return false;<br/>    }<br/>}</span></pre><p id="0b88" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这种方法的问题是应该知道最新的合同地址，因为有可能使用旧的合同。第二个问题是数据传输，如何传输数据需要非常小心。</p><p id="5ba4" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">2.创建中继协定并使用委托呼叫来传输数据</p><p id="cb7f" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">基本上，回退功能会将数据传输到当前版本的合同。制定了一个中继协定，它将通过回退功能将数据从旧协定传输到新协定，但这种方法的问题是它只能转发调用，不能返回值</p><pre class="km kn ko kp fq kq kr ks kt aw ku dt"><span id="858e" class="kv kw ht kr b fv kx ky l kz la">pragma solidity ^0.5.0;</span><span id="975b" class="kv kw ht kr b fv lb ky l kz la">contract Relay {<br/>    address public currentVersion;<br/>    address public owner;</span><span id="4b8e" class="kv kw ht kr b fv lb ky l kz la">    modifier onlyOwner() {<br/>        require(msg.sender == owner);<br/>        _;<br/>    }</span><span id="f00b" class="kv kw ht kr b fv lb ky l kz la">    constructor(address initAddr) {<br/>        require(initAddr != address(0));<br/>        currentVersion = initAddr;<br/>        owner = msg.sender; // this owner may be another contract with multisig, not a single contract owner<br/>    }</span><span id="d72d" class="kv kw ht kr b fv lb ky l kz la">    function changeContract(address newVersion) public<br/>    onlyOwner()<br/>    {<br/>        require(newVersion != address(0));<br/>        currentVersion = newVersion;<br/>    }</span><span id="ccc9" class="kv kw ht kr b fv lb ky l kz la">    fallback() external payable {<br/>        (bool success, ) = address(currentVersion).delegatecall(msg.data);<br/>        require(success);<br/>    }<br/>}</span></pre><p id="7485" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">人们需要非常小心如何在新的合同中存储数据，它应该有与前一个相同的存储布局，否则它会损坏数据</p><h1 id="6d7d" class="lc kw ht bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly dt translated">断路器</h1><p id="14ab" class="pw-post-body-paragraph jf jg ht jh b ji lz jk jl jm ma jo jp jq mb js jt ju mc jw jx jy md ka kb kc hm dt translated">停止除撤销之外的所有功能，受信任方只能撤销</p><h1 id="d68d" class="lc kw ht bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly dt translated">减速带:</h1><p id="3e1c" class="pw-post-body-paragraph jf jg ht jh b ji lz jk jl jm ma jo jp jq mb js jt ju mc jw jx jy md ka kb kc hm dt translated">减速过程(冷静期)刀攻有27天资金回笼</p><h1 id="b959" class="lc kw ht bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly dt translated">限速</h1><p id="5dc8" class="pw-post-body-paragraph jf jg ht jh b ji lz jk jl jm ma jo jp jq mb js jt ju mc jw jx jy md ka kb kc hm dt translated">要求提款或认沽条件批准只有一定数量的钱可以提取</p><h1 id="2263" class="lc kw ht bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly dt translated">部署</h1><p id="87f8" class="pw-post-body-paragraph jf jg ht jh b ji lz jk jl jm ma jo jp jq mb js jt ju mc jw jx jy md ka kb kc hm dt translated">合同应该有一个长时间的测试期——在大笔资金被置于风险之前。</p><p id="ec79" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">至少，您应该:</p><ul class=""><li id="a128" class="kd ke ht jh b ji jj jm jn jq kf ju kg jy kh kc me kj kk kl dt translated">拥有100%测试覆盖率(或接近100%)的完整测试套件</li><li id="6255" class="kd ke ht jh b ji mf jm mg jq mh ju mi jy mj kc me kj kk kl dt translated">在您自己的测试网上部署</li><li id="c35c" class="kd ke ht jh b ji mf jm mg jq mh ju mi jy mj kc me kj kk kl dt translated">部署在公共测试网上，提供大量测试和bug奖励</li><li id="e75c" class="kd ke ht jh b ji mf jm mg jq mh ju mi jy mj kc me kj kk kl dt translated">详尽的测试应该允许不同的参与者大量地与合同进行交互</li><li id="546c" class="kd ke ht jh b ji mf jm mg jq mh ju mi jy mj kc me kj kk kl dt translated">在测试版中在mainnet上部署，对风险金额进行限制</li></ul><blockquote class="mk ml mm"><p id="5160" class="jf jg mn jh b ji jj jk jl jm jn jo jp mo jr js jt mp jv jw jx mq jz ka kb kc hm dt translated">交易新手？试试<a class="ae mr" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae mr" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>