<html>
<head>
<title>How to create an UUPS Proxy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åˆ›å»ºUUPSä»£ç†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/coinmonks/how-to-create-an-uups-proxy-66eca257b2f9?source=collection_archive---------6-----------------------#2022-09-12">https://medium.com/coinmonks/how-to-create-an-uups-proxy-66eca257b2f9?source=collection_archive---------6-----------------------#2022-09-12</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><h1 id="5371" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">ä»€ä¹ˆæ˜¯UUPSä»£ç†ï¼Ÿ</h1><p id="2f81" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">UUPSä»£è¡¨é€šç”¨å¯å‡çº§ä»£ç†æ ‡å‡†ï¼Œæœ€åˆè®°å½•åœ¨<a class="ae km" href="https://eips.ethereum.org/EIPS/eip-1822" rel="noopener ugc nofollow" target="_blank"> EIP1822 </a>ä¸­ã€‚åœ¨è¿™ä¸ªä»£ç†æ¨¡å¼ä¸­ï¼Œå‡çº§å®ç°å¥‘çº¦åœ°å€çš„è´£ä»»åœ¨äºå®ç°å¥‘çº¦æœ¬èº«ã€‚ç›¸åï¼Œåœ¨é€æ˜ä»£ç†æ¨¡å¼ä¸­ï¼Œå‡çº§å®ç°å¥‘çº¦åœ°å€çš„è´£ä»»æ˜¯ä»£ç†å¥‘çº¦å’Œä»£ç†ç®¡ç†å¥‘çº¦çš„è´£ä»»ã€‚å…³äºé€æ˜ä»£ç†æ¨¡å¼çš„æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·æŸ¥çœ‹<a class="ae km" rel="noopener" href="/@HashHaran/essential-guide-to-smart-contract-upgradeability-a257dac36525">è¿™ç¯‡</a>æ–‡ç« ã€‚</p><p id="7de1" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">å½“æˆ‘ä»¬å°è¯•å‡çº§ä½¿ç”¨UUPSä»£ç†æ¨¡å¼éƒ¨ç½²çš„æ™ºèƒ½å¥‘çº¦æ—¶ï¼Œä»£ç†å¥‘çº¦ä¼šè°ƒç”¨å®ç°å¥‘çº¦ã€‚å®ƒæ£€æŸ¥å‡çº§çš„ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å‡çº§å®ç°ï¼Œç„¶åç»§ç»­å°†å®ç°åˆåŒåœ°å€æ›´æ”¹ä¸ºæ–°çš„åœ°å€ã€‚</p><p id="db27" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">ä¸é€æ˜ä»£ç†æ¨¡å¼ç›¸æ¯”ï¼Œæ¨èä½¿ç”¨UUPSä»£ç†æ¨¡å¼ï¼Œå› ä¸ºå®ƒæ¶ˆé™¤äº†é€æ˜ä»£ç†æ¨¡å¼ä¸­æ‰€éœ€çš„ä»£ç†ç®¡ç†å¥‘çº¦ï¼Œä»è€ŒèŠ‚çœäº†åˆå§‹éƒ¨ç½²æœŸé—´çš„å¼€é”€ã€‚ä½¿ç”¨UUPSä»£ç†æ¨¡å¼æ—¶ï¼Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ã€‚å¦‚æœæ‚¨ä½¿ç”¨éUUPSå…¼å®¹çš„å®ç°æ¥å‡çº§æ‚¨çš„ä»£ç†ï¼Œæ‚¨å°†æ°¸è¿œæ— æ³•å‡çº§å®ƒã€‚è¿™æ ·çš„é”™è¯¯å¯èƒ½æ˜¯è‡´å‘½çš„ï¼Œå› ä¸ºä½ å·²ç»å¤±å»äº†å¯å‡çº§æ€§ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¿®å¤è¿™ç§é”™è¯¯çš„åé—¨ã€‚</p><p id="36f9" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">è®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨UUPSä»£ç†æ¨¡å¼éƒ¨ç½²ä¸€ä¸ªæ™ºèƒ½å¥‘çº¦ã€‚</p><p id="a5d1" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">è¿™ä¸ª<a class="ae km" href="https://github.com/HashHaran/hardhat-upgrades" rel="noopener ugc nofollow" target="_blank"> Githubä»“åº“</a>æœ‰è¿™ç¯‡æ–‡ç« çš„ä»£ç ï¼Œå¯ä»¥éšæ„ä¿å­˜ä»¥å¤‡å°†æ¥ä½¿ç”¨ã€‚å¦‚æœæ‚¨ä¸æƒ³ä»å¤´å¼€å§‹è¿›è¡Œè®¾ç½®ï¼Œå¯ä»¥å…‹éš†å®ƒã€‚</p><h1 id="3323" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">é¡¹ç›®è®¾ç½®</h1><p id="49f0" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">æˆ‘ä»¬å°†ä½¿ç”¨<a class="ae km" href="https://hardhat.org/" rel="noopener ugc nofollow" target="_blank">å®‰å…¨å¸½</a>ç”¨äºæˆ‘ä»¬çš„ä»¥å¤ªåŠå¼€å‘å·¥ä½œæµç¨‹ã€‚åœ¨æœ¬æ¼”ç»ƒä¸­ï¼Œæˆ‘åœ¨windowsæœºå™¨ä¸Šä½¿ç”¨WSL2ã€‚å¦‚æœä½¿ç”¨ä¸åŒçš„è®¾ç½®ï¼Œæ‚¨å¯ä»¥ç¨å¾®è°ƒæ•´è¿™äº›æ­¥éª¤ã€‚æˆ‘ä»¬å¼€å§‹å§ï¼</p><p id="9e4f" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºèŠ‚ç‚¹é¡¹ç›®ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="7245" class="lb ir ht kx b fv lc ld l le lf"><strong class="kx hu">mkdir hardhat-upgrades &amp;&amp; cd hardhat-upgradesnpm init -y</strong></span></pre><p id="bce6" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">åœ¨è¿™ä¸ªç›®å½•ä¸­å®‰è£…hardhatã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="8fe6" class="lb ir ht kx b fv lc ld l le lf"><strong class="kx hu">npm i --save-dev hardhat</strong></span></pre><p id="55c8" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">åœ¨ç›®å½•ä¸­åˆå§‹åŒ–ä¸€ä¸ªhardhatç±»å‹çš„è„šæœ¬é¡¹ç›®ã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤å¹¶é€‰æ‹©â€œ<em class="lg">åˆ›å»ºä¸€ä¸ªTypeScripté¡¹ç›®â€</em>é€‰é¡¹ã€‚å¯¹äºå…¶ä½™çš„æç¤ºï¼Œè¯·ä½¿ç”¨é»˜è®¤å‚æ•°ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="fb2e" class="lb ir ht kx b fv lc ld l le lf"><strong class="kx hu">npx hardhat</strong></span></pre><p id="0d71" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">å®‰è£…å¼€æ”¾çš„zeppelin hardhatå‡çº§æ’ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥è½»æ¾éƒ¨ç½²æˆ‘ä»¬çš„ä»£ç†ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="39c2" class="lb ir ht kx b fv lc ld l le lf"><strong class="kx hu">npm i --save-dev @openzeppelin/hardhat-upgrades</strong></span></pre><p id="abd3" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">è¿˜è¦å®‰è£…æ¥è‡ªOpen zeppelinçš„å¯å‡çº§åˆåŒï¼Œå®ƒæ˜¯Open zeppelinåˆåŒçš„å¯å‡çº§å¯¹åº”ç‰©ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="7373" class="lb ir ht kx b fv lc ld l le lf"><strong class="kx hu">npm i --save-dev @openzeppelin/contracts-upgradeable</strong></span></pre><p id="7a54" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶å¹¶ç²˜è´´åˆ°hardhat.config.tsæ–‡ä»¶ä¸­ã€‚è¿™å°†åšè¿™ä¸ªé¡¹ç›®æ‰€éœ€çš„åŸºæœ¬å®‰å…¨å¸½è®¾ç½®ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="3ec1" class="lb ir ht kx b fv lc ld l le lf">import { HardhatUserConfig } from "hardhat/config";</span><span id="c03e" class="lb ir ht kx b fv lh ld l le lf">import "@nomicfoundation/hardhat-toolbox";</span><span id="079e" class="lb ir ht kx b fv lh ld l le lf">import "@openzeppelin/hardhat-upgrades";</span><span id="6653" class="lb ir ht kx b fv lh ld l le lf">import "@typechain/hardhat";</span><span id="205b" class="lb ir ht kx b fv lh ld l le lf">const config: HardhatUserConfig = {</span><span id="6403" class="lb ir ht kx b fv lh ld l le lf">solidity: {</span><span id="1640" class="lb ir ht kx b fv lh ld l le lf">version: "0.8.9",</span><span id="b1b7" class="lb ir ht kx b fv lh ld l le lf">settings: {</span><span id="ec7c" class="lb ir ht kx b fv lh ld l le lf">optimizer: {</span><span id="8438" class="lb ir ht kx b fv lh ld l le lf">enabled: true,</span><span id="9cdb" class="lb ir ht kx b fv lh ld l le lf">runs: 200,</span><span id="f277" class="lb ir ht kx b fv lh ld l le lf">},</span><span id="5c0f" class="lb ir ht kx b fv lh ld l le lf">},</span><span id="5475" class="lb ir ht kx b fv lh ld l le lf">},</span><span id="3518" class="lb ir ht kx b fv lh ld l le lf">defaultNetwork: "localhost",</span><span id="07d0" class="lb ir ht kx b fv lh ld l le lf">};</span><span id="b549" class="lb ir ht kx b fv lh ld l le lf">export default config;</span></pre><h1 id="2502" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">ä½¿ç”¨UUPSä»£ç†éƒ¨ç½²çš„å®æ–½åˆåŒ</h1><p id="dc4f" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">åœ¨contractsæ–‡ä»¶å¤¹ä¸­ï¼Œä¸ºæˆ‘ä»¬å°†è¦éƒ¨ç½²UUPSä»£ç†çš„å®ç°å¥‘çº¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="03f2" class="lb ir ht kx b fv lc ld l le lf"><strong class="kx hu">mkdir contracts/uups</strong></span></pre><p id="782e" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">åœ¨<em class="lg"> contracts </em>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<em class="lg"> VersionAware.sol </em>çš„æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹ä»£ç å¤åˆ¶ç²˜è´´åˆ°å…¶ä¸­ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="d96b" class="lb ir ht kx b fv lc ld l le lf"><em class="lg">// SPDX-License-Identifier: Unlicense</em></span><span id="0cbc" class="lb ir ht kx b fv lh ld l le lf">pragma solidity ^0.8.0;</span><span id="4438" class="lb ir ht kx b fv lh ld l le lf">abstract contract VersionAware {</span><span id="19fc" class="lb ir ht kx b fv lh ld l le lf">string public versionAwareContractName;</span><span id="0cb8" class="lb ir ht kx b fv lh ld l le lf">function getContractNameWithVersion()</span><span id="9b24" class="lb ir ht kx b fv lh ld l le lf">external</span><span id="6a97" class="lb ir ht kx b fv lh ld l le lf">pure</span><span id="2414" class="lb ir ht kx b fv lh ld l le lf">virtual</span><span id="b2a6" class="lb ir ht kx b fv lh ld l le lf">returns (string memory);</span><span id="fff6" class="lb ir ht kx b fv lh ld l le lf">}</span></pre><p id="4e0a" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†å®ç°å¥‘çº¦çš„åŸºæœ¬æ¡†æ¶ï¼Œä»¥ä¾¿åœ¨éƒ¨ç½²å’Œå‡çº§ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°çœ‹åˆ°ç‰ˆæœ¬å‡çº§ã€‚</p><p id="dec7" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">åœ¨<em class="lg"> contracts/uups </em>ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªåä¸ºUups <em class="lg"> ProxyPatternV1.sol </em>å’ŒUups <em class="lg"> ProxyPatternV2.sol </em>çš„æ–‡ä»¶ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶ç²˜è´´åˆ°å…¶ä¸­ã€‚</p><p id="d62d" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated"><em class="lg"> UupsProxyPatternV1.sol </em></p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="0478" class="lb ir ht kx b fv lc ld l le lf"><em class="lg">// SPDX-License-Identifier: Unlicense<br/></em>pragma solidity ^0.8.0;</span><span id="9f79" class="lb ir ht kx b fv lh ld l le lf">import {UUPSUpgradeable} from "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";<br/>import {OwnableUpgradeable} from "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";<br/>import {VersionAware} from "../VersionAware.sol";</span><span id="ab32" class="lb ir ht kx b fv lh ld l le lf">contract UupsProxyPatternV1 is<br/>UUPSUpgradeable,<br/>OwnableUpgradeable,<br/>VersionAware{</span><span id="7fd1" class="lb ir ht kx b fv lh ld l le lf">constructor() {<br/>_disableInitializers();<br/>}</span><span id="7f69" class="lb ir ht kx b fv lh ld l le lf">function initialize() external initializer {<br/>versionAwareContractName = "UUPS Proxy Pattern: V1";<br/><em class="lg">///@dev as there is no constructor, we need to initialise the OwnableUpgradeable explicitly<br/></em>__Ownable_init();<br/>}</span><span id="97cf" class="lb ir ht kx b fv lh ld l le lf"><em class="lg">///@dev required by the OZ UUPS module<br/></em>function _authorizeUpgrade(address) internal override onlyOwner {}</span><span id="9379" class="lb ir ht kx b fv lh ld l le lf">function getContractNameWithVersion()<br/>public<br/>pure<br/>override<br/>returns (string memory){<br/>return "UUPS Proxy Pattern: V1";<br/>}<br/>}</span></pre><p id="3cf6" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated"><em class="lg"> UupsProxyPatternV2.sol </em></p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="e657" class="lb ir ht kx b fv lc ld l le lf"><em class="lg">// SPDX-License-Identifier: Unlicense<br/></em>pragma solidity ^0.8.0;</span><span id="86c4" class="lb ir ht kx b fv lh ld l le lf">import {UUPSUpgradeable} from "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";<br/>import {OwnableUpgradeable} from "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";<br/>import {VersionAware} from "../VersionAware.sol";</span><span id="4d11" class="lb ir ht kx b fv lh ld l le lf">contract UupsProxyPatternV2 is<br/>UUPSUpgradeable,<br/>OwnableUpgradeable,<br/>VersionAware{</span><span id="eb38" class="lb ir ht kx b fv lh ld l le lf">constructor() {<br/>_disableInitializers();<br/>}</span><span id="db0a" class="lb ir ht kx b fv lh ld l le lf">function initialize() external reinitializer(2) {<br/>versionAwareContractName = "UUPS Proxy Pattern: V2";<br/><em class="lg">///@dev as there is no constructor, we need to initialise the OwnableUpgradeable explicitly<br/></em>__Ownable_init();<br/>}</span><span id="6b34" class="lb ir ht kx b fv lh ld l le lf"><em class="lg">///@dev required by the OZ UUPS module<br/></em>function _authorizeUpgrade(address) internal override onlyOwner {}</span><span id="0cdd" class="lb ir ht kx b fv lh ld l le lf">function getContractNameWithVersion()<br/>public<br/>pure<br/>override<br/>returns (string memory){<br/>return "UUPS Proxy Pattern: V2";<br/>}<br/>}</span></pre><p id="5c2a" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">æ³¨æ„ï¼Œåœ¨ä¸¤ä¸ªå¥‘çº¦ä¸­ï¼Œæˆ‘ä»¬éƒ½ç»§æ‰¿äº†<em class="lg">uupsupgradable . sol</em>ï¼Œè¿™ä½¿å¾—å¥‘çº¦UUPSå‡çº§å…¼å®¹ã€‚ä»è¯¥å¥‘çº¦ç»§æ‰¿è¦æ±‚æˆ‘ä»¬å®ç°<em class="lg"> _authorizeUpgrade </em>å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºå†³å®šæ˜¯å¦å…è®¸è°ƒç”¨è€…å‡çº§ã€‚</p><p id="7f28" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">åœ¨è¿™é‡Œï¼Œæˆ‘è¯•å›¾è§£é‡Šä¸Šè¿°åˆåŒçš„ä¸€äº›é«˜çº§ç»†èŠ‚ã€‚å¦‚æœä½ åœ¨ç¬¬ä¸€æ¬¡é˜…è¯»æ—¶ç†è§£æœ‰å›°éš¾ï¼Œè€ƒè™‘ç°åœ¨è·³è¿‡å®ƒï¼Œä»¥åå†å›æ¥ã€‚å…¸å‹çš„å¯å‡çº§åå®šä¸åº”è¯¥æœ‰æ„é€ å‡½æ•°ï¼Œå› ä¸ºå®ç°åå®šçš„æ„é€ å‡½æ•°æ°¸è¿œä¸èƒ½åœ¨ä»£ç†åå®šçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚æˆ‘ä»¬åœ¨è¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªå®‰å…¨çš„æ„é€ å‡½æ•°ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è®¾ç½®ä»»ä½•å­˜å‚¨å˜é‡ã€‚ä¸åˆå§‹åŒ–å°±é€€å‡ºåå®šä¼šé€ æˆå®‰å…¨å¨èƒã€‚åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨<em class="lg">_ disable initializer</em>æ–¹æ³•ä½¿å¾—å®ç°å¥‘çº¦ä¸å¯åˆå§‹åŒ–ï¼Œè¿™æ¯”è®©å®ç°æ²¡æœ‰æ„é€ å‡½æ•°ä¹Ÿä¸åˆå§‹åŒ–è¦å®‰å…¨å¾—å¤šã€‚æ³¨æ„ï¼Œæˆ‘åœ¨V1çš„<em class="lg">åˆå§‹åŒ–</em>æ–¹æ³•ä¸­ä½¿ç”¨äº†<em class="lg">åˆå§‹åŒ–å™¨</em>ä¿®é¥°ç¬¦ã€‚è¿™ä¸ªä¿®é¥°ç¬¦ç¡®ä¿è¿™ä¸ªinitializeæ–¹æ³•åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå°±åƒsolidityç¡®ä¿æ„é€ å‡½æ•°ä¸€æ ·ã€‚è¿˜è¦æ³¨æ„ï¼Œåœ¨V2ä¸­ï¼Œ<em class="lg">åˆå§‹åŒ–</em>æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯<em class="lg">é‡æ–°åˆå§‹åŒ–å™¨(2)ã€‚</em>è¿™é‡Œ2ä»£è¡¨å®ç°å¥‘çº¦çš„ç‰ˆæœ¬ã€‚å¿…é¡»ä½¿ç”¨<em class="lg">é‡æ–°åˆå§‹åŒ–å™¨</em>ä¿®æ”¹å™¨ï¼Œè€Œä¸æ˜¯<em class="lg">åˆå§‹åŒ–å™¨</em>ï¼Œå› ä¸ºä»£ç†å¥‘çº¦å·²ç»åœ¨V1åˆå§‹åŒ–è¿‡ä¸€æ¬¡ã€‚å…³äºæ‰€æœ‰å¯å‡çº§æ™ºèƒ½å¥‘çº¦éƒ½åº”è¯¥ç»§æ‰¿çš„<em class="lg"> Initializer.sol </em>å¥‘çº¦ï¼Œè¿˜æœ‰æ›´å¤šäº‹æƒ…å’Œç»†èŠ‚éœ€è¦äº†è§£ã€‚æˆ‘å°†åœ¨ä»¥åå†™æ›´å¤šå…³äºå®ƒçš„è¯¦ç»†æ–‡ç« ã€‚</p><p id="15aa" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">ç°åœ¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¼–è¯‘æ™ºèƒ½åˆçº¦ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="5bce" class="lb ir ht kx b fv lc ld l le lf"><strong class="kx hu">npx hardhat compile</strong></span></pre><h1 id="d8a6" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">UUPSä»£ç†éƒ¨ç½²å’Œå‡çº§</h1><p id="8ece" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨UUPSä»£ç†éƒ¨ç½²ç‰ˆæœ¬1ï¼Œç„¶åå°†å…¶å‡çº§åˆ°ç‰ˆæœ¬2ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå®‰å…¨å¸½è„šæœ¬æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚åœ¨scriptsæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<em class="lg"> uups.js </em>çš„è„šæœ¬ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶ç²˜è´´åˆ°å…¶ä¸­ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="156b" class="lb ir ht kx b fv lc ld l le lf">const { ethers, upgrades } = require("hardhat");</span><span id="e9f3" class="lb ir ht kx b fv lh ld l le lf">async function main() {</span><span id="6110" class="lb ir ht kx b fv lh ld l le lf">const UupsProxyPatternV1 = await ethers.getContractFactory("UupsProxyPatternV1");</span><span id="d0f9" class="lb ir ht kx b fv lh ld l le lf">const uupsProxyPatternV1 = await upgrades.deployProxy(UupsProxyPatternV1, [], {kind: 'uups', unsafeAllow: ['constructor']});</span><span id="60c7" class="lb ir ht kx b fv lh ld l le lf">await uupsProxyPatternV1.deployed();</span><span id="4fbd" class="lb ir ht kx b fv lh ld l le lf">console.log(`UUPS Proxy Pattern V1 is deployed to proxy address: ${uupsProxyPatternV1.address}`);</span><span id="32d1" class="lb ir ht kx b fv lh ld l le lf">let versionAwareContractName = await uupsProxyPatternV1.getContractNameWithVersion();</span><span id="9618" class="lb ir ht kx b fv lh ld l le lf">console.log(`UUPS Pattern and Version: ${versionAwareContractName}`);</span><span id="b8b6" class="lb ir ht kx b fv lh ld l le lf">const UupsProxyPatternV2 = await ethers.getContractFactory("UupsProxyPatternV2");</span><span id="0eeb" class="lb ir ht kx b fv lh ld l le lf">const upgraded = await upgrades.upgradeProxy(uupsProxyPatternV1.address, UupsProxyPatternV2, {kind: 'uups', unsafeAllow: ['constructor'], call: 'initialize'});</span><span id="ac34" class="lb ir ht kx b fv lh ld l le lf">console.log(`UUPS Proxy Pattern V2 is upgraded in proxy address: ${upgraded.address}`);</span><span id="3587" class="lb ir ht kx b fv lh ld l le lf">versionAwareContractName = await upgraded.getContractNameWithVersion();</span><span id="5e75" class="lb ir ht kx b fv lh ld l le lf">console.log(`UUPS Pattern and Version: ${versionAwareContractName}`);</span><span id="0279" class="lb ir ht kx b fv lh ld l le lf">}</span><span id="c90d" class="lb ir ht kx b fv lh ld l le lf"><em class="lg">// We recommend this pattern to be able to use async/await everywhere and properly handle errors.</em></span><span id="4579" class="lb ir ht kx b fv lh ld l le lf">main().catch((error) =&gt; {<br/>console.error(error);<br/>process.exitCode = 1;<br/>});</span></pre><p id="3389" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">æˆ‘ä»¬é¦–å…ˆéƒ¨ç½²å¸¦æœ‰ä»£ç†çš„æ™ºèƒ½åˆçº¦çš„ç‰ˆæœ¬1ã€‚Open zeppelinå‡çº§<em class="lg"> deployProxy </em>æ–¹æ³•ä¸ºæˆ‘ä»¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä¸€æ—¦ç”¨ä»£ç†éƒ¨ç½²äº†ç‰ˆæœ¬1ï¼Œæˆ‘ä»¬å°±åœ¨ä»£ç†ä¸Šè°ƒç”¨<em class="lg">getContractNameWithVersion</em>å‡½æ•°ã€‚è¯¥æ–¹æ³•å°†æ ¹æ®æˆ‘ä»¬åœ¨å¥‘çº¦çš„ç‰ˆæœ¬1ä¸­ä½¿è¯¥æ–¹æ³•è¿”å›çš„å†…å®¹è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ç„¶åæˆ‘ä»¬ç»§ç»­ç”¨<em class="lg">å‡çº§ä»£ç†</em>æ–¹æ³•å‡çº§è¿™ä¸ªåˆåŒã€‚å‡çº§ç»“æŸåï¼Œæˆ‘ä»¬å†æ¬¡è°ƒç”¨<em class="lg">getContractNameWithVersion</em>å‡½æ•°æ¥æŸ¥çœ‹è¿”å›çš„å­—ç¬¦ä¸²çš„å˜åŒ–ã€‚è®©æˆ‘ä»¬è¿è¡Œè„šæœ¬ï¼Œçœ‹çœ‹ç»“æœã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œè„šæœ¬ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="14b0" class="lb ir ht kx b fv lc ld l le lf"><strong class="kx hu">npx hardhat run scripts/uups.js</strong></span></pre><p id="a004" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">æ‚¨åº”è¯¥ä¼šåœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°ä»¥ä¸‹å†…å®¹ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="08eb" class="lb ir ht kx b fv lc ld l le lf">Warning: Potentially unsafe deployment of UupsProxyPatternV1</span><span id="51a6" class="lb ir ht kx b fv lh ld l le lf">You are using the `unsafeAllow.constructor` flag.</span><span id="8ea0" class="lb ir ht kx b fv lh ld l le lf">Warning: A proxy admin was previously deployed on this network</span><span id="c516" class="lb ir ht kx b fv lh ld l le lf">This is not natively used with the current kind of proxy ('uups').<br/>    Changes to the admin will have no effect on this new proxy.</span><span id="4cce" class="lb ir ht kx b fv lh ld l le lf">UUPS Proxy Pattern V1 is deployed to proxy address: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512<br/>UUPS Pattern and Version: UUPS Proxy Pattern: V1<br/>Warning: Potentially unsafe deployment of UupsProxyPatternV2</span><span id="0105" class="lb ir ht kx b fv lh ld l le lf">You are using the `unsafeAllow.constructor` flag.</span><span id="d866" class="lb ir ht kx b fv lh ld l le lf">UUPS Proxy Pattern V2 is upgraded in proxy address: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512<br/>UUPS Pattern and Version: UUPS Proxy Pattern: V2</span></pre><p id="11f3" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">è€¶ï¼ç»“æœåœ¨æ„æ–™ä¹‹ä¸­ã€‚å®æ–½åˆåŒå·²æˆåŠŸå‡çº§åˆ°ç‰ˆæœ¬2ã€‚è¿™å°±æ˜¯æ‚¨å¦‚ä½•ä½¿ç”¨UUPSä»£ç†æ¨¡å¼éƒ¨ç½²å’Œå‡çº§æœªæ¥ç‰ˆæœ¬çš„å¥‘çº¦ï¼Œæ— è®ºæ‚¨çš„æ™ºèƒ½å¥‘çº¦æœ‰å¤šå¤æ‚ã€‚</p><p id="9c64" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">æ„Ÿè°¢é˜…è¯»ã€‚</p><h1 id="66ac" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">æˆ‘æ˜¯è°ï¼Ÿ</h1><p id="532d" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">æˆ‘æ˜¯ä¸€åå…¨æ ˆåŒºå—é“¾å¼€å‘è€…ï¼Œå¯¹æ„å»ºä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„ã€æ½œåœ¨çš„æ›´å…·åŒ…å®¹æ€§çš„æœªæ¥å……æ»¡çƒ­æƒ…ã€‚æœ‰åŒºå—é“¾å‘å±•çš„éœ€æ±‚å—ï¼Ÿ</p><p id="8328" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">å–å¾—è”ç³»:ğŸ“§hariharan @ aluminum . iitm . AC . in</p><p id="b023" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated"><a class="ae km" href="https://github.com/HashHaran" rel="noopener ugc nofollow" target="_blank"> Github </a></p><blockquote class="li"><p id="8204" class="lj lk ht bd ll lm ln lo lp lq lr kl ek translated">äº¤æ˜“æ–°æ‰‹ï¼Ÿå°è¯•<a class="ae km" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">åŠ å¯†äº¤æ˜“æœºå™¨äºº</a>æˆ–<a class="ae km" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">å¤åˆ¶äº¤æ˜“</a></p></blockquote></div></div>    
</body>
</html>