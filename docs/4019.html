<html>
<head>
<title>CSC101 -Transferring Methods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CSC 101-转移方法</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/csc101-transferring-methods-8be8d83da8ce?source=collection_archive---------52-----------------------#2022-09-21">https://medium.com/coinmonks/csc101-transferring-methods-8be8d83da8ce?source=collection_archive---------52-----------------------#2022-09-21</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="574a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有没有尝试过编写一个可以持有CET的智能合约？它还可以发送CET给另一个人！</p><p id="7441" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本教程中，我们将讨论发送，转移和调用的可靠性。留在我身边；)</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/78db353f85d00a7149d8bc2b6bc3c9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nYib8N6wIy-Papn96wyEKg.png"/></div></div></figure><h2 id="5ad7" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">转移方法</h2><p id="0f0d" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">Solidity支持几种方法来发送本地硬币到另一个合同/钱包。</p><p id="6216" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您可以通过以下方式将本地硬币发送到其他合同</p><ul class=""><li id="f640" class="la lb ht is b it iu ix iy jb lc jf ld jj le jn lf lg lh li dt translated"><code class="eh lj lk ll lm b">transfer</code> (2300气，抛出错误)</li><li id="6c85" class="la lb ht is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li dt translated"><code class="eh lj lk ll lm b">send</code> (2300气体，返回布尔值)</li><li id="1c6a" class="la lb ht is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li dt translated"><code class="eh lj lk ll lm b">call</code>(转发所有气体或设定气体，返回bool)</li></ul><p id="189e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此外，接收原币的合同必须至少具有以下功能之一</p><ul class=""><li id="f76f" class="la lb ht is b it iu ix iy jb lc jf ld jj le jn lf lg lh li dt translated"><code class="eh lj lk ll lm b">receive() external payable</code></li><li id="97f5" class="la lb ht is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li dt translated"><code class="eh lj lk ll lm b">fallback() external payable</code></li></ul><p id="3e95" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果<code class="eh lj lk ll lm b">msg.data</code>为空，则调用<code class="eh lj lk ll lm b">receive()</code>，否则调用<code class="eh lj lk ll lm b">fallback()</code>。</p><p id="9d7b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh lj lk ll lm b">call</code>建议在2019年12月后使用与重入防护装置结合的方法。</p><p id="34b6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过以下措施防止再次进入</p><ul class=""><li id="5096" class="la lb ht is b it iu ix iy jb lc jf ld jj le jn lf lg lh li dt translated">在调用其他合同之前进行所有状态更改</li><li id="660e" class="la lb ht is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li dt translated">使用再入防护修改器</li></ul><h2 id="ee3b" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">转接vs发送vs通话</h2><p id="e263" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated"><strong class="is hu"> transfer: </strong>接收智能契约应该定义一个<strong class="is hu"> fallback </strong>函数，否则transfer调用将抛出一个<strong class="is hu">错误</strong>。有<strong class="is hu"> 2300气</strong>的气限，足够完成转移操作。很难编码来防止<strong class="is hu">重入攻击</strong>。</p><p id="ceb3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">发送:</strong>它的工作方式与转移呼叫类似，也有一个气体限制<strong class="is hu"> 2300气体</strong>。它将状态作为一个<strong class="is hu">布尔值</strong>返回。</p><p id="232b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">调用<em class="ls"> : </em> </strong>这是向智能合约发送原生币的推荐方式。空参数触发接收地址的<strong class="is hu">回退</strong>功能。</p><pre class="jp jq jr js fq lt lm lu lv aw lw dt"><span id="b0f1" class="ka kb ht lm b fv lx ly l lz ma"><strong class="lm hu">(bool sent,memory data) = _to.call{value: msg.value}("");</strong></span></pre><p id="5488" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用<strong class="is hu"> <em class="ls">调用</em> </strong>，也可以触发合同中定义的其他<strong class="is hu"> <em class="ls">功能</em> </strong>并发送固定量的气体来执行该功能。交易状态作为一个<strong class="is hu">布尔值</strong>发送，返回值在数据变量中发送。</p><pre class="jp jq jr js fq lt lm lu lv aw lw dt"><span id="9fb8" class="ka kb ht lm b fv lx ly l lz ma"><strong class="lm hu">(bool sent, bytes memory data) = _to.call{gas :10000, value: msg.value}("func_signature(uint256 args)");</strong></span></pre><p id="bcf1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">也有一些方法(视情况而定)转移硬币到其他合同/钱包。</p><h2 id="2cb8" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated"><code class="eh lj lk ll lm b">address.send(amount)</code></h2><p id="e92d" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">第一个也是最重要的特征是<strong class="is hu">提供2300气体极限</strong>用于执行合同接收乙醚的回退功能。顺便说一句，这个数量只够创建一个事件。</p><pre class="jp jq jr js fq lt lm lu lv aw lw dt"><span id="dd94" class="ka kb ht lm b fv lx ly l lz ma">contract Sender {<br/>  function send(address _receiver) payable {<br/>    _receiver.send(msg.value);<br/>  }<br/>}contract Receiver {<br/>  uint public balance = 0;<br/>  event Receive(uint value);<br/>  <br/>  function () payable {<br/>    Receive(msg.value);<br/>  }<br/>}</span></pre><p id="a351" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh lj lk ll lm b">send()</code>执行不成功，例如气体耗尽错误<strong class="is hu">返回假</strong>，但<strong class="is hu">不会抛出</strong>异常。因此，<code class="eh lj lk ll lm b">send()</code>的每次使用都应该在require之内。否则，您将支付天然气费用，以便在区块链提交交易，但所有状态更改都将被撤消。</p><p id="808d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">例如，只需稍微改变一下<code class="eh lj lk ll lm b">Receiver </code>合同中的应付款函数:</p><pre class="jp jq jr js fq lt lm lu lv aw lw dt"><span id="4df4" class="ka kb ht lm b fv lx ly l lz ma">function () payable {<br/>  Receive(msg.value);<br/>  balance += msg.value;<br/>}</span></pre><h2 id="f30b" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated"><code class="eh lj lk ll lm b">address.transfer(amount)</code></h2><p id="919d" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">让我们考虑一个出现在solidity后来版本中的方法。它还有两个值得一提的细节。</p><p id="d91f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，该方法具有相同的<strong class="is hu"> 2300气体极限</strong>。然而，在这些功能的开发过程中，开发人员<a class="ae mb" href="https://github.com/ethereum/solidity/issues/610#issuecomment-278521662" rel="noopener ugc nofollow" target="_blank">讨论了</a>添加<code class="eh lj lk ll lm b">.gas()</code>修改器的机会，该修改器重新定义了所提供气体的限制。</p><p id="1ba5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">第二，与<code class="eh lj lk ll lm b">send()</code>方法不同，<code class="eh lj lk ll lm b">transfer()</code> <strong class="is hu">在执行不成功时抛出异常</strong>。</p><h2 id="171a" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">address.call.value(金额)( )</h2><p id="1c22" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">最后也是最定制的方法。</p><p id="d024" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果出现错误，给定的函数<strong class="is hu">仍然返回false </strong>，这就是为什么要记住<code class="eh lj lk ll lm b">require()</code>的用法。</p><p id="05d9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">它与前两个功能的主要区别是有机会通过<code class="eh lj lk ll lm b">.gas(gasLimit)</code>调节器<strong class="is hu">设置气体极限</strong>。这是必要的，以防合同接收以太网的可支付功能执行复杂的逻辑，这需要大量的气体。</p><p id="271f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们看看下面的例子:</p><pre class="jp jq jr js fq lt lm lu lv aw lw dt"><span id="8378" class="ka kb ht lm b fv lx ly l lz ma">contract Sender {<br/>  function send(address _receiver) payable {<br/>    _receiver.call.value(msg.value).gas(20317)();<br/>  }<br/>}contract Receiver {<br/>  uint public balance = 0;<br/>  <br/>  function () payable {<br/>    balance += msg.value;<br/>  }<br/>}</span></pre><p id="bf84" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">执行接收器合同中的应付款功能需要花费2万多汽油。这就是为什么使用<code class="eh lj lk ll lm b">send()</code>或<code class="eh lj lk ll lm b">transfer()</code>会导致气体耗尽错误。</p><blockquote class="mc"><p id="c643" class="md me ht bd mf mg mh mi mj mk ml jn ek translated">加入Coinmonks <a class="ae mb" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae mb" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="0db7" class="mm kb ht bd kc mn mo mp kg mq mr ms kk mt mu mv kn mw mx my kq mz na nb kt nc dt translated">另外，阅读</h1><ul class=""><li id="2f9f" class="la lb ht is b it kv ix kw jb nd jf ne jj nf jn lf lg lh li dt translated"><a class="ae mb" href="https://coincodecap.com/futures-trading-signals" rel="noopener ugc nofollow" target="_blank">最佳期货交易信号</a> | <a class="ae mb" href="https://coincodecap.com/liquid-exchange-review" rel="noopener ugc nofollow" target="_blank">流动性交易所评论</a></li><li id="75a0" class="la lb ht is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li dt translated"><a class="ae mb" href="https://coincodecap.com/huobi-crypto-trading-signals" rel="noopener ugc nofollow" target="_blank">火币的加密交易信号</a> | <a class="ae mb" rel="noopener" href="/coinmonks/swapzone-review-crypto-exchange-data-aggregator-e0ad78e55ed7"> Swapzone审查</a></li><li id="64a1" class="la lb ht is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li dt translated"><a class="ae mb" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">最佳密码交易机器人</a> | <a class="ae mb" href="https://coincodecap.com/buy-solana" rel="noopener ugc nofollow" target="_blank">购买索拉纳</a> | <a class="ae mb" href="https://coincodecap.com/matrixport-review" rel="noopener ugc nofollow" target="_blank">矩阵导出评论</a></li><li id="b5c6" class="la lb ht is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li dt translated"><a class="ae mb" href="https://coincodecap.com/coldcard-review" rel="noopener ugc nofollow" target="_blank"> Coldcard评论</a> | <a class="ae mb" href="https://coincodecap.com/boxtradex-review" rel="noopener ugc nofollow" target="_blank"> BOXtradEX评论</a>|<a class="ae mb" href="https://coincodecap.com/uniswap" rel="noopener ugc nofollow" target="_blank">uni swap指南</a></li><li id="cb80" class="la lb ht is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li dt translated"><a class="ae mb" rel="noopener" href="/coinmonks/coinbase-review-6ef4e0f56064">比特币基地评论</a> | <a class="ae mb" rel="noopener" href="/coinmonks/deribit-review-options-fees-apis-and-testnet-2ca16c4bbdb2">德里比特评论</a> | <a class="ae mb" rel="noopener" href="/coinmonks/ftx-crypto-exchange-review-53664ac1198f"> FTX评论</a></li></ul></div></div>    
</body>
</html>