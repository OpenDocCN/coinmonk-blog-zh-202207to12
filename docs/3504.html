<html>
<head>
<title>How to create a Transparent Proxy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åˆ›å»ºé€æ˜ä»£ç†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/coinmonks/how-to-create-a-transparent-proxy-1683d21468bf?source=collection_archive---------5-----------------------#2022-09-11">https://medium.com/coinmonks/how-to-create-a-transparent-proxy-1683d21468bf?source=collection_archive---------5-----------------------#2022-09-11</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="313c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§æ™ºèƒ½åˆçº¦è®¾è®¡æ¨¡å¼ï¼Œç”¨äºä½¿æ™ºèƒ½åˆçº¦å¯å‡çº§ã€‚è¯·æ³¨æ„ï¼Œæ™ºèƒ½åˆçº¦æœ¬èº«æ˜¯ä¸å¯å˜çš„ï¼Œä¸ºäº†ä½¿å®ƒä»¬å¯å‡çº§ï¼Œä¸€äº›é«˜çº§çš„å¯é æ€§åŸºç¡€å·¥ä½œæ˜¯å¿…è¦çš„ã€‚æœ‰å…³æ™ºèƒ½åˆåŒå‡çº§èƒ½åŠ›çš„è¯¦ç»†æ¦‚è¿°å’Œé€æ˜ä»£ç†æ¨¡å¼çš„è§£é‡Šï¼Œè¯·é˜…è¯»<a class="ae jo" rel="noopener" href="/@HashHaran/essential-guide-to-smart-contract-upgradeability-a257dac36525">è¿™ç¯‡</a>æ›´æ—©çš„æ–‡ç« ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ä½¿ç”¨é€æ˜ä»£ç†æ¨¡å¼å®é™…éƒ¨ç½²æ‚¨çš„å¥‘çº¦ã€‚</p><p id="ac18" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">è¿™ä¸ª<a class="ae jo" href="https://github.com/HashHaran/hardhat-upgrades" rel="noopener ugc nofollow" target="_blank"> Githubä»“åº“</a>æœ‰è¿™ç¯‡æ–‡ç« çš„ä»£ç ï¼Œå¯ä»¥éšæ„ä¿å­˜ä»¥å¤‡å°†æ¥ä½¿ç”¨ã€‚å¦‚æœæ‚¨ä¸æƒ³ä»å¤´å¼€å§‹è¿›è¡Œè®¾ç½®ï¼Œå¯ä»¥å…‹éš†å®ƒã€‚</p><h1 id="e7b7" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">é¡¹ç›®è®¾ç½®</h1><p id="3eaa" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">æˆ‘ä»¬å°†ä½¿ç”¨<a class="ae jo" href="https://hardhat.org/" rel="noopener ugc nofollow" target="_blank">å®‰å…¨å¸½</a>ç”¨äºæˆ‘ä»¬çš„ä»¥å¤ªåŠå¼€å‘å·¥ä½œæµç¨‹ã€‚åœ¨æœ¬æ¼”ç»ƒä¸­ï¼Œæˆ‘åœ¨windowsæœºå™¨ä¸Šä½¿ç”¨WSL2ã€‚å¦‚æœä½¿ç”¨ä¸åŒçš„è®¾ç½®ï¼Œæ‚¨å¯ä»¥ç¨å¾®è°ƒæ•´è¿™äº›æ­¥éª¤ã€‚æˆ‘ä»¬å¼€å§‹å§ï¼</p><p id="f4a0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºèŠ‚ç‚¹é¡¹ç›®ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="612f" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">mkdir hardhat-upgrades &amp;&amp; cd hardhat-upgrades</strong></span><span id="181a" class="lb jq ht kx b fv lg ld l le lf"><strong class="kx hu">npm init -y</strong></span></pre><p id="9011" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨è¿™ä¸ªç›®å½•ä¸­å®‰è£…hardhatã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="8c22" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npm i --save-dev hardhat</strong></span></pre><p id="c95c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨ç›®å½•ä¸­åˆå§‹åŒ–ä¸€ä¸ªhardhatç±»å‹çš„è„šæœ¬é¡¹ç›®ã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤å¹¶é€‰æ‹©â€œ<em class="lh">åˆ›å»ºä¸€ä¸ªTypeScripté¡¹ç›®â€</em>é€‰é¡¹ã€‚å¯¹äºå…¶ä½™çš„æç¤ºï¼Œè¯·ä½¿ç”¨é»˜è®¤å‚æ•°ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="9d07" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npx hardhat</strong></span></pre><p id="aca2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">å®‰è£…å¼€æ”¾çš„zeppelin hardhatå‡çº§æ’ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥è½»æ¾éƒ¨ç½²æˆ‘ä»¬çš„ä»£ç†ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="a97b" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npm i --save-dev @openzeppelin/hardhat-upgrades</strong></span></pre><p id="0765" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">è¿˜è¦å®‰è£…æ¥è‡ªOpen zeppelinçš„å¯å‡çº§åˆåŒï¼Œå®ƒæ˜¯Open zeppelinåˆåŒçš„å¯å‡çº§å¯¹åº”ç‰©ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="9355" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npm i --save-dev @openzeppelin/contracts-upgradeable</strong></span></pre><p id="aa06" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶å¹¶ç²˜è´´åˆ°hardhat.config.tsæ–‡ä»¶ä¸­ã€‚è¿™å°†åšè¿™ä¸ªé¡¹ç›®æ‰€éœ€çš„åŸºæœ¬å®‰å…¨å¸½è®¾ç½®ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="6f6f" class="lb jq ht kx b fv lc ld l le lf">import { HardhatUserConfig } from "hardhat/config";</span><span id="9c46" class="lb jq ht kx b fv lg ld l le lf">import "@nomicfoundation/hardhat-toolbox";</span><span id="660b" class="lb jq ht kx b fv lg ld l le lf">import "@openzeppelin/hardhat-upgrades";</span><span id="edaf" class="lb jq ht kx b fv lg ld l le lf">import "@typechain/hardhat";</span><span id="6ca5" class="lb jq ht kx b fv lg ld l le lf">const config: HardhatUserConfig = {</span><span id="fbed" class="lb jq ht kx b fv lg ld l le lf">solidity: {</span><span id="b76d" class="lb jq ht kx b fv lg ld l le lf">version: "0.8.9",</span><span id="d245" class="lb jq ht kx b fv lg ld l le lf">settings: {</span><span id="fe45" class="lb jq ht kx b fv lg ld l le lf">optimizer: {</span><span id="4c2e" class="lb jq ht kx b fv lg ld l le lf">enabled: true,</span><span id="a4fb" class="lb jq ht kx b fv lg ld l le lf">runs: 200,</span><span id="9cf2" class="lb jq ht kx b fv lg ld l le lf">},</span><span id="40ef" class="lb jq ht kx b fv lg ld l le lf">},</span><span id="d7d1" class="lb jq ht kx b fv lg ld l le lf">},</span><span id="8380" class="lb jq ht kx b fv lg ld l le lf">defaultNetwork: "localhost",</span><span id="c3d6" class="lb jq ht kx b fv lg ld l le lf">};</span><span id="539a" class="lb jq ht kx b fv lg ld l le lf">export default config;</span></pre><h1 id="581f" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">ä½¿ç”¨é€æ˜ä»£ç†éƒ¨ç½²çš„å®æ–½åˆåŒ</h1><p id="eabb" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">åœ¨contractsæ–‡ä»¶å¤¹ä¸­ä¸ºæˆ‘ä»¬å°†è¦éƒ¨ç½²é€æ˜ä»£ç†çš„å®ç°å¥‘çº¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="f217" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">mkdir contracts/transparent</strong></span></pre><p id="2d6a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨<em class="lh"> contracts </em>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<em class="lh"> VersionAware.sol </em>çš„æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹ä»£ç å¤åˆ¶ç²˜è´´åˆ°å…¶ä¸­ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="9111" class="lb jq ht kx b fv lc ld l le lf"><em class="lh">// SPDX-License-Identifier: Unlicense</em></span><span id="3c1d" class="lb jq ht kx b fv lg ld l le lf">pragma solidity ^0.8.0;</span><span id="6744" class="lb jq ht kx b fv lg ld l le lf">abstract contract VersionAware {</span><span id="eb75" class="lb jq ht kx b fv lg ld l le lf">string public versionAwareContractName;</span><span id="49ea" class="lb jq ht kx b fv lg ld l le lf">function getContractNameWithVersion()</span><span id="3853" class="lb jq ht kx b fv lg ld l le lf">external</span><span id="48f2" class="lb jq ht kx b fv lg ld l le lf">pure</span><span id="8e68" class="lb jq ht kx b fv lg ld l le lf">virtual</span><span id="5f70" class="lb jq ht kx b fv lg ld l le lf">returns (string memory);</span><span id="6845" class="lb jq ht kx b fv lg ld l le lf">}</span></pre><p id="10c9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†å®ç°å¥‘çº¦çš„åŸºæœ¬æ¡†æ¶ï¼Œä»¥ä¾¿åœ¨éƒ¨ç½²å’Œå‡çº§ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°çœ‹åˆ°ç‰ˆæœ¬å‡çº§ã€‚</p><p id="b12e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨<em class="lh"> contracts/transparent </em>ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªåä¸º<em class="lh">transparentproxypatternv 1 . sol</em>å’Œ<em class="lh">transparentproxypatternv 2 . sol</em>çš„æ–‡ä»¶ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶ç²˜è´´åˆ°å…¶ä¸­ã€‚</p><p id="2090" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lh">transparentproxypatternv 1 . sol</em></p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="4f42" class="lb jq ht kx b fv lc ld l le lf"><em class="lh">// SPDX-License-Identifier: Unlicense</em></span><span id="f011" class="lb jq ht kx b fv lg ld l le lf">pragma solidity ^0.8.0;</span><span id="47eb" class="lb jq ht kx b fv lg ld l le lf">import {ERC1967UpgradeUpgradeable} from "@openzeppelin/contracts-upgradeable/proxy/ERC1967/ERC1967UpgradeUpgradeable.sol";</span><span id="33cc" class="lb jq ht kx b fv lg ld l le lf">import {VersionAware} from "../VersionAware.sol";</span><span id="205f" class="lb jq ht kx b fv lg ld l le lf">contract TransparentProxyPatternV1 is ERC1967UpgradeUpgradeable, VersionAware {</span><span id="a7e5" class="lb jq ht kx b fv lg ld l le lf">constructor() {</span><span id="1a89" class="lb jq ht kx b fv lg ld l le lf">_disableInitializers();</span><span id="8c52" class="lb jq ht kx b fv lg ld l le lf">}</span><span id="ccf8" class="lb jq ht kx b fv lg ld l le lf">function initialize() external initializer {</span><span id="da8f" class="lb jq ht kx b fv lg ld l le lf">versionAwareContractName = "Transparent Proxy Pattern: V1";</span><span id="291e" class="lb jq ht kx b fv lg ld l le lf">}</span><span id="77fe" class="lb jq ht kx b fv lg ld l le lf">function getContractNameWithVersion()</span><span id="e24e" class="lb jq ht kx b fv lg ld l le lf">public</span><span id="949a" class="lb jq ht kx b fv lg ld l le lf">pure</span><span id="ddd6" class="lb jq ht kx b fv lg ld l le lf">override</span><span id="90ac" class="lb jq ht kx b fv lg ld l le lf">returns (string memory)</span><span id="40c1" class="lb jq ht kx b fv lg ld l le lf">{</span><span id="3053" class="lb jq ht kx b fv lg ld l le lf">return "Transparent Proxy Pattern: V1";</span><span id="9147" class="lb jq ht kx b fv lg ld l le lf">}</span><span id="1949" class="lb jq ht kx b fv lg ld l le lf">}</span></pre><p id="3f4b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lh">transparentproxypatternv 2 . sol</em></p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="d42f" class="lb jq ht kx b fv lc ld l le lf"><em class="lh">// SPDX-License-Identifier: Unlicense</em></span><span id="eb56" class="lb jq ht kx b fv lg ld l le lf">pragma solidity ^0.8.0;</span><span id="8c40" class="lb jq ht kx b fv lg ld l le lf">import {ERC1967UpgradeUpgradeable} from "@openzeppelin/contracts-upgradeable/proxy/ERC1967/ERC1967UpgradeUpgradeable.sol";</span><span id="a7c3" class="lb jq ht kx b fv lg ld l le lf">import {VersionAware} from "../VersionAware.sol";</span><span id="d1f9" class="lb jq ht kx b fv lg ld l le lf">contract TransparentProxyPatternV2 is ERC1967UpgradeUpgradeable, VersionAware {</span><span id="1a1b" class="lb jq ht kx b fv lg ld l le lf">constructor() {</span><span id="bbda" class="lb jq ht kx b fv lg ld l le lf">_disableInitializers();</span><span id="3d81" class="lb jq ht kx b fv lg ld l le lf">}</span><span id="4b15" class="lb jq ht kx b fv lg ld l le lf">function initialize() external reinitializer(2) {</span><span id="879a" class="lb jq ht kx b fv lg ld l le lf">versionAwareContractName = "Transparent Proxy Pattern: V2";</span><span id="e759" class="lb jq ht kx b fv lg ld l le lf">}</span><span id="03e0" class="lb jq ht kx b fv lg ld l le lf">function getContractNameWithVersion()</span><span id="1bb5" class="lb jq ht kx b fv lg ld l le lf">public</span><span id="1162" class="lb jq ht kx b fv lg ld l le lf">pure</span><span id="c0db" class="lb jq ht kx b fv lg ld l le lf">override</span><span id="e7ba" class="lb jq ht kx b fv lg ld l le lf">returns (string memory)</span><span id="1422" class="lb jq ht kx b fv lg ld l le lf">{</span><span id="29bf" class="lb jq ht kx b fv lg ld l le lf">return "Transparent Proxy Pattern: V2";</span><span id="82d0" class="lb jq ht kx b fv lg ld l le lf">}</span><span id="758e" class="lb jq ht kx b fv lg ld l le lf">}</span></pre><p id="a68c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">æˆ‘ä»¬æœ‰ä¸¤ä¸ªå®ç°åˆåŒç‰ˆæœ¬1å’Œ2ã€‚è¯·æ³¨æ„ï¼Œç‰ˆæœ¬1å’Œç‰ˆæœ¬2çš„ç»“æ„ä¸å¿…ç›¸åŒï¼Œå‡çº§ä¹Ÿèƒ½å·¥ä½œã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªåˆåŒéƒ½æ˜¯ä»å¼€æ”¾çš„zeppelinå¯å‡çº§åŒ…çš„<em class="lh">ERC 1967å¯å‡çº§</em>åˆåŒç»§æ‰¿çš„ã€‚é˜…è¯»æœ¬æ–‡é¡¶éƒ¨é“¾æ¥çš„æ—©æœŸæ–‡ç« ï¼Œäº†è§£æ›´å¤šå…³äºERC1967æ ‡å‡†çš„ä¿¡æ¯ã€‚</p><p id="5e56" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">æˆ‘ä»¬æœ‰ä¸¤ä¸ªå®ç°åˆåŒç‰ˆæœ¬1å’Œ2ã€‚è¯·æ³¨æ„ï¼Œç‰ˆæœ¬1å’Œç‰ˆæœ¬2çš„ç»“æ„ä¸å¿…ç›¸åŒï¼Œå‡çº§ä¹Ÿèƒ½å·¥ä½œã€‚æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªåˆåŒéƒ½ç»§æ‰¿äº†æ¥è‡ªå¼€æ”¾çš„zeppelinå¯å‡çº§åŒ…çš„<em class="lh">ERC 1967å¯å‡çº§</em>åˆåŒã€‚é˜…è¯»æœ¬æ–‡é¡¶éƒ¨é“¾æ¥çš„æ—©æœŸæ–‡ç« ï¼Œäº†è§£æ›´å¤šå…³äºERC1967æ ‡å‡†çš„ä¿¡æ¯ã€‚</p><p id="ad54" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨è¿™é‡Œï¼Œæˆ‘è¯•å›¾è§£é‡Šä¸Šè¿°åˆåŒçš„ä¸€äº›é«˜çº§ç»†èŠ‚ã€‚å¦‚æœä½ åœ¨ç¬¬ä¸€æ¬¡é˜…è¯»æ—¶ç†è§£æœ‰å›°éš¾ï¼Œè€ƒè™‘ç°åœ¨è·³è¿‡å®ƒï¼Œä»¥åå†å›æ¥ã€‚å…¸å‹çš„å¯å‡çº§åå®šä¸åº”è¯¥æœ‰æ„é€ å‡½æ•°ï¼Œå› ä¸ºå®ç°åå®šçš„æ„é€ å‡½æ•°æ°¸è¿œä¸èƒ½åœ¨ä»£ç†åå®šçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚æˆ‘ä»¬åœ¨è¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªå®‰å…¨çš„æ„é€ å‡½æ•°ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è®¾ç½®ä»»ä½•å­˜å‚¨å˜é‡ã€‚ä¸åˆå§‹åŒ–å°±é€€å‡ºåå®šä¼šé€ æˆå®‰å…¨å¨èƒã€‚åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨<em class="lh">_ disable initializer</em>æ–¹æ³•ä½¿å¾—å®ç°å¥‘çº¦ä¸å¯åˆå§‹åŒ–ï¼Œè¿™æ¯”è®©å®ç°æ²¡æœ‰æ„é€ å‡½æ•°ä¹Ÿä¸åˆå§‹åŒ–è¦å®‰å…¨å¾—å¤šã€‚æ³¨æ„ï¼Œæˆ‘åœ¨V1çš„<em class="lh">åˆå§‹åŒ–</em>æ–¹æ³•ä¸­ä½¿ç”¨äº†<em class="lh">åˆå§‹åŒ–å™¨</em>ä¿®é¥°ç¬¦ã€‚è¿™ä¸ªä¿®é¥°ç¬¦ç¡®ä¿è¿™ä¸ªinitializeæ–¹æ³•åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå°±åƒsolidityç¡®ä¿æ„é€ å‡½æ•°ä¸€æ ·ã€‚è¿˜è¦æ³¨æ„ï¼Œåœ¨V2ä¸­ï¼Œ<em class="lh">åˆå§‹åŒ–</em>æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯<em class="lh">é‡æ–°åˆå§‹åŒ–å™¨(2)ã€‚</em>æ­¤å¤„2ä»£è¡¨å®æ–½åˆåŒçš„ç‰ˆæœ¬ã€‚å¿…é¡»ä½¿ç”¨<em class="lh">é‡æ–°åˆå§‹åŒ–å™¨</em>ä¿®æ”¹å™¨ï¼Œè€Œä¸æ˜¯<em class="lh">åˆå§‹åŒ–å™¨</em>ï¼Œå› ä¸ºä»£ç†å¥‘çº¦å·²ç»åœ¨V1åˆå§‹åŒ–è¿‡ä¸€æ¬¡ã€‚å…³äºæ‰€æœ‰å¯å‡çº§æ™ºèƒ½å¥‘çº¦éƒ½åº”è¯¥ç»§æ‰¿çš„Initializer.solå¥‘çº¦ï¼Œè¿˜æœ‰æ›´å¤šäº‹æƒ…å’Œç»†èŠ‚éœ€è¦äº†è§£ã€‚ä»¥åæˆ‘ä¼šå†™æ›´å¤šå…³äºå®ƒçš„è¯¦ç»†æ–‡ç« ã€‚</p><p id="f3bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ç°åœ¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¼–è¯‘æ™ºèƒ½åˆçº¦ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="1f88" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npx hardhat compile</strong></span></pre><h1 id="ca33" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">é€æ˜ä»£ç†éƒ¨ç½²å’Œå‡çº§</h1><p id="6750" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é€æ˜ä»£ç†éƒ¨ç½²ç‰ˆæœ¬1ï¼Œç„¶åå°†å…¶å‡çº§åˆ°ç‰ˆæœ¬2ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå®‰å…¨å¸½è„šæœ¬æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚åœ¨è„šæœ¬æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<em class="lh"> transparent.js </em>çš„è„šæœ¬ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶ç²˜è´´åˆ°å…¶ä¸­ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="aa40" class="lb jq ht kx b fv lc ld l le lf">const { ethers, upgrades } = require("hardhat");</span><span id="fb9a" class="lb jq ht kx b fv lg ld l le lf">async function main() {</span><span id="83c4" class="lb jq ht kx b fv lg ld l le lf">const TransparentProxyPatternV1 = await ethers.getContractFactory("TransparentProxyPatternV1");</span><span id="3526" class="lb jq ht kx b fv lg ld l le lf">const transparentProxyPatternV1 = await upgrades.deployProxy(TransparentProxyPatternV1, [], {kind: 'transparent', unsafeAllow: ['constructor']});</span><span id="fa9f" class="lb jq ht kx b fv lg ld l le lf">await transparentProxyPatternV1.deployed();</span><span id="68f1" class="lb jq ht kx b fv lg ld l le lf">console.log(`Transparent Proxy Pattern V1 is deployed to proxy address: ${transparentProxyPatternV1.address}`);</span><span id="1555" class="lb jq ht kx b fv lg ld l le lf">let versionAwareContractName = await transparentProxyPatternV1.getContractNameWithVersion();</span><span id="bbcf" class="lb jq ht kx b fv lg ld l le lf">console.log(`Proxy Pattern and Version: ${versionAwareContractName}`);</span><span id="f834" class="lb jq ht kx b fv lg ld l le lf">const TransparentProxyPatternV2 = await ethers.getContractFactory("TransparentProxyPatternV2");</span><span id="2b85" class="lb jq ht kx b fv lg ld l le lf">const upgraded = await upgrades.upgradeProxy(transparentProxyPatternV1.address, TransparentProxyPatternV2, {kind: 'transparent', unsafeAllow: ['constructor'], call: 'initialize'});</span><span id="70c6" class="lb jq ht kx b fv lg ld l le lf">console.log(`Transparent Proxy Pattern V2 is upgraded in proxy address: ${upgraded.address}`);</span><span id="5003" class="lb jq ht kx b fv lg ld l le lf">versionAwareContractName = await upgraded.getContractNameWithVersion();</span><span id="f912" class="lb jq ht kx b fv lg ld l le lf">console.log(`Proxy Pattern and Version: ${versionAwareContractName}`);</span><span id="f514" class="lb jq ht kx b fv lg ld l le lf">}</span><span id="f903" class="lb jq ht kx b fv lg ld l le lf">main().catch((error) =&gt; {</span><span id="e3c1" class="lb jq ht kx b fv lg ld l le lf">console.error(error);</span><span id="8181" class="lb jq ht kx b fv lg ld l le lf">process.exitCode = 1;</span><span id="f5fd" class="lb jq ht kx b fv lg ld l le lf">});</span></pre><p id="f0fa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">æˆ‘ä»¬é¦–å…ˆéƒ¨ç½²å¸¦æœ‰ä»£ç†å’Œä»£ç†ç®¡ç†çš„æ™ºèƒ½åˆçº¦ç‰ˆæœ¬1ã€‚Open zeppelinå‡çº§<em class="lh"> deployProxy </em>æ–¹æ³•ä¸ºæˆ‘ä»¬è§£å†³äº†æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚ä¸€æ—¦ç”¨ä»£ç†éƒ¨ç½²äº†ç‰ˆæœ¬1ï¼Œæˆ‘ä»¬å°±åœ¨ä»£ç†ä¸Šè°ƒç”¨<em class="lh">getContractNameWithVersion</em>å‡½æ•°ã€‚è¯¥æ–¹æ³•å°†æ ¹æ®æˆ‘ä»¬åœ¨å¥‘çº¦çš„ç‰ˆæœ¬1ä¸­ä½¿è¯¥æ–¹æ³•è¿”å›çš„å†…å®¹è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ç„¶åæˆ‘ä»¬ç»§ç»­ç”¨<em class="lh">å‡çº§ä»£ç†</em>æ–¹æ³•å‡çº§è¿™ä¸ªåˆåŒã€‚å‡çº§ç»“æŸåï¼Œæˆ‘ä»¬å†æ¬¡è°ƒç”¨<em class="lh">getContractNameWithVersion</em>å‡½æ•°æ¥æŸ¥çœ‹è¿”å›çš„å­—ç¬¦ä¸²çš„å˜åŒ–ã€‚è®©æˆ‘ä»¬è¿è¡Œè„šæœ¬ï¼Œçœ‹çœ‹ç»“æœã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œè„šæœ¬ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="a43d" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npx hardhat run scripts/transparent.js</strong></span></pre><p id="4035" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">æ‚¨åº”è¯¥ä¼šåœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°ä»¥ä¸‹å†…å®¹ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="b4d1" class="lb jq ht kx b fv lc ld l le lf">Warning: Potentially unsafe deployment of TransparentProxyPatternV1</span><span id="6033" class="lb jq ht kx b fv lg ld l le lf">You are using the `unsafeAllow.constructor` flag.</span><span id="6ac3" class="lb jq ht kx b fv lg ld l le lf">Transparent Proxy Pattern V1 is deployed to proxy address: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0<br/>Proxy Pattern and Version: Transparent Proxy Pattern: V1<br/>Warning: Potentially unsafe deployment of TransparentProxyPatternV2</span><span id="2166" class="lb jq ht kx b fv lg ld l le lf">You are using the `unsafeAllow.constructor` flag.</span><span id="3064" class="lb jq ht kx b fv lg ld l le lf">Transparent Proxy Pattern V2 is upgraded in proxy address: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0<br/>Proxy Pattern and Version: Transparent Proxy Pattern: V2</span></pre><p id="3cb4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">è€¶ï¼ç»“æœåœ¨æ„æ–™ä¹‹ä¸­ã€‚å®æ–½åˆåŒå·²æˆåŠŸå‡çº§åˆ°ç‰ˆæœ¬2ã€‚è¿™å°±æ˜¯æ‚¨å¦‚ä½•ä½¿ç”¨é€æ˜ä»£ç†æ¨¡å¼éƒ¨ç½²å’Œå‡çº§æœªæ¥ç‰ˆæœ¬çš„å¥‘çº¦ï¼Œæ— è®ºæ‚¨çš„æ™ºèƒ½å¥‘çº¦å˜å¾—å¤šä¹ˆå¤æ‚ã€‚</p><p id="167b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">æ„Ÿè°¢é˜…è¯»ã€‚</p><h1 id="3541" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">æˆ‘æ˜¯è°ï¼Ÿ</h1><p id="2381" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">æˆ‘æ˜¯ä¸€åå…¨æ ˆåŒºå—é“¾å¼€å‘è€…ï¼Œå¯¹æ„å»ºä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„ã€æ½œåœ¨çš„æ›´å…·åŒ…å®¹æ€§çš„æœªæ¥å……æ»¡çƒ­æƒ…ã€‚æœ‰åŒºå—é“¾å‘å±•çš„éœ€æ±‚å—ï¼Ÿ</p><p id="8d80" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">å–å¾—è”ç³»:ğŸ“§hariharan @ aluminum . iitm . AC . in</p><p id="a3c7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://github.com/HashHaran" rel="noopener ugc nofollow" target="_blank"> Github </a></p><blockquote class="li"><p id="df0c" class="lj lk ht bd ll lm ln lo lp lq lr jn ek translated">äº¤æ˜“æ–°æ‰‹ï¼Ÿå°è¯•<a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">åŠ å¯†äº¤æ˜“æœºå™¨äºº</a>æˆ–<a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">å¤åˆ¶äº¤æ˜“</a></p></blockquote></div></div>    
</body>
</html>