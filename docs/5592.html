<html>
<head>
<title>Rentable NFT on CSC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CSC上的可租赁NFT</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/rentable-nft-on-csc-4d921424f404?source=collection_archive---------28-----------------------#2022-10-27">https://medium.com/coinmonks/rentable-nft-on-csc-4d921424f404?source=collection_archive---------28-----------------------#2022-10-27</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="865a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">NFT不仅仅是图像所有权的加密保证。大多数人认为NFT只是一个图像！但是图像只是NFT的一部分，我们称之为<strong class="is hu">元数据。</strong>在本教程中，我们将讨论可租赁的NFT。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/2cc4372bca4b650cc3e0edf1b9b70510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lkLs64wp7r-o4FBEkTPOzQ.png"/></div></div></figure><h2 id="4140" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated"><strong class="ak"> NFT </strong></h2><p id="0cd4" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated"><strong class="is hu">不可替代令牌</strong> ( <strong class="is hu"> NFT </strong>)是唯一的数字标识符，不可复制、替代或细分，记录在区块链中，用于证明真实性和所有权。NFT的所有权记录在区块链，所有者可以转让，允许非森林交易。任何人都可以创建NFT，创建NFT只需要很少或不需要编码技能。NFT通常包含对数字文件的引用，如照片、视频和音频。因为NFT是唯一可识别的资产，所以不同于加密货币，加密货币是可替代的。</p><p id="aa5e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">NFTs的支持者声称，NFTs提供了一个公共的真实性证书或所有权证明，但NFT传达的法律权利可能是不确定的。由区块链定义的NFT的所有权没有固有的法律含义，并且不一定授予其相关数字文件的版权、知识产权或其他法律权利。NFT不限制共享或复制其关联的数字文件，也不阻止创建引用相同文件的NFT。</p><p id="0def" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">例如，在游戏领域，NFT公用事业公司提供了一种管理游戏内资产所有权的新方法，或者在社交空间，它们有助于保证对独家社区的安全访问。</p><p id="9c4b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">另一个用例可能是与“可出租智能物理资产”(es)相关的NFT。储物柜、度假屋或汽车)，其中用户可以发送命令(es。“锁门”、“解锁门”)后证明他是NFT的现任主人。</p><p id="ff20" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">谈到公用事业NFT，在某些情况下，所有者和使用者并不总是相同是有道理的。NFT的所有者可以在一定时间内将其出租给用户。在此期间，用户暂时获得NFT赋予的特权，但不能转让其所有权。</p><h2 id="1f93" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">ERC721</h2><p id="fc6e" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">ERC-721是一个免费的开放标准，它描述了如何在基于以太坊的区块链上构建不可替换的或唯一的令牌。虽然大多数令牌都是可替换的(每个令牌都是相同的)，但ERC-721令牌都是唯一的。</p><p id="bc08" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ERC-721定义了智能合约必须实现的最小接口，以允许管理、拥有和交易唯一令牌。它没有强制要求令牌元数据的标准，也没有限制添加补充功能。</p><p id="78f8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好消息是，出租NFT的EIP是存在的(<a class="ae la" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-4907.md" rel="noopener ugc nofollow" target="_blank"> EIP 4907 </a>)声明:</p><blockquote class="lb lc ld"><p id="7881" class="iq ir le is b it iu iv iw ix iy iz ja lf jc jd je lg jg jh ji lh jk jl jm jn hm dt translated">“这个标准是EIP-721 的延伸。它提出了一个可以授予地址的附加角色(用户)，以及该角色自动撤销的时间(过期)。用户角色代表“使用”NFT的权限，但不代表转移它或设置用户的能力</p></blockquote><p id="3db6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该标准被设计为完全兼容ERC-721，并且基本上引入了一个接口来实现(<a class="ae la" href="https://github.com/ethereum/EIPs/blob/master/assets/eip-4907/contracts/IERC4907.sol" rel="noopener ugc nofollow" target="_blank"> IERC4907.sol </a>)以下方法:</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="dfb6" class="ka kb ht lj b fv ln lo l lp lq">function setUser(uint256 tokenId, address user, uint64 expires)</span></pre><p id="8295" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果呼叫者是NFT或批准地址的所有者，此方法将设置新用户和NFT的过期时间。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="1e62" class="ka kb ht lj b fv ln lo l lp lq">function userOf(uint256 tokenId) external view returns(address);</span></pre><p id="633b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这将返回NFT的当前用户的地址，其中零地址表示没有用户或者租期已过。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="d8c1" class="ka kb ht lj b fv ln lo l lp lq">function userExpires(uint256 tokenId) external view returns(uint256);</span></pre><p id="ec2c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后一个方法返回NFT用户的到期时间，其中零值表示没有用户。</p><p id="587f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">查看参考实现(<a class="ae la" href="https://github.com/ethereum/EIPs/blob/master/assets/eip-4907/contracts/ERC4907.sol" rel="noopener ugc nofollow" target="_blank"> ERC4907.sol </a>)，我们可以注意到合同是如何扩展ERC721标准的，并使用NFT和其最终用户之间的映射以及到期时间。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="6bfd" class="ka kb ht lj b fv ln lo l lp lq">contract ERC4907 is ERC721, IERC4907 {<br/>  struct UserInfo<br/>  {<br/>    address user; // address of user role<br/>    uint64 expires; // unix timestamp, user expires<br/>  }<br/>  mapping (uint256 =&gt; UserInfo) internal _users;<br/>  …</span></pre><p id="ef29" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我问自己的第一个问题是:“如果EIP的名称是“出租NFT”，为什么IERC4907或参考实现缺少“出租”方法？</p><p id="efee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好的，有setUser方法，但是使用它，只有NFT的所有者(或批准的地址)可以设置用户。在这种情况下，该过程听起来更像是一个贷款过程，其中所有者将与公用事业NFT相关的特权借给用户，此外，还要为此支付汽油费。</p><p id="2745" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这里，所有者可以选择:</p><ol class=""><li id="7cef" class="lr ls ht is b it iu ix iy jb lt jf lu jj lv jn lw lx ly lz dt translated">为了将他的NFTs设置为可出租的，</li><li id="0050" class="lr ls ht is b it ma ix mb jb mc jf md jj me jn lw lx ly lz dt translated">设定在一定时期内租赁其NFTs所需的乙醚量。</li></ol><p id="f66b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果NFT被列为可租赁，用户就有能力租赁它并为此向所有者付费。</p><p id="923e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">想要租赁NFT的用户必须向合同发送一个事务，指定他想要租赁的NFT和租赁时间间隔。此外，交易必须具有所选时间间隔的正确醚量。</p><p id="ce45" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们看看solidity代码的相关部分:</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="7fd0" class="ka kb ht lj b fv ln lo l lp lq">contract RentableNFT is ERC4907, Ownable</span></pre><p id="d55b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当然，RentableNFT契约扩展了引用实现<strong class="is hu"> <em class="le"> ERC4907 </em> </strong>和OpenZeppelin Ownable契约(好吧，我同意你的观点，Ownable扩展并不是绝对必要的，但是在这个契约中，我希望只能允许契约的所有者进行铸造)。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="ce28" class="ka kb ht lj b fv ln lo l lp lq">uint256 public baseAmount = 1000000000000000; //0.001 Cet<br/>struct RentableItem {<br/>   bool rentable;<br/>   uint256 amountPerMinute;<br/>}<br/>mapping(uint256 =&gt; RentableItem) public rentables;</span></pre><ul class=""><li id="daa1" class="lr ls ht is b it iu ix iy jb lt jf lu jj lv jn mf lx ly lz dt translated"><strong class="is hu"> <em class="le"> baseAmount </em> </strong>是租赁一分钟的默认支付金额，</li><li id="5f4e" class="lr ls ht is b it ma ix mb jb mc jf md jj me jn mf lx ly lz dt translated"><strong class="is hu"> <em class="le"> RentableItem </em> </strong>是存储某个NFT的可租性和费用信息的结构，</li><li id="4513" class="lr ls ht is b it ma ix mb jb mc jf md jj me jn mf lx ly lz dt translated"><strong class="is hu"> <em class="le"> rentables </em> </strong>是NFTs和RentableItem结构之间的映射。</li></ul><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="18c9" class="ka kb ht lj b fv ln lo l lp lq">function mint() public onlyOwner {<br/>    currentTokenId.increment();<br/>    uint256 newItemId = currentTokenId.current();<br/>    _safeMint(owner(), newItemId);<br/>    rentables[newItemId] = RentableItem({<br/>        rentable: false,<br/>        amountPerMinute: baseAmount<br/>    });<br/>}</span></pre><p id="5e05" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">默认情况下，在<strong class="is hu">的<em class="le">薄荷</em>的</strong>功能中，新创建了NFT:</p><ul class=""><li id="8271" class="lr ls ht is b it iu ix iy jb lt jf lu jj lv jn mf lx ly lz dt translated">是由合同的所有者铸造的，</li><li id="b052" class="lr ls ht is b it ma ix mb jb mc jf md jj me jn mf lx ly lz dt translated">被设置为不可出租，</li><li id="078f" class="lr ls ht is b it ma ix mb jb mc jf md jj me jn mf lx ly lz dt translated">其费用设置为<strong class="is hu"> <em class="le">基数</em> </strong>。</li></ul><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="68b3" class="ka kb ht lj b fv ln lo l lp lq">function setRentFee(uint256 _tokenId, uint256 _amountPerMinute) public {<br/>   require(_isApprovedOrOwner(_msgSender(), _tokenId), "Caller is not token owner nor approved");<br/>   rentables[_tokenId].amountPerMinute = _amountPerMinute;<br/>}</span></pre><p id="fd3f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是NFT<strong class="is hu"><em class="le">amountPerMinute</em></strong>值的设置方法。此方法只能由NFT的所有者(或批准的地址)调用。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="73d7" class="ka kb ht lj b fv ln lo l lp lq">function setRentable(uint256 _tokenId, bool _rentable) public {<br/>   require(_isApprovedOrOwner(_msgSender(), _tokenId), "Caller is not token owner nor approved");<br/>   rentables[_tokenId].rentable = _rentable;<br/>}</span></pre><p id="b11b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此方法设置NFT的可出租布尔值。此方法只能由NFT的所有者(或批准的地址)调用。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="0487" class="ka kb ht lj b fv ln lo l lp lq">function rent(uint256 _tokenId, uint64 _expires) public payable virtual {<br/>   uint256 dueAmount = rentables[_tokenId].amountPerMinute * _expires;<br/>   require(msg.value == dueAmount, "Uncorrect amount");<br/>   require(userOf(_tokenId) == address(0), "Already rented");<br/>   require(rentables[_tokenId].rentable, "Renting disabled for the NFT");<br/>   payable(ownerOf(_tokenId)).transfer(dueAmount);<br/>   UserInfo storage info = _users[_tokenId];<br/>   info.user = msg.sender;<br/>   info.expires = block.timestamp + (_expires * 60);<br/>   emit UpdateUser(_tokenId, msg.sender, _expires);<br/>}</span></pre><p id="e85f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里核心的<strong class="is hu"> <em class="le">租</em> </strong>法，它:</p><ul class=""><li id="763b" class="lr ls ht is b it iu ix iy jb lt jf lu jj lv jn mf lx ly lz dt translated">计算租用NFT的应付金额，</li><li id="8feb" class="lr ls ht is b it ma ix mb jb mc jf md jj me jn mf lx ly lz dt translated">验证发送的金额是否正确，</li><li id="6624" class="lr ls ht is b it ma ix mb jb mc jf md jj me jn mf lx ly lz dt translated">验证NFT尚未被其他人租用，</li><li id="d196" class="lr ls ht is b it ma ix mb jb mc jf md jj me jn mf lx ly lz dt translated">验证NFT是由其所有者出租的，</li><li id="4edd" class="lr ls ht is b it ma ix mb jb mc jf md jj me jn mf lx ly lz dt translated">将到期金额转给NFT所有者，</li><li id="0b8f" class="lr ls ht is b it ma ix mb jb mc jf md jj me jn mf lx ly lz dt translated">更新有关用户和过期时间的信息。</li></ul><p id="84ed" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">提议的合同可在github的<a class="ae la" href="https://github.com/donpabblo/rentable-nft/blob/main/contracts/RentableNFT.sol" rel="noopener ugc nofollow" target="_blank">链接</a>上获得。</p><blockquote class="mg"><p id="c4f2" class="mh mi ht bd mj mk ml mm mn mo mp jn ek translated">交易新手？尝试<a class="ae la" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae la" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>