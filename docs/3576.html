<html>
<head>
<title>Deploying a Smart Contract with Truffle Ganache</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">部署与Truffle Ganache的智能合同</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/deploying-a-smart-contract-with-truffle-ganache-fde535318ed5?source=collection_archive---------3-----------------------#2022-09-13">https://medium.com/coinmonks/deploying-a-smart-contract-with-truffle-ganache-fde535318ed5?source=collection_archive---------3-----------------------#2022-09-13</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/b55999681bfd9c7c7efcb44a16c65270.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0xgqZqqZ60pnP1U3"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@drawkit?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">DrawKit Illustrations</a> on <a class="ae jf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="a708" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">加纳切</h1><p id="146c" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hm dt translated">今天，我们将看到如何在truffle ganache的帮助下部署智能合约。以太坊Ganache是一个为开发和测试而设计的本地内存区块链。它模拟了一个真实以太网的特征，包括许多由测试以太网资助的账户的可用性。以太坊Ganache有两个版本:带有用户界面的图形应用程序和命令行版本。要在我们的系统中运行Ganache，首先我们必须使用这个<a class="ae jf" href="https://trufflesuite.com/ganache/" rel="noopener ugc nofollow" target="_blank">链接</a>下载GUI，我们还必须为Ganache CLI安装Ganache。要安装，请运行以下命令。打开您的终端，键入以下命令。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="2c9d" class="ll jh ht lh b fv lm ln l lo lp">npm install -g ganache-cli</span></pre><p id="ff70" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">成功安装后，我们可以使用下面的命令检查truffle ganache的版本。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="dc47" class="ll jh ht lh b fv lm ln l lo lp">truffle version</span></pre><p id="a3ff" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">如果安装成功，我们可以看到下面的输出。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="6eec" class="ll jh ht lh b fv lm ln l lo lp">Truffle v5.5.5 (core: 5.5.5)<br/>Ganache v^7.0.3<br/>Solidity v0.5.16 (solc-js)<br/>Node v16.13.0<br/>Web3.js v1.5.3</span></pre><p id="1d35" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">没错。我们已经成功安装了松露和加纳切。现在让我们建立松露项目。</p><h1 id="aa96" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">创建一个松露项目</h1><p id="6cb8" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hm dt translated">我们将使用VS代码创建松露项目，如果你没有，请使用这个<a class="ae jf" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank">链接</a>下载。下载并安装后，打开VS代码并在其中创建一个文件夹。并在顶部点击<em class="lv">新建终端</em>。</p><figure class="lc ld le lf fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lw"><img src="../Images/64762056e7076d4f26c44a93ffe4a250.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CGvKijjXp60NBBuv"/></div></div></figure><p id="245e" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">它将在vs代码中打开一个新的cmd。然后键入命令创建一个新的truffle项目，如下所示。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="1c33" class="ll jh ht lh b fv lm ln l lo lp">truffle init</span></pre><p id="48a9" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">现在我们可以看到我们的松露项目成功创建。</p><figure class="lc ld le lf fq iu fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/a7d115f57bbee2b5487cfe8cefcfedb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/0*CPXFweL6l6MZGczQ"/></div></figure><p id="896f" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">你可以看到，它还在我们的vs代码中创建了一些文件夹。</p><figure class="lc ld le lf fq iu fe ff paragraph-image"><div class="fe ff ly"><img src="../Images/155a9edea922dd3a07e9e8d0f480e123.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/0*ETUNlsIATv4TdqHz"/></div></figure><p id="dff8" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">总共有3个名为<em class="lv"> contracts、migrations和test </em>的文件夹。正如您所猜测的，您必须将我们所有的智能合同写入到<em class="lv">合同</em>文件夹中，并将我们必须保存的合同按顺序部署到<em class="lv">迁移</em>文件夹中，<em class="lv">我们很快就会明白我所说的按顺序是什么意思了</em>。为了测试我们的合同，我们可以使用<em class="lv"> test </em>文件夹。另外，还有一个<em class="lv"> truffle-config.json </em>文件我们可以看到。在这个文件中，我们必须根据我们的部署需求进行修改。我们将在本文中看到所有细节。</p><h1 id="8d26" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">加纳切</h1><p id="6e2a" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hm dt translated">在部署智能合约之前，让我们看一下我们的Ganache GUI。打开你安装的Ganache，启动<em class="lv">以太坊快速入门</em>。一旦它成功启动，你可以看到一个主屏幕如下。</p><figure class="lc ld le lf fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lw"><img src="../Images/513ae8a0dd5cae59d1dbcd10a5530a64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LNqon9cEGVsJ0Z5I"/></div></div></figure><p id="9493" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">我希望您已经阅读了我之前的文章，在这篇文章中，我们使用Remix IDE部署了一个智能合约，如果您没有阅读这个<a class="ae jf" rel="noopener" href="/coinmonks/complete-solidity-code-deployment-process-f88be7913990">链接</a>的话。我们看到了Remix IDE如何提供给我们一些地址，比如Ganache也提供给我们一些测试以太坊地址，每个地址包含100个以太。这种乙醚没有实际价值，这只是为了测试目的。另外，如果您在<em class="lv">块</em>选项卡中看到，我们可以看到只有块0可用。</p><figure class="lc ld le lf fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lw"><img src="../Images/a480f3a5daec85704405feafb12699b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wSTfJ7ZbLRkXR646"/></div></div></figure><p id="d32c" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">部署智能合同后，只有我们可以看到新的数据块。我们可以在Ganache GUI中探索其余的选项卡。现在，让我们部署智能合约。</p><h1 id="0a33" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">部署智能合同</h1><p id="6f61" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb hm dt translated">如您所见，我们有一个名为contracts的文件夹，在该文件夹中，以前有一个智能合同。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="4610" class="ll jh ht lh b fv lm ln l lo lp">// SPDX-License-Identifier: MIT<br/>pragma solidity &gt;=0.4.22 &lt;0.9.0;</span><span id="da2b" class="ll jh ht lh b fv lz ln l lo lp">contract Migrations {<br/>  address public owner = msg.sender;<br/>  uint public last_completed_migration;</span><span id="779a" class="ll jh ht lh b fv lz ln l lo lp">  modifier restricted() {<br/>    require(<br/>      msg.sender == owner,<br/>      "This function is restricted to the contract's owner"<br/>    );<br/>    _;<br/>  }</span><span id="9c4b" class="ll jh ht lh b fv lz ln l lo lp">  function setCompleted(uint completed) public restricted {<br/>    last_completed_migration = completed;<br/>  }<br/>}</span></pre><p id="6d40" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">坚持住！在部署之前，我们必须修改truffle-config.js文件，因为我们使用的是Ganache GUI。正如你在Ganache中看到的，服务器是7545。让我们修改文件。取消对开发代码的注释，并进行如下更改。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="503a" class="ll jh ht lh b fv lm ln l lo lp">development: {<br/>     host: "127.0.0.1",     // Localhost (default: none)<br/>     port: 7545,            // Standard Ethereum port (default: none)<br/>     network_id: "*",       // Any network (default: none)<br/>    },</span></pre><p id="c464" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated"><strong class="kg hu">没错！我们都准备好部署了！</strong></p><p id="ec9e" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">现在，在vs代码中打开终端并运行下面的命令。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="c272" class="ll jh ht lh b fv lm ln l lo lp">truffle migrate</span></pre><p id="e989" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">如果一切顺利，您可以看到下面的输出。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="e41d" class="ll jh ht lh b fv lm ln l lo lp">Compiling your contracts...<br/>===========================<br/>&gt; Compiling .\contracts\Migrations.sol<br/>&gt; Artifacts written to C:\Users\DEEL\Desktop\Ganache\build\contracts<br/>&gt; Compiled successfully using:<br/>   - solc: 0.8.12+commit.f00d7308.Emscripten.clang</span><span id="21dc" class="ll jh ht lh b fv lz ln l lo lp">Starting migrations...<br/>======================<br/>&gt; Network name:    'development'     <br/>&gt; Network id:      5777<br/>&gt; Block gas limit: 6721975 (0x6691b7)</span><span id="2e10" class="ll jh ht lh b fv lz ln l lo lp">1_initial_migration.js<br/>======================</span><span id="76f8" class="ll jh ht lh b fv lz ln l lo lp">   Deploying 'Migrations'<br/>   ----------------------<br/>   &gt; transaction hash:    0xb8262dcf48a0206de348870c38af3e2bfebe886840b9d99136239541a130343e<br/>   &gt; Blocks: 0            Seconds: 0<br/>   &gt; contract address:    0x6f9291645850130DBe0FC6673a2AF7441fd70B14<br/>   &gt; block number:        1<br/>   &gt; block timestamp:     1663047343<br/>   &gt; account:             0x8FA9410C97AbC21aEf6b12ddAB0B6cfFf6B8a4a4<br/>   &gt; balance:             99.99502316<br/>   &gt; gas used:            248842 (0x3cc0a)<br/>   &gt; gas price:           20 gwei<br/>   &gt; value sent:          0 ETH<br/>   &gt; total cost:          0.00497684 ETH</span><span id="f1e4" class="ll jh ht lh b fv lz ln l lo lp">   &gt; Saving migration to chain.<br/>   &gt; Saving artifacts<br/>   -------------------------------------<br/>   &gt; Total cost:          0.00497684 ETH</span><span id="a5e1" class="ll jh ht lh b fv lz ln l lo lp">Summary<br/>=======<br/>&gt; Total deployments:   1<br/>&gt; Final cost:          0.00497684 ETH</span></pre><p id="1389" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">现在，如果您注意到了，您会看到在<em class="lv"> migrations </em>文件夹中创建了一个名为<em class="lv"> 1_initial_migration.js </em>的新文件。1用于部署过程的序列化，这意味着它将首先部署。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="30c5" class="ll jh ht lh b fv lm ln l lo lp">const Migrations = artifacts.require("Migrations");</span><span id="4868" class="ll jh ht lh b fv lz ln l lo lp">module.exports = function (deployer) {<br/>  deployer.deploy(Migrations);<br/>};</span></pre><p id="3bdb" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">此外，我们可以在输出中看到我们的智能合约已部署，我们还可以在Ganache GUI中看到所有这些详细信息。可以看到地址0x8FA扣除了一些醚。</p><figure class="lc ld le lf fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ma"><img src="../Images/a55a0423dee92325f5c068eb7f0c3573.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2yiHj5HBieUfd42N"/></div></div></figure><p id="ad1b" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">现在，如果您签入Blocks选项卡，将会添加一个新块。</p><figure class="lc ld le lf fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lw"><img src="../Images/4db6e1e1976831a87442de0868ed21b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OBDzxb8hSAlSdUeb"/></div></div></figure><p id="ec52" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">在这里我们可以看到我们交易的细节。</p><figure class="lc ld le lf fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mb"><img src="../Images/cee94bfabe7bf1fde6ce9ff864864c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2rQ8OLg1_l1esAJL"/></div></div></figure><p id="df6e" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">如果您单击其中一个交易，您可以在下面看到该交易的所有详细信息。</p><figure class="lc ld le lf fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lw"><img src="../Images/09657079dcf7f89f3bd7201c23e821d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*efKF90Rxoh_3xoUX"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Ganache</figcaption></figure><p id="e09b" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">在这里，我们可以看到发送者地址、创建的合同地址、价值、使用的气体、气体价格、气体限制、区块开采和TX数据。在truffle和ganache的帮助下，我们已经成功部署了我们的智能合约。你自己试试吧，我相信你会喜欢的。</p><p id="0c5f" class="pw-post-body-paragraph ke kf ht kg b kh lq kj kk kl lr kn ko kp ls kr ks kt lt kv kw kx lu kz la lb hm dt translated">感谢你阅读这篇文章，稍后带着新的话题再见。</p><blockquote class="mc"><p id="6f48" class="md me ht bd mf mg mh mi mj mk ml lb ek translated">交易新手？尝试<a class="ae jf" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae jf" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>