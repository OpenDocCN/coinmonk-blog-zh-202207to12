<html>
<head>
<title>Learn Solidity lesson 17. The structure of a smart contract.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习第17课坚固性。智能合约的结构。</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/learn-solidity-lesson-17-the-structure-of-a-smart-contract-9dca379f66e1?source=collection_archive---------4-----------------------#2022-08-06">https://medium.com/coinmonks/learn-solidity-lesson-17-the-structure-of-a-smart-contract-9dca379f66e1?source=collection_archive---------4-----------------------#2022-08-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/874efffa430d180b871cdb789a9b69a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R6AwdfBGXuKI09zlD6Bb3w.jpeg"/></div></div></figure><p id="d469" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在这一章中，我们将看到智能合同的结构，以及它的所有可能性。智能协定文件具有. sol扩展名，并且可以在其中声明一个或多个协定。</p><p id="eef7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们已经看到，契约的声明是通过语句<em class="jz"> contract </em>来完成的，但是仍然有两种未探索的可能性:库和接口。</p><p id="2d9c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">库</strong>看起来像契约，但是没有状态变量。这是一种纯方法类型的契约，旨在由其他契约使用，而不是由它自己使用。</p><p id="9cdf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">接口</strong>就像契约模式。定义了状态变量和方法，但没有任何实现。这就像是写了一个带有空功能的契约，要在未来实现。</p><p id="0d5e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们将在以后的课程中学习更多关于库和接口的知识。目前，我们将只与合同合作。</p><p id="8afa" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">合同中可以(并且经常)定义以下项目。</p><ul class=""><li id="37da" class="ka kb ht jd b je jf ji jj jm kc jq kd ju ke jy kf kg kh ki dt translated">状态变量</li><li id="ae4a" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">功能</li><li id="fc50" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">修饰语</li><li id="50a1" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">事件</li><li id="1902" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">错误</li><li id="d336" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">结构</li><li id="eeb1" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">枚举</li></ul><p id="806c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在前面的课程中，我们已经看到了其中的一些项目，而其他项目在本课程中仍然是未知的。我们将简要讨论每一个项目，甚至是我们已经看过的项目。</p><h1 id="eaed" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">状态变量</h1><p id="94f6" class="pw-post-body-paragraph jb jc ht jd b je lm jg jh ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">当我们想在区块链上存储一些信息时，我们需要为这些数据预留一个专用空间。我们通过状态变量做到这一点。它们是值被永久存储的变量，就像在数据库中一样。</p><p id="5fab" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这类变量是静态类型的，也就是说，它们的类型必须在创建时声明，并且不能修改。</p><p id="4806" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">Solidity中可用的类型有:<em class="jz"> int </em>(整数)、<em class="jz"> uint </em>(无符号整数)、<em class="jz"> bool </em>(布尔值)、<em class="jz">字节</em>、<em class="jz">地址</em>、<em class="jz">字符串</em>、<em class="jz">数组</em>和<em class="jz">映射</em>。</p><p id="cf53" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">其中一些类型有细分，例如整数，范围从<em class="jz"> int8 </em>到<em class="jz"> int256 </em>。最大值总是32字节，因为存储是一种键/值数据结构，其中键和值都是32字节长。</p><p id="24e8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">坚实度没有未定义的值或空值。每个变量在声明时都被初始化；当它的值没有被显式声明时，它被赋予一个默认值。数字的默认值为0，字符串为空字符串，布尔值为false。</p><p id="59a7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">部署后无法创建新的状态变量。在函数中创建的变量要么是在内存中创建的，要么是指向已经存在于内存中的状态变量的指针。</p><h1 id="0155" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">功能</h1><p id="5773" class="pw-post-body-paragraph jb jc ht jd b je lm jg jh ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">函数在以太坊中扮演着一个基本而特殊的角色。在许多编程语言中，函数作为代码块供重用，同样的应用程序可以不使用函数来编写。在以太坊上，函数不仅仅是一段代码。</p><p id="fe69" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">函数是事务的入口，它们的基本作用是操纵状态变量。当帐户向区块链提交交易时，它必须明确指出要调用哪个函数。如果未指定该函数，将调用合同的默认函数(<em class="jz">回退</em>)，如果它存在的话。</p><p id="f3a3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">所有契约逻辑都存在于函数中，函数可以理解为执行块。在一个事务中，不可能直接调用一个以上的函数；然而，契约的一个函数可能会从同一个契约或其他契约中调用另一个函数。</p><h1 id="fd76" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">修饰语</h1><p id="4aa3" class="pw-post-body-paragraph jb jc ht jd b je lm jg jh ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">可以定义函数修饰符。<strong class="jd hu">修饰符</strong>是可重用的代码块，可以包含在一个或多个函数中。我们将在另一课中看到如何设置和使用修改器。</p><p id="f367" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">修饰语在智能合同的写作中并不重要。当同一段代码在项目中不断重复时，会使用它们，从而避免重复。</p><h1 id="2528" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">事件</h1><p id="2c6e" class="pw-post-body-paragraph jb jc ht jd b je lm jg jh ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated"><strong class="jd hu">事件</strong>是在区块链上记录信息的一种方式，类似于<em class="jz">日志</em>。可以对外部客户端进行编程，以监控此类事件的发射，然后将区块链状态的任何变化通知给外部客户端。</p><p id="dcab" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">事件在函数中发出，但不能被协定读取。一旦发布，只能从EVM以外的地方查询。它们记录在交易收据中，而不是存储中。一旦发出，也不能删除。</p><p id="1b30" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">除了用于向外部客户端通知区块链的状态变化之外，事件还可以用于以较低的价格存储信息。记录(发出)一个事件比改变存储中的状态变量花费更少的气体。</p><p id="9ae2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我希望明确事件是由契约定义和发出的，但不能被契约读取。它们的功能是与区块链以外的世界互动。</p><h1 id="c959" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">错误</h1><p id="d397" class="pw-post-body-paragraph jb jc ht jd b je lm jg jh ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">我们经常希望交易被拒绝。例如，当我们要求交易的来源是授权账户时，就会发生这种情况。我们已经看到，我们可以使用表达式<code class="eh lr ls lt lu b">require(msg.sender == owner)</code>进行这样的检查。如果发送交易的帐户不是所有者，则交易必须恢复。</p><p id="fb1a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">此时，可以确定交易被拒绝的原因，并将该信息发送给客户端。这种识别可以使用字符串来完成，但是也有可能向客户端返回一个自定义错误。</p><p id="9954" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为此，我们首先定义自定义错误，如果事务恢复，可以将这些错误发送给客户端。</p><p id="4422" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">返回自定义错误的最大好处是节省汽油。可以定义自定义错误并在事务恢复时发送这些自定义错误，而不是多次使用同一个字符串。</p><p id="d86b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们将在另一课中看到更多关于自定义错误的内容。</p><h1 id="e6ff" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">结构</h1><p id="0247" class="pw-post-body-paragraph jb jc ht jd b je lm jg jh ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">结构是自定义类型，是包含不同类型的几个变量的数据结构。结构也可以包含其他结构。</p><p id="e92b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在使用它们之前，需要对它们进行定义。一旦定义，就不能更改。我们已经在前面的课程中使用过结构，并将在整个课程中再次使用。</p><h1 id="821c" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">枚举</h1><p id="43c7" class="pw-post-body-paragraph jb jc ht jd b je lm jg jh ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">可枚举数也是用户定义的类型，但它是8位固定长度的类型。可枚举定义为一组标识符，对应于一个正整数，从数字0开始。</p><p id="a4a7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">可枚举只存在于定义它们的协定中。可枚举类型的状态变量通过它们的整数写入区块链，并且仅在协定内转换为标识符。</p><p id="718f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在上一课中，我们已经使用了可枚举数。</p><p id="ee69" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">感谢阅读！</strong></p><p id="b779" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">欢迎对本文提出意见和建议。</p><p id="0460" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">欢迎任何投稿。www.buymeacoffee.com/jpmorais<a class="ae lv" href="http://www.buymeacoffee.com/jpmorais" rel="noopener ugc nofollow" target="_blank"/></p><blockquote class="lw"><p id="a085" class="lx ly ht bd lz ma mb mc md me mf jy ek translated">加入Coinmonks <a class="ae lv" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae lv" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="4cbf" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kz mg lb lc ld mh lf lg lh mi lj lk ll dt translated">另外，阅读</h1><ul class=""><li id="926e" class="ka kb ht jd b je lm ji ln jm mj jq mk ju ml jy kf kg kh ki dt translated"><a class="ae lv" rel="noopener" href="/coinmonks/bitcoin-margin-trading-exchange-bcbfcbf7b8e3">最佳比特币保证金交易</a> | <a class="ae lv" href="https://coincodecap.com/bityard-margin-trading" rel="noopener ugc nofollow" target="_blank">比特币保证金交易</a></li><li id="b9f7" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated"><a class="ae lv" rel="noopener" href="/coinmonks/crypto-margin-trading-exchanges-428b1f7ad108">加密保证金交易交易所</a> | <a class="ae lv" rel="noopener" href="/coinmonks/earn-bitcoin-6e8bd3c592d9">赚取比特币</a></li><li id="dd4e" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated"><a class="ae lv" rel="noopener" href="/coinmonks/wazirx-vs-coindcx-vs-bitbns-149f4f19a2f1">WazirX vs CoinDCX vs bit bns</a>|<a class="ae lv" rel="noopener" href="/coinmonks/blockfi-vs-coinloan-vs-nexo-cb624635230d">block fi vs coin loan vs Nexo</a></li><li id="43f0" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated"><a class="ae lv" href="https://coincodecap.com/blockfi-credit-card" rel="noopener ugc nofollow" target="_blank"> BlockFi信用卡</a> | <a class="ae lv" href="https://coincodecap.com/buy-bitcoin-binance" rel="noopener ugc nofollow" target="_blank">如何在币安购买比特币</a></li><li id="aedb" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated"><a class="ae lv" href="https://coincodecap.com/huobi-trading-bot" rel="noopener ugc nofollow" target="_blank">火币交易Bot </a> | <a class="ae lv" href="https://coincodecap.com/buy-ada-cardano" rel="noopener ugc nofollow" target="_blank">如何购买ADA </a> | <a class="ae lv" href="https://coincodecap.com/geco-one-review" rel="noopener ugc nofollow" target="_blank"> Geco？一次回顾</a></li></ul></div></div>    
</body>
</html>