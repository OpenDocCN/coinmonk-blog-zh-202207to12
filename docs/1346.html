<html>
<head>
<title>Audios protocol hack analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">音频协议黑客分析</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/audios-protocol-hack-analysis-c4d7b96756da?source=collection_archive---------10-----------------------#2022-07-27">https://medium.com/coinmonks/audios-protocol-hack-analysis-c4d7b96756da?source=collection_archive---------10-----------------------#2022-07-27</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/7951db33aa02177be719ea139606e973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fylqq8RNqW8WUgGbmLEhNQ.jpeg"/></div></div></figure><p id="2684" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> 0x01预览</strong></p><p id="5ac6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">Audius是一个完全去中心化的音乐平台。拥有主人和平台。奥迪斯周六被黑客攻击，损失了价值约600万美元的以太坊音频令牌。这1860万个音频令牌以705 ETH(110万美元)的价格转售，并通过交易混合服务进行交易。</p><p id="e053" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> 0x02攻击信息</strong></p><p id="efce" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">攻击者的地址</p><p id="778a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">0xa 0 c 7 BD 318d 69424603 CBF 91 e 9969870 f 21 b 8 ab 4c</p><p id="c63a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">攻击交易</p><p id="d54a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">0 xfefd 829 e 246002 a8fd 061 eed 7501 bccb 6 e 244 a9 AAC ea 0 ebceaecef 5d 877 a984</p><p id="82f7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">0x3c 09 c 6306 b 67737227 EDC 24 c 663462d 870 e 7c 2 BF 39 e 9 ab 66877 a 980 c 900 D5 d 5</p><p id="8c36" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">0x 4227 BCA 8 ed 4b 8915 c 7 EEC 0 e 14 ad 3748 a 88 c 4371d 4176 e 716 e 8007249 b 9980 DC 9</p><p id="7e7d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">攻击合同</p><p id="01ef" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">0 xa 62 C3 ced 6906 b 188 a4 d3a 3c 981 b 79 F2 aabp 2107 f</p><p id="28d1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">0x bdbb 5945 f 252 BC 3466 a 319 CDCC 3 ee 8056 bf2e 569</p><p id="0e40" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">被攻击的合同<strong class="jd hu">治理</strong></p><p id="5a2b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">0x 35 DD 16 DFA 4 ea 1522 c 29 DDD 087 E8 f 076 CAD 0 AE 5 e 8</p><p id="1edd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> 0x03攻击步骤</strong></p><ol class=""><li id="535e" class="jz ka ht jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh dt translated">攻击者部署攻击合同</li><li id="4ebe" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">攻击者通过<strong class="jd hu"> evaluateProposalOutcome </strong>方法评估当前84提案是否通过(84提案由攻击者发起，但缺乏提案通过的条件)</li><li id="fad7" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">通过转账方式向0x bdbb 5945 f 252 BC 3466 a 319 CDCC 3 ee 8056 BF 2e 569发起大额资金转账新提案85。</li></ol><figure class="ko kp kq kr fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kn"><img src="../Images/350812636e132446d07777966c0f893e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4IibHtmcRTdYoqKj4CvgSw.png"/></div></div></figure><p id="27ac" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">4.调用<strong class="jd hu"> Staking.initialize </strong>初始化方法，将攻击者契约地址设置为管理员地址(<strong class="jd hu">注</strong>:为什么攻击者可以调用初始化方法)</p><p id="6d64" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">5.调用<strong class="jd hu">delegate manager v2 . initialize</strong>初始化方法更新管理员地址</p><p id="d07f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">6.调用<strong class="jd hu">delegate manager . setserviceproviderfactoryaddress</strong>更新<strong class="jd hu">serviceProviderFactoryAddress</strong></p><p id="af73" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">7.调用<strong class="jd hu"> delegateStake </strong>方法将大量选票委托给攻击者的契约地址</p><p id="59cf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">8.攻击者调用<strong class="jd hu"> submitVote </strong>方法进行投票</p><p id="cb35" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">9.攻击者调用<strong class="jd hu">evaluateProposalOutcome</strong>方法评估85提议通过，成功完成转移。</p><p id="7b53" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> 0x04攻击的核心</strong></p><p id="422f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">可初始化合同</strong></p><figure class="ko kp kq kr fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ks"><img src="../Images/2c4d17d991da8ff4150b5bda5868c14f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PSrFNhHbNMB8Qko-eLmycA.png"/></div></div></figure><p id="01ba" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">初始值设定项()</strong>修饰符判断中的三个条件。</p><p id="0e4e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">初始化:最初为假，当方法完成时也为假。</p><p id="a59b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> isConstructor() </strong>:最初部署契约时，代码在构造函数运行时仍未部署，对其代码大小的任何检查都将产生零。</p><p id="db60" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">初始化:</strong>初始化为true满足条件，方法执行结束时修改为false，不能进行二次调用。<br/>正常调用初始化契约，被初始化器修改的方法只能调用一次，这里攻击者在多个契约中进行了调用，为什么会这样？</p><p id="8521" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">Audius平台上存在代理契约，治理契约由代理契约调用，初始化契约中的修饰符在部署时由治理契约调用。</p><figure class="ko kp kq kr fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kt"><img src="../Images/afd2d210ff5388efca00347e5150848e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwzynN0QQL3ye8CLkFYUPQ.png"/></div></div></figure><p id="5d3e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">初始化导致存在于第一个卡槽中的governanceAddress地址的确定，以及该初始化的修饰符条件，其中变量的布尔值也存储在第一个卡槽中，导致存储冲突，之后初始化变量保持为真。可以多次调用initializer()修饰符。</p><p id="94db" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> 0x05资金来源和流向</strong></p><p id="9b5a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">袭击者被龙卷风带走。币安链上的现金平台</p><figure class="ko kp kq kr fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kt"><img src="../Images/60558b400d6a0b5f6e449bf5c7d6361a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PJT44z0OzyF9oZ9ri-6k_g.png"/></div></div></figure><p id="1bf9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">资金流向</strong></p><p id="bb05" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">攻击者现在已经把他们的利润转移到了<strong class="jd hu">龙卷风上。现金</strong>平台。</p><figure class="ko kp kq kr fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kt"><img src="../Images/591a478dfe73422e78c5b48899445e10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hlTtu7o4L8u1SR472w1RaQ.png"/></div></div></figure><p id="89c3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> 0x06摘要</strong></p><p id="663b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">虽然在官方的openzeppelin代理模型中声明了多个存储冲突，但是当多个逻辑组合在一起时，可能会发生意外的存储冲突。Audius现已正式在初始化修改器中添加了一个判断条件，以防止二次开发，并在初始化契约中添加了存储参数。</p><blockquote class="ku"><p id="6f13" class="kv kw ht bd kx ky kz la lb lc ld jy ek translated">交易新手？尝试<a class="ae le" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae le" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>