<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/coinmonks/nomad-attack-analysis-fee13427cf08?source=collection_archive---------21-----------------------#2022-08-03">https://medium.com/coinmonks/nomad-attack-analysis-fee13427cf08?source=collection_archive---------21-----------------------#2022-08-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><h2 id="b95c" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">游牧攻击分析</h2><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff iq"><img src="../Images/7d15db1f04e72edf8820a7cecb710f91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ywfydTaWZZwHwnaJxYxgqw.jpeg"/></div></div></figure><figure class="ir is it iu fq iv fe ff paragraph-image"><div class="fe ff jc"><img src="../Images/4d824ba173ba62394407c1b05fa7186d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*udtDxd5DvPX2upcnD3WYqA.png"/></div></figure><h2 id="31dd" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">1.攻击信息</h2><p id="0e9d" class="pw-post-body-paragraph jd je ht jf b jg jh ji jj jk jl jm jn id jo jp jq ih jr js jt il ju jv jw jx hm dt translated">攻击交易</p><p id="2daf" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">0x 96 a2 cfab 19 CAC 9 ba 2 a 21 C1 f 32 b 6 f 21 b 6132 AFE 1 b4f 4698 dee 563 ca 01 EC 20 e 01转让USDC</p><p id="8e23" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">0x 811 a 54270 e 38154 c 30 e 65 BDB 8e 484883 F5 a 9659 DD 16 f1 a 335 f 9 ff 8 f 7 eee 342 f transfer wet</p><p id="bdc3" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">0x 12 efbc 03 ECC 8d 56 ebbadd 637 dbfc 30 CD 709 b 463 e2c 831034233427 dfaecf 777转让FRAX</p><p id="1380" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">0 xc 78 BC 10 c 77 ca 92693513 e5b 97 b4a 0063167 ca 8488 b 019 F6 b 740 BC 9 F8 CAD 103 BF转移CQT</p><p id="91f7" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">0 x8c 65 b 25 be 2c 929d 86 f1 FB 556 aa 0b 981 BD 54 C2 ad 54 D8 de 63d 3876 C4 c 833293 e转戴</p><p id="c512" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">0x 5304 e 01 a4 CB 926523 f 681 BC 34 A8 b 71 a 1 dfae 35 b5 a 5159 f 78 aecc 7 f 685 f 42422 c传输卡</p><h2 id="1f5a" class="hr hs ht bd hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip dt translated">被攻击的合同</h2><p id="37ae" class="pw-post-body-paragraph jd je ht jf b jg jh ji jj jk jl jm jn id jo jp jq ih jr js jt il ju jv jw jx hm dt translated">0xb 92336759618 f 55 BD 0 f 8313 BD 843604592 e 27 BD 8副本</p><p id="8721" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">对上述攻击交易的分析表明，攻击者在交易期间执行了10次从Nomad:ERC20桥转移资金的相同过程。</p><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kd"><img src="../Images/b388b9c1cbddd91d81bf0811a9457a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-AB9r7VuNjpyyrYEH45RQ.png"/></div></div></figure><p id="a24f" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">每次调用流程时都会调用<strong class="jf ke"> Replica.process() </strong>方法，传入的参数基本相同，唯一的区别是当时生成的契约的地址。</p><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kd"><img src="../Images/9b06ed6586bbc9c678a947b2e47072fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OY5YDvw3TwvbOV--Dws-yw.png"/></div></div></figure><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kf"><img src="../Images/569b44c401418b6fb32de27edeb8f7b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ijLBgccVXjBD9uTrupkECg.png"/></div></div></figure><p id="a5e2" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">这里，流程方法注释清楚地表明，该方法检查传入的消息是否包含可接受的<strong class="jf ke"> Merkle </strong>根，如果消息未被证明，则退出。这里的主要判断在第185行。</p><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kg"><img src="../Images/ff46c13bf98dd836d9afb0c39749b014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XfWITt0ggmPG087GGvuYwg.png"/></div></div></figure><p id="1784" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">这里传入的参数是0x000…. 000，接着使用方法<strong class="jf ke"> acceptableRoot() </strong></p><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kh"><img src="../Images/d67d168cbb5811d46874e4bd867572d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Il00apu3SgESs9Ef9Rk6vQ.png"/></div></div></figure><p id="c170" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">在上面的判断中，前两个if判断条件都不成立，将in _root作为零传递，并且<strong class="jf ke"> LEGACY_STATUS_PROVEN </strong>和<strong class="jf ke"> LEGACY_STATUS_PROCESSED </strong>在副本契约中都被设置为非零。</p><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kd"><img src="../Images/9e238d250341cee30cac0b37f4f3a406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WffzIbtnAG0f4oYapqOc-Q.png"/></div></div></figure><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ki"><img src="../Images/f448bb266287291c46ddda795c1ad3b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aVG1Ciu35XhKlS1heH_I1Q.png"/></div></div></figure><p id="7e62" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated"><strong class="jf ke">攻击的核心</strong></p><figure class="ir is it iu fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kd"><img src="../Images/b99b8a7dd37b5ee5efb93f6a0eaee71b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b7Em-4wmfEJ-Nft-LPCo7g.png"/></div></div></figure><p id="9d55" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">由于副本契约是用传递给<strong class="jf ke"> _committedRoot </strong>的零值初始化的，这导致后续契约中<strong class="jf ke">confirm at[0x 000…000]</strong>都为真。该条件可以直接在process方法中传递，这样默认情况下每个消息都被证明是有效的，任何人都可以发送构造好的消息来转移资金。</p><p id="7144" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated"><strong class="jf ke">总结和建议</strong></p><p id="4c57" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated">到目前为止，已有超过1.8亿美元被转移到Nomad。通过这种攻击，似乎契约部署者在初始化契约时没有给传入参数分配目标值，而是传入全零值，导致契约中的一些判断条件保持为真，允许任何人通过发送构造的消息来转移资金。</p><p id="9118" class="pw-post-body-paragraph jd je ht jf b jg jy ji jj jk jz jm jn id ka jp jq ih kb js jt il kc jv jw jx hm dt translated"><strong class="jf ke">安全建议</strong></p><ul class=""><li id="ce5d" class="kj kk ht jf b jg jy jk jz id kl ih km il kn jx ko kp kq kr dt translated">建议使用传入参数的目标赋值来初始化协定，以避免默认情况下协定没有传入参数的风险。</li><li id="29bd" class="kj kk ht jf b jg ks jk kt id ku ih kv il kw jx ko kp kq kr dt translated">建议合同开发人员严格验证审计报告中的风险提示，以避免因疏忽的风险内容而产生的合同风险。</li></ul><blockquote class="kx"><p id="d3d8" class="ky kz ht bd la lb lc ld le lf lg jx ek translated">交易新手？试试<a class="ae lh" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae lh" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>