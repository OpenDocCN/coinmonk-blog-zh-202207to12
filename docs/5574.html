<html>
<head>
<title>Switching from Chainlink VRF to API3 QRNG</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从VRF链环切换到API3 QRNG</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/switching-from-chainlink-vrf-to-api3-qrng-b7939c5a4760?source=collection_archive---------10-----------------------#2022-10-27">https://medium.com/coinmonks/switching-from-chainlink-vrf-to-api3-qrng-b7939c5a4760?source=collection_archive---------10-----------------------#2022-10-27</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="5eb6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">从Chainlink VRFs切换到API3 QRNG以生成NFT，并在您的薄荷糖中利用真正的量子随机性。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/16d6e9ba78d38d3218a72195f15b0193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R8WocxYVyHB7TGe0"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">Photo by <a class="ae ke" href="https://unsplash.com/@yassine_khalfalli?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Yassine Khalfalli</a> on <a class="ae ke" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="kf kg kh"><p id="bca0" class="iq ir ki is b it iu iv iw ix iy iz ja kj jc jd je kk jg jh ji kl jk jl jm jn hm dt translated">我在上一篇文章中已经讨论了在智能合约中产生真正随机性的问题。这将是一个更高级的版本。这里可以看<a class="ae ke" href="https://vanshwassan.medium.com/a-guide-to-using-anus-quantum-random-number-generator-in-your-smart-contracts-21be5bed5aba" rel="noopener">。</a></p></blockquote><h1 id="662a" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">介绍</h1><p id="f717" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">在本教程中，我们将制作一个简单的铸造合同，并为一个随机的龙与地下城角色铸造一个NFT，利用API3的量子随机数生成(QRNG)赋予它属性/统计数据来显示它的力量、法力、智力和经验。我是在浏览Patrick Collins的教程时得到这个想法的，但是我们将利用API3的QRNG，而不是使用Chainlink的vrf来生成和设置随机属性。</p><p id="3864" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要阅读更多关于qrg是什么和它是如何工作的，点击<a class="ae ke" href="https://docs.api3.org/qrng/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><blockquote class="kf kg kh"><p id="a5bb" class="iq ir ki is b it iu iv iw ix iy iz ja kj jc jd je kk jg jh ji kl jk jl jm jn hm dt translated"><a class="ae ke" href="https://docs.api3.org/qrng/reference/chains.html" rel="noopener ugc nofollow" target="_blank">API 3 QRNG服务是免费的，并且在所有主要的EVM兼容测试网上运行。</a></p></blockquote><p id="2516" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">帕特里克·科林斯写的<a class="ae ke" href="https://blog.chain.link/random-numbers-nft-erc721/" rel="noopener ugc nofollow" target="_blank">指南</a>使用链环VRF为角色生成随机属性。我在上一篇文章中已经讨论了使用第三方oracle网络的缺点，我还发现在您的智能合约中设置链接令牌支出限制有些复杂(这不是免费服务)。但是，API3 QRNG是完全免费的，集成起来容易得多。您不需要在智能合同中设置任何支出限制，而是只需为一个简单的赞助商钱包提供资金，该钱包使用链条的本地天然气令牌来支付所有天然气成本。</p></div><div class="ab cl lp lq hb lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hm hn ho hp hq"><h1 id="c7a2" class="km kn ht bd ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ma lh li lj dt translated">NFT合同编码</h1><p id="c09b" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">让我们从创建一个具有五个主要属性的基本角色开始:</p><p id="5372" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh mb mc md me b">strength</code>、<code class="eh mb mc md me b">intelligence</code>、<code class="eh mb mc md me b">mana</code>、<code class="eh mb mc md me b">experience</code>和<code class="eh mb mc md me b">name</code>。我们将把所有这些属性存储在一个字符结构下。每当我们创建一个新角色时，这些属性都会被随机设置。</p><p id="d015" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，我们定义一个字符数组，该数组定义了契约中存在的所有字符。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mf mg l"/></div></figure><p id="1815" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们已经导入了<em class="ki"> RrpRequesterV0.sol </em>，它是链上<a class="ae ke" href="https://docs.api3.org/airnode/v0.8/concepts/" rel="noopener ugc nofollow" target="_blank"> RRP协议契约</a><em class="ki">(</em><a class="ae ke" href="https://docs.api3.org/airnode/v0.8/concepts/#airnoderrpv0-sol" rel="noopener ugc nofollow" target="_blank"><em class="ki">airnoderrpv 0 . sol</em></a><em class="ki">)</em>。它负责向QRNG Airnode发出实际的完整请求。发出请求后，离线Airnode获取事件日志，并获得请求的随机数，然后对请求者执行回调。</p><p id="2fa1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们还从OpenZeppelin进口了<em class="ki"> ERC721.sol </em>和<em class="ki"> Ownable.sol </em>来制造和铸造NFT。</p><p id="00ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh mb mc md me b">airnode</code>是QRNG Airnode的地址，<code class="eh mb mc md me b">endpointIdUint256 </code>指定QRNG API路径的端点，<code class="eh mb mc md me b">sponsorWallet</code>将是发出实际请求的钱包。我们以后需要资助这个钱包。</p><p id="9601" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh mb mc md me b">expectingRequestWithIdToBeFulfilled</code>映射将跟踪我们的请求，并检查它是否已经完成。</p><p id="80ac" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh mb mc md me b">requestToCharacterName</code>映射跟踪每个随机性请求，因为它与角色的名字相关联。</p><p id="74b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每个角色都有一个唯一的ID来代表它，它被映射到<code class="eh mb mc md me b">requestToTokenId</code>。与铸造NFT的地址联系在一起。</p><p id="4d7a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">构造函数将接受<code class="eh mb mc md me b">_airnodeRrp</code>地址作为参数。</p><p id="7d83" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ERC721 有两个参数，令牌的名称和符号。这里的名字是<code class="eh mb mc md me b">DungeonsAndDragonsCharacter</code>，符号是<code class="eh mb mc md me b">D&amp;D</code>。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mf mg l"/></div></figure><p id="a02d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ki"> setRequestParameters </em>函数将设置请求参数。</p><p id="3175" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ki">requestNewRandomCharacter</em>函数将向Airnode请求随机性。它将角色的名字作为输入。然后，它调用<a class="ae ke" href="https://docs.api3.org/airnode/v0.8/concepts/#airnoderrpv0-sol" rel="noopener ugc nofollow" target="_blank"> AirnodeRrpV0.sol </a>协议契约的<em class="ki"> makeFullRequest </em>函数，该函数将请求添加到其存储中，并返回一个<code class="eh mb mc md me b">requestId.</code>。<code class="eh mb mc md me b">requestId</code>将用于设置函数中的所有映射。</p><p id="28d3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一旦请求被发送到Airnode，我们现在等待它被完成，这将通过函数<em class="ki">fulfillnommandations</em>来完成。</p><p id="b8f4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">目标链外QRNG <a class="ae ke" href="https://docs.api3.org/airnode/v0.8/concepts/airnode.html" rel="noopener ugc nofollow" target="_blank"> Airnode </a>收集请求，并使用随机数(<code class="eh mb mc md me b">qrngUint256</code>)对请求者执行回调(使用<em class="ki">fulfillmonrandoms</em>函数)。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mf mg l"/></div></figure><p id="a121" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用<code class="eh mb mc md me b">qrngUint256</code>，我们现在可以为我们的角色设置属性，并将角色推送到数组中。</p><p id="8b6e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后，我们将铸造令牌，并把它连同它的<em class="ki"> Id </em>一起发送到发出随机请求的地址。</p><p id="b9fa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ki"> getCharacterStats </em>是一个视图函数，它将获取角色的统计数据。它接纳了<code class="eh mb mc md me b">tokenId</code>。</p><p id="2810" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们现在可以向前推进，部署和编译智能合同。</p><h1 id="315d" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">编制和部署NFT合同</h1><p id="2465" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">前往<a class="ae ke" href="https://remix.ethereum.org" rel="noopener ugc nofollow" target="_blank"> Remix IDE </a>，制作合同并粘贴<a class="ae ke" href="https://gist.github.com/vanshwassan/48baa25995ef3c556ebf208c725f7a86" rel="noopener ugc nofollow" target="_blank">API3QRNG</a>代码。现在点击仪表板右侧的compile，编译智能合约。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff mh"><img src="../Images/7d0d1322c992814b4aadef42c1a35adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*yvwsN04zZT8IplHVdcKYAg.png"/></div></figure><p id="5e6b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将在Goerli测试网上部署它。确保你的钱包里有足够的testnet ETH来部署合同并在以后为<code class="eh mb mc md me b">sponsorWallet</code>提供资金。你可以从这里买到一些。</p><p id="5eac" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">开始部署和运行事务，并选择Environment下的Injected Provider-meta mask选项。连接您的元掩码。确保你在格利测试网上。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/c509d191d3cde87356f03ef622ddea9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*qJPTWT4F1Sze8HTxwpepMQ.png"/></div></figure><p id="27e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh mb mc md me b">_rrpAddress</code>号是主<em class="ki">号航母。</em>RRP合同已经在链上部署。您可以在这里查看您的具体链条<a class="ae ke" href="https://docs.api3.org/qrng/reference/chains.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="2259" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">填写<code class="eh mb mc md me b">_rrpAddress</code>并点击部署。确认元掩码上的事务，并等待它部署请求者契约。</p><h1 id="8d80" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">调用合同</h1><p id="1fcd" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">当您的<em class="ki"> API3QRNG </em>被部署后，前往Deploy &amp; run transactions并在Deployed Contracts下点击您的请求者的下拉菜单。</p><p id="dc71" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在选择<em class="ki"> setRequestParameters </em>下拉菜单来设置所有参数。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff mj"><img src="../Images/db7b31bb3ac42351c5b851d00a512f5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*i-8w300dh7xw0n7TFJCWEw.png"/></div></figure><p id="8b10" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你可以在这里找到<em class="ki">_ air node</em>(qrg Provider air node地址)和<em class="ki">_ endpointiduint 256</em><a class="ae ke" href="https://docs.api3.org/qrng/reference/providers.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="893a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ki"> _sponsortWallet </em>是您的钱包，由请求者合同地址、Airnode地址和Airnode xpub派生而来。钱包用于支付汽油费用以获得一个随机数。必须使用管理CLI中的命令<a class="ae ke" href="https://docs.api3.org/airnode/v0.7/reference/packages/admin-cli.html#derive-sponsor-wallet-address" rel="noopener ugc nofollow" target="_blank">derive-sponsor-wallet-address</a>派生赞助商钱包。使用命令输出的<em class="ki">赞助商钱包地址</em>的值。确保你的钱包里有足够的测试ETH，因为它会发出实际的请求。</p><p id="8467" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">点击交易按钮并确认交易以设置参数。</p><p id="4c5f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们可以前进，要求一个随机字符。为此，点击<em class="ki">requestNewRandomCharacter</em>并给你的角色起个名字。点击交易。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/a2aeefffa06f3719b3f9b2117910037b.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*L0gr-z58yM_twMRafrKUnA.png"/></div></figure><p id="bf88" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，你可以前往<a class="ae ke" href="https://goerli.etherscan.io" rel="noopener ugc nofollow" target="_blank">https://goer Li . ethers can . io</a>查看你的<em class="ki">赞助商名单</em>中的任何新交易。</p><blockquote class="kf kg kh"><p id="c05b" class="iq ir ki is b it iu iv iw ix iy iz ja kj jc jd je kk jg jh ji kl jk jl jm jn hm dt translated">您可能需要等待一段时间，因为Airnode调用AirnodeRrpV0.sol中的<code class="eh mb mc md me b">fulfill()</code>函数，该函数将使用函数<code class="eh mb mc md me b">fulfillFunctionId</code>在<code class="eh mb mc md me b">fulfillAddress</code>回调请求者契约，以交付<code class="eh mb mc md me b">data</code>(随机数)。</p></blockquote><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff ml"><img src="../Images/baaba62dd4ddd014ba74a2609bd11e93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ef2XWtbxdClyd7_hTuXfNQ.png"/></div></div></figure><p id="91ba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这里，我们可以看到最新的<em class="ki">完成</em>交易。你可以点击它，看到D &amp; D NFT已经被铸造出来，并发送到你的地址。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff mm"><img src="../Images/643765d561c1b6c6c531f8bc9d5edcdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0xkrQlN25d1XdHGnk-MYXA.png"/></div></div></figure><p id="eca6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要检查你的角色统计数据，回到Remix，点击<em class="ki"> getCharcterStats </em>并输入你的tokenId(本例中为0)</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/504d7e1d9304cd6afe3ac7a789bd87fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*SLyqHTJ003aUaTsYmTgP0Q.png"/></div></figure><p id="dafe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里，这些是我们角色的属性。</p><p id="ae79" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所以我们请求并利用量子随机性创造了一个新角色NFT。</p><p id="0cfc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">查看<a class="ae ke" href="https://github.com/vanshwassan/QRNG-NFT-Mint" rel="noopener ugc nofollow" target="_blank"> Github repo </a>获取本指南中使用的所有代码。</p><p id="b66d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">阅读更多关于<a class="ae ke" href="https://docs.api3.org/qrng/" rel="noopener ugc nofollow" target="_blank"> API3 QRNG </a>的信息。</p><pre class="jp jq jr js fq mo me mp mq aw mr dt"><span id="5520" class="ms kn ht me b fv mt mu l mv mw"><strong class="me hu">Any questions?<br/></strong>Check out <a class="ae ke" href="https://discord.com/invite/qnRrcfnm5W" rel="noopener ugc nofollow" target="_blank"><strong class="me hu">API3’s Discord Server</strong></a> and drop your queries there!</span></pre><blockquote class="mx"><p id="ab99" class="my mz ht bd na nb nc nd ne nf ng jn ek translated">交易新手？尝试<a class="ae ke" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae ke" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>