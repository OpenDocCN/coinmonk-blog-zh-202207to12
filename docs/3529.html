<html>
<head>
<title>How to create a Beacon Proxy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åˆ›å»ºä¿¡æ ‡ä»£ç†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/coinmonks/how-to-create-a-beacon-proxy-3d55335f7353?source=collection_archive---------1-----------------------#2022-09-12">https://medium.com/coinmonks/how-to-create-a-beacon-proxy-3d55335f7353?source=collection_archive---------1-----------------------#2022-09-12</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="5672" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Beacon proxyæ˜¯ä¸€ç§ä»£ç†æ¨¡å¼ï¼Œå…¶ä¸­å¤šä¸ªä»£ç†å¼•ç”¨å•ä¸ªæ™ºèƒ½åå®šï¼Œä»¥ä¾¿ä¸ºå®ƒä»¬æä¾›å®ç°åå®šçš„åœ°å€ã€‚ä¸ºä»£ç†æä¾›å®ç°å¥‘çº¦åœ°å€çš„å¥‘çº¦ç§°ä¸ºä¿¡æ ‡å¥‘çº¦ã€‚</p><p id="f3dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">å…³äºä»€ä¹ˆæ˜¯ä»£ç†ä»¥åŠä¸ºä»€ä¹ˆåº”è¯¥ä½¿ç”¨å®ƒçš„æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·æŸ¥çœ‹è¿™ç¯‡æ›´æ—©çš„æ–‡ç« ã€‚</p><p id="4a7d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">å½“æ‚¨æœ‰å¤šä¸ªä»£ç†å¼•ç”¨ä¸€ä¸ªéšæˆ‘ä»¬çš„è¿›å±•è€Œå‡çº§çš„å®ç°å¥‘çº¦æ—¶ï¼Œå°±ä½¿ç”¨ä¿¡æ ‡ä»£ç†ã€‚å¦‚æœæ‚¨è¦ä½¿ç”¨<a class="ae jo" rel="noopener" href="/@HashHaran/how-to-create-a-transparent-proxy-1683d21468bf">é€æ˜ä»£ç†</a>æˆ–<a class="ae jo" rel="noopener" href="/@HashHaran/how-to-create-an-uups-proxy-66eca257b2f9"> UUPSä»£ç†</a>ï¼Œæ‚¨å°†ä¸å¾—ä¸ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å‡çº§æ‰€æœ‰ä»£ç†ä¸­çš„å®ç°å¥‘çº¦åœ°å€ã€‚å¦‚æœæ‚¨çš„é¡¹ç›®éœ€è¦å¤šä¸ªä»£ç†æ¥å¼•ç”¨åŒä¸€ä¸ªå®ç°ï¼Œé‚£ä¹ˆbeaconä»£ç†æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p id="b90b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">å½“æˆ‘ä»¬è¯•å›¾å‡çº§ä½¿ç”¨ä¿¡æ ‡æ¨¡å¼éƒ¨ç½²çš„æ™ºèƒ½å¥‘çº¦æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨ä¿¡æ ‡å¥‘çº¦å¹¶å‡çº§å­˜å‚¨åœ¨é‚£é‡Œçš„å®ç°å¥‘çº¦åœ°å€ã€‚åªæœ‰æ‰€æœ‰è€…åœ°å€èƒ½å¤Ÿè¿›è¡Œè¿™ç§å‡çº§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯éƒ¨ç½²ä¿¡æ ‡çš„åœ°å€ã€‚ä¸€æ—¦è¯¥ä¿¡æ ‡è¢«æ›´æ–°ï¼Œå¼•ç”¨è¯¥ä¿¡æ ‡çš„æ‰€æœ‰ä»£ç†å°†å¼€å§‹å¼•ç”¨æ–°çš„å¥‘çº¦ï¼Œå¹¶ä¸”ä»£ç†å°†è¢«ç«‹å³å‡çº§åˆ°æ–°çš„å®ç°ã€‚</p><p id="a2d4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">è®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨UUPSä»£ç†æ¨¡å¼éƒ¨ç½²ä¸€ä¸ªæ™ºèƒ½å¥‘çº¦ã€‚</p><h1 id="f236" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">é¡¹ç›®è®¾ç½®</h1><p id="9be2" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">æˆ‘ä»¬å°†ä½¿ç”¨<a class="ae jo" href="https://hardhat.org/" rel="noopener ugc nofollow" target="_blank">å®‰å…¨å¸½</a>ç”¨äºæˆ‘ä»¬çš„ä»¥å¤ªåŠå¼€å‘å·¥ä½œæµç¨‹ã€‚åœ¨æœ¬æ¼”ç»ƒä¸­ï¼Œæˆ‘åœ¨windowsæœºå™¨ä¸Šä½¿ç”¨WSL2ã€‚å¦‚æœä½¿ç”¨ä¸åŒçš„è®¾ç½®ï¼Œæ‚¨å¯ä»¥ç¨å¾®è°ƒæ•´è¿™äº›æ­¥éª¤ã€‚æˆ‘ä»¬å¼€å§‹å§ï¼</p><p id="361f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºèŠ‚ç‚¹é¡¹ç›®ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="e486" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">mkdir hardhat-upgrades &amp;&amp; cd hardhat-upgradesnpm init -y</strong></span></pre><p id="d98b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨è¿™ä¸ªç›®å½•ä¸­å®‰è£…hardhatã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="41e1" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npm i --save-dev hardhat</strong></span></pre><p id="d65e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨ç›®å½•ä¸­åˆå§‹åŒ–ä¸€ä¸ªhardhatç±»å‹çš„è„šæœ¬é¡¹ç›®ã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤å¹¶é€‰æ‹©â€œ<em class="lg">åˆ›å»ºä¸€ä¸ªTypeScripté¡¹ç›®â€</em>é€‰é¡¹ã€‚å¯¹äºå…¶ä½™çš„æç¤ºï¼Œè¯·ä½¿ç”¨é»˜è®¤å‚æ•°ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="3cdd" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npx hardhat</strong></span></pre><p id="68da" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">å®‰è£…å¼€æ”¾çš„zeppelin hardhatå‡çº§æ’ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥è½»æ¾éƒ¨ç½²æˆ‘ä»¬çš„ä»£ç†ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="b3f1" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npm i --save-dev @openzeppelin/hardhat-upgrades</strong></span></pre><p id="3400" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">è¿˜è¦å®‰è£…æ¥è‡ªOpen zeppelinçš„å¯å‡çº§åˆåŒï¼Œå®ƒæ˜¯Open zeppelinåˆåŒçš„å¯å‡çº§å¯¹åº”ç‰©ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="162c" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npm i --save-dev @openzeppelin/contracts-upgradeable</strong></span></pre><p id="e5dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶å¹¶ç²˜è´´åˆ°hardhat.config.tsæ–‡ä»¶ä¸­ã€‚è¿™å°†åšè¿™ä¸ªé¡¹ç›®æ‰€éœ€çš„åŸºæœ¬å®‰å…¨å¸½è®¾ç½®ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="f501" class="lb jq ht kx b fv lc ld l le lf">import { HardhatUserConfig } from "hardhat/config";<br/>import "@nomicfoundation/hardhat-toolbox";<br/>import "@openzeppelin/hardhat-upgrades";<br/>import "@typechain/hardhat";</span><span id="308c" class="lb jq ht kx b fv lh ld l le lf">const config: HardhatUserConfig = {<br/>solidity: {<br/>version: "0.8.9",<br/>settings: {<br/>optimizer: {<br/>enabled: true,<br/>runs: 200,<br/>},<br/>},<br/>},<br/>defaultNetwork: "localhost",<br/>};</span><span id="248a" class="lb jq ht kx b fv lh ld l le lf">export default config;</span></pre><h1 id="7f4f" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">éƒ¨ç½²ä¿¡æ ‡ä»£ç†çš„å®æ–½åˆåŒ</h1><p id="e1cd" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">åœ¨contractsæ–‡ä»¶å¤¹ä¸­ï¼Œä¸ºæˆ‘ä»¬å°†è¦éƒ¨ç½²ä¿¡æ ‡ä»£ç†çš„å®ç°å¥‘çº¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="9f31" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">mkdir contracts/beacon</strong></span></pre><p id="c133" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨<em class="lg"> contracts </em>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<em class="lg"> VersionAware.sol </em>çš„æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹ä»£ç å¤åˆ¶ç²˜è´´åˆ°å…¶ä¸­ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="6149" class="lb jq ht kx b fv lc ld l le lf"><em class="lg">// SPDX-License-Identifier: Unlicense<br/></em>pragma solidity ^0.8.0;</span><span id="0246" class="lb jq ht kx b fv lh ld l le lf">abstract contract VersionAware {</span><span id="ec8c" class="lb jq ht kx b fv lh ld l le lf">string public versionAwareContractName;</span><span id="6741" class="lb jq ht kx b fv lh ld l le lf">function getContractNameWithVersion() external pure virtual<br/>returns (string memory);<br/>}</span></pre><p id="49a0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†å®ç°å¥‘çº¦çš„åŸºæœ¬æ¡†æ¶ï¼Œä»¥ä¾¿åœ¨éƒ¨ç½²å’Œå‡çº§ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°çœ‹åˆ°ç‰ˆæœ¬å‡çº§ã€‚</p><p id="d099" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨<em class="lg"> contracts/beacon </em>ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªåä¸º<em class="lg"> BeaconProxyPatternV1.sol </em>å’Œ<em class="lg"> BeaconProxyPatternV2.sol </em>çš„æ–‡ä»¶ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶ç²˜è´´åˆ°å…¶ä¸­ã€‚</p><p id="2a78" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lg"> BeaconProxyPatternV1.sol </em></p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="47b4" class="lb jq ht kx b fv lc ld l le lf"><em class="lg">// SPDX-License-Identifier: Unlicense</em></span><span id="b3a3" class="lb jq ht kx b fv lh ld l le lf">pragma solidity ^0.8.0;</span><span id="0653" class="lb jq ht kx b fv lh ld l le lf">import {Initializable} from "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";</span><span id="9d58" class="lb jq ht kx b fv lh ld l le lf">import {VersionAware} from "../VersionAware.sol";</span><span id="49b9" class="lb jq ht kx b fv lh ld l le lf">contract BeaconProxyPatternV1 is Initializable, VersionAware {</span><span id="6ebb" class="lb jq ht kx b fv lh ld l le lf">constructor() {<br/>_disableInitializers();<br/>}</span><span id="1266" class="lb jq ht kx b fv lh ld l le lf">function initialize() external initializer {<br/>versionAwareContractName = "Beacon Proxy Pattern: V1";<br/>}</span><span id="2534" class="lb jq ht kx b fv lh ld l le lf">function getContractNameWithVersion() public pure override returns (string memory){<br/>return "Beacon Proxy Pattern: V1";<br/>}<br/>}</span></pre><p id="5508" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lg"> BeaconProxyPatternV2.sol </em></p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="1cc0" class="lb jq ht kx b fv lc ld l le lf"><em class="lg">// SPDX-License-Identifier: Unlicense<br/></em>pragma solidity ^0.8.0;</span><span id="9d1e" class="lb jq ht kx b fv lh ld l le lf">import {Initializable} from "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";</span><span id="f802" class="lb jq ht kx b fv lh ld l le lf">import {VersionAware} from "../VersionAware.sol";</span><span id="d527" class="lb jq ht kx b fv lh ld l le lf">contract BeaconProxyPatternV2 is Initializable, VersionAware {</span><span id="f375" class="lb jq ht kx b fv lh ld l le lf">constructor() {<br/>_disableInitializers();<br/>}</span><span id="f099" class="lb jq ht kx b fv lh ld l le lf">function initialize() external initializer {<br/>versionAwareContractName = "Beacon Proxy Pattern: V2";<br/>}</span><span id="1d0a" class="lb jq ht kx b fv lh ld l le lf">function getContractNameWithVersion() public pure override returns (string memory){<br/>return "Beacon Proxy Pattern: V2";<br/>}<br/>}</span></pre><p id="7c07" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">æˆ‘ä»¬çš„ä¸¤ä¸ªå¥‘çº¦éƒ½æ˜¯ç®€å•çš„å¯åˆå§‹åŒ–å¥‘çº¦ï¼Œæˆ‘ä»¬ç°åœ¨å°†ä½¿ç”¨beaconä»£ç†æ¨¡å¼æ¥éƒ¨ç½²å®ƒä»¬ã€‚</p><p id="e2e9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">åœ¨è¿™é‡Œï¼Œæˆ‘è¯•å›¾è§£é‡Šä¸Šè¿°åˆåŒçš„ä¸€äº›é«˜çº§ç»†èŠ‚ã€‚å¦‚æœä½ åœ¨ç¬¬ä¸€æ¬¡é˜…è¯»æ—¶ç†è§£æœ‰å›°éš¾ï¼Œè€ƒè™‘ç°åœ¨è·³è¿‡å®ƒï¼Œä»¥åå†å›æ¥ã€‚å…¸å‹çš„å¯å‡çº§åå®šä¸åº”è¯¥æœ‰æ„é€ å‡½æ•°ï¼Œå› ä¸ºå®ç°åå®šçš„æ„é€ å‡½æ•°æ°¸è¿œä¸èƒ½åœ¨ä»£ç†åå®šçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚æˆ‘ä»¬åœ¨è¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªå®‰å…¨çš„æ„é€ å‡½æ•°ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è®¾ç½®ä»»ä½•å­˜å‚¨å˜é‡ã€‚ä¸åˆå§‹åŒ–å°±é€€å‡ºåå®šä¼šé€ æˆå®‰å…¨å¨èƒã€‚åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨<em class="lg">_ disable initializer</em>æ–¹æ³•ä½¿å¾—å®ç°å¥‘çº¦ä¸å¯åˆå§‹åŒ–ï¼Œè¿™æ¯”è®©å®ç°æ²¡æœ‰æ„é€ å‡½æ•°ä¹Ÿä¸åˆå§‹åŒ–è¦å®‰å…¨å¾—å¤šã€‚æ³¨æ„ï¼Œæˆ‘åœ¨V1çš„<em class="lg">åˆå§‹åŒ–</em>æ–¹æ³•ä¸­ä½¿ç”¨äº†<em class="lg">åˆå§‹åŒ–å™¨</em>ä¿®é¥°ç¬¦ã€‚è¿™ä¸ªä¿®é¥°ç¬¦ç¡®ä¿è¿™ä¸ªinitializeæ–¹æ³•åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå°±åƒsolidityç¡®ä¿æ„é€ å‡½æ•°ä¸€æ ·ã€‚è¿˜è¦æ³¨æ„ï¼Œåœ¨V2ä¸­ï¼Œ<em class="lg">åˆå§‹åŒ–</em>æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯<em class="lg">é‡æ–°åˆå§‹åŒ–å™¨(2)ã€‚</em>è¿™é‡Œ2ä»£è¡¨å®ç°å¥‘çº¦çš„ç‰ˆæœ¬ã€‚å¿…é¡»ä½¿ç”¨<em class="lg">é‡æ–°åˆå§‹åŒ–å™¨</em>ä¿®æ”¹å™¨ï¼Œè€Œä¸æ˜¯<em class="lg">åˆå§‹åŒ–å™¨</em>ï¼Œå› ä¸ºä»£ç†å¥‘çº¦å·²ç»åœ¨V1åˆå§‹åŒ–è¿‡ä¸€æ¬¡ã€‚å…³äºæ‰€æœ‰å¯å‡çº§æ™ºèƒ½å¥‘çº¦éƒ½åº”è¯¥ç»§æ‰¿çš„Initializer.solå¥‘çº¦ï¼Œè¿˜æœ‰æ›´å¤šäº‹æƒ…å’Œç»†èŠ‚éœ€è¦äº†è§£ã€‚æˆ‘å°†åœ¨ä»¥åå†™æ›´å¤šå…³äºå®ƒçš„è¯¦ç»†æ–‡ç« ã€‚</p><p id="8828" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ç°åœ¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¼–è¯‘æ™ºèƒ½åˆçº¦ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="5ab2" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npx hardhat compile</strong></span></pre><h1 id="d9bf" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">ä¿¡æ ‡ä»£ç†éƒ¨ç½²å’Œå‡çº§</h1><p id="c709" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Beaconä»£ç†éƒ¨ç½²ç‰ˆæœ¬1ï¼Œç„¶åå°†å…¶å‡çº§åˆ°ç‰ˆæœ¬2ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå®‰å…¨å¸½è„šæœ¬æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚åœ¨scriptsæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<em class="lg"> beacon.js </em>çš„è„šæœ¬ï¼Œå¹¶å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶ç²˜è´´åˆ°å…¶ä¸­ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="de66" class="lb jq ht kx b fv lc ld l le lf">const { ethers, upgrades } = require("hardhat");</span><span id="9d16" class="lb jq ht kx b fv lh ld l le lf">async function main() {</span><span id="8186" class="lb jq ht kx b fv lh ld l le lf">const BeaconProxyPatternV1 = await ethers.getContractFactory("BeaconProxyPatternV1");<br/>const beacon = await upgrades.deployBeacon(BeaconProxyPatternV1, {unsafeAllow: ['constructor']});<br/>await beacon.deployed();<br/>console.log(`Beacon with Beacon Proxy Pattern V1 as implementation is deployed to address: ${beacon.address}`);<br/>const beaconProxy1 = await upgrades.deployBeaconProxy(beacon.address, BeaconProxyPatternV1, []);</span><span id="4316" class="lb jq ht kx b fv lh ld l le lf">let versionAwareContractName = await beaconProxy1.getContractNameWithVersion();</span><span id="08e0" class="lb jq ht kx b fv lh ld l le lf">console.log(`Proxy Pattern and Version from Proxy 1 Implementation: ${versionAwareContractName}`);</span><span id="1d32" class="lb jq ht kx b fv lh ld l le lf">const beaconProxy2 = await upgrades.deployBeaconProxy(beacon.address, BeaconProxyPatternV1, []);</span><span id="c580" class="lb jq ht kx b fv lh ld l le lf">versionAwareContractName = await beaconProxy2.getContractNameWithVersion();</span><span id="dff7" class="lb jq ht kx b fv lh ld l le lf">console.log(`Proxy Pattern and Version from Proxy 2 Implementation: ${versionAwareContractName}`);</span><span id="d9a5" class="lb jq ht kx b fv lh ld l le lf">const BeaconProxyPatternV2 = await ethers.getContractFactory("BeaconProxyPatternV2");</span><span id="38a3" class="lb jq ht kx b fv lh ld l le lf">const upgradedBeacon = await upgrades.upgradeBeacon(beacon.address, BeaconProxyPatternV2, {unsafeAllow: ['constructor']});</span><span id="668d" class="lb jq ht kx b fv lh ld l le lf">console.log(`Beacon upgraded with Beacon Proxy Pattern V2 as implementation at address: ${upgradedBeacon.address}`);</span><span id="384c" class="lb jq ht kx b fv lh ld l le lf">versionAwareContractName = await beaconProxy1.getContractNameWithVersion();</span><span id="0967" class="lb jq ht kx b fv lh ld l le lf">console.log(`Proxy Pattern and Version from Proxy 1 Implementation: ${versionAwareContractName}`);</span><span id="2b5e" class="lb jq ht kx b fv lh ld l le lf">versionAwareContractName = await beaconProxy2.getContractNameWithVersion();</span><span id="a019" class="lb jq ht kx b fv lh ld l le lf">console.log(`Proxy Pattern and Version from Proxy 2 Implementation: ${versionAwareContractName}`);</span><span id="e1c1" class="lb jq ht kx b fv lh ld l le lf">versionAwareContractName = await beaconProxy1.versionAwareContractName();</span><span id="1947" class="lb jq ht kx b fv lh ld l le lf">console.log(`Proxy Pattern and Version from Proxy 1 Storage: ${versionAwareContractName}`);</span><span id="ce43" class="lb jq ht kx b fv lh ld l le lf">versionAwareContractName = await beaconProxy2.versionAwareContractName();</span><span id="28d8" class="lb jq ht kx b fv lh ld l le lf">console.log(`Proxy Pattern and Version from Proxy 2 Storage: ${versionAwareContractName}`);</span><span id="74e1" class="lb jq ht kx b fv lh ld l le lf">const initTx = await beaconProxy1.initialize();<br/>const receipt = await initTx.wait();</span><span id="1b43" class="lb jq ht kx b fv lh ld l le lf">versionAwareContractName = await beaconProxy1.versionAwareContractName();</span><span id="c2a0" class="lb jq ht kx b fv lh ld l le lf">console.log(`Proxy Pattern and Version from Proxy 1 Storage: ${versionAwareContractName}`);</span><span id="bd0c" class="lb jq ht kx b fv lh ld l le lf">versionAwareContractName = await beaconProxy2.versionAwareContractName();</span><span id="04e6" class="lb jq ht kx b fv lh ld l le lf">console.log(`Proxy Pattern and Version from Proxy 2 Storage: ${versionAwareContractName}`);<br/>}</span><span id="d11a" class="lb jq ht kx b fv lh ld l le lf"><em class="lg">// We recommend this pattern to be able to use async/await everywhere and properly handle errors.</em></span><span id="932f" class="lb jq ht kx b fv lh ld l le lf">main().catch((error) =&gt; {<br/>console.error(error);<br/>process.exitCode = 1;<br/>});</span></pre><p id="9daa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">æˆ‘ä»¬é¦–å…ˆä½¿ç”¨<em class="lg"> deployBeacon </em>æ–¹æ³•éƒ¨ç½²ä¿¡æ ‡å¥‘çº¦ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨<em class="lg"> deployBeaconProxy </em>æ–¹æ³•éƒ¨ç½²ä¸¤ä¸ªä¿¡æ ‡ä»£ç†ã€‚ä¸¤ä¸ªä»£ç†å¼•ç”¨åŒä¸€ä¸ªä¿¡æ ‡ï¼Œè¯¥ä¿¡æ ‡åˆå¼•ç”¨å®ç°å¥‘çº¦ã€‚ç„¶åæˆ‘ä»¬ç”¨<em class="lg">å‡çº§ä¿¡æ ‡</em>æ–¹æ³•å‡çº§ä¿¡æ ‡å¥‘çº¦ã€‚ä¸€æ—¦ç‰ˆæœ¬1éƒ¨ç½²äº†ä»£ç†ï¼Œæˆ‘ä»¬å°±åœ¨ä»£ç†ä¸Šè°ƒç”¨<em class="lg">getContractNameWithVersion</em>å‡½æ•°ã€‚è¯¥æ–¹æ³•å°†æ ¹æ®æˆ‘ä»¬åœ¨å¥‘çº¦çš„ç‰ˆæœ¬1ä¸­ä½¿è¯¥æ–¹æ³•è¿”å›çš„å†…å®¹è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å‡çº§ç»“æŸåï¼Œæˆ‘ä»¬å†æ¬¡è°ƒç”¨<em class="lg">getContractNameWithVersion</em>å‡½æ•°æ¥æŸ¥çœ‹è¿”å›çš„å­—ç¬¦ä¸²çš„å˜åŒ–ã€‚è®©æˆ‘ä»¬è¿è¡Œè„šæœ¬ï¼Œçœ‹çœ‹ç»“æœã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œè„šæœ¬ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="0aee" class="lb jq ht kx b fv lc ld l le lf"><strong class="kx hu">npx hardhat run scripts/beacon.js</strong></span></pre><p id="1d9a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">æ‚¨åº”è¯¥ä¼šåœ¨æ§åˆ¶å°ä¸Šçœ‹åˆ°ä»¥ä¸‹å†…å®¹ã€‚</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="47ef" class="lb jq ht kx b fv lc ld l le lf">Warning: Potentially unsafe deployment of BeaconProxyPatternV1</span><span id="edfd" class="lb jq ht kx b fv lh ld l le lf">You are using the `unsafeAllow.constructor` flag.</span><span id="46b7" class="lb jq ht kx b fv lh ld l le lf">Beacon with Beacon Proxy Pattern V1 as implementation is deployed to address: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512<br/>Warning: A proxy admin was previously deployed on this network</span><span id="d329" class="lb jq ht kx b fv lh ld l le lf">This is not natively used with the current kind of proxy ('beacon').<br/>    Changes to the admin will have no effect on this new proxy.</span><span id="a23e" class="lb jq ht kx b fv lh ld l le lf">Proxy Pattern and Version from Proxy 1 Implementation: Beacon Proxy Pattern: V1<br/>Warning: A proxy admin was previously deployed on this network</span><span id="dcc3" class="lb jq ht kx b fv lh ld l le lf">This is not natively used with the current kind of proxy ('beacon').<br/>    Changes to the admin will have no effect on this new proxy.</span><span id="4dc4" class="lb jq ht kx b fv lh ld l le lf">Proxy Pattern and Version from Proxy 2 Implementation: Beacon Proxy Pattern: V1<br/>Warning: Potentially unsafe deployment of BeaconProxyPatternV2</span><span id="137a" class="lb jq ht kx b fv lh ld l le lf">You are using the `unsafeAllow.constructor` flag.</span><span id="b9e1" class="lb jq ht kx b fv lh ld l le lf">Beacon upgraded with Beacon Proxy Pattern V2 as implementation at address: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512<br/>Proxy Pattern and Version from Proxy 1 Implementation: Beacon Proxy Pattern: V2<br/>Proxy Pattern and Version from Proxy 2 Implementation: Beacon Proxy Pattern: V2<br/>Proxy Pattern and Version from Proxy 1 Storage: Beacon Proxy Pattern: V1<br/>Proxy Pattern and Version from Proxy 2 Storage: Beacon Proxy Pattern: V1<br/>Proxy Pattern and Version from Proxy 1 Storage: Beacon Proxy Pattern: V2<br/>Proxy Pattern and Version from Proxy 2 Storage: Beacon Proxy Pattern: V1</span></pre><p id="a0fb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">è€¶ï¼æˆ‘ä»¬ä¸€å‡çº§ä¿¡æ ‡ï¼Œä¸¤ä¸ªä»£ç†ä¸­çš„å®ç°å°±å‡çº§äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹å‡çº§å‰åç”±<em class="lg">getContractNameWithVersion</em>å‡½æ•°è¿”å›çš„å­—ç¬¦ä¸²æ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚</p><p id="675e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ç°åœ¨æˆ‘æƒ³è®©ä½ ä»¬æ³¨æ„ç»“æœä¸­çš„ä¸€äº›ä¸œè¥¿ã€‚è¯·æ³¨æ„ï¼Œå³ä½¿åœ¨å‡çº§ä¹‹åï¼Œå­˜å‚¨ä¸­çš„<em class="lg">versionawarecractname</em>å˜é‡çš„å€¼ä¹Ÿæ²¡æœ‰æ”¹å˜ã€‚è¿™æ˜¯å› ä¸ºå½“æˆ‘ä»¬å‡çº§å®ç°æ—¶ï¼Œæˆ‘ä»¬åªæ›´æ”¹æ™ºèƒ½åˆçº¦çš„ä»£ç ï¼Œå­˜å‚¨ä¿æŒä¸å˜ã€‚è¿™æ˜¯å¯å–çš„ï¼Œå› ä¸ºå°†ä¸€ä¸ªæ™ºèƒ½åˆåŒçš„å­˜å‚¨è¿ç§»åˆ°å¦ä¸€ä¸ªæ™ºèƒ½åˆåŒå¹¶ä¸ç®€å•ã€‚ä»£ç†å¥‘çº¦çš„å­˜å‚¨ç”¨äºå­˜å‚¨å®ç°æ™ºèƒ½å¥‘çº¦ä¸­å£°æ˜çš„å˜é‡(å¦‚æœæ‚¨ä¸æ¸…æ¥šä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œè¯·é˜…è¯»æœ¬æ–‡<a class="ae jo" rel="noopener" href="/@HashHaran/essential-guide-to-smart-contract-upgradeability-a257dac36525">ä¸­çš„</a>éƒ¨åˆ†ï¼Œæˆ‘å°†åœ¨é‚£é‡Œè§£é‡Šè¿™ä¸€ç‚¹)ã€‚å› æ­¤ï¼Œå³ä½¿åœ¨å‡çº§å,<em class="lg">versionawarecractname</em>å­˜å‚¨å˜é‡çš„å€¼ä»ç„¶ä¸ç‰ˆæœ¬1ç›¸åŒã€‚åœ¨æˆ‘ä»¬è°ƒç”¨ä»£ç†1ä¸Šçš„<em class="lg"> initialize </em>æ–¹æ³•åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸‹ä¸€è¡Œä¸­çœ‹åˆ°<em class="lg">versionawarecontraname</em>çš„å€¼å·²ç»æ”¹å˜ã€‚æ­£æ˜¯åœ¨<em class="lg"> initialize </em>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†è¯¥å€¼è®¾ç½®ä¸ºç‰ˆæœ¬2çš„å€¼ã€‚å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œåœ¨æœ€åä¸€è¡Œä¸­ï¼Œä»£ç†2ä¸­çš„<em class="lg">versionawarecractname</em>çš„å€¼ä»ç„¶ä¸ç‰ˆæœ¬1ä¸­çš„å€¼ç›¸åŒã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åªåœ¨ä»£ç†1ä¸Šè°ƒç”¨äº†<em class="lg"> initialize </em>æ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç†2ä¸Šã€‚</p><p id="6a54" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ç†è§£æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­æ¼”ç¤ºçš„å†…å®¹å¾ˆé‡è¦ã€‚å³ä½¿ä¿¡æ ‡ä»£ç†æ¨¡å¼ä¸­çš„æ‰€æœ‰ä»£ç†éƒ½å¼•ç”¨å®ç°åå®šåœ°å€çš„ä¿¡æ ‡ï¼Œå¹¶ä¸”ä»…å‡çº§ä¿¡æ ‡å°±è¶³ä»¥å‡çº§æ‰€æœ‰ä»£ç†ï¼Œä¹Ÿåº”è¯¥åœ¨æ¯ä¸ªä»£ç†åå®šä¸Šé€ä¸ªè°ƒç”¨åç»­ç‰ˆæœ¬çš„åˆå§‹åŒ–å™¨ã€‚å¦åˆ™ï¼Œ<em class="lg"> initialize </em>æ–¹æ³•çš„æ•ˆæœåœ¨æ²¡æœ‰è°ƒç”¨å®ƒçš„ä»£ç†ä¸­çœ‹ä¸åˆ°ã€‚(è¿™æ˜¯é’ˆå¯¹å½“å‰å®ç°çš„Openzeppelinå¥‘çº¦åŠå…¶å‡çº§æ’ä»¶ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªç†æƒ³çš„å¼€å‘è€…ä½“éªŒã€‚æˆ‘å¸Œæœ›å°†æ¥ä¼šå‡ºç°ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ä¸ºæ­¤æ‹…å¿ƒã€‚)</p><p id="d83d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">æ„Ÿè°¢é˜…è¯»ã€‚</p><h1 id="41c9" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">æˆ‘æ˜¯è°ï¼Ÿ</h1><p id="b581" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">æˆ‘æ˜¯ä¸€åå…¨æ ˆåŒºå—é“¾å¼€å‘è€…ï¼Œå¯¹æ„å»ºä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„ã€æ½œåœ¨çš„æ›´å…·åŒ…å®¹æ€§çš„æœªæ¥å……æ»¡çƒ­æƒ…ã€‚æœ‰åŒºå—é“¾å‘å±•çš„éœ€æ±‚å—ï¼Ÿ</p><p id="3998" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">å–å¾—è”ç³»:ğŸ“§hariharan @ aluminum . iitm . AC . in</p><p id="f6c3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://github.com/HashHaran" rel="noopener ugc nofollow" target="_blank"> Github </a></p><blockquote class="li"><p id="1218" class="lj lk ht bd ll lm ln lo lp lq lr jn ek translated">åŠ å…¥Coinmonks <a class="ae jo" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">ç”µæŠ¥é¢‘é“</a>å’Œ<a class="ae jo" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtubeé¢‘é“</a>äº†è§£åŠ å¯†äº¤æ˜“å’ŒæŠ•èµ„</p></blockquote><h1 id="0db7" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka ls kc kd ke lt kg kh ki lu kk kl km dt translated">å¦å¤–ï¼Œé˜…è¯»</h1><ul class=""><li id="ed8d" class="lv lw ht is b it kn ix ko jb lx jf ly jj lz jn ma mb mc md dt translated"><a class="ae jo" href="https://coincodecap.com/fold-app-review" rel="noopener ugc nofollow" target="_blank">æŠ˜å Appå›é¡¾</a> | <a class="ae jo" rel="noopener" href="/coinmonks/kucoin-trading-bot-automate-your-trades-8cf0ca2138e0"> Kucoinäº¤æ˜“æœºå™¨äºº</a></li><li id="912d" class="lv lw ht is b it me ix mf jb mg jf mh jj mi jn ma mb mc md dt translated"><a class="ae jo" href="https://coincodecap.com/buy-bitcoin-anonymously" rel="noopener ugc nofollow" target="_blank">å¦‚ä½•åŒ¿åè´­ä¹°æ¯”ç‰¹å¸</a> | <a class="ae jo" href="https://coincodecap.com/bitcoin-cash-wallets" rel="noopener ugc nofollow" target="_blank">æ¯”ç‰¹å¸ç°é‡‘é’±åŒ…</a></li><li id="095e" class="lv lw ht is b it me ix mf jb mg jf mh jj mi jn ma mb mc md dt translated"><a class="ae jo" href="https://coincodecap.com/binance-vs-ftx" rel="noopener ugc nofollow" target="_blank">å¸å®‰vs FTX </a> | <a class="ae jo" href="https://coincodecap.com/solana-wallets" rel="noopener ugc nofollow" target="_blank">æœ€ä½³(SOL)ç´¢æ‹‰çº³é’±åŒ…</a></li><li id="0141" class="lv lw ht is b it me ix mf jb mg jf mh jj mi jn ma mb mc md dt translated"><a class="ae jo" href="https://coincodecap.com/binomo-review" rel="noopener ugc nofollow" target="_blank">æ¯”è¯ºè«è¯„è®º</a> | <a class="ae jo" href="https://coincodecap.com/stoic-vs-3commas-vs-tradesanta" rel="noopener ugc nofollow" target="_blank">æ–¯å¤šè‘›æ´¾vs 3Commas vs TradeSanta </a></li><li id="98f6" class="lv lw ht is b it me ix mf jb mg jf mh jj mi jn ma mb mc md dt translated"><a class="ae jo" href="https://coincodecap.com/capital-com-review" rel="noopener ugc nofollow" target="_blank">Capital.comè¯„è®º</a> | <a class="ae jo" href="https://coincodecap.com/crypto-lending-hong-kong" rel="noopener ugc nofollow" target="_blank">é¦™æ¸¯çš„åŠ å¯†å€Ÿè´·å¹³å°</a></li></ul></div></div>    
</body>
</html>