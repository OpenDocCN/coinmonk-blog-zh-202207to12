# æ™ºèƒ½åˆåŒå¯å‡çº§æ€§åŸºæœ¬æŒ‡å—

> åŸæ–‡ï¼š<https://medium.com/coinmonks/essential-guide-to-smart-contract-upgradeability-a257dac36525?source=collection_archive---------1----------------------->

æœ¬æ–‡å‡è®¾æ‚¨å¯¹ä»¥å¤ªåŠå¼€å‘å·¥ä½œæµæœ‰æ‰€äº†è§£ã€‚å³æ™ºèƒ½åˆåŒéƒ¨ç½²ã€åœ°å€å’Œ EVM ç­‰æ¦‚å¿µã€‚

# ä½ ä¸ºä»€ä¹ˆè¦åœ¨ä¹ï¼Ÿ

æ™ºèƒ½åˆåŒæ˜¯å¯¹ EVM çš„ä¹¦é¢çº²é¢†æ€§è¯´æ˜ã€‚ç„¶åï¼ŒEVM ä¼šåœ¨é€‚å½“çš„æ—¶å€™æ‰§è¡Œå®ƒä»¬(ä¾‹å¦‚ï¼Œåœ¨ç”¨æˆ·è¿›è¡Œ RPC è°ƒç”¨æ—¶)ã€‚å‘ EVM å‘å‡ºè¿™äº›æŒ‡ä»¤çš„è¿‡ç¨‹ç§°ä¸ºéƒ¨ç½²ã€‚è¿™äº›æŒ‡ä»¤æ˜¯ä½œä¸ºåŒºå—é“¾äº¤æ˜“çš„ä¸€éƒ¨åˆ†ç»™å‡ºçš„ï¼Œè¯¥äº¤æ˜“æœ€ç»ˆè¢«æ·»åŠ åˆ°å—ä¸­å¹¶è¾¾æˆå…±è¯†ã€‚æ™ºèƒ½åˆçº¦éƒ¨ç½²æ˜¯éå¸¸å¿…è¦çš„ï¼Œå› ä¸ºæ²¡æœ‰å®ƒï¼Œä»–ä»¬å°†éå¸¸ä¸å®‰å…¨ï¼Œä¸é€‚åˆå¤„ç†ç”¨æˆ·èµ„é‡‘ã€‚è¿™æ ·ï¼ŒåŒºå—é“¾ä¸­å—çš„ä¸å¯å˜æ€§è´¨ä½¿å¾—å¥‘çº¦éƒ¨ç½²ä¹Ÿæ˜¯ä¸å¯å˜çš„ã€‚æ™ºèƒ½åˆçº¦ä¸€æ—¦éƒ¨ç½²å°±ä¸å¯æ”¹å˜ï¼Œå¹¶ä¸”ä¸èƒ½è¿›ä¸€æ­¥ä¿®æ”¹ã€‚ä»¥å¤ªåŠå’Œå…¶ä»– EVM å…¼å®¹çš„åŒºå—é“¾ç¡®ä¿æ¯å½“æˆ‘ä»¬éƒ¨ç½²æ™ºèƒ½åˆçº¦æ—¶ï¼Œéƒ½ä¼šè¿›è¡Œæ–°çš„éƒ¨ç½²ã€‚å³ä½¿æ‚¨å†æ¬¡éƒ¨ç½²ç›¸åŒçš„åˆåŒï¼Œä¹Ÿåªä¼šè¿›è¡Œæ–°çš„éƒ¨ç½²ã€‚

![](img/b320019b8d31181465c7c4702d4ac733.png)

Smart contract, fancy name for solidity code

![](img/795258c9fb49ee97b893e5d50723b806.png)

Credits: [me.me](https://me.me/i/its-not-a-bug-its-a-feature-ff25911c48334cc884cef01207cddf48)

æ™ºèƒ½åˆçº¦åªä¸è¿‡æ˜¯ç¨‹åºå‘˜ç¼–å†™çš„å¯é ä»£ç ã€‚ä»¥å¤ªåŠçš„å¼€å‘å·¥ä½œæµç¨‹åœ¨å¾ˆå¤šæ–¹é¢ä¸ä¼ ç»Ÿçš„å¼€å‘å·¥ä½œæµç¨‹æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œå› ä¸º EVMã€åŒºå—é“¾å’Œ solidity çš„è®¾è®¡æ–¹å¼ä¸åŒã€‚é€šå¸¸è¦ç‰¹åˆ«æ³¨æ„æŠµæ¶ˆæ™ºèƒ½åˆçº¦éƒ¨ç½²çš„ä¸å˜æ€§ã€‚å°½ç®¡å¦‚æ­¤ï¼Œbug ç¡®å®ä¼šåƒåœ¨ä¼ ç»Ÿçš„ web2 é¡¹ç›®ä¸­ä¸€æ ·æ‚„æ‚„å‡ºç°ã€‚å¯ä»¥è‚¯å®šåœ°è¯´ï¼Œweb3 é¡¹ç›®ä¸­çš„é”™è¯¯ä¼šæ¯” web2 é¡¹ç›®ä¸­çš„é”™è¯¯é€ æˆæ›´å¤§çš„æŸå¤±ã€‚

å½“åœ¨æ™ºèƒ½åˆçº¦éƒ¨ç½²ä¹‹åè¯†åˆ«å‡ºè¿™æ ·çš„é”™è¯¯æ—¶ï¼Œé¡¹ç›®èƒŒåçš„å›¢é˜Ÿéœ€è¦ä¸€ç§æ–¹æ³•æ¥ä¿®å¤å®ƒã€‚è¯¥å›¢é˜Ÿå¯èƒ½ä¼šåœ¨å°†æ¥æå‡ºä¸€ä¸ªæ–°çš„ç‰¹æ€§ï¼Œä¸ºæ­¤ä»–ä»¬éœ€è¦æ›´æ”¹æ™ºèƒ½åˆåŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§å‡çº§æ™ºèƒ½åˆçº¦éƒ¨ç½²çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•åœ¨è®¾è®¡ä¸Šæ˜¯ä¸å¯å˜çš„ã€‚(è¯·æ³¨æ„ï¼Œåƒ Uniswap è¿™æ ·çš„ä¸€äº›å¤‡å—æ¨å´‡çš„é¡¹ç›®å¹¶ä¸ä½¿ç”¨å¯å‡çº§çš„æ™ºèƒ½åˆçº¦ä½œä¸ºå‘å…¶ç”¨æˆ·ä¿è¯å…¶åè®®çš„å½“å‰ç‰ˆæœ¬å°†ç»§ç»­ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œç›´åˆ°æ°¸è¿œçš„æ–¹å¼ã€‚å³ä½¿ä»–ä»¬å‘å¸ƒäº†æ–°ç‰ˆæœ¬çš„åè®®ï¼Œæ—§ç‰ˆæœ¬ä»åœ¨ä½¿ç”¨ï¼Œå¹¶ä¸”å‡çº§å¯¹ç”¨æˆ·æ¥è¯´æ˜¯å¯é€‰çš„ã€‚)åœ¨å‡çº§æ™ºèƒ½åˆçº¦æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿åªæœ‰åˆçº¦çš„é€»è¾‘å‘ç”Ÿå˜åŒ–ï¼Œä½†å­˜å‚¨ä¸­çš„ä¿¡æ¯ä¿æŒä¸å˜ã€‚å°†ä¸€ä¸ªæ™ºèƒ½åˆçº¦çš„å­˜å‚¨è¿ç§»åˆ°å¦ä¸€ä¸ªæ™ºèƒ½åˆçº¦æœ¬èº«å°±æ˜¯ä¸€åœºå™©æ¢¦ã€‚æˆ‘ä»¬å°†é€šè¿‡ä¸€äº›èŠ±å“¨çš„ç¨³å›ºæ­¥æ³•æ¥é¿å…è¿™ç§æƒ…å†µï¼Œåœ¨ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•é¿å…ã€‚

å‡çº§æ™ºèƒ½åˆçº¦çš„å¦ä¸€ä¸ªåŸå› æ˜¯ä¿æŒå·²éƒ¨ç½²æ™ºèƒ½åˆçº¦çš„åœ°å€ä¸å˜ã€‚ä¸€æ—¦ä½ çš„é¡¹ç›®å˜å¤§ï¼Œé‚£ä¹ˆå¤šçš„ç¬¬ä¸‰æ–¹å®¢æˆ·è¿æ¥åˆ°ä½ çš„æ™ºèƒ½åˆåŒï¼Œæ”¹å˜æ¯ä¸ªäººçš„åœ°å€å°†æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚

# ä»£ç†æ¨¡å¼æŒ½æ•‘äº†å±€é¢

ä»£ç†æ¨¡å¼æ˜¯å¹¿æ³›ç”¨äºæ„å»ºå¯å‡çº§æ™ºèƒ½å¥‘çº¦çš„æ¨¡å¼ã€‚åœ¨ä»£ç†æ¨¡å¼ä¸­ï¼Œæœ‰ä¸€ä¸ªä»£ç†æ™ºèƒ½å¥‘çº¦å’Œä¸€ä¸ªå®ç°æ™ºèƒ½å¥‘çº¦ã€‚ä»£ç†æ™ºèƒ½åå®šæ˜¯ç”¨æˆ·å¯¹å…¶è¿›è¡Œæ‰€æœ‰ RPC è°ƒç”¨çš„åå®šã€‚ä»£ç†å¥‘çº¦åªæ˜¯å­˜å‚¨å®ç°å¥‘çº¦çš„åœ°å€ï¼Œå¹¶å°†æ‰€æœ‰è°ƒç”¨ä¸­ç»§ç»™å®ƒã€‚

# å§”æ´¾ç”µè¯ğŸ“:æ•‘ç”Ÿå¸®åŠ©çƒ­çº¿

ä»£ç†æ¨¡å¼çš„æ ¸å¿ƒæ˜¯ DELEGATECALL EVM æ“ä½œç ã€‚å½“åå®š A ä½¿ç”¨ DELEGATECALL è°ƒç”¨åå®š B æ—¶ï¼Œè°ƒç”¨çš„å‡½æ•°åœ¨ A çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚ç”±å‡½æ•°è°ƒç”¨å®Œæˆçš„å¯¹æ™ºèƒ½åå®šå­˜å‚¨çš„è¯»å–å’Œå†™å…¥ä¼šå½±å“ A çš„å­˜å‚¨ï¼Œè€Œä¸ä¼šå½±å“ Bã€‚å…¨å±€å˜é‡(å¦‚ msg.sender)å°†ä¸ B ä¸­å‡½æ•°å†…çš„ A çš„è°ƒç”¨æ–¹ç›¸åŒã€‚ä¸è°ƒç”¨ EVM æ“ä½œç ç›¸æ¯”ï¼Œè¿™æ›´å®¹æ˜“ç†è§£ã€‚å½“å¥‘çº¦ A ä½¿ç”¨ CALL EVM æ“ä½œç è°ƒç”¨ B æ—¶ï¼Œåœ¨ B ä¸­è°ƒç”¨çš„å‡½æ•°ä¸­çš„è¯»å–å’Œå†™å…¥ä¼šå½±å“ B çš„å­˜å‚¨ã€‚å¥‘çº¦ B ä¸­çš„å‡½æ•°è°ƒç”¨å†…çš„å…¨å±€å˜é‡ msg.sender å°†æ˜¯å¥‘çº¦ A çš„åœ°å€ã€‚å°† DELEGATECALL è§†ä¸ºå¥‘çº¦ A å®Œå…¨ä¿¡ä»»å¥‘çº¦ Bï¼Œå¹¶å°†ä¸€åˆ‡å§”æ‰˜ç»™å®ƒã€‚

![](img/b7283c8b7c857dee194d0ddbdf839492.png)

Version 2 is the active implementation here and it can be changed

å§”æ‰˜è°ƒç”¨å¯¹äºä»£ç†æ¨¡å¼æ˜¯éå¸¸å¿…è¦çš„ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨å®ç°å¥‘çº¦çš„éƒ¨ç½²ä»£ç å’Œä»£ç†å¥‘çº¦çš„å­˜å‚¨ã€‚å½“æˆ‘ä»¬éœ€è¦å‡çº§æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦æ—¶ï¼Œæˆ‘ä»¬åªéœ€å°†ä»£ç†åˆçº¦ä¸­çš„å®ç°åˆçº¦çš„åœ°å€æ›´æ”¹ä¸ºæ–°æ™ºèƒ½åˆçº¦éƒ¨ç½²çš„åœ°å€ã€‚ä¸€æ—¦å®Œæˆï¼Œä»£ç†å¥‘çº¦å°†å¼€å§‹å°†æ‰€æœ‰ RPC è°ƒç”¨è½¬å‘ç»™æ–°çš„å®ç°ï¼ŒåŒæ—¶å°†æ‰€æœ‰å†…å®¹ä¿å­˜åœ¨å…¶å­˜å‚¨ä¸­ã€‚

# ERC1976:ä»£ç†æ ‡å‡†

éšç€ä»£ç†æˆä¸ºæ™ºèƒ½åˆçº¦å¼€å‘ä¸­çš„ä¸€ä¸ªå¸¸ç”¨åç§°ï¼Œå›´ç»•å®ƒå¼€å‘äº†ä¸€äº›æ ‡å‡†æ¥ä¿æŒäº‹ç‰©çš„äº’æ“ä½œæ€§ã€‚ABI æ˜¯æ™ºèƒ½åˆçº¦å¦‚ä½•è®©å…¶ä»–äººçŸ¥é“å®ƒå®ç°äº†ä»€ä¹ˆåŠŸèƒ½ï¼Œä»¥ä¾¿ä»»ä½•å…¶ä»–æ–¹å¯ä»¥ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥è°ƒç”¨è¿™äº›åŠŸèƒ½ã€‚åœ¨ä½¿ç”¨ä»£ç†æ¨¡å¼çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä¸ ABI å¯¹æˆ‘ä»¬æ²¡æœ‰ç”¨çš„ä»£ç†å¥‘çº¦è¿›è¡Œäº¤äº’ã€‚æˆ‘ä»¬éœ€è¦å®ç°å¥‘çº¦çš„ ABI æ¥è¿›è¡Œå‡½æ•°è°ƒç”¨ã€‚å¦‚æœä¸åŒçš„ä»£ç†å¥‘çº¦ä»¥ä¸åŒçš„æ–¹å¼å­˜å‚¨å®ç°åœ°å€ï¼Œåˆ™æ£€ç´¢å®ç°åœ°å€å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚ERC1967 å¼•å…¥äº†åœ¨ä»£ç†å¥‘çº¦åœ°å€ä¸­å­˜å‚¨å®ç°å¥‘çº¦åœ°å€çš„æ ‡å‡†ã€‚ä»…çŸ¥é“æ‚¨æ­£åœ¨ä¸ä»£ç†äº¤äº’å°±è¶³ä»¥æ‰¾å‡ºå®ç°å¥‘çº¦åœ°å€å¹¶è·å¾—å®ƒçš„ ABIã€‚Etherscan å¯ä»¥è®©æ‚¨ä½¿ç”¨ä»£ç†æ¨¡å¼ä¸æ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’ï¼Œåªè¦å®ƒéµå¾ªè¿™ä¸ªæ ‡å‡†ã€‚Open Zeppelin å®ç°äº†è¿™ä¸ªä»£ç†æ ‡å‡†ï¼Œä»–ä»¬çš„ä¸€äº›ä»£ç†å¥‘çº¦ä¹Ÿç»§æ‰¿äº†è¿™ä¸ªæ ‡å‡†ã€‚æˆ‘å¼ºçƒˆå»ºè®®åœ¨ä½ çš„ä»£ç†åˆåŒä¸­éµå¾ªè¿™ä¸ªæ ‡å‡†ã€‚

# ä»£ç†ç®¡ç†å‘˜:è´Ÿè´£çš„å…¸ç‹±é•¿

å¦‚æ‚¨æ‰€è§ï¼Œä»»ä½•äººéƒ½ä¸èƒ½æ›´æ”¹ä»£ç†å¥‘çº¦çš„å®ç°åœ°å€ã€‚ä¸€ä¸ªæ¶æ„è€…å¯ä»¥ç®€å•åœ°æŠŠå®ƒå˜æˆä¸€ä¸ªå°†æ‰€æœ‰èµ„é‡‘è½¬ç§»ç»™ä»–çš„å®ç°ğŸ¤‘ã€‚æœ‰ä¸€ä¸ªä»£ç†ç®¡ç†å‘˜çš„æ¦‚å¿µï¼Œè¿™æ˜¯å”¯ä¸€å…è®¸æ›´æ”¹å®æ–½åˆåŒåœ°å€çš„å¸æˆ·ã€‚åœ¨ Open Zeppelin çš„ä»£ç†éƒ¨ç½²æ’ä»¶å®ç°ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç®¡ç†å‘˜æ˜¯éƒ¨ç½²ä»£ç†å¥‘çº¦çš„åœ°å€ã€‚ç®¡ç†å‘˜å¯ä»¥æ›´æ”¹ï¼Œä½†åªèƒ½é€šè¿‡ç®¡ç†å‘˜å¸æˆ·ã€‚

# é€æ˜ä»£ç†æ¨¡å¼:æ›´å®‰å…¨çš„é€‰æ‹©

å½“ä»£ç†å’Œå®ç°å¥‘çº¦ä¹‹é—´çš„å‡½æ•°ç­¾åå­˜åœ¨å†²çªæ—¶ï¼Œä»£ç†æ¨¡å¼ä¼šé‡åˆ°ä¸€ä¸ªæ¼æ´ã€‚ä»£ç†å¥‘çº¦éœ€è¦æœ‰è‡ªå·±çš„åŠŸèƒ½æ¥å‡çº§å®ç°æ™ºèƒ½å¥‘çº¦åœ°å€å’Œä¸€äº›å…¶ä»–ç›®çš„ã€‚å¦‚æœä»£ç†å¥‘çº¦ä¸­çš„å‡½æ•°ä¹ŸåŒ…å«åœ¨å®ç°æ™ºèƒ½å¥‘çº¦ä¸­ï¼Œç”¨æˆ·å°†æ— æ³•è°ƒç”¨å®ç°å¥‘çº¦å‡½æ•°ã€‚ä¸ºäº†è§£å†³å‡½æ•°å†²çªé—®é¢˜ï¼Œå¼•å…¥äº†é€æ˜ä»£ç†æ¨¡å¼ã€‚

åœ¨é€æ˜ä»£ç†æ¨¡å¼ä¸­ï¼Œåªæœ‰å½“è°ƒç”¨æ¥è‡ªé admin å¸æˆ·æ—¶ï¼Œå‡½æ•°è°ƒç”¨æ‰è¢«å§”æ‰˜ç»™å®ç°å¥‘çº¦ã€‚å¦‚æœè°ƒç”¨æ¥è‡ª admin å¸æˆ·ï¼Œå®ƒæ°¸è¿œä¸ä¼šå§”æ‰˜ç»™å®ç°å¥‘çº¦ï¼Œè€Œæ€»æ˜¯è°ƒç”¨ä»£ç†å¥‘çº¦çš„åŠŸèƒ½ã€‚è¿™æ ·ï¼Œå³ä½¿åœ¨ä»£ç†å¥‘çº¦å’Œå®ç°å¥‘çº¦ä¹‹é—´å‘ç”ŸåŠŸèƒ½å†²çªçš„æƒ…å†µä¸‹ï¼Œä»£ç†æ¨¡å¼ä¹Ÿå¯ä»¥ç»§ç»­å¿«é€Ÿå·¥ä½œã€‚

ç¼–å†™å¯å‡çº§çš„æ™ºèƒ½åˆçº¦æœ‰å¾ˆå¤šæ³¨æ„äº‹é¡¹ã€‚æœ‰è®¸å¤šè¯¥åšå’Œä¸è¯¥åšçš„äº‹æƒ…è¦éµå¾ªã€‚æˆ‘ä¸ä¼šåœ¨è¿™é‡Œä¸€ä¸€ä»‹ç»ã€‚è¯·åœ¨è¿™é‡Œé˜…è¯»æ¥è‡ª Zeppelin å…¬å¼€æ–‡æ¡£[çš„è­¦å‘Šã€‚](https://docs.openzeppelin.com/upgrades-plugins/1.x/writing-upgradeable)

ä¸€ç¯‡å…³äºå¦‚ä½•ä½¿ç”¨é€æ˜ä»£ç†æ¨¡å¼ç¼–å†™å’Œéƒ¨ç½²å¯å‡çº§æ™ºèƒ½å¥‘çº¦çš„å®è·µæ–‡ç« åœ¨[è¿™é‡Œ](/@HashHaran/how-to-create-a-transparent-proxy-1683d21468bf)å‘å¸ƒã€‚UUPS ä¸ŠåŒæ ·çš„ä»£ç†æ¨¡å¼åœ¨[è¿™é‡Œ](/@HashHaran/how-to-create-an-uups-proxy-66eca257b2f9)å‘å¸ƒã€‚ä¿¡æ ‡ä»£ç†æ¨¡å¼ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œåœ¨è¿™é‡Œ[å‘å¸ƒ](/@HashHaran/how-to-create-a-beacon-proxy-3d55335f7353)ã€‚

æ„Ÿè°¢é˜…è¯»ã€‚

# æˆ‘æ˜¯è°ï¼Ÿ

æˆ‘æ˜¯ä¸€åå…¨æ ˆåŒºå—é“¾å¼€å‘è€…ï¼Œå¯¹æ„å»ºä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„ã€æ½œåœ¨çš„æ›´å…·åŒ…å®¹æ€§çš„æœªæ¥å……æ»¡çƒ­æƒ…ã€‚æœ‰åŒºå—é“¾å‘å±•çš„éœ€æ±‚å—ï¼Ÿ

å–å¾—è”ç³»:ğŸ“§hariharan @ aluminum . iitm . AC . in

[Github](https://github.com/HashHaran)

> äº¤æ˜“æ–°æ‰‹ï¼Ÿè¯•è¯•[åŠ å¯†äº¤æ˜“æœºå™¨äºº](/coinmonks/crypto-trading-bot-c2ffce8acb2a)æˆ–è€…[å¤åˆ¶äº¤æ˜“](/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c)