<html>
<head>
<title>How to Create Your Own Crowdsale Cotract on CSC -part1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在CSC上创建自己的众筹合同-第1部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-create-your-own-crowdsale-cotract-on-csc-part1-b571420d8f7?source=collection_archive---------6-----------------------#2022-07-30">https://medium.com/coinmonks/how-to-create-your-own-crowdsale-cotract-on-csc-part1-b571420d8f7?source=collection_archive---------6-----------------------#2022-07-30</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="0559" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们假设我们有一个项目，并希望在区块链(而不是集中交易所)独立推出销售计划。你如何给很多人分发很多代币？答案是众卖合约。在本教程中，我们将在csc上创建一个批量销售合同。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff jo"><img src="../Images/0c758e50bd1cc3d271d82e72287a9306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*oVKdy1-89pfDf3pa73V-rQ.jpeg"/></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">photo by bianca fazacas</figcaption></figure><h2 id="1f48" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">项目设置</h2><p id="f03f" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">首先，我们为我们的项目创建一个目录。在终端类型中:</p><pre class="jp jq jr js fq la lb lc ld aw le dt"><span id="ad9a" class="ka kb ht lb b fv lf lg l lh li">mkdir crowdsale<br/>cd crowdsale</span></pre><p id="387e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里我们做了两件事:<br/>我们修改了Open-Zeppelin的旧众卖智能合约，使其符合Solidity 0.6<br/>我们在它的基础上写出了自己的众卖<br/> <br/>随着OpenZeppelin接近Solidity 0.6，众卖合约被删除。有些人倾向于给令牌智能合约本身添加一个<br/>“mint Token”功能或类似的东西，但这将是糟糕的设计。我们应该<br/>添加一个单独的处理令牌分发的众筹合同。</p><p id="83ad" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要安装Openzeppelin库，请在终端中键入:</p><pre class="jp jq jr js fq la lb lc ld aw le dt"><span id="d3ef" class="ka kb ht lb b fv lf lg l lh li">npm install @openzeppelin/contracts</span></pre><h2 id="75e4" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">CRC20</h2><p id="97e1" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">我们的token.sol是crc-20。以太网上的crc-20与erc-20相同</p><p id="834c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ERC20是以太坊区块链上用于实现令牌的智能合约的技术标准。ERC代表以太坊评论请求，20是分配给该请求的号码。</p><pre class="jp jq jr js fq la lb lc ld aw le dt"><span id="9c53" class="ka kb ht lb b fv lf lg l lh li">pragma solidity &gt;=0.8.10;<br/>import “@openzeppelin/contracts/token/ERC20/ERC20.sol”;<br/>contract MyToken is ERC20 {<br/>constructor(uint256 initialSupply) ERC20(“coinex smart chain token”, “CST”) public {<br/>_mint(msg.sender, initialSupply);<br/>_setupDecimals(0);<br/>}<br/>}</span></pre><p id="5d82" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们为我们的令牌创建众筹合同</p><h2 id="a966" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">众筹合同</h2><p id="006d" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">创建一个名为“TokenSale.sol”的文件，并将它放入:</p><pre class="jp jq jr js fq la lb lc ld aw le dt"><span id="e1c1" class="ka kb ht lb b fv lf lg l lh li">pragma solidity ^0.8.10;<br/>import “./Crowdsale.sol”;<br/>contract MyTokenSale is Crowdsale {<br/>KycContract kyc;<br/>constructor(<br/>uint256 rate, // rate in TKNbits<br/>address payable wallet,<br/>IERC20 token<br/>)<br/>Crowdsale(rate, wallet, token)<br/>public<br/>{ }<br/>}</span></pre><p id="6dc3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您可以使用Hardhat、Tuffle和csc工具包进行编译和测试</p><p id="8f60" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你喜欢安全帽，你可以阅读这篇文章:</p><p id="90bf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae lj" rel="noopener" href="/coinmonks/introduction-to-smart-contract-development-and-dapp-development-on-csc-part3-e5ddbe2c23fa">https://medium . com/coin monks/introduction-to-smart-contract-development-and-dapp-development-on-CSC-part 3-e 5 ddbe 2c 23 fa</a></p><p id="5ed4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你想用松露，你可以用这篇文章:</p><div class="lk ll fm fo lm ln"><a rel="noopener follow" target="_blank" href="/coinmonks/smart-contract-deployment-on-csc-using-truffle-152d09cd1abb"><div class="lo ab ej"><div class="lp ab lq cl cj lr"><h2 class="bd hu fv z el ls eo ep lt er et hs dt translated">使用Truffle在CSC上部署智能合同</h2><div class="lu l"><h3 class="bd b fv z el ls eo ep lt er et ek translated">您是否曾经尝试过使用truffle在coinex智能链上部署您的智能合约？在本教程中，我们希望…</h3></div><div class="lv l"><p class="bd b gc z el ls eo ep lt er et ek translated">medium.com</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb ju ln"/></div></div></a></div><p id="3b87" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了测试令牌，我们想稍微改变一下我们通常的设置。让我们使用chai的expect来测试令牌从<br/>所有者到另一个帐户的转移。</p><p id="c800" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后在tests文件夹中创建我们的测试。创建一个名为/tests/MyToken.test.js的新文件:</p><pre class="jp jq jr js fq la lb lc ld aw le dt"><span id="6996" class="ka kb ht lb b fv lf lg l lh li">const Token = artifacts.require(“MyToken”);<br/>var chai = require(“chai”);<br/>const BN = web3.utils.BN;<br/>const chaiBN = require(‘chai-bn’)(BN);<br/>chai.use(chaiBN);<br/>var chaiAsPromised = require(“chai-as-promised”);<br/>chai.use(chaiAsPromised);<br/>const expect = chai.expect;<br/>contract(“Token Test”, async accounts =&gt; {<br/>const [ initialHolder, recipient, anotherAccount ] = accounts;<br/>it(“All tokens should be in my account”, async () =&gt; {<br/>let instance = await Token.deployed();<br/>let totalSupply = await instance.totalSupply();<br/>//old style:<br/>//let balance = await instance.balanceOf.call(initialHolder);<br/>//assert.equal(balance.valueOf(), 0, “Account 1 has a balance”);<br/>//condensed, easier readable style:<br/>await expect(instance.balanceOf(initialHolder)).to.eventually.be.a.bignumber.equal(totalSupply);<br/>});<br/>});</span></pre><p id="ee09" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在上面的代码中，我们使用chai js来测试我们的契约。我们将在下一篇文章中讨论柴</p><p id="34aa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了让我们的crowdsale智能合约发挥作用，我们必须将所有的钱发送到合约。这是在我们的truffle安装中的迁移<br/>阶段完成的:<br/>问题是现在测试失败了。让我们将标准的Truffle测试套件更改为openzeppelin测试套件:</p><pre class="jp jq jr js fq la lb lc ld aw le dt"><span id="e7b7" class="ka kb ht lb b fv lf lg l lh li"><br/>var MyToken = artifacts.require(“./MyToken.sol”);<br/>var MyTokenSales = artifacts.require(“./MyTokenSale.sol”);<br/>module.exports = async function(deployer) {<br/>let addr = await web3.eth.getAccounts();<br/>await deployer.deploy(MyToken, 1000000000);<br/>await deployer.deploy(MyTokenSales, 1, addr[0], MyToken.address);<br/>let tokenInstance = await MyToken.deployed();<br/>await tokenInstance.transfer(MyTokenSales.address, 1000000000);<br/>};</span></pre><h2 id="f02c" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">KYC智能合同</h2><p id="b9dc" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">首先，我们将添加一个处理白名单的KYC智能合约。在contracts/KycContract.sol中增加<br/>以下内容。</p><pre class="jp jq jr js fq la lb lc ld aw le dt"><span id="d30b" class="ka kb ht lb b fv lf lg l lh li">pragma solidity ^0.8.10;<br/>import “@openzeppelin/contracts/access/Ownable.sol”;<br/>contract KycContract is Ownable {<br/>mapping(address =&gt; bool) allowed;<br/>function setKycCompleted(address _addr) public onlyOwner {<br/>allowed[_addr] = true;<br/>}<br/>function setKycRevoked(address _addr) public onlyOwner {<br/>allowed[_addr] = false;<br/>}<br/>function kycCompleted(address _addr) public view returns(bool) {<br/>return allowed[_addr];<br/>}<br/>}</span></pre><p id="1787" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将Crowdsale.sol和KycContrct.sol导入MyTokenSale.sol:</p><pre class="jp jq jr js fq la lb lc ld aw le dt"><span id="adb2" class="ka kb ht lb b fv lf lg l lh li">pragma solidity ^0.8.10;<br/>import “./Crowdsale.sol”;<br/>import “./KycContract.sol”;<br/>contract MyTokenSale is Crowdsale {<br/>KycContract kyc;<br/>constructor(<br/>uint256 rate, // rate in TKNbits<br/>address payable wallet,<br/>IERC20 token,<br/>KycContract _kyc<br/>)<br/>Crowdsale(rate, wallet, token)<br/>public<br/>{<br/>kyc = _kyc;<br/>}<br/>function _preValidatePurchase(address beneficiary, uint256 weiAmount) internal view override {<br/>super._preValidatePurchase(beneficiary, weiAmount);<br/>require(kyc.kycCompleted(beneficiary), “KYC not completed yet, aborting”);<br/>}<br/></span></pre><h2 id="9385" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">部署</h2><p id="0283" class="pw-post-body-paragraph iq ir ht is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hm dt translated">让我们自动进行部署:</p><pre class="jp jq jr js fq la lb lc ld aw le dt"><span id="7fe0" class="ka kb ht lb b fv lf lg l lh li">var MyToken = artifacts.require(“./MyToken.sol”);<br/>var MyTokenSales = artifacts.require(“./MyTokenSale.sol”);<br/>var KycContract = artifacts.require(“./KycContract.sol”);<br/>require(‘dotenv’).config({path: ‘../.env’});<br/>module.exports = async function(deployer) {<br/>let addr = await web3.eth.getAccounts();<br/>await deployer.deploy(MyToken, process.env.INITIAL_TOKENS);<br/>await deployer.deploy(KycContract);<br/>await deployer.deploy(MyTokenSales, 1, addr[0], MyToken.address, KycContract.address);<br/>let tokenInstance = await MyToken.deployed();<br/>await tokenInstance.transfer(MyTokenSales.address, process.env.INITIAL_TOKENS);<br/>};</span></pre><p id="2476" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您可以在npm中安装dotenv:</p><pre class="jp jq jr js fq la lb lc ld aw le dt"><span id="083e" class="ka kb ht lb b fv lf lg l lh li"># install locally (recommended)<br/>npm install dotenv --save</span></pre><p id="1b90" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Dotenv是一个零依赖模块，它将环境变量从一个<code class="eh mc md me lb b">.env</code>文件加载到<code class="eh mc md me lb b"><a class="ae lj" href="https://nodejs.org/docs/latest/api/process.html#process_process_env" rel="noopener ugc nofollow" target="_blank">process.env</a></code>中。将配置存储在独立于代码的环境中是基于<a class="ae lj" href="http://12factor.net/config" rel="noopener ugc nofollow" target="_blank">十二因素应用</a>方法的。</p><p id="657f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">祝贺🥳</p><p id="0f84" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们已经编写了dapp的后端代码，在下一部分中，我们将使用前端代码</p><blockquote class="mf"><p id="6f72" class="mg mh ht bd mi mj mk ml mm mn mo jn ek translated">交易新手？试试<a class="ae lj" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a>或<a class="ae lj" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>