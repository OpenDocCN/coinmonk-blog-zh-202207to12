<html>
<head>
<title>CSC101- Access Control</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CSC101-访问控制</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/csc101-access-control-217b15aea132?source=collection_archive---------49-----------------------#2022-11-30">https://medium.com/coinmonks/csc101-access-control-217b15aea132?source=collection_archive---------49-----------------------#2022-11-30</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="8f48" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">访问控制意味着“谁被允许做某事”，这在智能合约的世界中非常重要。你的合同的访问控制可能决定谁可以铸造代币，对提议投票，冻结转让，以及许多其他事情。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/78db353f85d00a7149d8bc2b6bc3c9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nYib8N6wIy-Papn96wyEKg.png"/></div></div></figure><h2 id="0ecb" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">所有权和<code class="eh kv kw kx ky b">Ownable</code></h2><p id="e209" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">最常见和最基本的访问控制形式是<strong class="is hu">所有权</strong>的概念:有一个帐户是契约的<code class="eh kv kw kx ky b">owner</code>，可以对它执行管理任务。这种方法对于只有一个管理用户的合同来说是完全合理的。</p><p id="4d74" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">OpenZeppelin为在合同中实现所有权提供了<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/ownership#Ownable" rel="noopener ugc nofollow" target="_blank">Ownable</a></code>。</p><pre class="jp jq jr js fq lf ky lg bn lh li bi"><span id="c7f3" class="lj kb ht ky b be lk ll l lm ln">pragma solidity ^0.8.10;</span></pre><pre class="lo lf ky lp lq aw lr dt"><span id="bc6e" class="ka kb ht ky b fv ls lt l lu ln">import "@openzeppelin/contracts/ownership/Ownable.sol";</span><span id="017a" class="ka kb ht ky b fv lv lt l lu ln">contract MyContract is Ownable {<br/>    function normalThing() public {<br/>        // anyone can call this normalThing()<br/>    }</span><span id="e15d" class="ka kb ht ky b fv lv lt l lu ln">    function specialThing() public onlyOwner {<br/>        // only the owner can call specialThing()!<br/>    }<br/>}</span></pre><p id="5bce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">默认情况下，<code class="eh kv kw kx ky b">Ownable</code>合同的<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/ownership#Ownable-owner--" rel="noopener ugc nofollow" target="_blank">owner</a></code>是部署它的账户，这通常正是您想要的。</p><p id="13d1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Ownable还允许您:</p><ul class=""><li id="4bc5" class="lw lx ht is b it iu ix iy jb ly jf lz jj ma jn mb mc md me dt translated"><code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/ownership#Ownable-transferOwnership-address-" rel="noopener ugc nofollow" target="_blank">transferOwnership</a></code>从业主账户转入新账户，以及</li><li id="2542" class="lw lx ht is b it mf ix mg jb mh jf mi jj mj jn mb mc md me dt translated">对于所有者来说，在集中管理的初始阶段结束之后，放弃这种管理特权是一种常见的模式。</li></ul><p id="2b7c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">注意:</strong>一个合同也可以是另一个合同的所有者。</p><h2 id="2315" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">基于角色的访问控制</h2><p id="dbf5" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">虽然所有权<strong class="is hu">的简单性</strong>对于简单的系统或快速原型开发很有用，但是通常需要不同级别的授权。帐户可以禁止用户进入系统，但不能创建新令牌。<strong class="is hu">基于角色的访问控制(RBAC) </strong>在这方面提供了灵活性。</p><p id="68a4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">本质上，我们将定义多个<strong class="is hu">角色</strong>，每个角色被允许执行不同的动作集合。而不是到处都用<code class="eh kv kw kx ky b">onlyOwner</code>——例如，你会在一些地方用<code class="eh kv kw kx ky b">onlyAdminRole</code>，而在另一些地方用<code class="eh kv kw kx ky b">onlyModeratorRole</code>。另外，您将能够定义如何为帐户分配角色、转移角色等规则。</p><p id="041a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">大多数软件开发都使用基于角色的访问控制系统:一些用户是普通用户，一些可能是主管或经理，还有一些通常拥有管理特权。</p><h2 id="5691" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">使用<code class="eh kv kw kx ky b">Roles</code></h2><p id="c4fd" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated"><strong class="is hu"> OpenZeppelin </strong>为实现基于角色的访问控制提供了<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/access#Roles" rel="noopener ugc nofollow" target="_blank">Roles</a></code>。它的用法很简单:对于您想要定义的每个角色，您将存储一个类型为<code class="eh kv kw kx ky b">Role</code>的变量，该变量将保存具有该角色的帐户列表。</p><p id="ee0d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里有一个在<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/tokens#ERC20" rel="noopener ugc nofollow" target="_blank">ERC20</a></code> <a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/tokens#ERC20" rel="noopener ugc nofollow" target="_blank">令牌</a>中使用<code class="eh kv kw kx ky b">Roles</code>的简单例子:我们将定义两个角色<code class="eh kv kw kx ky b">minters</code>和<code class="eh kv kw kx ky b">burners</code>，它们将能够分别铸造新令牌，并烧掉它们。</p><pre class="jp jq jr js fq lf ky lg bn lh li bi"><span id="45db" class="lj kb ht ky b be lk ll l lm ln">pragma solidity ^0.8.10;</span></pre><pre class="lo lf ky lp lq aw lr dt"><span id="f275" class="ka kb ht ky b fv ls lt l lu ln">import "@openzeppelin/contracts/access/Roles.sol";<br/>import "@openzeppelin/contracts/token/ERC20/ERC20.sol";<br/>import "@openzeppelin/contracts/token/ERC20/ERC20Detailed.sol";</span><span id="b24c" class="ka kb ht ky b fv lv lt l lu ln">contract MyToken is ERC20, ERC20Detailed {<br/>    using Roles for Roles.Role;</span><span id="685e" class="ka kb ht ky b fv lv lt l lu ln">    Roles.Role private _minters;<br/>    Roles.Role private _burners;</span><span id="752c" class="ka kb ht ky b fv lv lt l lu ln">    constructor(address[] memory minters, address[] memory burners)<br/>        ERC20Detailed("MyToken", "MTKN", 18)<br/>        public<br/>    {<br/>        for (uint256 i = 0; i &lt; minters.length; ++i) {<br/>            _minters.add(minters[i]);<br/>        }</span><span id="6bb9" class="ka kb ht ky b fv lv lt l lu ln">        for (uint256 i = 0; i &lt; burners.length; ++i) {<br/>            _burners.add(burners[i]);<br/>        }<br/>    }</span><span id="d6d2" class="ka kb ht ky b fv lv lt l lu ln">    function mint(address to, uint256 amount) public {<br/>        // Only minters can mint<br/>        require(_minters.has(msg.sender), "DOES_NOT_HAVE_MINTER_ROLE");</span><span id="2a16" class="ka kb ht ky b fv lv lt l lu ln">        _mint(to, amount);<br/>    }</span><span id="9866" class="ka kb ht ky b fv lv lt l lu ln">    function burn(address from, uint256 amount) public {<br/>        // Only burners can burn<br/>        require(_burners.has(msg.sender), "DOES_NOT_HAVE_BURNER_ROLE");</span><span id="be33" class="ka kb ht ky b fv lv lt l lu ln">       _burn(from, amount);<br/>    }<br/>}</span></pre><p id="4f4a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这么干净！通过以这种方式划分关注点，可以实现比简单的<strong class="is hu">所有权</strong>访问控制方法更细粒度的权限级别。请注意，如果需要，一个帐户可以有多个角色。</p><p id="3340" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">OpenZeppelin 广泛使用<code class="eh kv kw kx ky b">Roles</code>和预定义的契约，这些契约为每个特定的角色编码规则。例如:<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/token/ERC20#ERC20Mintable" rel="noopener ugc nofollow" target="_blank">ERC20Mintable</a></code>使用<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/access#MinterRole" rel="noopener ugc nofollow" target="_blank">MinterRole</a></code>来确定谁可以铸造代币，而<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/crowdsale#WhitelistCrowdsale" rel="noopener ugc nofollow" target="_blank">WhitelistCrowdsale</a></code>使用<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/access#WhitelistAdminRole" rel="noopener ugc nofollow" target="_blank">WhitelistAdminRole</a></code>和<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/access#WhitelistedRole" rel="noopener ugc nofollow" target="_blank">WhitelistedRole</a></code>来创建一组可以购买代币的账户。</p><p id="b150" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这种灵活性允许有趣的设置:例如，一个<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/crowdsale#MintedCrowdsale" rel="noopener ugc nofollow" target="_blank">MintedCrowdsale</a></code>期望被给予一个<code class="eh kv kw kx ky b">ERC20Mintable</code>的<code class="eh kv kw kx ky b">MinterRole</code>以便工作，但是令牌契约也可以扩展<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/token/ERC20#ERC20Pausable" rel="noopener ugc nofollow" target="_blank">ERC20Pausable</a></code>并将<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/access#PauserRole" rel="noopener ugc nofollow" target="_blank">PauserRole</a></code>分配给一个DAO，作为在契约代码中发现漏洞时的应急机制。限制系统的每个组件能够做什么被称为最小特权原则，这是一个很好的安全实践。</p><h2 id="d7ef" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jb kl km kn jf ko kp kq jj kr ks kt ku dt translated">OpenZeppelin中的用法</h2><p id="cc9b" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">你会注意到没有一个OpenZeppelin合同使用<code class="eh kv kw kx ky b">Ownable</code>。<code class="eh kv kw kx ky b">Roles</code>是一个首选的解决方案，因为它为库的用户提供了足够的灵活性来调整所提供的合同以满足他们的需求。</p><p id="913b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然而，在某些情况下，合同之间存在直接关系。例如，<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/crowdsale#RefundableCrowdsale" rel="noopener ugc nofollow" target="_blank">RefundableCrowdsale</a></code>在建筑上部署了一个<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/payment#RefundEscrow" rel="noopener ugc nofollow" target="_blank">RefundEscrow</a></code>，以持有其资金。对于这些情况，我们将使用<code class="eh kv kw kx ky b"><a class="ae le" href="https://docs.openzeppelin.com/contracts/2.x/api/ownership#Secondary" rel="noopener ugc nofollow" target="_blank">Secondary</a></code>创建一个次级契约，允许一个<em class="mk">主</em>契约来管理它。你也可以认为这些是辅助合同。</p><blockquote class="ml"><p id="d86e" class="mm mn ht bd mo mp mq mr ms mt mu jn ek translated">交易新手？尝试<a class="ae le" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae le" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p><p id="debb" class="mm mn ht bd mo mp mq mr ms mt mu jn ek translated">加入Coinmonks <a class="ae le" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae le" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae le" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="ka kb ht bd kc kd mv kf kg kh mw kj kk jb mx km kn jf my kp kq jj mz ks kt ku dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="lw lx ht is b it kz ix la jb na jf nb jj nc jn mb mc md me dt translated"><a class="ae le" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae le" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="lw lx ht is b it mf ix mg jb mh jf mi jj mj jn mb mc md me dt translated"><a class="ae le" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae le" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="lw lx ht is b it mf ix mg jb mh jf mi jj mj jn mb mc md me dt translated"><a class="ae le" rel="noopener" href="/coinmonks/top-3-telegram-channels-for-crypto-traders-in-2021-8385f4411ff4">密码电报信号</a> | <a class="ae le" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="lw lx ht is b it mf ix mg jb mh jf mi jj mj jn mb mc md me dt translated"><a class="ae le" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae le" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="lw lx ht is b it mf ix mg jb mh jf mi jj mj jn mb mc md me dt translated">开发人员的最佳加密API</li><li id="b359" class="lw lx ht is b it mf ix mg jb mh jf mi jj mj jn mb mc md me dt translated">最佳<a class="ae le" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="3c98" class="lw lx ht is b it mf ix mg jb mh jf mi jj mj jn mb mc md me dt translated"><a class="ae le" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae le" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9487" class="lw lx ht is b it mf ix mg jb mh jf mi jj mj jn mb mc md me dt translated"><a class="ae le" rel="noopener" href="/coinmonks/leveraged-token-3f5257808b22">杠杆代币</a>终极指南</li></ul></div></div>    
</body>
</html>