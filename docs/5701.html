<html>
<head>
<title>Lottery Smart Contract on CSC -Part2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CSC上的彩票智能合约-第2部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/lottery-smart-contract-on-csc-part2-4adbc75d640f?source=collection_archive---------33-----------------------#2022-10-29">https://medium.com/coinmonks/lottery-smart-contract-on-csc-part2-4adbc75d640f?source=collection_archive---------33-----------------------#2022-10-29</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="8e22" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">嘿嘿嘿！</p><p id="94e6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ZeroXlive是为Coinex智能链学院而来😃</p><p id="1d08" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本教程中，我们想写彩票智能合同使用Coinex智能链上的可靠性。留在我身边；)</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/ad5f5886c590e06e022a359764163a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x0L4Tz25CV7a9RDg2bZXIA.png"/></div></div></figure><p id="12f2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">参赛选手</strong></p><p id="2301" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里，任何调用该函数并随该调用一起发送费用金额的用户都注册了彩票。我们首先检查发送的金额(msg.value)是否正好等于费用，然后将函数调用方(msg.sender)的地址添加到参赛选手数组中。此函数具有payable关键字，因为智能合同在此函数中接收资金。</p><pre class="jp jq jr js fq ka kb kc kd aw ke dt"><span id="dbad" class="kf kg ht kb b fv kh ki l kj kk">function enter() public payable  {         require(msg.value == fees, "Enter fees amount only as value");         contestants.push(payable(msg.sender));              }</span></pre><p id="0cdb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">查看奖金</strong></p><p id="e404" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">get balance就像getFees函数一样获取智能合约中的资金量。this关键字在这里是要注意的，它总是指正在使用的合同。我们把它转换成地址类型并返回余额。</p><pre class="jp jq jr js fq ka kb kc kd aw ke dt"><span id="52d1" class="kf kg ht kb b fv kh ki l kj kk">function getBalance() public view returns (uint) {<br/>        return address(this).balance;<br/>    }</span></pre><p id="91ae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">宣布结果</strong></p><p id="58f8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这样做的逻辑是在参赛者数组的起始和结束索引中生成一个随机范围，并宣布他为获胜者。然而，有一个问题。solidity中没有真正的随机数生成器。区块链作为一个状态完整的机器，并不支持真正的随机数。因此，我们必须使用伪随机数生成算法。这个问题可以通过使用<strong class="is hu">神谕</strong> <em class="kl">来解决。</em>在该实施中，我们将使用伪随机数生成算法。我们散列块生成时间戳和创建者地址，然后用数组长度对其取模。Solidity为我们提供了keecak256哈希算法，我们用它来进行哈希运算。保持这个函数私有或公开并没有太大的区别，但是因为我们这样做是为了学习，所以它是公开的。随机数生成后，我们将合同中的金额转移到该地址，然后我们重置数组，因为抽奖已经结束，新的抽奖可以再次开始。</p><p id="7ae2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">完整的代码应该如下所示:</p><pre class="jp jq jr js fq ka kb kc kd aw ke dt"><span id="a237" class="kf kg ht kb b fv kh ki l kj kk">//SPDX-License-Identifier: MIT                              pragma solidity ^0.8.0;                                                           contract Lottery{                                 address public creator;                                 address payable[] public contestants;                                 uint fees= 1 ether;                                                                  constructor(){                                     creator = msg.sender;                                 }                                                               function enter() public payable{                                     require(msg.value == fees, "Enter fees amount only as value");                                     contestants.push(payable(msg.sender));                                                                      }                                                               function getRandomNumber() public view returns(uint){                                     return uint(keccak256(abi.encodePacked(creator, block.timestamp)));                                 }                                                               function selectWinner() public onlyOwner{                                     uint winningIndex = getRandomNumber() % contestants.length;                                     contestants[winningIndex].transfer(address(this).balance);                                     contestants=new address payable[](0);                                 }                                 function getBalance() public view returns (uint) {                                     return address(this).balance;                                 }                                 function setFees(uint _fees) public onlyOwner{                                     fees=_fees;                                 }                                 function getFees() public view returns (uint){                                     return fees;                                 }                                 modifier onlyOwner() {                                   require(msg.sender == creator);                                   _;                                 }                             }</span></pre><p id="f5d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">生:<a class="ae km" href="https://pastebin.pl/view/raw/b0631418" rel="noopener ugc nofollow" target="_blank">https://pastebin.pl/view/raw/b0631418</a></p><p id="327d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好了，我们已经准备好了彩票智能合约。现在你需要做的就是尝试一下，在remix上自己测试一下。IDE使用起来非常直观，通过体验和测试这些特性，您会学到更多。一些常见的错误是:-</p><ol class=""><li id="de76" class="kn ko ht is b it iu ix iy jb kp jf kq jj kr jn ks kt ku kv dt translated">输入彩票时，请确保设置的值正好等于费用，并确保单位设置为以太。默认情况下，它被设置为魏。</li><li id="5616" class="kn ko ht is b it kw ix kx jb ky jf kz jj la jn ks kt ku kv dt translated">确保使用创建者地址调用onlyOwner函数。那会给你一个错误。</li><li id="29b4" class="kn ko ht is b it kw ix kx jb ky jf kz jj la jn ks kt ku kv dt translated">当输入费用这样的参数时，默认值再次设置为Wei，您必须添加所需数量的零，记住(</li></ol><blockquote class="lb"><p id="4719" class="lc ld ht bd le lf lg lh li lj lk jn ek translated">交易新手？试试<a class="ae km" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae km" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p><p id="debb" class="lc ld ht bd le lf ll lm ln lo lp jn ek translated">加入Coinmonks <a class="ae km" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae km" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae km" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="kf kg ht bd lq lr ls lt lu lv lw lx ly jb lz ma mb jf mc md me jj mf mg mh mi dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="kn ko ht is b it mj ix mk jb ml jf mm jj mn jn mo kt ku kv dt translated"><a class="ae km" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae km" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="kn ko ht is b it kw ix kx jb ky jf kz jj la jn mo kt ku kv dt translated"><a class="ae km" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae km" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="kn ko ht is b it kw ix kx jb ky jf kz jj la jn mo kt ku kv dt translated"><a class="ae km" rel="noopener" href="/coinmonks/top-3-telegram-channels-for-crypto-traders-in-2021-8385f4411ff4">密码电报信号</a> | <a class="ae km" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="kn ko ht is b it kw ix kx jb ky jf kz jj la jn mo kt ku kv dt translated"><a class="ae km" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae km" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="kn ko ht is b it kw ix kx jb ky jf kz jj la jn mo kt ku kv dt translated">开发人员的最佳加密API</li><li id="b359" class="kn ko ht is b it kw ix kx jb ky jf kz jj la jn mo kt ku kv dt translated">最佳<a class="ae km" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="3c98" class="kn ko ht is b it kw ix kx jb ky jf kz jj la jn mo kt ku kv dt translated"><a class="ae km" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae km" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9487" class="kn ko ht is b it kw ix kx jb ky jf kz jj la jn mo kt ku kv dt translated"><a class="ae km" rel="noopener" href="/coinmonks/leveraged-token-3f5257808b22">杠杆代币的终极指南</a></li></ul></div></div>    
</body>
</html>