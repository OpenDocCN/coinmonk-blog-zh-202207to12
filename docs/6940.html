<html>
<head>
<title>CRC20 Supply</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CRC20电源</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/crc20-supply-b9a691731abf?source=collection_archive---------48-----------------------#2022-11-30">https://medium.com/coinmonks/crc20-supply-b9a691731abf?source=collection_archive---------48-----------------------#2022-11-30</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="67e8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本教程中，我们将学习如何创建自己的自定义供应机制的CRC20令牌。为此，我们将展示两种使用OpenZeppelin契约的惯用方法，您将能够将它们应用到您的智能契约开发实践中。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/ad5f5886c590e06e022a359764163a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x0L4Tz25CV7a9RDg2bZXIA.png"/></div></div></figure><p id="4a51" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由构建在Coinex智能链上的令牌实现的标准接口称为CRC20。CRC20与以太坊上的ERC20相同，Contracts包含一个广泛使用的实现:名副其实的<code class="eh ka kb kc kd b"><a class="ae ke" href="https://docs.openzeppelin.com/contracts/2.x/api/token/ERC20" rel="noopener ugc nofollow" target="_blank">ERC20</a></code> contract。这个合同，就像标准本身一样，非常简单。事实上，如果您尝试按原样部署一个<code class="eh ka kb kc kd b">ERC20</code>实例，它将毫无用处…它将没有供应！没有供给的代币有什么用？</p><p id="b68e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ERC20文件中未定义供应的创建方式。每个令牌都可以自由地试验自己的机制，从最分散的到最集中的，从最天真的到最有研究的，等等。</p><h2 id="10f4" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated">定量供应</h2><p id="34e3" class="pw-post-body-paragraph iq ir ht is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hm dt translated">假设我们想要一个固定供应量为1000的令牌，最初分配给部署合同的帐户。如果您使用过Contracts v1，您可能已经编写了如下代码:</p><pre class="jp jq jr js fq lf kd lg bn lh li bi"><span id="b66c" class="lj kg ht kd b be lk ll l lm ln">contract CRC20FixedSupply is ERC20 {<br/>    constructor() public {<br/>        totalSupply += 1000;<br/>        balances[msg.sender] += 1000;<br/>    }<br/>}</span></pre><p id="ff36" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">注意:</strong>不要忘记导入Oppenzeppelin ERC20.sol</p><p id="eb91" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">从Contracts v2开始，这种模式不仅不被鼓励，而且被禁止。变量<code class="eh ka kb kc kd b">totalSupply</code>和<code class="eh ka kb kc kd b">balances</code>现在是<code class="eh ka kb kc kd b">ERC20</code>的私有实现细节，不能直接写。相反，有一个内部的<code class="eh ka kb kc kd b"><a class="ae ke" href="https://docs.openzeppelin.com/contracts/2.x/api/token/ERC20#ERC20-_mint-address-uint256-" rel="noopener ugc nofollow" target="_blank">_mint</a></code>函数可以做到这一点:</p><pre class="jp jq jr js fq lf kd lg bn lh li bi"><span id="e583" class="lj kg ht kd b be lk ll l lm ln">contract CRC20FixedSupply is ERC20 {<br/>    constructor() public {<br/>        _mint(msg.sender, 1000);<br/>    }<br/>}</span></pre><p id="83e5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">像这样封装状态使得扩展契约更加安全。例如，在第一个例子中，我们必须手动保持<code class="eh ka kb kc kd b">totalSupply</code>与修改后的天平同步，这很容易忘记。事实上，我们忽略了另一件也很容易被遗忘的事情:标准所要求的、一些客户端所依赖的<code class="eh ka kb kc kd b">Transfer</code>事件。第二个例子没有这个bug，因为内部的<code class="eh ka kb kc kd b">_mint</code>函数会处理它。</p><h2 id="d905" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated">奖励矿工</h2><p id="a177" class="pw-post-body-paragraph iq ir ht is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hm dt translated">内部的<code class="eh ka kb kc kd b"><a class="ae ke" href="https://docs.openzeppelin.com/contracts/2.x/api/token/ERC20#ERC20-_mint-address-uint256-" rel="noopener ugc nofollow" target="_blank">_mint</a></code>函数是关键的构建模块，它允许我们编写实现供应机制的CRC20扩展。</p><p id="d838" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将实施的机制是对生产CSC区块的矿工的象征性奖励。在Solidity中，我们可以在全局变量<code class="eh ka kb kc kd b">block.coinbase</code>中访问当前块的矿工地址。每当有人调用我们令牌上的函数<code class="eh ka kb kc kd b">mintMinerReward()</code>时，我们将向该地址铸造一个令牌奖励。这种机制听起来可能很傻，但是你永远不知道这会导致什么样的动态，这是值得分析和试验的！</p><pre class="jp jq jr js fq lf kd lg bn lh li bi"><span id="93e2" class="lj kg ht kd b be lk ll l lm ln">contract CRC20WithMinerReward is ERC20 {<br/>    function mintMinerReward() public {<br/>        _mint(block.coinbase, 1000);<br/>    }<br/>}</span></pre><p id="1dd8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">正如我们所看到的，<code class="eh ka kb kc kd b">_mint</code>使得正确地做到这一点变得非常容易。</p><h2 id="c8be" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated">将机制模块化</h2><p id="02f2" class="pw-post-body-paragraph iq ir ht is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hm dt translated">合同中已经包含一个供应机制:<code class="eh ka kb kc kd b"><a class="ae ke" href="https://docs.openzeppelin.com/contracts/2.x/api/token/ERC20#ERC20Mintable" rel="noopener ugc nofollow" target="_blank">ERC20Mintable</a></code>。这是一种通用机制，其中一组帐户被分配了<code class="eh ka kb kc kd b">minter</code>角色，授予他们调用<code class="eh ka kb kc kd b"><a class="ae ke" href="https://docs.openzeppelin.com/contracts/2.x/api/token/ERC20#ERC20Mintable-mint-address-uint256-" rel="noopener ugc nofollow" target="_blank">mint</a></code>函数的权限，这是<code class="eh ka kb kc kd b">_mint</code>的外部版本。</p><p id="5f0d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这可用于集中铸造，其中外部拥有的账户(即，具有一对密钥的人)决定制造多少供应和给谁。这种机制有非常合理的用例，比如传统的资产支持的stablecoins。</p><p id="9bfa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但是，具有minter角色的帐户不需要为外部所有，也可以是实现无信任机制的智能契约。事实上，我们可以实现与上一节相同的行为。</p><pre class="jp jq jr js fq lf kd lg bn lh li bi"><span id="c2cd" class="lj kg ht kd b be lk ll l lm ln">contract MinerRewardMinter {<br/>    ERC20Mintable _token;</span></pre><pre class="lo lf kd lp lq aw lr dt"><span id="0830" class="kf kg ht kd b fv ls lt l lu ln">    constructor(ERC20Mintable token) public {<br/>        _token = token;<br/>    }</span><span id="8c84" class="kf kg ht kd b fv lv lt l lu ln">    function mintMinerReward() public {<br/>        _token.mint(block.coinbase, 1000);<br/>    }<br/>}</span></pre><p id="dbd0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个契约在用一个<code class="eh ka kb kc kd b">ERC20Mintable</code>实例初始化时，将导致与上一节中实现的行为完全相同的行为。使用<code class="eh ka kb kc kd b">ERC20Mintable</code>的有趣之处在于，我们可以通过将角色分配给多个合同来轻松地组合多个供应机制，而且我们可以动态地这样做。</p><h2 id="59fd" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated">自动化奖励</h2><p id="4b3f" class="pw-post-body-paragraph iq ir ht is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hm dt translated">除了<code class="eh ka kb kc kd b">_mint</code>之外，<code class="eh ka kb kc kd b">ERC20</code>还提供了其他可以使用或扩展的内部函数，如<code class="eh ka kb kc kd b"><a class="ae ke" href="https://docs.openzeppelin.com/contracts/2.x/api/token/ERC20#ERC20-_transfer-address-address-uint256-" rel="noopener ugc nofollow" target="_blank">_transfer</a></code>。该函数实现令牌传输并由<code class="eh ka kb kc kd b">ERC20</code>使用，因此可用于自动触发功能。这是用<code class="eh ka kb kc kd b">ERC20Mintable</code>方法做不到的。</p><p id="9acd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">除了我们以前的供应机制，我们可以用它来为区块链中包含的每一次代币转移创造一个矿工奖励。</p><pre class="jp jq jr js fq lf kd lg bn lh li bi"><span id="e1fc" class="lj kg ht kd b be lk ll l lm ln">contract CRC20WithAutoMinerReward is ERC20 {<br/>    function _mintMinerReward() internal {<br/>        _mint(block.coinbase, 1000);<br/>    }</span></pre><pre class="lo lf kd lp lq aw lr dt"><span id="5e1e" class="kf kg ht kd b fv ls lt l lu ln">    function _transfer(address from, address to, uint256 value) internal {<br/>        _mintMinerReward();<br/>        super._transfer(from, to, value);<br/>    }<br/>}</span></pre><p id="a374" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意我们如何覆盖<code class="eh ka kb kc kd b">_transfer</code>来首先铸造矿工奖励，然后通过调用<code class="eh ka kb kc kd b">super._transfer</code>来运行最初的实现。这最后一步对于保留ERC20传输的原始语义非常重要。</p><p id="b5a4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们已经看到了两种实现CRC20供应机制的方法:内部通过<code class="eh ka kb kc kd b">_mint</code>，外部通过<code class="eh ka kb kc kd b">ERC20Mintable</code>。希望这已经帮助你理解了如何使用<strong class="is hu"> OpenZeppelin </strong>和它背后的一些设计原则，你可以将它们应用到你自己的智能合同中。</p><blockquote class="lw"><p id="a008" class="lx ly ht bd lz ma mb mc md me mf jn ek translated">交易新手？尝试<a class="ae ke" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae ke" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p><p id="debb" class="lx ly ht bd lz ma mb mc md me mf jn ek translated">加入Coinmonks <a class="ae ke" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae ke" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae ke" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="kf kg ht bd kh ki mg kk kl km mh ko kp jb mi kr ks jf mj ku kv jj mk kx ky kz dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="ml mm ht is b it la ix lb jb mn jf mo jj mp jn mq mr ms mt dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae ke" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="ml mm ht is b it mu ix mv jb mw jf mx jj my jn mq mr ms mt dt translated"><a class="ae ke" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">电网交易</a> | <a class="ae ke" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="ml mm ht is b it mu ix mv jb mw jf mx jj my jn mq mr ms mt dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/top-3-telegram-channels-for-crypto-traders-in-2021-8385f4411ff4">密码电报信号</a> | <a class="ae ke" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="ml mm ht is b it mu ix mv jb mw jf mx jj my jn mq mr ms mt dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae ke" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="ml mm ht is b it mu ix mv jb mw jf mx jj my jn mq mr ms mt dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">面向开发人员的最佳加密API</a></li><li id="b359" class="ml mm ht is b it mu ix mv jb mw jf mx jj my jn mq mr ms mt dt translated">最佳<a class="ae ke" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="3c98" class="ml mm ht is b it mu ix mv jb mw jf mx jj my jn mq mr ms mt dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae ke" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9487" class="ml mm ht is b it mu ix mv jb mw jf mx jj my jn mq mr ms mt dt translated">杠杆代币的终极指南</li></ul></div></div>    
</body>
</html>