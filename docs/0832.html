<html>
<head>
<title>Learn Solidity lesson 3. The compiler.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习第三课的可靠性。编译器。</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/learn-solidity-lesson-3-the-compiler-a9a6b8da1e70?source=collection_archive---------5-----------------------#2022-07-17">https://medium.com/coinmonks/learn-solidity-lesson-3-the-compiler-a9a6b8da1e70?source=collection_archive---------5-----------------------#2022-07-17</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/798a42d20e909f611c693f0cb1e2e6f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h4ED1Lk14BH74L56TAyN6w.jpeg"/></div></div></figure><p id="bcb1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">当一个合同被保存在Remix中时，它被自动编译。在这一节中，我们将看到编译是如何发生的及其结果。首先，我们来看看Solidity编译器以及如何使用它。</p><h1 id="4b86" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">Solc</h1><p id="1b73" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">Solidity编译器被命名为<em class="lc"> solc </em>，它大部分是用C++编写的，目前版本是0.8.15。源代码可以在github.com/ethereum/solidity的<a class="ae ld" href="http://github.com/ethereum/solidity" rel="noopener ugc nofollow" target="_blank">找到。有一个用JavaScript(更准确的说是TypeScript)写的包装器可以通过<strong class="jd hu"> npm </strong>(或者<strong class="jd hu"> yarn </strong>)安装，命名为<em class="lc"> solc-js </em>。还是用<em class="lc"> solc-js </em>吧，安装使用更方便。</a></p><p id="a8b9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了展示solc的用法，让我们暂时远离Remix。使用您选择的任何文本编辑器，粘贴您编写的合同并将文件保存为<em class="lc"> HelloWorld.sol </em>。我使用的是VS代码，如下图所示。</p><figure class="lf lg lh li fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff le"><img src="../Images/68307ec1fb7bd817736e7184288f3346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9d30Vs32yJbLvtaTHavhGA.png"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">HelloWorld.sol</figcaption></figure><p id="5b6e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们运行<em class="lc"> solc </em>来编译合同。为此，我们将使用<strong class="jd hu"> npx </strong>，它在没有安装的情况下运行节点包。Npx是和<strong class="jd hu"> node.js </strong>一起安装的，如果你的电脑上没有安装，请到<a class="ae ld" href="http://nodejs.dev" rel="noopener ugc nofollow" target="_blank"> nodejs.dev </a>按照说明操作。</p><p id="2ba3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要编译契约，也就是生成它的字节码，在shell中运行下面的命令行。我正在使用Windows命令提示符。</p><pre class="lf lg lh li fq ln lo lp lq aw lr dt"><span id="8cca" class="ls ka ht lo b fv lt lu l lv lw">npx solc --bin HelloWorld.sol</span></pre><p id="ed31" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">Solc接受几个参数，但是我们将把自己限制在严格必要的范围内。有必要使用选项<em class="lc"> — bin </em>或<em class="lc"> — abi </em>指出我们是想要生成字节码还是契约的<strong class="jd hu"> ABI </strong>。我们使用<em class="lc"> — bin </em>来生成字节码，这是EVM机器码。</p><p id="18d6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在下图中，我们看到编译器警告我们缺少许可证声明，就像Remix一样。仅仅一个警告并不能阻止编译器编译，生成一个名为<em class="lc">hello world _ sol _ hello world . bin</em>的文件。</p><figure class="lf lg lh li fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lx"><img src="../Images/67ab38cda13f034a8387032e21965a82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V7PlDbvfMNTaK60fmzvoAA.png"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Generating the bytecode using <em class="ly">solc</em>.</figcaption></figure><p id="26d1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="lc">。bin </em>文件包含必须在事务中发送到区块链的字节码。这是一个二进制代码，但以十六进制为基础，因此它可以包含数字和字母之间的' a '和' f '。我们可以在下图中看到这一点。</p><figure class="lf lg lh li fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lz"><img src="../Images/d6bd0441fe2679fbc6ba878bbff0b2eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Fwe7GWGjY2WiijqVwr-ZQ.png"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">The bytecode of HelloWorld.sol.</figcaption></figure><p id="bafc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">另一个选项是生成ABI，将在后面解释。现在让我们看看在哪里可以使用Remix找到字节码。在屏幕底部名为<em class="lc"> Solidity Compiler </em>的选项卡中，注意两个按钮的存在:ABI和字节码。见下图。</p><figure class="lf lg lh li fq iu fe ff paragraph-image"><div class="fe ff ma"><img src="../Images/390ef729780756557aef269dad7a003d.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*5P02cfm2iJCg05-_-aBwew.png"/></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Bytecode and ABI in Remix.</figcaption></figure><p id="cbb2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">可以点击<em class="lc">字节码</em>复制Remix生成的内容，粘贴到文本文件中。然而，您可能会注意到，它不仅仅是一个十六进制数，而是一个JSON文件。真正的字节码几乎是在JSON的末尾，在一个名为<em class="lc">对象</em>的属性中找到的，如下图所示。</p><figure class="lf lg lh li fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mb"><img src="../Images/1bda076936145d42c5a3e3c1378ef3cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pLsLVomeU3-2OAQr8kBu7g.png"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">The ‘Bytecode’ generated by Remix is a JSON file.</figcaption></figure><p id="21bc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这个问题乍一看可能会令人困惑，但是让我们搞清楚:字节码是一个很大的十六进制数，这是EVM机器码。Remix还显示了<em class="lc">操作码</em>，这是从字节码转换而来的汇编代码。虽然看到契约生成的操作码很有趣，但它们并不是发布所必需的。发布合同就是在事务中把字节码发送给区块链。</p><p id="6b8d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这正是我们在Remix中使用部署选项时所做的。它写给我们一个事务，其中事务数据包括字节码，这个事务被发送到网络中的一个节点。在Remix自己测试局域网的情况下，节点就是Remix本身。</p><blockquote class="mc md me"><p id="e149" class="jb jc lc jd b je jf jg jh ji jj jk jl mf jn jo jp mg jr js jt mh jv jw jx jy hm dt translated">交易新手？尝试<a class="ae ld" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae ld" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote><h1 id="d828" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">史前古器物</h1><p id="41f2" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">工件是帮助描述软件架构的副产品。当我们在Remix中构建智能契约时，它会生成一个工件，保存在名为<em class="lc">contracts/artifacts/build-info</em>的文件夹中。这可以从下图中看出。</p><figure class="lf lg lh li fq iu fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/f1140c808758e947c3fe71798b4a4e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*Pu1pgZ-gKdYzv8zWNwKTHA.png"/></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Artifacts generated by Remix.</figcaption></figure><p id="9c16" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">生成了两个文件:<em class="lc">hello world _ metadata . JSON</em>和<em class="lc"> HelloWorld.json </em>。两者不仅包含关于契约的信息，还包含关于编译器的信息。同一个契约，用不同版本的<em class="lc"> solc </em>编译，可以生成不同的字节码，所以要知道用的是哪个版本的编译器。</p><p id="6bbe" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">其他面向Solidity的开发环境，比如<strong class="jd hu">松露</strong>和<strong class="jd hu">安全帽</strong>，也生成自己的工件。它们不一定相同，但是它们都包含字节码和ABI。它们是发布和与合同交互所需的信息。</p><p id="a680" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们应该注意的一个问题是，Remix(以及其他ide)通常会生成两个字节码。Remix称它们为<em class="lc">字节码</em>和<em class="lc">‘部署的字节码’</em>。虽然它们是相关的，但它们并不相同。</p><p id="aa14" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="lc">字节码</em>是在合同创建时，在事务中发送到网络的代码。<em class="lc">部署的字节码</em>(其他ide使用不同的命名法)是实际写入区块链的代码。</p><p id="dc6c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">它们之间的区别在于，发送到区块链的代码除了包含将要保存的代码之外，还包含一个初始代码，该代码将在部署时执行。执行后，初始代码被丢弃。</p><p id="1f53" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">字节码将总是比部署的字节码大，并且将包含它。我们可以在下图中看到这一点。我在记事本上复制了这两个字节码。上面，我们有字节码，用一个空行隔开，是部署的字节码。蓝色部分是字节码中与部署的字节码完全相同的部分。字节码的初始部分(没有用蓝色标记)将在部署时执行，然后被丢弃。</p><figure class="lf lg lh li fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mj"><img src="../Images/c9e1a7a3cc1b4383277fe247e0e8dbfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XkbCmWmVXbRqbQx8kdF86g.png"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">The bytecode and the deployed Bytecode.</figcaption></figure><p id="f7ab" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">感谢阅读！</strong></p><blockquote class="mk"><p id="b0aa" class="ml mm ht bd mn mo mp mq mr ms mt jy ek translated">加入Coinmonks <a class="ae ld" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae ld" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h1 id="6000" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk mu km kn ko mv kq kr ks mw ku kv kw dt translated">另外，阅读</h1><ul class=""><li id="c25c" class="mx my ht jd b je kx ji ky jm mz jq na ju nb jy nc nd ne nf dt translated"><a class="ae ld" href="https://coincodecap.com/okex-kucoin" rel="noopener ugc nofollow" target="_blank"> OKEx vs KuCoin </a> | <a class="ae ld" href="https://coincodecap.com/celsius-alternatives" rel="noopener ugc nofollow" target="_blank">摄氏替代品</a> | <a class="ae ld" href="https://coincodecap.com/buy-vechain" rel="noopener ugc nofollow" target="_blank">如何购买VeChain </a></li><li id="760b" class="mx my ht jd b je ng ji nh jm ni jq nj ju nk jy nc nd ne nf dt translated"><a class="ae ld" href="https://coincodecap.com/profitfarmers-review" rel="noopener ugc nofollow" target="_blank"> ProfitFarmers回顾</a> | <a class="ae ld" href="https://coincodecap.com/cornix-trading-bot" rel="noopener ugc nofollow" target="_blank">如何使用Cornix Trading Bot </a></li><li id="8226" class="mx my ht jd b je ng ji nh jm ni jq nj ju nk jy nc nd ne nf dt translated"><a class="ae ld" href="https://coincodecap.com/buy-bitcoin-anonymously" rel="noopener ugc nofollow" target="_blank">如何匿名购买比特币</a> | <a class="ae ld" href="https://coincodecap.com/bitcoin-cash-wallets" rel="noopener ugc nofollow" target="_blank">比特币现金钱包</a></li><li id="5dbe" class="mx my ht jd b je ng ji nh jm ni jq nj ju nk jy nc nd ne nf dt translated"><a class="ae ld" href="https://coincodecap.com/wazirx-nft-review" rel="noopener ugc nofollow" target="_blank">瓦济里克斯NFT评论</a> | <a class="ae ld" href="https://coincodecap.com/bitsgap-vs-pionex" rel="noopener ugc nofollow" target="_blank">比茨盖普vs皮奥克斯</a> | <a class="ae ld" href="https://coincodecap.com/tangem-wallet-review" rel="noopener ugc nofollow" target="_blank">坦吉姆评论</a></li><li id="44d3" class="mx my ht jd b je ng ji nh jm ni jq nj ju nk jy nc nd ne nf dt translated"><a class="ae ld" href="https://coincodecap.com/create-a-dapp-on-ethereum-using-solidity" rel="noopener ugc nofollow" target="_blank">如何使用Solidity在以太坊上创建DApp？</a></li></ul></div></div>    
</body>
</html>