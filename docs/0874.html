<html>
<head>
<title>Learn Solidity lesson 4. Functions and transactions.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习第四课的可靠性。功能和事务。</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/learn-solidity-lesson-4-functions-and-transactions-9ef4214766df?source=collection_archive---------4-----------------------#2022-07-18">https://medium.com/coinmonks/learn-solidity-lesson-4-functions-and-transactions-9ef4214766df?source=collection_archive---------4-----------------------#2022-07-18</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/bbfcc0a21fa72bf37ba1c6f9b3ba94d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ch8RyTYG6PLnm9jGAybAag.jpeg"/></div></div></figure><p id="b7f2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在编程中，函数有多种用途。一种是简单地将一组语句聚合到一个代码块中。在EVM，函数扮演着比简单的语句集合更重要的角色。</p><p id="82a1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">并不是每个函数都会改变区块链的状态，但是如果我们想要进行任何状态改变，这样的改变必须在函数内部进行。</p><p id="6be3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">对区块链的事务可以请求执行一个函数，传递它的参数。一个事务可以只要求执行一个函数，但是函数可以调用其他函数，从而生成一系列请求。</p><p id="6147" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们在代码中看到这一点。向契约<em class="jz"> HelloWorld </em>添加一个函数，如下所示。</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="fae3" class="kj kk ht kf b fv kl km l kn ko">function setName(string memory _name) public {<br/>    name = _name;<br/>}</span></pre><p id="647b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">完整的合同可以在下图中看到。我们先从理解函数开始，然后理解函数和一个事务的关系。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff kp"><img src="../Images/67b6f38d60d12052e449e9759c2b3fa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*9vyvDiPWr56WkExI5n30Xg.png"/></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">The full HelloWorld contract.</figcaption></figure><p id="8c03" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了在Solidity中声明一个函数，我们从关键字<strong class="jd hu"> function </strong>开始，后面是函数名。在括号中，我们定义了它的参数。在我们的例子中，函数只有一个参数，类型为<em class="jz">字符串</em>，名为<em class="jz"> _name </em>。在类型和名字之间，我们找到另一个关键词，<strong class="jd hu">内存</strong>。很快我们将看到使用这个关键字的原因，现在只需理解它是强制的，如果不包含它，编译器将抛出一个错误。</p><p id="804b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">函数名及其参数定义了<strong class="jd hu">函数签名</strong>。之后，我们声明它的可见性，在本例中是<strong class="jd hu"> public </strong>。函数可以有四种可见性，<strong class="jd hu">公共</strong>、<strong class="jd hu">外部</strong>、<strong class="jd hu">内部</strong>或<strong class="jd hu">私有</strong>。我们很快会看到更多。可以从契约内部或外部访问公共函数。</p><p id="9669" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">函数体必须用大括号{ }括起来。在我们的示例中，函数体中只有一条语句，它将状态变量<em class="jz"> name </em>更改为通过参数<em class="jz"> _name </em>传递给函数的值。</p><p id="e954" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">函数可以返回值，但是在我们的例子中，函数不返回值。因此，没有必要定义退货。</p><blockquote class="ku kv kw"><p id="8f40" class="jb jc jz jd b je jf jg jh ji jj jk jl kx jn jo jp ky jr js jt kz jv jw jx jy hm dt translated">交易新手？尝试<a class="ae la" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae la" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote><h1 id="2e92" class="lb kk ht bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">处理</h1><p id="ac6d" class="pw-post-body-paragraph jb jc ht jd b je ly jg jh ji lz jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">以太坊可以看做是通过交易改变状态的机器。让我们用我们的例子来理解这种行为。在其中，只有一个状态变量，<em class="jz"> name </em>。如果我们想改变这种状态，我们发送一个事务。该事务调用函数<em class="jz"> setName </em>，该函数改变状态变量<em class="jz"> name </em>。</p><p id="17f2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">虽然我们的例子非常简单，但它完美地总结了以太坊的工作方式。我们在契约中定义状态变量，以及改变这些状态变量的函数。然后，通过事务，我们调用这些函数，这些函数的目的是改变这样的状态变量(也有可能间接改变其他契约的状态)。</p><p id="e134" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这个想法在以太坊的黄皮书中表达的很清楚，如下图所示。以太坊虚拟机在名为sigma的状态下运行，通过名为T的事务，生成一个新的sigma状态。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff md"><img src="../Images/a9e8969988e3678e52d1d329e4734aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*sZPpGxaDLRAFdDp5XAxlog.png"/></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">An excerpt from Ethereum’s yellow paper.</figcaption></figure><p id="a0ec" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们保存新合同并将其部署到Remix，就像我们之前所做的那样，单击<em class="jz"> Deploy </em>按钮。当展开契约时，现在注意到出现了一个新按钮，<em class="jz"> setName </em>，如下图所示。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff me"><img src="../Images/0787fd889f093fe28e7d462c228a7db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*59vnWQMZBGTfpo-V_wKmNA.png"/></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">The function <em class="mf">setName</em> can be executed using Remix.</figcaption></figure><p id="f419" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要执行此功能，只需在输入字段中插入一个字符串，即带有占位符<em class="jz"> string_name </em>的字符串，然后单击<em class="jz"> setName </em>。按钮为橙色表示将生成一个交易并发送给合同。让我们插入一些值并执行函数。</p><p id="5f15" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">请注意，在屏幕底部，将会出现一个新的交易。如果一切顺利，将会显示绿色标志，如下图所示。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/cb6d0bdb455d55dd865d1df9614c7810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zji5DqmZMRyFQDGLki9Jew.png"/></div></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">A transaction has been executed.</figcaption></figure><p id="ea8e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">除了事务被成功执行的信息之外，Remix还为我们带来了关于它的几个细节。在整个课程中，我们将更好地理解这些细节。现在，让我们仔细看看区块链是如何工作的。</p><p id="33f7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">区块链是一个大的交易分类账。每个区块链块相当于这个分类账的一页，我们在其中记录一定数量的交易。这种块以一种使其防篡改的方式连接。</p><p id="1180" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们执行的交易就像在分类账中写下类似于“<em class="jz">将变量名改为【新名称】</em>”的内容。在接收到该事务时，EVM改变数据库中变量<em class="jz"> name </em>的值。如果我们把以太坊想象成一家银行，区块链就是分类账，状态变量就是每个账户的金库，而EVM就是负责做出所需变更的员工。</p><p id="59dd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这给我们留下了一个问题:谁要求这样的交易？</p><h1 id="5a0a" class="lb kk ht bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx dt translated">再混合账户</h1><p id="5b6c" class="pw-post-body-paragraph jb jc ht jd b je ly jg jh ji lz jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">每笔交易都有一个发件人账户。Remix有10个预先创建的账户，可以在<em class="jz">部署&amp;运行交易</em>页签中看到，如下图所示。提交交易时，我们必须选择一个帐户，默认情况下，第一个帐户已经选定。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff mh"><img src="../Images/3001a1a99b3766556dbc8d8cfddd0bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*5zmJrVA3YBSAe96dTpceFQ.png"/></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">Remix has some pre-created accounts.</figcaption></figure><p id="2aee" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">以太坊上的账户由一个地址表示，这个地址是一个20字节的十六进制数。与帐户一起，Remix指示以太中的余额。上图显示第一个账户，<em class="jz"> 0x5B3… </em>的余额为99.9999…乙醚。</p><p id="05e3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">默认情况下，混合账户有100个醚的余额。为什么提到的账号现在在100醚以下？因为它必须付费才能将交易发送到以太坊。每笔交易都要交一笔费用，燃气费，后面会进一步解释。</p><p id="a388" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">事务有两个非排他性的目的:将本地货币(在本例中是乙醚)发送到其他帐户，或者调用合同中的某个功能。可以在对合同调用函数的同时向合同发送货币。</p><p id="05ad" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们很快会谈到更多关于帐户的内容，但现在我只想说明，交易是通过帐户发送的。我们使用Remix创建的帐户向契约发送一个事务，调用函数<em class="jz"> setName </em>，传递值“Hello Me！”作为它的参数。</p><p id="5aab" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">成功执行事务后，我们现在可以调用变量<em class="jz">名称</em>，并看到它已经被更改，如下图所示。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/630b1afd84a9c36870f93a463e7bbb40.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*K-7z1vmBvmZK5_VgBnX0GA.png"/></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">The state variable has been changed by the transaction.</figcaption></figure><p id="b10a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我想强调的是，电话不需要通过帐户发送，因为它们不会改变区块链的状态。因此，他们可以是匿名的，没有必要进行任何形式的支付。</p><p id="e8ed" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">感谢阅读！</strong></p></div></div>    
</body>
</html>